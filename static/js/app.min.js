!function(a,b,c,d,e){"use strict";function f(){this.ie=/msie/.test(navigator.userAgent.toLowerCase())&&!b.opera,this.ie8AndBelow=this.ie&&this.getIeVersion()<=8,this.ie9AndBelow=this.ie&&this.getIeVersion()<=9,this.opera=!!b.opera,this.firefox=/firefox/.test(navigator.userAgent.toLowerCase()),this.chrome=/chrome/.test(navigator.userAgent.toLowerCase())}function g(){this.sUrl="?/Ajax/",this.aRequests=[]}function h(){var c=a(b);this.resizeAll=_.debounce(function(){c.resize()},100),this.defaultScreen=_b.Screens.Mailbox,this.currentScreen=_b.Screens.Mailbox,this.lastMailboxRouting="",this.lastHelpdeskRouting=_b.Screens.Helpdesk,this.currentHash="",this.previousHash=""}function i(){}function j(){this.replyText=c.observable(""),this.replyDraftUid=c.observable(""),this.replyCc=c.observable(""),this.replyBcc=c.observable(""),this.postponedMailData=null}function k(){this.prefetchStarted=c.observable(!1),this.init()}function l(b,d,e,f,g,h,i,j,k,l){this.fBeforeSelectCallback=null,this.fSelectCallback=d||function(){},this.fDeleteCallback=e||function(){},this.fDblClickCallback=f||function(){},this.fEnterCallback=g||function(){},this.bResetCheckedOnClick=ac.isUnd(i)?!1:!!i,this.bCheckOnSelect=ac.isUnd(j)?!1:!!j,this.bUnselectOnCtrl=ac.isUnd(k)?!1:!!k,this.bDisableMultiplySelection=ac.isUnd(l)?!1:!!l,this.useKeyboardKeys=c.observable(!1),this.list=c.observableArray([]),b&&b.subscribe&&b.subscribe(function(a){this.list(a)},this),this.multiplyLineFactor=h,this.oLast=null,this.oListScope=null,this.oScrollScope=null,this.iTimer=0,this.iFactor=1,this.KeyUp=_b.Key.Up,this.KeyDown=_b.Key.Down,this.KeyLeft=_b.Key.Up,this.KeyRight=_b.Key.Down,this.multiplyLineFactor&&(this.multiplyLineFactor.subscribe?this.multiplyLineFactor.subscribe(function(a){this.iFactor=a>0?a:1},this):this.iFactor=ac.pInt(this.multiplyLineFactor),this.KeyUp=_b.Key.Up,this.KeyDown=_b.Key.Down,this.KeyLeft=_b.Key.Left,this.KeyRight=_b.Key.Right,a("html").hasClass("rtl")&&(this.KeyLeft=_b.Key.Right,this.KeyRight=_b.Key.Left)),this.sActionSelector="",this.sSelectabelSelector="",this.sCheckboxSelector="";var m=this;this.listChecked=c.computed({read:function(){var a=_.filter(this.list(),function(a){var b=a.checked(),c=a.selected();return b||m.bCheckOnSelect&&c});return a},write:function(a){a=!!a,_.each(this.list(),function(b){b.checked(a)}),this.list.valueHasMutated()},owner:this}),this.checkAll=c.computed({read:function(){return 0<this.listChecked().length},write:function(a){this.listChecked(!!a)},owner:this}),this.selectorHook=c.observable(null),this.selectorHook.subscribe(function(){var a=this.selectorHook();a&&a.selected(!1)},this,"beforeChange"),this.selectorHook.subscribe(function(a){a&&a.selected(!0)},this),this.itemSelected=c.computed({read:this.selectorHook,write:function(a){this.selectorHook(a),a&&(this.oLast=a)},owner:this}),this.list.subscribe(function(a){if(_.isArray(a)){var b=this.itemSelected();b&&(_.find(a,function(a){return b===a})||this.itemSelected(null))}else this.itemSelected(null)},this),this.listCheckedOrSelected=c.computed({read:function(){var a=this.itemSelected(),b=this.listChecked();return 0<b.length?b:a?[a]:[]},write:function(a){a?this.listChecked(!0):(this.itemSelected(null),this.listChecked(!1))},owner:this}),this.listCheckedAndSelected=c.computed({read:function(){var a=[],b=this.itemSelected(),c=this.listChecked();return c&&(a=c.slice(0)),b&&-1===_.indexOf(c,b)&&a.push(b),a},write:function(a){a?this.listChecked(!0):(this.itemSelected(null),this.listChecked(!1))},owner:this}),this.isIncompleteChecked=c.computed(function(){var a=this.list().length,b=this.listChecked().length;return a>0&&b>0&&a>b},this),this.onKeydownBinded=_.bind(this.onKeydown,this)}function m(){}function n(){Data.init()}function o(){this.provider=null,this.phoneReport=c.observable("Not connected"),this.action=c.observable("offline"),this.timerValue=c.observable(""),this.voiceApp=c.observable(!1),this.reconnectInterval=0,this.timerInterval=0}function p(){this.phone=cc.Phone,this.voiceApp=cc.Phone.voiceApp,this.phoneReport=cc.Phone.phoneReport,this.action=cc.Phone.action,this.stack=c.observable(null),this.registerSession=c.observable(null),this.callSession=c.observable(null),this.stackConf=c.observable(null),this.registerConf=c.observable(null),this.hangupConf=c.observable(null),this.hasFatalError=c.observable(!1),this.isStarted=c.observable(!1),this.eventSessionBinded=this.eventSession.bind(this),this.createStackErrorBinded=this.createStackError.bind(this),this.createStackBinded=this.createStack.bind(this),this.audioRemote=document.getElementById("audio_remote"),this.interval=0,this.setConfigs(),this.init()}function q(){this.flash=null,this.jqFlash=null,this.phone=cc.Phone,this.voiceApp=cc.Phone.voiceApp,this.phoneReport=cc.Phone.phoneReport,this.action=cc.Phone.action,this.voiceImpi=ec.User.VoiceImpi,this.voicePassword=ec.User.VoicePassword,this.sessionid=c.observable(""),this.callState=c.observable(""),this.initStatus=c.observable(!1),this.connectStatus=c.observable(!1),this.init()}function r(){this.device=null,this.connection=null,this.phone=cc.Phone,this.voiceApp=cc.Phone.voiceApp,this.phoneReport=cc.Phone.phoneReport,this.init()}function s(){this.alertDesc=c.observable(""),this.closeCallback=null,this.title=c.observable(""),this.okButtonText=c.observable(ac.i18n("MAIN/BUTTON_OK"))}function t(){this.fConfirmCallback=null,this.confirmDesc=c.observable(""),this.title=c.observable(""),this.okButtonText=c.observable(ac.i18n("MAIN/BUTTON_OK")),this.cancelButtonText=c.observable(ac.i18n("MAIN/BUTTON_CANCEL"))}function u(){this.fCallback=null,this.editedAccountId=ec.Accounts.editedId,this.loading=c.observable(!1),this.friendlyName=c.observable(""),this.email=c.observable(""),this.incomingMailLogin=c.observable(""),this.incLoginFocused=c.observable(!1),this.incLoginFocused.subscribe(function(){this.incLoginFocused()&&""===this.incomingMailLogin()&&this.incomingMailLogin(this.email())},this),this.incomingMailPassword=c.observable(""),this.incomingMailPort=c.observable(143),this.incomingMailServer=c.observable(""),this.outgoingMailLogin=c.observable(""),this.outgoingMailPassword=c.observable(""),this.outgoingMailPort=c.observable(25),this.outgoingMailServer=c.observable(""),this.outServerFocused=c.observable(!1),this.outServerFocused.subscribe(function(){this.outServerFocused()&&""===this.outgoingMailServer()&&this.outgoingMailServer(this.incomingMailServer())},this),this.useSmtpAuthentication=c.observable(!0),this.friendlyNameFocus=c.observable(!1),this.isFirstStep=c.observable(!0)}function v(){this.oIdentityPropertiesViewModel=new Sb(this,!0)}function w(){this.defaultAccountId=ec.Accounts.defaultId,this.loading=c.observable(!1),this.incomingMailServer=c.observable(""),this.incomingMailPort=c.observable(110),this.incomingMailLogin=c.observable(""),this.incomingMailPassword=c.observable(""),this.folderList=cc.MailCache.folderList,this.options=c.computed(function(){return this.folderList().getOptions(void 0,!0)},this),this.addNewFolderCommand=ac.createCommand(this,this.onAddNewFolderClick),this.folder=c.observable(""),this.outgoingMailServer=c.observable(""),this.outgoingMailPort=c.observable(25),this.leaveMessagesOnServer=c.observable(!1),this.useSmtpAuthentication=c.observable(!1),this.serverIsSelected=c.observable(!1),this.loginIsSelected=c.observable(!1),this.passwordIsSelected=c.observable(!1),this.defaultOptionsAfterRender=ac.defaultOptionsAfterRender}function x(){this.folders=c.observable(null),this.options=c.computed(function(){return this.folders()?this.folders().getOptions(ac.i18n("SETTINGS/ACCOUNT_FOLDERS_NO_USAGE_ASSIGNED")):[]},this),this.sSentFolderOld="",this.sDraftFolderOld="",this.sSpamFolderOld="",this.sTrashFolderOld="",this.sentFolderFullName=c.observable(""),this.draftsFolderFullName=c.observable(""),this.spamFolderFullName=c.observable(""),this.trashFolderFullName=c.observable(""),this.sentFolderFullName.subscribe(function(a){!ac.isUnd(a)&&this.folders()&&this.folders().sentFolderFullName(a)},this),this.draftsFolderFullName.subscribe(function(a){!ac.isUnd(a)&&this.folders()&&this.folders().draftsFolderFullName(a)},this),this.spamFolderFullName.subscribe(function(a){!ac.isUnd(a)&&this.folders()&&this.folders().spamFolderFullName(a)},this),this.trashFolderFullName.subscribe(function(a){!ac.isUnd(a)&&this.folders()&&this.folders().trashFolderFullName(a)},this),this.defaultOptionsAfterRender=ac.defaultOptionsAfterRender,this.allowSpamFolderExtension=c.computed(function(){var a=ec.Accounts.getEdited();return a.extensionExists("AllowSpamFolderExtension")},this)}function y(){this.folders=cc.MailCache.editedFolderList,this.loading=c.observable(!1),this.options=c.computed(function(){return this.folders().getOptions(ac.i18n("SETTINGS/ACCOUNT_FOLDERS_NO_PARENT"),!0,!1,!0)},this),this.namespace=c.computed(function(){return this.folders().sNamespaceFolder},this),this.parentFolder=c.observable(""),this.folderName=c.observable(""),this.folderNameFocus=c.observable(!1),this.defaultOptionsAfterRender=ac.defaultOptionsAfterRender}function z(){this.currentPassword=c.observable(""),this.newPassword=c.observable(""),this.confirmPassword=c.observable(""),this.isHelpdesk=c.observable(!1)}function A(){this.fCallback=null,this.folderName=c.observable(""),this.folderNameFocus=c.observable(!1)}function B(){this.fCallback=null,this.item=c.observable(null),this.name=c.observable(""),this.nameFocus=c.observable(!1)}function C(){this.item=null,this.pub=c.observable(""),this.pubFocus=c.observable(!1)}function D(){this.fCallback=null,this.calendarId=c.observable(null),this.calendarName=c.observable(""),this.calendarDescription=c.observable(""),this.calendarNameFocus=c.observable(!1),this.calendarDescriptionFocus=c.observable(!1),this.colors=c.observableArray([]),this.selectedColor=c.observable(this.colors()[0])}function E(){this.defaultAccount=ec.Accounts.getDefault(),this.fCallback=null,this.calendarId=c.observable(null),this.selectedColor=c.observable(""),this.calendarUrl=c.observable(""),this.exportUrl=c.observable(""),this.icsLink=c.observable(""),this.isPublic=c.observable(!1),this.shares=c.observableArray([]),this.oldShares=c.observableArray([]),this.owner=c.observable(""),this.recivedAnim=c.observable(!1).extend({autoResetToFalse:500}),this.whomAnimate=c.observable(""),this.shareAutocompleteItem=c.observable(null),this.shareAutocompleteItem.subscribe(function(a){a&&this.setGlobal(a.email,this.newShareList())},this),this.newShareList=c.observableArray([]),this.newShare=c.observable(""),this.newShareFocus=c.observable(!1),this.newShareAccess=c.observable(_b.CalendarAccess.Read),this.sharedToAll=c.observable(!1),this.sharedToAllAccess=c.observable(_b.CalendarAccess.Read),this.canAdd=c.observable(!1),this.aAccess=[{value:_b.CalendarAccess.Read,display:ac.i18n("CALENDAR/CALENDAR_ACCESS_READ")},{value:_b.CalendarAccess.Write,display:ac.i18n("CALENDAR/CALENDAR_ACCESS_WRITE")}],this.autocompleteCallbackBinded=_.bind(this.autocompleteCallback,this),this.showGlobalContacts=!!ec.User.ShowGlobalContacts}function F(){this.fCallback=null,this.calendarId=c.observable(null),this.selectedColor=c.observable(""),this.calendarUrl=c.observable(""),this.exportUrl=c.observable(""),this.icsLink=c.observable(""),this.isPublic=c.observable(!1),this.pubUrl=c.observable("")}function G(){this.defaultAccount=ec.Accounts?ec.Accounts.getDefault():null,this.modified=!1,this.isPublic=fc,this.isEditable=c.observable(!1),this.isEditableReminders=c.observable(!1),this.selectedCalendarIsShared=c.observable(!1),this.selectedCalendarIsEditable=c.observable(!1),this.callbackSave=null,this.callbackDelete=null,this.timeFormatMoment="HH:mm",this.dateFormatMoment="MM/DD/YYYY",this.dateFormatDatePicker="mm/dd/yy",this.calendarId=c.observable(null),this.id=c.observable(null),this.uid=c.observable(null),this.recurrenceId=c.observable(null),this.allEvents=c.observable(_b.CalendarEditRecurrenceEvent.AllEvents),this.isMyEvent=c.observable(!1),this.startDom=c.observable(null),this.endDom=c.observable(null),this.repeatEndDom=c.observable(null),this.yearlyDate=c.observable(""),this.monthlyDate=c.observable(""),this.subject=c.observable(""),this.description=c.observable(""),this.startDate=c.observable(""),this.startTime=c.observable(""),this.startTime.subscribe(function(){this.selectStartDate()},this),this.allDay=c.observable(!1),this.allDay.subscribe(function(a){a||this.setActualTime()},this),this.endDate=c.observable(""),this.endTime=c.observable(""),this.endTime.subscribe(function(){this.selectEndDate()},this),this.repeatEndDate=c.observable(""),this.isEvOneDay=c.observable(!0),this.isEvOneTime=c.observable(!0),this.isRepeat=c.observable(!1),this.location=c.observable(""),this.repeatPeriodOptions=c.observableArray(this.getDisplayedPeriods()),this.repeatWeekIntervalOptions=c.observableArray([1,2,3,4]),this.repeatMonthIntervalOptions=c.observableArray(this.getDisplayedIntervals()),this.alarmOptions=c.observableArray(this.getDisplayedAlarms([5,10,15,30,60,120,180,240,300,360,420,480,540,600,660,720,1080,1440,2880,4320,5760,10080,20160])),this.timeOptions=c.observableArray(this.getDisplayedTimes(ec.User.defaultTimeFormat()===_b.TimeFormat.F24?"HH:mm":"hh:mm A")),this.displayedAlarms=c.observableArray([]),this.displayedAlarms.subscribe(function(){this.disableAlarms()},this),this.excluded=c.observable(!1),this.repeatPeriod=c.observable(0),this.repeatPeriod.subscribe(function(a){this.isRepeat(!!a)},this),this.repeatInterval=c.observable(1),this.repeatEnd=c.observable(0),this.repeatCount=c.observable(null),this.repeatWeekNum=c.observable(null),this.weekDays=c.observable(!1),this.weekMO=c.observable(!1),this.weekTU=c.observable(!1),this.weekWE=c.observable(!1),this.weekTH=c.observable(!1),this.weekFR=c.observable(!1),this.weekSA=c.observable(!1),this.weekSU=c.observable(!1),this.appointment=c.observable(!1),this.attendees=c.observableArray([]),this.attenderStatus=c.observable(0),this.owner=c.observable(""),this.ownerName=c.observable(""),this.ownerDisplay=c.computed(function(){return""!==this.ownerName()?this.ownerName():this.owner()},this),this.recivedAnim=c.observable(!1).extend({autoResetToFalse:500}),this.whomAnimate=c.observable(""),this.guestAutocompleteItem=c.observable(null),this.guestAutocomplete=c.observable(""),this.guestEmailFocus=c.observable(!1),this.guestAutocomplete.subscribe(function(a){""===a&&this.guestAutocompleteItem(null)},this),this.condition=c.observable(""),this.autosizeTrigger=c.observable(!0),this.calendars=null,this.calendarsList=c.observableArray([]),this.calendarColor=c.observable(""),this.selectedCalendar=c.observable(""),this.selectedCalendarName=c.observable(""),this.selectedCalendar.subscribe(function(a){if(a){var b=this.calendars.getCalendarById(a);this.selectedCalendarName(b.name()),this.selectedCalendarIsShared(b.isShared()),this.selectedCalendarIsEditable(b.isEditable()),this.changeCalendarColor(a)}},this),this.subjectFocus=c.observable(!1),this.descriptionFocus=c.observable(!1),this.locationFocus=c.observable(!1),this.dateEdit=c.observable(!1),this.repeatEdit=c.observable(!1),this.guestsEdit=c.observable(!1),this.defaultOptionsAfterRender=ac.defaultOptionsAfterRender,this.isEditForm=c.computed(function(){return!!this.id()},this),this.callbackAttendeeActionDecline=null,this.calendarAppointments=ec.User.AllowCalendar&&ec.User.CalendarAppointments,this.allChanges=c.computed(function(){this.subject(),this.description(),this.location(),this.isRepeat(),this.allDay(),this.repeatPeriod(),this.repeatInterval(),this.repeatEnd(),this.repeatCount(),this.repeatWeekNum(),this.startDate(),this.startTime(),this.endDate(),this.endTime(),this.repeatEndDate(),this.displayedAlarms(),this.weekDays(),this.weekMO(),this.weekTU(),this.weekWE(),this.weekTH(),this.weekFR(),this.weekSA(),this.weekSU(),this.attendees(),this.selectedCalendar(),this.modified=!0},this)}function H(){this.fCallback=null,this.confirmDesc=ac.i18n("CALENDAR/EDIT_RECURRENCE_CONFIRM_DESCRIPTION"),this.onlyThisInstanceButtonText=c.observable(ac.i18n("CALENDAR/ONLY_THIS_INSTANCE")),this.allEventsButtonText=c.observable(ac.i18n("CALENDAR/ALL_EVENTS_IN_THE_SERIES")),this.cancelButtonText=c.observable(ac.i18n("MAIN/BUTTON_CANCEL"))}function I(){this.phone=cc.Phone,this.voiceApp=cc.Phone.voiceApp,this.phoneReport=cc.Phone.phoneReport,this.action=c.observable(""),this.phoneNumber=c.observable(""),this.callback=null}function J(){this.AllowUsersChangeInterfaceSettings=!0,this.AllowUsersChangeEmailSettings=!0,this.AllowUsersAddNewAccounts=!0,this.SiteName="",this.Languages=[{name:"English",value:"en"}],this.Themes=["Default"],this.DateFormats=[],this.DefaultLanguage="English",this.AttachmentSizeLimit=1024e4,this.ImageUploadSizeLimit=1024e4,this.FileSizeLimit=1024e4,this.AllowFetcher=!1,this.AutoSave=!0,this.AutoSaveIntervalSeconds=60,this.IdleSessionTimeout=0,this.AllowInsertImage=!0,this.AllowBodySize=!1,this.MaxBodySize=600,this.MaxSubjectSize=255,this.AllowPrefetch=!0,this.MaxPrefetchBodiesSize=5e4,this.LoginFormType=_b.LoginFormType.Email,this.LoginAtDomainValue="",this.DemoWebMail=!0,this.DemoWebMailLogin="",this.DemoWebMailPassword="",this.LoginDescription="",this.GoogleAnalyticsAccount="",this.ShowQuotaBar=!1,this.ServerUseUrlRewrite=!1,this.AllowLanguageOnLogin=!1,this.FlagsLangSelect=!1,this.CustomLoginUrl="",this.CustomLogoutUrl="",this.IosDetectOnLogin="",this.DefaultLanguageShort="en"}function K(){this.IdUser=1,this.MailsPerPage=20,this.ContactsPerPage=20,this.iInterval=-1,this.AutoCheckMailInterval=0,this.DefaultEditor=1,this.Layout=_b.MailboxLayout.Side,this.DefaultTheme="Default",this.DefaultLanguage="English",this.DefaultDateFormat="MM/DD/YYYY",this.defaultTimeFormat=c.observable(0),this.ThreadsEnabled=!0,this.useThreads=c.observable(!0),this.saveRepliedToCurrFolder=c.observable(!0),this.AllowCompose=!0,this.AllowReply=!0,this.AllowForward=!0,this.SaveMail=_b.SaveMail.Checked,this.OutlookSyncEnable=!0,this.MobileSyncEnable=!0,this.ShowPersonalContacts=!0,this.ShowGlobalContacts=!1,this.IsFilesSupported=!1,this.IsHelpdeskSupported=!1,this.IsHelpdeskAgent=!1,this.HelpdeskIframeUrl="",this.ShowContacts=this.ShowPersonalContacts||this.ShowGlobalContacts,this.LastLogin=0,this.IsDemo=!1,this.AllowVoice=!1,this.VoiceRealm="",this.VoiceWebsocketProxyUrl="",this.VoiceOutboundProxyUrl="",this.VoiceCallerID="",this.VoiceImpi="",this.VoiceImpu="",this.VoicePassword="",this.VoiceProvider="",this.AllowCalendar=!0,this.CalendarSharing=!1,this.CalendarAppointments=!1,this.CalendarShowWeekEnds=!1,this.CalendarShowWorkDay=!1,this.CalendarWorkDayStarts=0,this.CalendarWorkDayEnds=0,this.CalendarWeekStartsOn=0,this.CalendarDefaultTab=_b.CalendarDefaultTab.Month,this.needToReloadCalendar=c.observable(!1),this.mobileSync=c.observable(null),this.MobileSyncDemoPass="demo",this.outlookSync=c.observable(null),this.OutlookSyncDemoPass="demo",this.AllowHelpdeskNotifications=!1}function L(){this.id=c.observable(0),this.email=c.observable(""),this.extensions=c.observableArray([]),this.fetchers=c.observable(null),this.identities=c.observable(null),this.friendlyName=c.observable(""),this.incomingMailLogin=c.observable(""),this.incomingMailPort=c.observable(143),this.incomingMailServer=c.observable(""),this.isInternal=c.observable(!1),this.isLinked=c.observable(!1),this.isDefault=c.observable(!1),this.outgoingMailAuth=c.observable(0),this.outgoingMailLogin=c.observable(""),this.outgoingMailPort=c.observable(25),this.outgoingMailServer=c.observable(""),this.isExtended=c.observable(!1),this.signature=c.observable(null),this.autoresponder=c.observable(null),this.forward=c.observable(null),this.filters=c.observable(null),this.quota=c.observable(0),this.usedSpace=c.observable(0),this.fullEmail=c.computed(function(){return""===this.friendlyName()?this.email():this.friendlyName()+" <"+this.email()+">"},this),this.isCurrent=c.observable(!1),this.isEdited=c.observable(!1),this.extensionsRequested=c.observable(!1),this.removeHint=c.computed(function(){var a="",b="";return this.isDefault()?(ec.User.AllowCalendar&&ec.User.ShowContacts?a=ac.i18n("SETTINGS/ACCOUNTS_REMOVE_CONTACTS_CALENDARS_HINT"):ec.User.AllowCalendar?a=ac.i18n("SETTINGS/ACCOUNTS_REMOVE_CALENDARS_HINT"):ec.User.ShowContacts&&(a=ac.i18n("SETTINGS/ACCOUNTS_REMOVE_CONTACTS_HINT")),b=ac.i18n("SETTINGS/ACCOUNTS_REMOVE_DEFAULT_HINT",{AND_OTHER:a}),ec.Accounts.collection().length>1&&(b+=ac.i18n("SETTINGS/ACCOUNTS_REMOVE_DEFAULT_NOTSINGLE_HINT"))):b=ac.i18n("SETTINGS/ACCOUNTS_REMOVE_HINT"),b},this),this.removeConfirmation=c.computed(function(){return this.isDefault()?this.removeHint()+ac.i18n("SETTINGS/ACCOUNTS_REMOVE_DEFAULT_CONFIRMATION"):ac.i18n("SETTINGS/ACCOUNTS_REMOVE_CONFIRMATION")},this)}function M(){this.defaultId=c.observable(0),this.currentId=c.observable(0),this.editedId=c.observable(0),this.currentId.subscribe(function(a){var b=this.getCurrent();b.requestExtensions(),_.defer(_.bind(function(){this.editedId(a)},this))},this),this.collection=c.observableArray([])}function N(){this.sName="",this.sEmail=""}function O(){this.aCollection=[]}function P(){this.oMoment=null}function Q(){this.enabled=c.observable(!0),this.email=c.observable(""),this.friendlyName=c.observable(""),this.fullEmail=c.computed(function(){return""!==this.friendlyName()?this.friendlyName()+" <"+this.email()+">":this.email()},this),this.accountId=c.observable(-1),this.id=c.observable(-1),this.signature=c.observable(""),this.useSignature=c.observable(!0)}function R(){this.fileName=c.observable(""),this.tempName=c.observable(""),this.displayName=c.observable(""),this.extension=c.observable(""),this.fileName.subscribe(function(){var a=this.fileName(),b=a.lastIndexOf(".");this.displayName(a.substr(0,b)),this.extension(a.substr(b+1))},this),this.size=c.observable(0),this.friendlySize=c.computed(function(){return ac.friendlySize(this.size())},this),this.downloadTitle=c.computed(function(){return ac.i18n("MESSAGE/ATTACHMENT_CLICK_TO_DOWNLOAD",{FILENAME:this.fileName(),SIZE:this.friendlySize()})},this),this.accountId=c.observable(0),this.hash=c.observable(""),this.thumb=c.observable(!1),this.downloadLink=c.computed(function(){return ac.getDownloadLinkByHash(this.accountId(),this.hash())},this),this.viewLink=c.computed(function(){return ac.getViewLinkByHash(this.accountId(),this.hash())},this),this.viewThumbnailLink=c.computed(function(){var a=this.accountId(),b=this.hash();return this.thumb()?ac.getViewThumbnailLinkByHash(a,b):""},this),this.type=c.observable(""),this.uploadUid=c.observable(""),this.uploaded=c.observable(!1),this.uploadError=c.observable(!1),this.isViewMimeType=c.computed(function(){return-1!==a.inArray(this.type(),kc)},this),this.isMessageType=c.observable(!1),this.visibleViewLink=c.computed(function(){return this.isVisibleViewLink()},this),this.visibleExpandLink=c.observable(!1),this.visibleSpinner=c.observable(!1),this.statusText=c.observable(""),this.progressPercent=c.observable(0),this.visibleProgress=c.observable(!1),this.uploadStarted=c.observable(!1),this.uploadStarted.subscribe(function(){this.uploadStarted()?(this.uploaded(!1),this.visibleProgress(!0),this.progressPercent(20)):(this.progressPercent(100),this.visibleProgress(!1),this.uploaded(!0))},this)}function S(){this.folderName=c.observable(""),this.messageUid=c.observable(""),this.cid=c.observable(""),this.inline=c.observable(!1),this.linked=c.observable(!1),this.mimePartIndex=c.observable(""),this.messagePart=c.observable(null),R.call(this),this.isMessageType=c.computed(function(){return this.type(),this.mimePartIndex(),"message/rfc822"===this.type()&&""!==this.mimePartIndex()},this)}function T(){this.iAccountId=0,this.account=c.computed(function(){return ec.Accounts.getAccount(this.iAccountId)},this),this.parentFullName=c.observable(""),this.level=c.observable(0),this.name=c.observable(""),this.nameForEdit=c.observable(""),this.fullName=c.observable(""),this.fullNameHash=c.observable(),this.uidNext=c.observable(""),this.hash=c.observable(""),this.routingHash=c.observable(""),this.delimiter=c.observable(""),this.type=c.observable(_b.FolderTypes.User),this.showUnseenMessages=c.computed(function(){return this.type()!==_b.FolderTypes.Drafts},this),this.withoutThreads=c.computed(function(){return this.type()===_b.FolderTypes.Drafts||this.type()===_b.FolderTypes.Spam||this.type()===_b.FolderTypes.Trash},this),this.messageCount=c.observable(0),this.unseenMessageCount=c.observable(0),this.unseenMessageCount.subscribe(function(){_.delay(_.bind(function(){cc.MailCache.countMessages(this)},this),1e3)},this),this.realUnseenMessageCount=c.observable(0),this.enableEmptyFolder=c.computed(function(){return this.messageCount()>0&&(this.type()===_b.FolderTypes.Spam||this.type()===_b.FolderTypes.Trash)},this),this.virtual=c.observable(!1),this.virtualEmpty=c.computed(function(){return this.virtual()&&0===this.messageCount()},this),this.hasExtendedInfo=c.observable(!1),this.selectable=c.observable(!0),this.subscribed=c.observable(!0),this.subscribed.subscribe(function(){if(this.parentFullName()){var a=cc.MailCache.folderList().getFolderByFullName(this.parentFullName());a&&cc.MailCache.countMessages(a)}},this),this.existen=c.observable(!0),this.isNamespace=c.observable(!1),this.subfoldersMessagesCount=c.observable(0),this.subfolders=c.observableArray([]),this.subfolders.subscribe(function(a){var b=_.any(_.map(a,function(a){return a.subscribed()}));this.canExpand(b)},this),this.canExpand=c.observable(!0),this.expanded=c.observable(!1),this.isCollapseHandler=c.computed(function(){return 0!==this.subfolders().length&&!this.isNamespace()&&this.canExpand()},this),cc.MailCache.editedFolderList.subscribe(function(){},this),this.messageCountToShow=c.computed(function(){return this.canExpand()?this.showUnseenMessages()?this.unseenMessageCount()+this.subfoldersMessagesCount():this.messageCount():this.showUnseenMessages()?this.unseenMessageCount():this.messageCount()},this),this.isSubFolder=c.computed(function(){return this.level()>0},this),this.selected=c.observable(!1),this.recivedAnim=c.observable(!1).extend({autoResetToFalse:500}),this.hasSubscribedSubfolders=c.computed(function(){return!!c.utils.arrayFirst(this.subfolders(),function(a){return a.subscribed()})},this),this.isSystem=c.computed(function(){return this.type()!==_b.FolderTypes.User?!0:!1},this),this.visible=c.computed(function(){var a=this.subscribed(),b=this.existen(),c=this.selectable(),d=this.hasSubscribedSubfolders(),e=this.isSystem();return a||e||d&&(!b||!c)},this),this.edited=c.observable(!1),this.edited.subscribe(function(a){a===!1&&this.nameForEdit(this.name())},this),this.canBeSelected=c.computed(function(){var a=this.existen(),b=this.selectable();return a&&b},this),this.canSubscribe=c.computed(function(){var a=this.account(),b=!1;return a&&(b=a.extensionExists("DisableManageSubscribe")),!this.isSystem()&&this.canBeSelected()&&!b},this),this.canDelete=c.computed(function(){return!this.isSystem()&&this.hasExtendedInfo()&&0===this.messageCount()&&0===this.subfolders().length},this),this.canRename=c.computed(function(){return!this.isSystem()&&this.canBeSelected()},this),this.usedAs=c.computed(function(){var a="";switch(this.type()){case _b.FolderTypes.Inbox:a=ac.i18n("SETTINGS/ACCOUNT_FOLDERS_USED_AS_INBOX");break;case _b.FolderTypes.Sent:a=ac.i18n("SETTINGS/ACCOUNT_FOLDERS_USED_AS_SENT");break;case _b.FolderTypes.Drafts:a=ac.i18n("SETTINGS/ACCOUNT_FOLDERS_USED_AS_DRAFTS");break;case _b.FolderTypes.Trash:a=ac.i18n("SETTINGS/ACCOUNT_FOLDERS_USED_AS_TRASH");break;case _b.FolderTypes.Spam:a=ac.i18n("SETTINGS/ACCOUNT_FOLDERS_USED_AS_SPAM");break;default:a=""}return a},this),this.oMessages={},this.oUids={},this.aResponseHandlers=[],this.displayName=c.computed(function(){var a=this.name();switch(this.type()){case _b.FolderTypes.Inbox:a=ac.i18n("MAIN/FOLDER_INBOX");break;case _b.FolderTypes.Sent:a=ac.i18n("MAIN/FOLDER_SENT");break;case _b.FolderTypes.Drafts:a=ac.i18n("MAIN/FOLDER_DRAFTS");break;case _b.FolderTypes.Trash:a=ac.i18n("MAIN/FOLDER_TRASH");break;case _b.FolderTypes.Spam:a=ac.i18n("MAIN/FOLDER_SPAM")}return a},this),this.aRequestedUids=[],this.aRequestedThreadUids=[],this.requestedLists=[],this.hasChanges=c.observable(!1),this.hasChanges.subscribe(function(){this.requestedLists=[]},this)}function U(){this.iAccountId=0,this.bInitialized=c.observable(!1),this.collection=c.observableArray([]),this.options=c.observableArray([]),this.sNamespace="",this.sNamespaceFolder="",this.oStarredFolder=null,this.oNamedCollection={};var a=this,b=function(a){return function(b){b&&b.type(a)}},d=function(b){return{read:function(){return this.collection(),b()?b().fullName():""},write:function(a){b(this.getFolderByFullName(a))},owner:a}};this.totalMessageCount=c.computed(function(){return this.getRecursivelyMessageCount(this.collection())},this),this.currentFolder=c.observable(null),this.inboxFolder=c.observable(null),this.sentFolder=c.observable(null),this.draftsFolder=c.observable(null),this.spamFolder=c.observable(null),this.trashFolder=c.observable(null),this.inboxFolder.subscribe(b(_b.FolderTypes.User),this,"beforeChange"),this.sentFolder.subscribe(b(_b.FolderTypes.User),this,"beforeChange"),this.draftsFolder.subscribe(b(_b.FolderTypes.User),this,"beforeChange"),this.spamFolder.subscribe(b(_b.FolderTypes.User),this,"beforeChange"),this.trashFolder.subscribe(b(_b.FolderTypes.User),this,"beforeChange"),this.inboxFolder.subscribe(b(_b.FolderTypes.Inbox)),this.sentFolder.subscribe(b(_b.FolderTypes.Sent)),this.draftsFolder.subscribe(b(_b.FolderTypes.Drafts)),this.spamFolder.subscribe(b(_b.FolderTypes.Spam)),this.trashFolder.subscribe(b(_b.FolderTypes.Trash)),this.inboxFolderFullName=c.computed(d(this.inboxFolder)),this.sentFolderFullName=c.computed(d(this.sentFolder)),this.draftsFolderFullName=c.computed(d(this.draftsFolder)),this.spamFolderFullName=c.computed(d(this.spamFolder)),this.trashFolderFullName=c.computed(d(this.trashFolder)),this.currentFolderFullName=c.computed(d(this.currentFolder)),this.currentFolderType=c.computed(function(){return this.currentFolder()?this.currentFolder().type():_b.FolderTypes.User},this),this.delimiter=c.computed(function(){return this.inboxFolder()?this.inboxFolder().delimiter():""},this)}function V(){this.accountId=c.observable(0),this.folder=c.observable(""),this.uid=c.observable(""),this.subject=c.observable(""),this.emptySubject=c.computed(function(){return""===ac.trim(this.subject())},this),this.subjectForDisplay=c.computed(function(){return this.emptySubject()?ac.i18n("MAILBOX/EMPTY_SUBJECT"):this.subject()},this),this.messageId=c.observable(""),this.size=c.observable(0),this.friendlySize=c.computed(function(){return ac.friendlySize(this.size())},this),this.textSize=c.observable(0),this.oDateModel=new P,this.fullDate=c.observable(""),this.oFrom=new O,this.fullFrom=c.observable(""),this.oTo=new O,this.to=c.observable(""),this.fromOrToText=c.observable(""),this.oCc=new O,this.cc=c.observable(""),this.oBcc=new O,this.bcc=c.observable(""),this.oSender=new O,this.oReplyTo=new O,this.seen=c.observable(!1),this.flagged=c.observable(!1),this.answered=c.observable(!1),this.forwarded=c.observable(!1),this.hasAttachments=c.observable(!1),this.threadsAllowed=c.computed(function(){var a=cc.MailCache.getFolderByFullName(this.accountId(),this.folder()),b=a&&(a.type()===_b.FolderTypes.Drafts||a.type()===_b.FolderTypes.Spam||a.type()===_b.FolderTypes.Trash);return ec.User.useThreads()&&!b},this),this.threadPart=c.observable(!1),this.threadUids=c.observableArray([]),this.threadCount=c.computed(function(){return this.threadUids().length},this),this.threadUnreedCount=c.observable(0),this.threadOpened=c.observable(!1),this.threadLoading=c.observable(!1),this.threadLoadingVisible=c.computed(function(){return this.threadsAllowed()&&this.threadOpened()&&this.threadLoading()},this),this.threadCountVisible=c.computed(function(){return this.threadsAllowed()&&this.threadCount()>0&&!this.threadLoading()},this),this.threadCountForLoad=c.observable(5),this.threadNextLoadingVisible=c.observable(!1),this.threadNextLoadingLinkVisible=c.observable(!1),this.threadFunctionLoadNext=null,this.threadShowAnimation=c.observable(!1),this.threadHideAnimation=c.observable(!1),this.importance=c.observable(_b.Importance.Normal),this.draftInfo=c.observableArray([]),this.sensitivity=c.observable(_b.Sensivity.Nothing),this.hash=c.observable(""),this.downloadLink=c.computed(function(){return this.hash().length>0?ac.getDownloadLinkByHash(this.accountId(),this.hash()):""
},this),this.completelyFilled=c.observable(!1),this.checked=c.observable(!1),this.checked.subscribe(function(a){if(!this.threadOpened()){var b=cc.MailCache.folderList().getFolderByFullName(this.folder());_.each(this.threadUids(),function(c){var d=b.oMessages[c];d&&d.checked(a)})}},this),this.selected=c.observable(!1),this.deleted=c.observable(!1),this.inReplyTo=c.observable(""),this.references=c.observable(""),this.readingConfirmation=c.observable(""),this.isPlain=c.observable(!1),this.text=c.observable(""),this.textBodyForNewWindow=c.observable(""),this.$text=null,this.rtl=c.observable(!1),this.hasExternals=c.observable(!1),this.isExternalsShown=c.observable(!1),this.isExternalsAlwaysShown=c.observable(!1),this.foundedCids=c.observableArray([]),this.attachments=c.observableArray([]),this.usesAttachmentString=!1,this.allAttachmentsHash="",this.safety=c.observable(!1),this.ical=c.observable(null),this.vcard=c.observable(null),this.domMessageForPrint=c.observable(null),this.Custom={}}function W(){this.resultCount=c.observable(-1),this.search=c.observable(""),this.filters=c.observable(""),this.collection=c.observableArray([]),this.threadUids={}}function X(){this.uid=c.observable(""),this.uid.subscribe(function(){""!==this.uid()&&"0"!==this.uid()&&cc.CalendarCache.addIcal(this)},this),this.file=c.observable(""),this.type=c.observable(""),this.icalType=c.observable(""),this.icalConfig=c.observable(""),this.type.subscribe(function(){var a=this.type().split("-"),b=a.shift(),c=_.find(_b.IcalType,function(a){return b===a},this),d=a.join("-"),e=_.find(_b.IcalConfig,function(a){return d===a},this);b!==c&&(b=_b.IcalType.Save),this.icalType(b),d!==e&&(d=_b.IcalConfig.NeedsAction),this.icalConfig(d)},this),this.isRequestType=c.computed(function(){return this.icalType()===_b.IcalType.Request},this),this.isCancelType=c.computed(function(){return this.icalType()===_b.IcalType.Cancel},this),this.cancelDecision=c.observable(""),this.isReplyType=c.computed(function(){return this.icalType()===_b.IcalType.Reply},this),this.replyDecision=c.observable(""),this.isSaveType=c.computed(function(){return this.icalType()===_b.IcalType.Save},this),this.isJustSaved=c.observable(!1),this.fillDecisions(),this.isAccepted=c.computed(function(){return this.icalConfig()===_b.IcalConfig.Accepted},this),this.isDeclined=c.computed(function(){return this.icalConfig()===_b.IcalConfig.Declined},this),this.isTentative=c.computed(function(){return this.icalConfig()===_b.IcalConfig.Tentative},this),this.location=c.observable(""),this.description=c.observable(""),this.when=c.observable(""),this.calendarId=c.observable(""),this.calendars=c.computed(function(){return _.filter(cc.CalendarCache.calendars(),function(a){return a.canEdit})},this),this.selectedCalendar=c.observable(""),this.chosenCalendarName=c.computed(function(){var a=null;return""!==this.calendarId()&&(a=_.find(this.calendars(),function(a){return a.id===this.calendarId()},this)),a?a.name:""},this),this.calendarIsChosen=c.computed(function(){return""!==this.chosenCalendarName()},this),this.visibleCalendarDropdown=c.computed(function(){return!this.calendarIsChosen()&&this.calendars().length>1&&(this.isRequestType()||this.isSaveType())},this),this.visibleCalendarName=c.computed(function(){return this.calendarIsChosen()},this),this.visibleFirstCalendarName=c.computed(function(){return 1===this.calendars().length&&!this.calendarIsChosen()},this),this.visibleCalendarRow=c.computed(function(){return this.visibleCalendarDropdown()||this.visibleCalendarName()||this.visibleFirstCalendarName()},this),this.animation=c.observable(!1)}function Y(){this.uid=c.observable(""),this.uid.subscribe(function(){""!==this.uid()&&"0"!==this.uid()&&cc.ContactsCache.addVcard(this)},this),this.file=c.observable(""),this.name=c.observable(""),this.email=c.observable(""),this.isExists=c.observable(!1),this.isJustSaved=c.observable(!1)}function Z(){this.sEmailDefaultType=_b.ContactEmailType.Personal,this.sPhoneDefaultType=_b.ContactPhoneType.Mobile,this.sAddressDefaultType=_b.ContactAddressType.Personal,this.voiceApp=cc.Phone.voiceApp,this.idContact=c.observable(""),this.idUser=c.observable(""),this.global=c.observable(!1),this.itsMe=c.observable(!1),this.isNew=c.observable(!1),this.readOnly=c.observable(!1),this.edited=c.observable(!1),this.extented=c.observable(!1),this.personalCollapsed=c.observable(!1),this.businessCollapsed=c.observable(!1),this.otherCollapsed=c.observable(!1),this.groupsCollapsed=c.observable(!1),this.displayName=c.observable(""),this.firstName=c.observable(""),this.lastName=c.observable(""),this.nickName=c.observable(""),this.skype=c.observable(""),this.facebook=c.observable(""),this.displayNameFocused=c.observable(!1),this.primaryEmail=c.observable(this.sEmailDefaultType),this.primaryPhone=c.observable(this.sPhoneDefaultType),this.primaryAddress=c.observable(this.sAddressDefaultType),this.mainPrimaryEmail=c.computed({read:this.primaryEmail,write:function(a){!ac.isUnd(a)&&0<=ac.inArray(a,[_b.ContactEmailType.Personal,_b.ContactEmailType.Business,_b.ContactEmailType.Other])?this.primaryEmail(a):this.primaryEmail(_b.ContactEmailType.Personal)},owner:this}),this.mainPrimaryPhone=c.computed({read:this.primaryPhone,write:function(a){!ac.isUnd(a)&&0<=ac.inArray(a,[_b.ContactPhoneType.Mobile,_b.ContactPhoneType.Personal,_b.ContactPhoneType.Business])?this.primaryPhone(a):this.primaryPhone(_b.ContactPhoneType.Mobile)},owner:this}),this.mainPrimaryAddress=c.computed({read:this.primaryAddress,write:function(a){!ac.isUnd(a)&&0<=ac.inArray(a,[_b.ContactAddressType.Personal,_b.ContactAddressType.Business])?this.primaryAddress(a):this.primaryAddress(_b.ContactAddressType.Personal)},owner:this}),this.personalEmail=c.observable(""),this.personalStreetAddress=c.observable(""),this.personalCity=c.observable(""),this.personalState=c.observable(""),this.personalZipCode=c.observable(""),this.personalCountry=c.observable(""),this.personalWeb=c.observable(""),this.personalFax=c.observable(""),this.personalPhone=c.observable(""),this.personalMobile=c.observable(""),this.businessEmail=c.observable(""),this.businessCompany=c.observable(""),this.businessDepartment=c.observable(""),this.businessJob=c.observable(""),this.businessOffice=c.observable(""),this.businessStreetAddress=c.observable(""),this.businessCity=c.observable(""),this.businessState=c.observable(""),this.businessZipCode=c.observable(""),this.businessCountry=c.observable(""),this.businessWeb=c.observable(""),this.businessFax=c.observable(""),this.businessPhone=c.observable(""),this.otherEmail=c.observable(""),this.otherBirthdayMonth=c.observable("0"),this.otherBirthdayDay=c.observable("0"),this.otherBirthdayYear=c.observable("0"),this.otherNotes=c.observable(""),this.etag=c.observable(""),this.birthdayIsEmpty=c.computed(function(){var a="0"===this.otherBirthdayMonth(),b="0"===this.otherBirthdayDay(),c="0"===this.otherBirthdayYear();return a||b||c},this),this.otherBirthday=c.computed(function(){var a="",b=ac.pInt(this.otherBirthdayYear()),c=ac.pInt(this.otherBirthdayMonth()),d=ac.pInt(this.otherBirthdayDay()),e=new P;return this.birthdayIsEmpty()||(e.setDate(b,c>0?c-1:0,d),a=e.getShortDate()),a},this),this.groups=c.observableArray([]),this.groupsIsEmpty=c.computed(function(){return 0===this.groups().length},this),this.email=c.computed({read:function(){var a="";switch(this.primaryEmail()){case _b.ContactEmailType.Personal:a=this.personalEmail();break;case _b.ContactEmailType.Business:a=this.businessEmail();break;case _b.ContactEmailType.Other:a=this.otherEmail()}return a},write:function(a){switch(this.primaryEmail()){case _b.ContactEmailType.Personal:this.personalEmail(a);break;case _b.ContactEmailType.Business:this.businessEmail(a);break;case _b.ContactEmailType.Other:this.otherEmail(a);break;default:this.primaryEmail(this.sEmailDefaultType),this.email(a)}},owner:this}),this.personalIsEmpty=c.computed(function(){var a=this.personalEmail()!==this.email()?this.personalEmail():"";return""==""+a+this.personalStreetAddress()+this.personalCity()+this.personalState()+this.personalZipCode()+this.personalCountry()+this.personalWeb()+this.personalFax()+this.personalPhone()+this.personalMobile()},this),this.businessIsEmpty=c.computed(function(){var a=this.businessEmail()!==this.email()?this.businessEmail():"";return""==""+a+this.businessCompany()+this.businessDepartment()+this.businessJob()+this.businessOffice()+this.businessStreetAddress()+this.businessCity()+this.businessState()+this.businessZipCode()+this.businessCountry()+this.businessWeb()+this.businessFax()+this.businessPhone()},this),this.otherIsEmpty=c.computed(function(){var a=this.otherEmail()!==this.email()?this.otherEmail():"";return""==""+a+this.otherNotes()&&this.birthdayIsEmpty()},this),this.phone=c.computed({read:function(){var a="";switch(this.primaryPhone()){case _b.ContactPhoneType.Mobile:a=this.personalMobile();break;case _b.ContactPhoneType.Personal:a=this.personalPhone();break;case _b.ContactPhoneType.Business:a=this.businessPhone()}return a},write:function(a){switch(this.primaryPhone()){case _b.ContactPhoneType.Mobile:this.personalMobile(a);break;case _b.ContactPhoneType.Personal:this.personalPhone(a);break;case _b.ContactPhoneType.Business:this.businessPhone(a);break;default:this.primaryPhone(this.sEmailDefaultType),this.phone(a)}},owner:this}),this.address=c.computed({read:function(){var a="";switch(this.primaryAddress()){case _b.ContactAddressType.Personal:a=this.personalStreetAddress();break;case _b.ContactAddressType.Business:a=this.businessStreetAddress()}return a},write:function(a){switch(this.primaryAddress()){case _b.ContactAddressType.Personal:this.personalStreetAddress(a);break;case _b.ContactAddressType.Business:this.businessStreetAddress(a);break;default:this.primaryAddress(this.sEmailDefaultType),this.address(a)}},owner:this}),this.emails=c.computed(function(){var a=[];return""!==this.personalEmail()&&a.push({text:ac.i18n("CONTACTS/OPTION_PERSONAL")+": "+this.personalEmail(),value:_b.ContactEmailType.Personal}),""!==this.businessEmail()&&a.push({text:ac.i18n("CONTACTS/OPTION_BUSINESS")+": "+this.businessEmail(),value:_b.ContactEmailType.Business}),""!==this.otherEmail()&&a.push({text:ac.i18n("CONTACTS/OPTION_OTHER")+": "+this.otherEmail(),value:_b.ContactEmailType.Other}),a},this),this.phones=c.computed(function(){var a=[];return""!==this.personalMobile()&&a.push({text:ac.i18n("CONTACTS/LABEL_MOBILE")+": "+this.personalMobile(),value:_b.ContactPhoneType.Mobile}),""!==this.personalPhone()&&a.push({text:ac.i18n("CONTACTS/OPTION_PERSONAL")+": "+this.personalPhone(),value:_b.ContactPhoneType.Personal}),""!==this.businessPhone()&&a.push({text:ac.i18n("CONTACTS/OPTION_BUSINESS")+": "+this.businessPhone(),value:_b.ContactPhoneType.Business}),a},this),this.addresses=c.computed(function(){var a=[];return""!==this.personalStreetAddress()&&a.push({text:ac.i18n("CONTACTS/OPTION_PERSONAL")+": "+this.personalStreetAddress(),value:_b.ContactAddressType.Personal}),""!==this.businessStreetAddress()&&a.push({text:ac.i18n("CONTACTS/OPTION_BUSINESS")+": "+this.businessStreetAddress(),value:_b.ContactAddressType.Business}),a},this),this.hasEmails=c.computed(function(){return 0<this.emails().length},this),this.extented.subscribe(function(a){a&&(this.personalCollapsed(!this.personalIsEmpty()),this.businessCollapsed(!this.businessIsEmpty()),this.otherCollapsed(!this.otherIsEmpty()),this.groupsCollapsed(!this.groupsIsEmpty()))},this),this.birthdayMonthSelect=Z.birthdayMonthSelect,this.birthdayYearSelect=Z.birthdayYearSelect,this.birthdayDaySelect=c.computed(function(){for(var a=1,b=ac.pInt(ac.daysInMonth(this.otherBirthdayMonth(),this.otherBirthdayYear())),c="",d=[{text:ac.i18n("DATETIME/DAY"),value:"0"}];b>=a;a++)c=a.toString(),d.push({text:c,value:c});return d},this);for(var a=new Date,b="",d=a.getFullYear(),e=1932;d>=e;d--)b=d.toString(),this.birthdayYearSelect.push({text:b,value:b});this.canBeSave=c.computed(function(){return!0},this),this.sendMailLink=c.computed(function(){return this.getSendMailLink(this.email())},this),this.sendMailToPersonalLink=c.computed(function(){return this.getSendMailLink(this.personalEmail())},this),this.sendMailToBusinessLink=c.computed(function(){return this.getSendMailLink(this.businessEmail())},this),this.sendMailToOtherLink=c.computed(function(){return this.getSendMailLink(this.otherEmail())},this)}function $(){this.isNew=c.observable(!1),this.readOnly=c.observable(!1),this.idGroup=c.observable(""),this.idUser=c.observable(""),this.name=c.observable(""),this.edited=c.observable(!1),this.nameFocused=c.observable(!1),this.canBeSave=c.computed(function(){return""!==this.name()},this),this.newContactsInGroupCount=c.observable(0),this.newContactsInGroupHint=c.computed(function(){var a=this.newContactsInGroupCount();return this.isNew()&&a>0?ac.i18n("CONTACTS/CONTACT_ADD_TO_NEW_HINT_PLURAL",{COUNT:a},null,a):""},this)}function ab(){this.bIsGroup=!1,this.bReadOnly=!1,this.bItsMe=!1,this.bGlobal=!1,this.sId="",this.sName="",this.sEmail="",this.deleted=c.observable(!1),this.checked=c.observable(!1),this.selected=c.observable(!1),this.recivedAnim=c.observable(!1).extend({autoResetToFalse:500})}function bb(){this.id=0,this.name=c.observable(""),this.description=c.observable(""),this.owner=c.observable(""),this.isDefault=!1,this.isShared=c.observable(!1),this.isSharedToAll=c.observable(!1),this.sharedToAllAccess=_b.CalendarAccess.Read,this.isPublic=c.observable(!1),this.access=_b.CalendarAccess.Write,this.url=c.observable(""),this.davUrl=c.observable(""),this.exportUrl=c.observable(""),this.pubUrl=c.observable(""),this.shares=c.observableArray([]),this.events=[],this.hiddenEvents=[],this.color=c.observable(""),this.color.subscribe(function(){var a=[],b=this;_.each(this.events,function(c){c.backgroundColor=b.color(),c.borderColor=b.color(),a.push(c)}),this.events=a,this.name.valueHasMutated()},this),this.active=c.observable(!0),this.startDateTime=0,this.endDateTime=0,this.account=ec.Accounts.getDefault()}function cb(a){this.parentOnCalendarActiveChange=a.onCalendarActiveChange,this.defaultCal=c.observable(null),this.currentCal=c.observable(null),this.collection=c.observableArray([]),this.collection.subscribe(function(){this.pickCurrentCalendar(this.defaultCal())},this),this.count=c.computed(function(){return this.collection().length},this),this.own=c.computed(function(){var a=_.filter(this.collection(),function(a){return!a.isShared()});return a},this),this.ownCount=c.computed(function(){return this.own().length},this),this.shared=c.computed(function(){var a=_.filter(this.collection(),function(a){return a.isShared()&&!a.isSharedToAll()});return a},this),this.sharedCount=c.computed(function(){return this.shared().length},this),this.sharedToAll=c.computed(function(){var a=_.filter(this.collection(),function(a){return a.isShared()&&a.isSharedToAll()});return a},this),this.sharedToAllCount=c.computed(function(){return this.sharedToAll().length},this),this.ids=c.computed(function(){return _.map(this.collection(),function(a){return a.id},this)},this)}function db(){this.nameForEdit=c.observable(""),this.storageType=c.observable(_b.FileStorageType.Private),this.lastModified=c.observable(""),this.path=c.observable(""),this.publicHash=c.observable(""),this.selected=c.observable(!1),this.checked=c.observable(!1),this.isFolder=c.observable(!1),this.edited=c.observable(!1),this.deleted=c.observable(!1),this.recivedAnim=c.observable(!1).extend({autoResetToFalse:500}),this.shared=c.observable(!1),this.owner=c.observable(""),this.ownerHeaderText=c.computed(function(){return ac.i18n("FILESTORAGE/OWNER_HEADER_EMAIL",{OWNER:this.owner()})},this),this.lastModifiedHeaderText=c.computed(function(){return ac.i18n("FILESTORAGE/OWNER_HEADER_LAST_MODIFIED_DATE_TEXT",{LASTMODIFIED:this.lastModified()})},this),R.call(this),this.fileName.subscribe(function(a){this.nameForEdit(a)},this),this.type=this.storageType,this.uploaded=c.observable(!0),this.downloadLink=c.computed(function(){return ac.getFilestorageDownloadLinkByHash(ec.Accounts.currentId(),this.hash(),this.publicHash())},this),this.viewLink=c.computed(function(){return ac.getFilestorageViewLinkByHash(ec.Accounts.currentId(),this.hash(),this.publicHash())},this),this.isViewable=c.computed(function(){var a=!1,b=["JPEG","JPG","PNG","GIF","TXT","PDF"];return _.indexOf(b,this.extension().toUpperCase())>=0&&(a=!0),a},this),this.visibleViewLink=this.isViewable,this.edited.subscribe(function(a){a===!1&&this.nameForEdit(this.fileName())},this)}function eb(){this.Id=null,this.IdThread=null,this.IdOwner=null,this.sFrom="",this.sDate="",this.iType=null,this.bSysType=!1,this.bThreadOwner=null,this.sText="",this.collapsed=c.observable(!1),this.attachments=c.observableArray([]),this.allowDownloadAttachmentsLink=!0,this.itsMe=c.observable(!1),this.canBeDeleted=this.itsMe}function fb(){this.Id=null,this.ThreadHash="",this.IdOwner=null,this.ItsMe=!1,this.aOwner=[],this.sSubject="",this.sEmail="",this.sName="",this.sFrom="",this.sFromFull="",this.sDate="",this.state=c.observable(0),this.unseen=c.observable(!1),this.postsCount=c.observable(0),this.printableState=c.computed(function(){var a="",b=this.ItsMe?"_FOR_CLIENT":"";switch(this.state()){case _b.HelpdeskThreadStates.Pending:a=ac.i18n("HELPDESK/THREAD_STATE_PENDING"+b);break;case _b.HelpdeskThreadStates.Resolved:a=ac.i18n("HELPDESK/THREAD_STATE_RESOLVED"+b);break;case _b.HelpdeskThreadStates.Waiting:a=ac.i18n("HELPDESK/THREAD_STATE_WAITING"+b);break;case _b.HelpdeskThreadStates.Answered:a=ac.i18n("HELPDESK/THREAD_STATE_ANSWERED"+b);break;case _b.HelpdeskThreadStates.Deferred:a=ac.i18n("HELPDESK/THREAD_STATE_DEFERRED"+b)}return a},this),this.deleted=c.observable(!1),this.checked=c.observable(!1),this.selected=c.observable(!1)}function gb(){R.call(this),this.downloadLink=c.computed(function(){var a=!fc&&ec&&ec.Accounts?ec.Accounts.currentId():0,b=fc&&ec?ec.TenantHash:"";return ac.getDownloadLinkByHash(a,this.hash(),fc,b)},this),this.viewLink=c.computed(function(){var a=!fc&&ec&&ec.Accounts?ec.Accounts.currentId():0,b=fc&&ec?ec.TenantHash:"";return ac.getViewLinkByHash(a,this.hash(),fc,b)},this),this.viewThumbnailLink=c.computed(function(){var a=!fc&&ec&&ec.Accounts?ec.Accounts.currentId():0,b=fc&&ec?ec.TenantHash:"",c=this.thumb()?ac.getViewThumbnailLinkByHash(a,this.hash(),fc,b):"";return c},this)}function hb(){this.iAccountId=0,this.type=c.observable(!0),this.options=c.observable(0),this.signature=c.observable("")}function ib(){this.iAccountId=0,this.enable=!1,this.subject="",this.message=""}function jb(){this.FETCHER=!0,this.id=c.observable(0),this.accountId=c.observable(0),this.isEnabled=c.observable(!1),this.isLocked=c.observable(!1),this.email=c.observable(""),this.userName=c.observable(""),this.folder=c.observable(""),this.signatureOptions=c.observable(0),this.signature=c.observable(""),this.incomingMailServer=c.observable(""),this.incomingMailPort=c.observable(0),this.incomingMailLogin=c.observable(""),this.leaveMessagesOnServer=c.observable(""),this.isOutgoingEnabled=c.observable(!1),this.outgoingMailServer=c.observable(""),this.outgoingMailPort=c.observable(0),this.outgoingMailAuth=c.observable(!1),this.fullEmail=c.computed(function(){return""===this.userName()?this.email():this.userName()+" <"+this.email()+">"},this)}function kb(){this.accountId=0,this.collection=c.observableArray([])}function lb(){this.iAccountId=0,this.enable=!1,this.email=""}function mb(){this.iAccountId=0,this.collection=c.observableArray([])}function nb(a){this.iAccountId=a,this.enable=c.observable(!0),this.field=c.observable(""),this.condition=c.observable(""),this.filter=c.observable(""),this.action=c.observable(""),this.folder=c.observable("")}function ob(){this.loadingMessage=c.observable(""),this.loadingVisible=c.observable(!1),this.reportMessage=c.observable(""),this.reportVisible=c.observable(!1),this.iReportTimeout=0/0,this.errorMessage=c.observable(""),this.errorNotHide=c.observable(!1),this.errorVisible=c.observable(!1),this.iErrorTimeout=-1,this.isHtmlError=c.observable(!1)}function pb(){this.oPhone=new tb,this.allowVoice=ec.User.AllowVoice,this.currentAccountId=ec.Accounts.currentId,this.currentAccountId.subscribe(function(){this.changeCurrentAccount()},this),this.tabs=cc.headerTabs,this.email=c.observable(""),this.accounts=ec.Accounts.collection,this.currentTab=cc.Screens.currentScreen,this.sMailboxHash=cc.Routing.buildHashFromArray([_b.Screens.Mailbox]),this.sSettingsHash=cc.Routing.buildHashFromArray([_b.Screens.Settings]),this.contactsRecivedAnim=cc.ContactsCache.recivedAnim,this.calendarRecivedAnim=cc.CalendarCache.recivedAnim}function qb(a,b){this.currentPage=c.observable(1),this.count=c.observable(a),this.perPage=c.observable(b),this.pagesCount=c.computed(function(){var a=Math.ceil(this.count()/this.perPage());return a>0?a:1},this),this.firstPage=c.computed(function(){var a=this.currentPage()-2;return a>0?a:1},this),this.lastPage=c.computed(function(){var a=this.firstPage()+4;return a<=this.pagesCount()?a:this.pagesCount()},this),this.visibleFirst=c.computed(function(){return this.firstPage()>1},this),this.visibleLast=c.computed(function(){return this.lastPage()<this.pagesCount()},this),this.pages=c.computed(function(){var a=this.firstPage(),b=[];if(this.firstPage()<this.lastPage())for(;a<=this.lastPage();a++)b.push({number:a,current:a===this.currentPage(),clickFunc:_.bind(this.clickPage,this)});return b},this)}function rb(a,b){this.oParent=b,this.creaId="creaId"+Math.random().toString().replace(".",""),this.workareaDom=c.observable(),this.uploaderAreaDom=c.observable(),this.editorUploaderBodyDragOver=c.observable(!1),this.editorUploaderProgress=c.observable(!1),this.colorPickerDropdownDom=c.observable(),this.insertLinkDropdownDom=c.observable(),this.insertImageDropdownDom=c.observable(),this.isEnable=c.observable(!0),this.isEnable.subscribe(function(){this.oCrea&&this.oCrea.setEditable(this.isEnable())},this),this.allowInsertImage=c.observable(a&&ec.App.AllowInsertImage),this.lockFontSubscribing=c.observable(!1),this.aFonts=["Arial","Arial Black","Courier New","Tahoma","Times New Roman","Verdana"],this.iDefaultFont="Tahoma",this.selectedFont=c.observable(this.iDefaultFont),this.selectedFont.subscribe(function(){this.lockFontSubscribing()||this.oCrea.fontName(this.selectedFont())},this),this.aSizes=[1,2,3,4,5,6,7],this.iDefaultSize=3,this.selectedSize=c.observable(this.iDefaultSize),this.selectedSize.subscribe(function(){this.lockFontSubscribing()||this.oCrea.fontSize(this.selectedSize())},this),this.visibleInsertLinkPopup=c.observable(!1),this.linkForInsert=c.observable(""),this.linkFocused=c.observable(!1),this.visibleLinkPopup=c.observable(!1),this.linkPopupTop=c.observable(0),this.linkPopupLeft=c.observable(0),this.linkHref=c.observable(""),this.visibleLinkHref=c.observable(!1),this.visibleImagePopup=c.observable(!1),this.visibleImagePopup.subscribe(function(){this.onImageOut()},this),this.imagePopupTop=c.observable(0),this.imagePopupLeft=c.observable(0),this.imageSelected=c.observable(!1),this.tooltipText=c.observable(""),this.tooltipPopupTop=c.observable(0),this.tooltipPopupLeft=c.observable(0),this.visibleInsertImagePopup=c.observable(!1),this.imageUploaderButton=c.observable(null),this.uploadedImagePathes=c.observableArray([]),this.imagePathFromWeb=c.observable(""),this.visibleFontColorPopup=c.observable(!1),this.oFontColorPicker=new sb(ac.i18n("HTMLEDITOR/TEXT_COLOR_CAPTION"),this.setTextColorFromPopup,this),this.oBackColorPicker=new sb(ac.i18n("HTMLEDITOR/BACKGROUND_COLOR_CAPTION"),this.setBackColorFromPopup,this),this.activitySource=c.observable(1),this.inactive=c.observable(!1),this.inactive.subscribe(function(){var a=this.removeAllTags(this.getText());this.inactive()?(""===a||"&nbsp;"===a)&&this.setText('<span style="color: #AAAAAA;">'+ac.i18n("HTMLEDITOR/SIGNATURE_PLACEHOLDER")+"</span>"):a===ac.i18n("HTMLEDITOR/SIGNATURE_PLACEHOLDER")&&this.setText("")},this)}function sb(a,b,d){this.aGreyColors=["rgb(0, 0, 0)","rgb(68, 68, 68)","rgb(102, 102, 102)","rgb(153, 153, 153)","rgb(204, 204, 204)","rgb(238, 238, 238)","rgb(243, 243, 243)","rgb(255, 255, 255)"],this.aBrightColors=["rgb(255, 0, 0)","rgb(255, 153, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(0, 0, 255)","rgb(153, 0, 255)","rgb(255, 0, 255)"],this.aColorLines=[["rgb(244, 204, 204)","rgb(252, 229, 205)","rgb(255, 242, 204)","rgb(217, 234, 211)","rgb(208, 224, 227)","rgb(207, 226, 243)","rgb(217, 210, 233)","rgb(234, 209, 220)"],["rgb(234, 153, 153)","rgb(249, 203, 156)","rgb(255, 229, 153)","rgb(182, 215, 168)","rgb(162, 196, 201)","rgb(159, 197, 232)","rgb(180, 167, 214)","rgb(213, 166, 189)"],["rgb(224, 102, 102)","rgb(246, 178, 107)","rgb(255, 217, 102)","rgb(147, 196, 125)","rgb(118, 165, 175)","rgb(111, 168, 220)","rgb(142, 124, 195)","rgb(194, 123, 160)"],["rgb(204, 0, 0)","rgb(230, 145, 56)","rgb(241, 194, 50)","rgb(106, 168, 79)","rgb(69, 129, 142)","rgb(61, 133, 198)","rgb(103, 78, 167)","rgb(166, 77, 121)"],["rgb(153, 0, 0)","rgb(180, 95, 6)","rgb(191, 144, 0)","rgb(56, 118, 29)","rgb(19, 79, 92)","rgb(11, 83, 148)","rgb(53, 28, 117)","rgb(116, 27, 71)"],["rgb(102, 0, 0)","rgb(120, 63, 4)","rgb(127, 96, 0)","rgb(39, 78, 19)","rgb(12, 52, 61)","rgb(7, 55, 99)","rgb(32, 18, 77)","rgb(76, 17, 48)"]],this.caption=a,this.pickHandler=b,this.pickContext=d,this.colorPickerDom=c.observable(null)}function tb(){this.phone=cc.Phone,this.provider=cc.Phone.provider,this.phoneReport=cc.Phone.phoneReport,this.action=cc.Phone.action,this.action.subscribe(function(a){var b=this;"connection_end"===a&&_.delay(function(){b.action("online")},500)},this),this.isNotHide=c.observable(!1).extend({autoResetToFalse:300}),this.state=c.observable("offline"),this.input=c.observable(""),this.isActive=c.observable(!1),this.inputFocus=c.observable(!1),this.inputFocus.subscribe(function(a){if(!a){var b=this;_.delay(function(){"online_active"!==b.action()||b.isNotHide()||b.action("online")},250)}},this),this.phoneAutocompleteItem=c.observable(null)}function ub(){this.email=c.observable(""),this.login=c.observable(""),this.password=c.observable(""),this.rtl=c.observable(ac.isRTL()),this.loginDescription=c.observable(""),this.emailFocus=c.observable(!1),this.loginFocus=c.observable(!1),this.passwordFocus=c.observable(!1),this.loading=c.observable(!1),this.loginFocus.subscribe(function(a){a&&""===this.login()&&this.login(this.email())},this),this.loginFormType=c.observable(ec.App.LoginFormType),this.loginAtDomainValue=c.observable(ec.App.LoginAtDomainValue),this.loginAtDomainValueWithAt=c.computed(function(){var a=this.loginAtDomainValue();return""===a?"":"@"+a},this),this.emailVisible=c.computed(function(){return _b.LoginFormType.Login!==this.loginFormType()},this),this.loginVisible=c.computed(function(){return _b.LoginFormType.Email!==this.loginFormType()},this),this.signMeType=c.observable(ec.App.LoginSignMeType),this.signMe=c.observable(_b.LoginSignMeType.DefaultOn===this.signMeType()),this.signMeType.subscribe(function(){this.signMe(_b.LoginSignMeType.DefaultOn===this.signMeType())},this),this.focusedField="",this.aLanguages=ec.App.Languages,this.currentLanguage=c.observable(ec.App.DefaultLanguage),this.allowLanguages=c.observable(ec.App.AllowLanguageOnLogin),this.viewLanguagesAsDropdown=c.observable(!ec.App.FlagsLangSelect),this.canBeLogin=c.computed(function(){var a=this.loginFormType(),b=this.email(),c=this.login(),d=this.password();return!this.loading()&&""!==ac.trim(d)&&(_b.LoginFormType.Login===a&&""!==ac.trim(c)||_b.LoginFormType.Email===a&&""!==ac.trim(b)||_b.LoginFormType.Both===a&&""!==ac.trim(b))},this),this.signInButtonText=c.computed(function(){return this.loading()?ac.i18n("LOGIN/BUTTON_SIGNING_IN"):ac.i18n("LOGIN/BUTTON_SIGN_IN")},this),this.loginCommand=ac.createCommand(this,this.signIn,this.canBeLogin),this.email(ec.App.DemoWebMailLogin||""),this.password(ec.App.DemoWebMailPassword||""),this.loginDescription(ec.App.LoginDescription||"")}function vb(){this.foldersContainer=c.observable(null),this.folderList=cc.MailCache.folderList,this.manageFoldersHash=cc.Routing.buildHashFromArray([_b.Screens.Settings,_b.SettingsTab.EmailAccounts,_b.AccountSettingsTab.Folders]),this.quotaProc=c.observable(-1),this.quotaDesc=c.observable(""),c.computed(function(){if(!ec.App.ShowQuotaBar)return!0;cc.MailCache.quotaChangeTrigger();var a=ec.Accounts.getCurrent(),b=a?a.quota():0,c=a?a.usedSpace():0,d=b>0?Math.ceil(c/b*100):-1;return d=d>100?100:d,this.quotaProc(d),this.quotaDesc(d>-1?ac.i18n("MAILBOX/QUOTA_TOOLTIP",{PROC:d,QUOTA:ac.friendlySize(1024*b)}):""),!0},this)}function wb(){this.isFocused=c.observable(!1),this.messagesContainer=c.observable(null),this.searchInput=c.observable(""),this.searchInputFrom=c.observable(""),this.searchInputTo=c.observable(""),this.searchInputSubject=c.observable(""),this.searchInputText=c.observable(""),this.searchSpan=c.observable(""),this.highlightTrigger=c.observable(""),this.bAdvancedSearch=c.observable(!1),this.currentMessage=cc.MailCache.currentMessage,this.currentMessage.subscribe(function(){this.isFocused(!1),this.selector.itemSelected(this.currentMessage())},this),this.folderList=cc.MailCache.folderList,this.folderList.subscribe(this.onFolderListSubscribe,this),this.folderFullName=c.observable(""),this.filters=c.observable(""),this.uidList=cc.MailCache.uidList,this.uidList.subscribe(function(){this.uidList().searchCountSubscription&&(this.uidList().searchCountSubscription.dispose(),this.uidList().searchCountSubscription=void 0),this.uidList().searchCountSubscription=this.uidList().resultCount.subscribe(function(){this.uidList().resultCount()>=0&&this.oPageSwitcher.setCount(this.uidList().resultCount())},this),this.uidList().resultCount()>=0&&this.oPageSwitcher.setCount(this.uidList().resultCount())},this),this.useThreads=c.computed(function(){var a=this.folderList().currentFolder(),b=a&&a.withoutThreads(),c=""===this.uidList().search()&&""===this.uidList().filters();return ec.User.useThreads()&&!b&&c},this),this.collection=cc.MailCache.messages,this._search=c.observable(""),this.search=c.computed({read:function(){return ac.trim(this._search())},write:this._search,owner:this}),this.isEmptyList=c.computed(function(){return 0===this.collection().length},this),this.isNotEmptyList=c.computed(function(){return 0!==this.collection().length},this),this.isSearch=c.computed(function(){return this.search().length>0},this),this.isLoading=cc.MailCache.messagesLoading,this.isError=cc.MailCache.messagesLoadingError,this.visibleInfoLoading=c.computed(function(){return!this.isSearch()&&this.isLoading()},this),this.visibleInfoSearchLoading=c.computed(function(){return this.isSearch()&&this.isLoading()},this),this.visibleInfoSearchList=c.computed(function(){return this.isSearch()&&!this.isLoading()&&!this.isEmptyList()},this),this.visibleInfoMessageListEmpty=c.computed(function(){return!this.isLoading()&&!this.isSearch()&&this.filters()!==_b.FolderFilter.Flagged&&this.isEmptyList()&&!this.isError()},this),this.visibleInfoStarredFolderEmpty=c.computed(function(){return!this.isLoading()&&!this.isSearch()&&this.filters()===_b.FolderFilter.Flagged&&this.isEmptyList()&&!this.isError()},this),this.visibleInfoSearchEmpty=c.computed(function(){return this.isSearch()&&this.isEmptyList()&&!this.isError()&&!this.isLoading()},this),this.visibleInfoMessageListError=c.computed(function(){return!this.isSearch()&&this.isError()},this),this.visibleInfoSearchError=c.computed(function(){return this.isSearch()&&this.isError()},this),this.searchText=c.computed(function(){return ac.i18n("MAILBOX/INFO_SEARCH_RESULT",{SEARCH:this.search(),FOLDER:this.folderList().currentFolder()?this.folderList().currentFolder().displayName():""})},this),this.collectionChecked=c.computed(function(){var a=_.filter(this.collection(),function(a){return!a.deleted()&&a.checked()});return 0===a.length&&cc.MailCache.currentMessage()&&!cc.MailCache.currentMessage().deleted()&&(a=[cc.MailCache.currentMessage()]),a},this),this.collectionCheckedUids=c.computed(function(){return _.map(this.collectionChecked(),function(a){return a.uid()
})},this),this.isEnableGroupOperations=c.observable(!1).extend({throttle:250}),this.selector=new l(this.collection,_.bind(this.routeForMessage,this),_.bind(this.onDeletePress,this),_.bind(this.onMessageDblClick,this),_.bind(this.onEnterPress,this)),c.computed(function(){this.isEnableGroupOperations(0<this.selector.listCheckedOrSelected().length)},this),this.checkAll=this.selector.koCheckAll(),this.checkAllIncomplite=this.selector.koCheckAllIncomplete(),this.pageSwitcherLocked=c.observable(!1),this.oPageSwitcher=new qb(0,ec.User.MailsPerPage),this.oPageSwitcher.currentPage.subscribe(function(a){var b=this.folderList().currentFolderFullName(),c=this.currentMessage()?this.currentMessage().uid():"",d=this.search();this.pageSwitcherLocked()||this.changeRoutingForMessageList(b,a,c,d,this.filters())},this),this.currentPage=c.observable(0),this.listChangedThrottle=cc.browser.firefox||cc.browser.ie?c.observable(!1).extend({throttle:10}):c.observable(!1),this.firstCompleteCollection=c.observable(!0),this.collection.subscribe(function(){this.collection().length>0&&this.firstCompleteCollection(!1)},this),this.currentAccountId=ec.Accounts.currentId,this.listChanged=c.computed(function(){return[this.firstCompleteCollection(),this.currentAccountId(),this.folderFullName(),this.filters(),this.search(),this.oPageSwitcher.currentPage()]},this),this.listChanged.subscribe(function(){this.listChangedThrottle(!this.listChangedThrottle())},this)}function xb(){this.singleMode=c.observable(ec.SingleMode),this.isLoading=c.observable(!1),this.messages=cc.MailCache.messages,this.messages.subscribe(this.onMessagesSubscribe,this),this.currentMessage=cc.MailCache.currentMessage,this.currentMessage.subscribe(this.onCurrentMessageSubscribe,this),ec.User.defaultTimeFormat.subscribe(this.onCurrentMessageSubscribe,this),this.isCurrentMessage=c.computed(function(){return!!this.currentMessage()},this),this.isCurrentMessageLoaded=c.computed(function(){return this.isCurrentMessage()&&!this.isLoading()},this),this.visibleNoMessageSelectedText=c.computed(function(){return this.messages().length>0&&!this.isCurrentMessage()},this),this.isEnableReply=this.isCurrentMessageLoaded,this.isEnableReplyAll=this.isCurrentMessageLoaded,this.isEnableResend=this.isCurrentMessageLoaded,this.isEnableForward=this.isCurrentMessageLoaded,this.isEnablePrint=this.isCurrentMessageLoaded,this.isEnableSave=this.isCurrentMessage,this.prevMessageCommand=ac.createCommand(this,this.executePrevMessage),this.nextMessageCommand=ac.createCommand(this,this.executeNextMessage),this.replyCommand=ac.createCommand(this,this.executeReply,this.isEnableReply),this.replyAllCommand=ac.createCommand(this,this.executeReplyAll,this.isEnableReplyAll),this.resendCommand=ac.createCommand(this,this.executeResend,this.isEnableResend),this.forwardCommand=ac.createCommand(this,this.executeForward,this.isEnableForward),this.printCommand=ac.createCommand(this,this.executePrint,this.isEnablePrint),this.saveCommand=ac.createCommand(this,this.executeSave,this.isEnableSave),this.ical=c.observable(null),this.vcard=c.observable(null),this.visiblePicturesControl=c.observable(!1),this.visibleShowPicturesLink=c.observable(!1),this.visibleAppointmentInfo=c.computed(function(){return null!==this.ical()},this),this.visibleVcardInfo=c.computed(function(){return null!==this.vcard()},this),this.sensitivityText=c.computed(function(){var a="";if(this.currentMessage())switch(this.currentMessage().sensitivity()){case _b.Sensivity.Confidential:a=ac.i18n("MESSAGE/SENSIVITY_CONFIDENTIAL");break;case _b.Sensivity.Personal:a=ac.i18n("MESSAGE/SENSIVITY_PERSONAL");break;case _b.Sensivity.Private:a=ac.i18n("MESSAGE/SENSIVITY_PRIVATE")}return a},this),this.visibleConfirmationControl=c.computed(function(){return this.currentMessage()&&""!==this.currentMessage().readingConfirmation()},this),this.fakeHeader=c.computed(function(){return!(this.visiblePicturesControl()||this.visibleConfirmationControl()||""!==this.sensitivityText())},this),this.isCurrentNotDraftOrSent=c.computed(function(){var a=cc.MailCache.folderList().currentFolder();return a&&a.fullName().length>0&&a.type()!==_b.FolderTypes.Drafts&&a.type()!==_b.FolderTypes.Sent},this),this.isCurrentSentFolder=c.computed(function(){var a=cc.MailCache.folderList().currentFolder();return a&&a.fullName().length>0&&a.type()===_b.FolderTypes.Sent},this),this.isCurrentNotDraftFolder=c.computed(function(){var a=cc.MailCache.folderList().currentFolder();return a&&a.fullName().length>0&&a.type()!==_b.FolderTypes.Drafts},this),this.isVisibleReplyTool=this.isCurrentNotDraftOrSent,this.isVisibleResendTool=this.isCurrentSentFolder,this.isVisibleForwardTool=this.isCurrentNotDraftFolder,this.uid=c.observable(""),this.folder=c.observable(""),this.subject=c.observable(""),this.from=c.observable(""),this.fullFrom=c.observable(""),this.to=c.observable(""),this.cc=c.observable(""),this.bcc=c.observable(""),this.allRecipients=c.observable(""),this.fullDate=c.observable(""),this.midDate=c.observable(""),this.fromEmail=c.observable(""),this.fromName=c.observable(""),this.fromExistsInContacts=c.observable(!1),this.fromContactInfoReceived=c.observable(!1),this.fromContact=c.observable(new Z),this.hasFromContact=c.computed(function(){return this.fromContactInfoReceived()&&this.fromExistsInContacts()},this),this.shortFromToDisplay=c.computed(function(){var a=this.from();return""===this.fromName()&&this.hasFromContact()&&""!==this.fromContact().displayName()&&(a=this.fromContact().displayName()),a},this),this.contactCardWidth=c.observable(0),this.visibleAddToContacts=c.computed(function(){return this.isCurrentNotDraftOrSent()&&this.fromContactInfoReceived()&&!this.fromExistsInContacts()},this),this.textBody=c.observable(""),this.textBodyForNewWindow=c.observable(""),this.domTextBody=c.observable(null),this.rtlMessage=c.observable(!1),this.contentHasFocus=c.observable(!1),this.attachments=c.observableArray([]),this.usesAttachmentString=!0,this.attachmentsInString=c.computed(function(){return _.map(this.attachments(),function(a){return a.fileName()},this).join(", ")},this),this.notInlineAttachments=c.computed(function(){return _.filter(this.attachments(),function(a){return!a.linked()})},this),this.visibleDownloadAllAttachments=c.computed(function(){return ec.ZipAttachments&&this.notInlineAttachments().length>1},this),this.visibleSaveAttachmentsToFiles=c.observable(!1),this.visibleDownloadAllAttachmentsSeparately=c.observable(!0),this.downloadMenuExpanded=c.observable(!1),this.detailsVisible=c.observable(!1),this.hasNotInlineAttachments=c.computed(function(){return this.notInlineAttachments().length>0},this),this.scrollToAttachment=c.observable(".attachments"),this.hasBodyText=c.computed(function(){return this.textBody().length>0},this),this.visibleAddMenu=c.observable(!1),this.replyText=c.observable(""),this.replyHtmlText=c.computed(function(){return cc.MessageSender.getHtmlFromText(this.replyText())},this),this.replyTextFocus=c.observable(!1),this.replyPaneVisible=c.computed(function(){return this.currentMessage()&&this.currentMessage().completelyFilled()},this),this.replySendingStarted=c.observable(!1),this.replySavingStarted=c.observable(!1),this.replyDraftUid=c.observable(""),this.replyCc=c.observable(""),this.replyBcc=c.observable(""),this.replyLoadingText=c.computed(function(){return this.replySendingStarted()?ac.i18n("COMPOSE/INFO_SENDING"):this.replySavingStarted()?ac.i18n("COMPOSE/INFO_SAVING"):""},this),this.domMessageHeader=c.observable(null),this.domQuickReply=c.observable(null),this.domMessageForPrint=c.observable(null),this.replyTextFocusThrottled=c.observable(!1).extend({throttle:50}),this.replyTextFocus.subscribe(function(){this.replyTextFocusThrottled(this.replyTextFocus())},this),this.isQuickReplyActive=c.computed(function(){return this.replyText().length>0||this.replyTextFocusThrottled()},this),a(document).on("keyup",a.proxy(function(a){cc.Screens.currentScreen()===_b.Screens.Mailbox&&a&&a.keyCode===_b.Key.q&&!ac.isTextFieldFocused()&&this.replyTextFocus(!0)},this)),this.viewAllMailsWithContactBinded=_.bind(this.viewAllMailsWithContact,this),this.jqPanelHelper=null}function yb(){this.folderList=cc.MailCache.folderList,this.domFolderList=c.observable(null),this.oFolderList=new vb,this.oMessageList=new wb,this.oMessagePane=new xb,this.isEnableGroupOperations=this.oMessageList.isEnableGroupOperations,this.composeLink=c.observable(cc.Routing.buildHashFromArray(cc.Links.compose())),this.checkMailCommand=ac.createCommand(cc.MailCache,cc.MailCache.executeCheckMail),this.checkMailStarted=cc.MailCache.checkMailStarted,this.markAsReadCommand=ac.createCommand(this.oMessageList,this.oMessageList.executeMarkAsRead,this.isEnableGroupOperations),this.markAsUnreadCommand=ac.createCommand(this.oMessageList,this.oMessageList.executeMarkAsUnread,this.isEnableGroupOperations),this.markAllReadCommand=ac.createCommand(this.oMessageList,this.oMessageList.executeMarkAllRead),this.moveToFolderCommand=ac.createCommand(this,ac.emptyFunction,this.isEnableGroupOperations),this.deleteCommand=ac.createCommand(this.oMessageList,this.oMessageList.executeDelete,this.isEnableGroupOperations),this.selectedUids=c.computed(function(){var a=this.oMessageList.selector.listChecked(),b=this.getThreadCheckedUidsFromList(a),c=_.map(a,function(a){return a.uid()}),d=_.union(c,b);return d},this),this.selectedCount=c.computed(function(){var a=this.selectedUids(),b=a.length;return b},this),this.emptyTrashCommand=ac.createCommand(cc.MailCache,cc.MailCache.executeEmptyTrash,this.oMessageList.isNotEmptyList),this.emptySpamCommand=ac.createCommand(cc.MailCache,cc.MailCache.executeEmptySpam,this.oMessageList.isNotEmptyList),this.spamCommand=ac.createCommand(this.oMessageList,this.oMessageList.executeSpam,this.isEnableGroupOperations),this.notSpamCommand=ac.createCommand(this.oMessageList,this.oMessageList.executeNotSpam,this.isEnableGroupOperations),this.bVisibleComposeMessage=ec.User.AllowCompose,this.isVisibleReplyTool=c.computed(function(){return this.folderList().currentFolder()&&this.folderList().currentFolderFullName().length>0&&this.folderList().currentFolderType()!==_b.FolderTypes.Drafts&&this.folderList().currentFolderType()!==_b.FolderTypes.Sent},this),this.isVisibleForwardTool=c.computed(function(){return this.folderList().currentFolder()&&this.folderList().currentFolderFullName().length>0&&this.folderList().currentFolderType()!==_b.FolderTypes.Drafts},this),this.isSpamFolder=c.computed(function(){return this.folderList().currentFolderType()===_b.FolderTypes.Spam},this),this.allowedSpamAction=c.computed(function(){var a=ec.Accounts.getCurrent();return a.extensionExists("AllowSpamFolderExtension")&&!this.isSpamFolder()},this),this.allowedNotSpamAction=c.computed(function(){var a=ec.Accounts.getCurrent();return a.extensionExists("AllowSpamFolderExtension")&&this.isSpamFolder()},this),this.isTrashFolder=c.computed(function(){return this.folderList().currentFolderType()===_b.FolderTypes.Trash},this),this.jqPanelHelper=null}function zb(){this.toAddrDom=c.observable(),this.ccAddrDom=c.observable(),this.bccAddrDom=c.observable(),this.folderList=cc.MailCache.folderList,this.folderList.subscribe(function(){this.getMessageOnRoute()},this),this.singleMode=c.observable(ec.SingleMode),this.isDemo=c.observable(ec.User.IsDemo),this.sending=c.observable(!1),this.sending.subscribe(this.sendingAndSavingSubscription,this),this.saving=c.observable(!1),this.saving.subscribe(this.sendingAndSavingSubscription,this),this.oHtmlEditor=new rb(!0,this),this.visibleBcc=c.observable(!1),this.visibleBcc.subscribe(function(){gc.toggleClass("screen-compose-bcc",this.visibleCc()),_.defer(_.bind(function(){a(this.bccAddrDom()).inputosaurus("resizeInput")},this)),this.computeHeight()},this),this.visibleCc=c.observable(!1),this.visibleCc.subscribe(function(){gc.toggleClass("screen-compose-cc",this.visibleCc()),_.defer(_.bind(function(){a(this.ccAddrDom()).inputosaurus("resizeInput")},this)),this.computeHeight()},this),this.visibleCounter=c.observable(!1),this.readingConfirmation=c.observable(!1),this.saveMailInSentItems=c.observable(!0),this.useSaveMailInSentItems=c.observable(!1),this.composeUploaderButton=c.observable(null),this.composeUploaderDropPlace=c.observable(null),this.composeUploaderBodyDragOver=c.observable(!1),this.composeUploaderDragOver=c.observable(!1),this.allowDragNDrop=c.observable(!1),this.uploaderBodyDragOver=c.computed(function(){return this.allowDragNDrop()&&this.composeUploaderBodyDragOver()},this),this.uploaderDragOver=c.computed(function(){return this.allowDragNDrop()&&this.composeUploaderDragOver()},this),this.selectedImportance=c.observable(_b.Importance.Normal),this.selectedSensitivity=c.observable(_b.Sensivity.Nothing),this.senderList=c.observableArray([]),this.visibleFrom=c.computed(function(){return this.senderList().length>1},this),this.selectedSender=c.observable(""),this.selectedFetcherOrIdentity=c.observable(null),this.selectedFetcherOrIdentity.subscribe(function(){this.selectedFetcherOrIdentity()?this.selectedFetcherOrIdentity().FETCHER===!0?this.selectedSender("fetcher"+this.selectedFetcherOrIdentity().id()):this.selectedSender(ac.pString(this.selectedFetcherOrIdentity().id())):this.selectedSender(""),this.changeSignature()},this),this.selectedSender.subscribe(function(){var a=ec.Accounts.getAccount(this.senderAccountId()),b=this.selectedSender(),c=null;0===b.indexOf("fetcher")?a.fetchers()&&(b=b.replace("fetcher",""),c=_.find(a.fetchers().collection(),function(a){return a.id()===ac.pInt(b)})):c=_.find(a.identities(),function(a){return a.id()===ac.pInt(b)}),this.selectedFetcherOrIdentity(c)},this),this.selectedIdentityId=c.observable(0),this.selectedIdentityId.subscribe(function(){this.changeSignature()},this),this.senderAccountId=c.observable(ec.Accounts.currentId()),this.lockToAddr=c.observable(!1),this.toAddr=c.observable("").extend({reversible:!0}),this.toAddr.subscribe(function(){this.lockToAddr()||(a(this.toAddrDom()).val(this.toAddr()),a(this.toAddrDom()).inputosaurus("refresh")),this.computeHeight()},this),this.lockCcAddr=c.observable(!1),this.ccAddr=c.observable("").extend({reversible:!0}),this.ccAddr.subscribe(function(){this.lockCcAddr()||(a(this.ccAddrDom()).val(this.ccAddr()),a(this.ccAddrDom()).inputosaurus("refresh")),this.computeHeight()},this),this.lockBccAddr=c.observable(!1),this.bccAddr=c.observable("").extend({reversible:!0}),this.bccAddr.subscribe(function(){this.lockBccAddr()||(a(this.bccAddrDom()).val(this.bccAddr()),a(this.bccAddrDom()).inputosaurus("refresh")),this.computeHeight()},this),this.subject=c.observable("").extend({reversible:!0}),this.counter=c.observable(0),this.commitedTextBody=c.observable(""),this.textBody=c.observable(""),this.textBody.subscribe(function(){this.oHtmlEditor.setText(this.textBody()),this.commitedTextBody(this.oHtmlEditor.getText())},this),this.toAddrFocused=c.observable(!1),this.toAddrFocused.subscribe(function(){this.toAddrFocused()&&a(this.toAddrDom()).inputosaurus("focus")},this),this.ccAddrFocused=c.observable(!1),this.ccAddrFocused.subscribe(function(){this.ccAddrFocused()&&a(this.bccAddrDom()).inputosaurus("focus")},this),this.bccAddrFocused=c.observable(!1),this.bccAddrFocused.subscribe(function(){this.bccAddrFocused()&&a(this.bccAddrDom()).inputosaurus("focus")},this),this.subjectFocused=c.observable(!1),this.draftUid=c.observable(""),this.draftInfo=c.observableArray([]),this.routeType=c.observable(""),this.routeParams=c.observableArray([]),this.inReplyTo=c.observable(""),this.references=c.observable(""),this.uploadAttachmentsTimer=-1,this.messageUploadAttachmentsStarted=c.observable(!1),this.messageUploadAttachmentsStarted.subscribe(function(){clearTimeout(this.uploadAttachmentsTimer),this.messageUploadAttachmentsStarted()?this.uploadAttachmentsTimer=setTimeout(function(){cc.Api.showLoading(ac.i18n("COMPOSE/INFO_ATTACHMENTS_LOADING"))},4e3):cc.Api.hideLoading()},this),this.attachments=c.observableArray([]),this.attachmentsChanged=c.observable(!1),this.attachments.subscribe(function(){this.computeHeight()},this),this.notUploadedAttachments=c.computed(function(){return _.filter(this.attachments(),function(a){return!a.uploaded()})},this),this.allAttachmentsUploaded=c.computed(function(){return 0===this.notUploadedAttachments().length&&!this.messageUploadAttachmentsStarted()},this),this.notInlineAttachments=c.computed(function(){return _.filter(this.attachments(),function(a){return!a.linked()})},this),this.allowStartSending=c.computed(function(){return!this.saving()},this),this.allowStartSending.subscribe(function(){this.allowStartSending()&&this.requiresPostponedSending()&&(cc.MessageSender.sendPostponedMail(this.draftUid()),this.requiresPostponedSending(!1))},this),this.requiresPostponedSending=c.observable(!1),this.oJua=null,this.isDraftsCleared=c.observable(!1),this.autoSaveTimer=-1,this.backToListCommand=ac.createCommand(this,this.executeBackToList),this.sendCommand=ac.createCommand(this,this.executeSend,this.isEnableSending),this.saveCommand=ac.createCommand(this,this.executeSaveCommand,this.isEnableSaving),this.messageForm=c.observable(null),this.messageFields=c.observable(null),this.shown=c.observable(!1),this.shown.subscribe(function(){this.shown()||this.stopAutosaveTimer()},this),this.editableArea=c.observable(null),a(document).on("keydown",a.proxy(function(a){if(a&&a.ctrlKey){var b=!0,c=cc.Screens.currentScreen()===_b.Screens.Compose,d=this.editableArea(),e=a.keyCode,f=_b.Key;!d&&this.oHtmlEditor.oCrea&&this.editableArea(this.oHtmlEditor.oCrea.$editableArea[0]),c&&a&&b&&e===f.s?(a.preventDefault(),a.returnValue=!1,this.isEnableSaving()&&this.saveCommand()):c&&a&&b&&e===f.Enter&&""!==this.toAddr()&&this.sendCommand()}},this))}function Ab(a){this.oJua=null,this.oParent=a,this.visibility=c.observable(!1),this.importing=c.observable(!1)}function Bb(){var a=this;this.loadingList=c.observable(!1),this.loadingViewPane=c.observable(!1),this.showPersonalContacts=c.observable(!1),this.showGlobalContacts=c.observable(!1),this.selectedGroupType=c.observable(_b.ContactsGroupListType.Personal),this.selectedGroupInList=c.observable(null),this.selectedGroupInList.subscribe(function(){var a=this.selectedGroupInList();a&&a.selected(!1)},this,"beforeChange"),this.selectedGroupInList.subscribe(function(a){a&&this.showPersonalContacts()&&(a.selected(!0),this.selectedGroupType(_b.ContactsGroupListType.SubGroup),this.requestContactList())},this),this.selectedGroup=c.observable(null),this.selectedContact=c.observable(null),this.selectedGroupContactsList=c.observable(null),this.oContactModel=new Z,this.oGroupModel=new $,this.oContactImportViewModel=new Ab(this),this.selectedItem=c.computed({read:function(){return this.selectedContact()||this.selectedGroup()||null},write:function(a){a instanceof Z?(this.oContactImportViewModel.visibility(!1),this.selectedGroup(null),this.selectedContact(a)):a instanceof $?(this.oContactImportViewModel.visibility(!1),this.selectedContact(null),this.selectedGroup(a)):(this.selectedGroup(null),this.selectedContact(null)),this.loadingViewPane(!1)},owner:this}),this.sortOrder=c.observable(!0),this.sortType=c.observable(_b.ContactSortType.Name),this.collection=c.observableArray([]),this.isSearchFocused=c.observable(!1),this.searchInput=c.observable(""),this.search=c.observable(""),this.groupFullCollection=c.observableArray([]),this.selectedContact.subscribe(function(a){if(a){var b=a.groups();_.each(this.groupFullCollection(),function(a){a.checked(a&&0<=ac.inArray(a.Id(),b))})}},this),this.selectedGroupType.subscribe(function(a){_b.ContactsGroupListType.Personal===a&&!this.showPersonalContacts()&&this.showGlobalContacts()?this.selectedGroupType(_b.ContactsGroupListType.Global):_b.ContactsGroupListType.Global===a&&!this.showGlobalContacts()&&this.showPersonalContacts()?this.selectedGroupType(_b.ContactsGroupListType.Personal):(_b.ContactsGroupListType.Personal===a||_b.ContactsGroupListType.Global===a)&&(this.selectedGroupInList(null),this.selectedItem(null),this.selector.listCheckedOrSelected(!1),this.requestContactList())},this),this.oPageSwitcher=new qb(0,ec.User.ContactsPerPage),this.oPageSwitcher.currentPage.subscribe(function(){this.requestContactList()},this),this.search.subscribe(function(a){this.searchInput(a)},this),this.searchSubmitCommand=ac.createCommand(this,function(){this.oPageSwitcher.currentPage(1),this.search(this.searchInput()),this.requestContactList()}),this.selector=new l(this.collection,function(b){b&&a.requestContact(b)},_.bind(this.executeDelete,this),_.bind(this.onContactDblClick,this)),this.checkAll=this.selector.koCheckAll(),this.checkAllIncomplite=this.selector.koCheckAllIncomplete(),this.newContactCommand=ac.createCommand(this,this.executeNewContact),this.newGroupCommand=ac.createCommand(this,this.executeNewGroup),this.addContactsCommand=ac.createCommand(this,ac.emptyFunction,this.isEnableAddContacts),this.deleteCommand=ac.createCommand(this,this.executeDelete,this.isEnableDeleting),this.removeFromGroupCommand=ac.createCommand(this,this.executeRemoveFromGroup,this.isEnableRemoveContactsFromGroup),this.importCommand=ac.createCommand(this,this.executeImport),this.exportCommand=ac.createCommand(this,this.executeExport),this.saveCommand=ac.createCommand(this,this.executeSave,function(){var a=this.selectedItem();return a?a.canBeSave():!1}),this.newMessageCommand=ac.createCommand(this,function(){var a=this.selector.listCheckedOrSelected(),b=[];_.isArray(a)&&0<a.length&&(b=_.map(a,function(a){return a.EmailAndName()}),b=_.compact(b),cc.Api.openComposeMessage(b.join(", ")))},function(){return 0<this.selector.listCheckedOrSelected().length}),this.selector.listCheckedOrSelected.subscribe(function(a){this.oGroupModel.newContactsInGroupCount(a.length)},this),this.isLoading=this.loadingList,this.isSearch=c.computed(function(){return""!==this.search()},this),this.isEmptyList=c.computed(function(){return 0===this.collection().length},this),this.inGrooup=c.computed(function(){return _b.ContactsGroupListType.SubGroup===this.selectedGroupType()},this),this.searchText=c.computed(function(){return ac.i18n("CONTACTS/INFO_SEARCH_RESULT",{SEARCH:this.search()})},this)}function Cb(){this.aTabs=[],ec.App.AllowUsersChangeInterfaceSettings&&this.aTabs.push(new Db),this.aTabs.push(new Eb),ec.App.AllowUsersChangeInterfaceSettings&&ec.User.AllowCalendar&&this.aTabs.push(new Fb),ec.User.MobileSyncEnable&&this.aTabs.push(new Gb),ec.User.OutlookSyncEnable&&this.aTabs.push(new Hb),ec.User.IsHelpdeskSupported&&this.aTabs.push(new Rb),dc&&dc.getPluginsSettingsTabs&&_.each(dc.getPluginsSettingsTabs(),_.bind(function(a){this.aTabs.push(new a)},this)),this.tab=c.observable(_b.SettingsTab.Common),this.allowFolderListOrder=c.computed(function(){var a=ec.Accounts.getEdited();return!a.extensionExists("DisableFoldersManualSort")},this),this.folderListOrderUpdateDebounce=_.debounce(_.bind(this.folderListOrderUpdate,this),5e3),this.afterSortableFolderMoveBinded=_.bind(this.afterSortableFolderMove,this),this.iUpdateFolderListTimer=-1,this.bAllowFolderListOrderNameUpdate=!1}function Db(){this.aSkins=ec.App.Themes,this.selectedSkin=c.observable(ec.User.DefaultTheme),this.layout=c.observable(ec.User.Layout),this.aLanguages=ec.App.Languages,this.selectedLanguage=c.observable(ec.User.DefaultLanguage),this.loading=c.observable(!1),this.rangeOfNumbers=[10,20,30,50,75,100,150,200],this.messagesPerPageValues=c.observableArray(this.rangeOfNumbers),this.messagesPerPage=c.observable(this.rangeOfNumbers[0]),this.setMessagesPerPage(ec.User.MailsPerPage),this.contactsPerPageValues=c.observableArray(this.rangeOfNumbers),this.contactsPerPage=c.observable(this.rangeOfNumbers[0]),this.setContactsPerPage(ec.User.ContactsPerPage),this.autocheckmailInterval=c.observable(ec.User.AutoCheckMailInterval),this.richText=c.observable(ec.User.DefaultEditor),this.timeFormat=c.observable(ec.User.defaultTimeFormat()),this.aDateFormats=ac.getDateFormatsForSelector(),this.dateFormat=c.observable(ec.User.DefaultDateFormat),this.useThreads=c.observable(ec.User.useThreads()),this.saveRepliedToCurrFolder=c.observable(ec.User.SaveRepliedToCurrFolder),this.bAllowContacts=ec.User.ShowContacts,this.bAllowCalendar=ec.User.AllowCalendar,this.bAllowThreads=ec.User.ThreadsEnabled,this.firstState=this.getState()}function Eb(){this.accounts=ec.Accounts.collection,this.onlyOneAccount=c.computed(function(){var a=1===this.accounts().length&&!ec.App.AllowUsersAddNewAccounts;return a&&(this.TabTitle=ac.i18n("SETTINGS/TAB_EMAIL_ACCOUNT")),a},this),this.title=c.computed(function(){return this.onlyOneAccount()?ac.i18n("SETTINGS/TITLE_EMAIL_ACCOUNT"):ac.i18n("SETTINGS/TITLE_EMAIL_ACCOUNTS")},this),this.currentAccountId=ec.Accounts.currentId,this.editedAccountId=ec.Accounts.editedId,this.defaultAccountId=ec.Accounts.defaultId,this.defaultAccount=ec.Accounts.getDefault(),this.isAllowFetcher=!!ec.App.AllowFetcher,this.isAllowIdentities=!!ec.AllowIdentities,this.oAccountProperties=new Ib(this),this.oAccountSignature=new Kb(this),this.oAccountFilters=new Nb(this),this.oAccountAutoresponder=new Mb(this),this.oAccountForward=new Lb(this),this.oAccountFolders=new Jb(this),this.oFetcherIncoming=new Ob(this),this.oFetcherOutgoing=new Pb(this),this.oFetcherSignature=new Qb(this),this.oIdentityProperties=new Sb(this,!1),this.fetcher=c.observable(null),this.fetchers=c.observable(null),this.firstFetcher=c.observable(null),this.editedFetcherId=c.observable(null),this.editedIdentityId=c.observable(null),this.defaultAccount.fetchers.subscribe(function(a){if(a){var b=this.defaultAccount.fetchers(),c=b.collection()[0],d=c.id(),e=this.isFetcherTab(this.tab());this.fetchers(b),this.firstFetcher(c),this.editedFetcherId()&&e?this.onChangeFetcher(this.editedFetcherId()):e&&(this.editedFetcherId(d),this.editedIdentityId(null),this.onChangeFetcher(d))}else this.changeAccount(this.defaultAccountId())},this),this.tab=c.observable(_b.AccountSettingsTab.Properties),this.allowUsersAddNewAccounts=ec.App.AllowUsersAddNewAccounts,this.allowUsersChangeInterfaceSettings=ec.App.AllowUsersChangeInterfaceSettings,this.allowAutoresponderExtension=c.observable(!1),this.allowForwardExtension=c.observable(!1),this.allowSieveFiltersExtension=c.observable(!1),this.changeAccount(this.editedAccountId())}function Fb(){this.showWeekends=c.observable(ec.User.CalendarShowWeekEnds),this.loading=c.observable(!1),this.availableTimes=c.observableArray([{text:"00:00",value:"0"},{text:"01:00",value:"1"},{text:"02:00",value:"2"},{text:"03:00",value:"3"},{text:"04:00",value:"4"},{text:"05:00",value:"5"},{text:"06:00",value:"6"},{text:"07:00",value:"7"},{text:"08:00",value:"8"},{text:"09:00",value:"9"},{text:"10:00",value:"10"},{text:"11:00",value:"11"},{text:"12:00",value:"12"},{text:"13:00",value:"13"},{text:"14:00",value:"14"},{text:"15:00",value:"15"},{text:"16:00",value:"16"},{text:"17:00",value:"17"},{text:"18:00",value:"18"},{text:"19:00",value:"19"},{text:"20:00",value:"20"},{text:"21:00",value:"21"},{text:"22:00",value:"22"},{text:"23:00",value:"23"},{text:"24:00",value:"24"}]),this.selectedWorkdayStarts=c.observable(ec.User.CalendarWorkDayStarts),this.selectedWorkdayEnds=c.observable(ec.User.CalendarWorkDayEnds),this.showWorkday=c.observable(ec.User.CalendarShowWorkDay),this.weekStartsOn=c.observable(ec.User.CalendarWeekStartsOn),this.defaultTab=c.observable(ec.User.CalendarDefaultTab),this.firstState=this.getState()}function Gb(){this.mobileSync=ec.User.mobileSync,this.mobileSync.subscribe(this.onMobileSyncSubscribe,this),this.enableDav=c.observable(!1),this.davLogin=c.observable(""),this.davServer=c.observable(""),this.davCalendars=c.observable([]),this.visibleCalendars=c.computed(function(){return this.davCalendars().length>0},this),this.davPersonalContactsUrl=c.observable(""),this.davCollectedAddressesUrl=c.observable(""),this.davGlobalAddressBookUrl=c.observable(""),this.bVisiblePersonalContacts=ec.User.ShowPersonalContacts,this.bVisibleGlobalContacts=ec.User.ShowGlobalContacts,this.bVisibleContacts=ec.User.ShowContacts,this.bVisibleCalendar=ec.User.AllowCalendar,this.bVisibleFiles=ec.User.IsFilesSupported,this.bVisibleIosLink=hc,this.visibleDavViaUrls=c.computed(function(){return this.visibleCalendars()||this.bVisibleContacts},this),this.password=c.observable(ec.User.IsDemo?ec.User.MobileSyncDemoPass:ac.i18n("SETTINGS/MOBILE_DAVSYNC_PASSWORD_VALUE")),this.bChanged=!1}function Hb(){this.outlookSync=ec.User.outlookSync,this.outlookSync.subscribe(this.onOutlookSyncSubscribe,this),this.visibleOutlookSync=c.observable(!1),this.login=c.observable(""),this.server=c.observable(""),this.password=c.observable(ec.User.IsDemo?ec.User.OutlookSyncDemoPass:ac.i18n("SETTINGS/OUTLOOKSYNC_PASSWORD_VALUE")),this.bChanged=!1}function Ib(){this.allowUsersChangeInterfaceSettings=ec.App.AllowUsersChangeInterfaceSettings,this.allowUsersChangeEmailSettings=ec.App.AllowUsersChangeEmailSettings,this.account=c.observable(null),this.isInternal=c.observable(!0),this.isLinked=c.observable(!0),this.isDefault=c.observable(!1),this.removeHint=c.observable(""),this.friendlyName=c.observable(""),this.email=c.observable(""),this.incomingMailLogin=c.observable(""),this.incomingMailPassword=c.observable(""),this.incomingMailPort=c.observable(0),this.incomingMailServer=c.observable(""),this.outgoingMailLogin=c.observable(""),this.outgoingMailPassword=c.observable(""),this.outgoingMailPort=c.observable(0),this.outgoingMailServer=c.observable(""),this.loading=c.observable(!1),this.allowChangePassword=c.observable(!1),this.useSmtpAuthentication=c.observable(!1),this.incLoginFocused=c.observable(!1),this.incLoginFocused.subscribe(function(){this.incLoginFocused()&&""===this.incomingMailLogin()&&this.incomingMailLogin(this.email())},this),this.outServerFocused=c.observable(!1),this.outServerFocused.subscribe(function(){this.outServerFocused()&&""===this.outgoingMailServer()&&this.outgoingMailServer(this.incomingMailServer())},this),this.account.subscribe(function(a){this.populate(a)},this),this.firstState=null}function Jb(a){this.parent=a,this.highlighted=c.observable(!1).extend({autoResetToFalse:500}),this.collection=c.observableArray(cc.MailCache.editedFolderList().collection()),this.totalMessageCount=c.computed(function(){return cc.MailCache.editedFolderList().totalMessageCount()},this),this.enableButtons=c.computed(function(){return cc.MailCache.editedFolderList().bInitialized()},this),cc.MailCache.editedFolderList.subscribe(function(a){this.collection(a.collection())},this),this.addNewFolderCommand=ac.createCommand(this,this.onAddNewFolderClick,this.enableButtons),this.systemFoldersCommand=ac.createCommand(this,this.onSystemFoldersClick,this.enableButtons),this.showMovedWithMouseItem=c.computed(function(){var a=ec.Accounts.getEdited();return!jc&&!a.extensionExists("DisableFoldersManualSort")},this)}function Kb(a){this.parent=a,this.account=c.observable(null),this.type=c.observable(!1),this.useSignature=c.observable(0),this.signature=c.observable(""),this.loading=c.observable(!1),this.account.subscribe(function(){this.getSignature()},this),this.oHtmlEditor=new rb(!1),this.enabled=c.observable(!0),this.signature.subscribe(function(){this.oHtmlEditor.setText(this.signature())},this),ec.Accounts.editedId.subscribe(function(){this.account(ec.Accounts.getEdited())},this),this.getSignature(),this.firstState=null}function Lb(){this.account=c.observable(null),this.available=c.observable(!1),this.loading=c.observable(!1),this.enable=c.observable(!1),this.email=c.observable(""),this.available=c.computed(function(){var a=this.account();return a&&a.forward()},this),this.account.subscribe(function(){this.getForward()},this),this.firstState=null}function Mb(){this.account=c.observable(null),this.available=c.observable(!1),this.loading=c.observable(!1),this.enable=c.observable(!1),this.subject=c.observable(""),this.message=c.observable(""),this.available=c.computed(function(){var a=this.account();return a&&a.autoresponder()},this),this.account.subscribe(function(){this.getAutoresponder()},this),this.firstState=null
}function Nb(){this.account=c.observable(null),this.folderList=c.observable(cc.MailCache.editedFolderList()),cc.MailCache.editedFolderList.subscribe(function(a){this.folderList(a)},this),this.foldersOptions=c.computed(function(){return this.folderList()?this.folderList().getOptions(ac.i18n("SETTINGS/ACCOUNT_FOLDERS_NOT_SELECTED"),!0,!0):[]},this),this.available=c.observable(!1),this.loading=c.observable(!1),this.collection=c.observableArray([]),this.newCollection=c.observableArray([]),this.available=c.computed(function(){var a=this.account();return!(!a||!a.filters())},this),this.account.subscribe(function(){this.getFilters()},this),this.fieldOptions=[{text:ac.i18n("SETTINGS/ACCOUNT_FILTERS_FIELD_FROM"),value:0},{text:ac.i18n("SETTINGS/ACCOUNT_FILTERS_FIELD_TO"),value:1},{text:ac.i18n("SETTINGS/ACCOUNT_FILTERS_FIELD_SUBJECT"),value:2}],this.conditionOptions=[{text:ac.i18n("SETTINGS/ACCOUNT_FILTERS_COND_CONTAIN_SUBSTR"),value:0},{text:ac.i18n("SETTINGS/ACCOUNT_FILTERS_COND_EQUAL_TO"),value:1},{text:ac.i18n("SETTINGS/ACCOUNT_FILTERS_COND_NOT_CONTAIN_SUBSTR"),value:2}],this.actionOptions=[{text:ac.i18n("SETTINGS/ACCOUNT_FILTERS_ACTION_MOVE"),value:3},{text:ac.i18n("SETTINGS/ACCOUNT_FILTERS_ACTION_DELETE"),value:1}],this.phaseArray=[""],_.each(ac.i18n("SETTINGS/ACCOUNT_FILTERS_PHRASE").split(/\s/),function(a){var b=this.phaseArray.length-1;"%"===a.substr(0,1)||"%"===this.phaseArray[b].substr(-1,1)?this.phaseArray.push(a):this.phaseArray[b]+=" "+a},this),this.firstState=null}function Ob(){this.defaultAccountId=ec.Accounts.defaultId,this.folderList=cc.MailCache.folderList,this.loading=c.observable(!1),this.fetcher=c.observable(null),this.idFetcher=c.observable(null),this.isEnabled=c.observable(!0),this.incomingMailServer=c.observable(""),this.incomingMailPort=c.observable(110),this.incomingMailLogin=c.observable(""),this.incomingMailPassword=c.observable(""),this.folder=c.observable(""),this.options=c.computed(function(){return this.folderList().getOptions(void 0,!0)},this),this.leaveMessagesOnServer=c.observable(!1),this.folderList.subscribe(function(){this.folder(this.fetcher()?this.fetcher().folder():"")},this),this.serverIsSelected=c.observable(!1),this.loginIsSelected=c.observable(!1),this.passwordIsSelected=c.observable(!1),this.defaultOptionsAfterRender=ac.defaultOptionsAfterRender}function Pb(){this.defaultAccountId=ec.Accounts.defaultId,this.loading=c.observable(!1),this.fetcher=c.observable(null),this.idFetcher=c.observable(null),this.isEnabled=c.observable(!0),this.email=c.observable(""),this.userName=c.observable(""),this.isOutgoingEnabled=c.observable(!1),this.outgoingMailServer=c.observable(""),this.outgoingMailPort=c.observable(25),this.outgoingMailAuth=c.observable(!1),this.serverIsSelected=c.observable(!1)}function Qb(a){this.defaultAccountId=ec.Accounts.defaultId,this.idFetcher=c.observable(null),this.fetcher=c.observable(null),this.signature=c.observable(""),this.loading=c.observable(!1),this.type=c.observable(!1),this.useSignature=c.observable(0),this.oHtmlEditor=new rb(!1),this.enabled=a.oFetcherIncoming.isEnabled,this.enabled.subscribe(function(){this.oHtmlEditor.isEnable(this.enabled())},this),this.signature.subscribe(function(){this.oHtmlEditor.setText(this.signature())},this),this.firstState=null}function Rb(){this.allowNotifications=c.observable(ec.User.AllowHelpdeskNotifications),this.loading=c.observable(!1)}function Sb(a,b){this.defaultAccountId=ec.Accounts.defaultId,this.oParent=a,this.bCreate=b,this.loading=c.observable(!1),this.identity=c.observable(null),this.enabled=c.observable(!0),this.email=c.observable(""),this.friendlyName=c.observable(""),this.signature=c.observable(""),this.useSignature=c.observable(0),this.oHtmlEditor=new rb(!1),this.signature.subscribe(function(){this.oHtmlEditor.setText(this.signature())},this),this.enabled.subscribe(function(){this.oHtmlEditor.isEnable(this.enabled())},this)}function Tb(){this.aDayNames=ac.i18n("DATETIME/DAY_NAMES").split(" "),this.correctedDayNames=c.observable(this.aDayNames);var a=this;this.isPublic=fc,this.publicCalendarId=this.isPublic?ec.CalendarPubHash:"",this.publicCalendarName=c.observable(""),this.timeFormatGrid=ec.User.defaultTimeFormat()===_b.TimeFormat.F24?"HH:mm":"hh:mm TT",this.timeFormatMoment=ec.User.defaultTimeFormat()===_b.TimeFormat.F24?"HH:mm":"hh:mm A",this.dateFormat=ec.User.DefaultDateFormat,this.dateTitle=c.observable(""),this.dateTitleHelper=c.observableArray(ac.i18n("DATETIME/MONTH_NAMES").split(" ")),this.selectedView=c.observable(""),this.visibleWeekdayHeader=c.computed(function(){return"month"===this.selectedView()},this),this.selectedView.subscribe(function(){this.resize()},this),this.$calendarGrid=null,this.calendarGridDom=c.observable(null),this.$datePicker=null,this.datePickerDom=c.observable(null),this.calendars=new cb({onCalendarActiveChange:_.bind(function(a){var b=a.active()?"addEventSource":"removeEventSource";this.$calendarGrid.fullCalendar(b,{events:a.events}),this.refreshDatePicker()},this)}),this.colors=["#f09650","#f68987","#6fd0ce","#8fbce2","#b9a4f5","#f68dcf","#d88adc","#4afdb4","#9da1ff","#5cc9c9","#77ca71","#aec9c9"],this.busyDays=c.observableArray([]),this.$inlineEditedEvent=null,this.inlineEditedEventText=null,this.checkStarted=c.observable(!1),this.loaded=!1,this.startDateTime=0,this.endDateTime=0,this.needsToReload=!1,this.calendarListClick=function(a){a.active(!a.active())},this.currentCalendarDropdown=c.observable(!1),this.currentCalendarDropdownOffset=c.observable(0),this.calendarDropdownToggle=function(b,c){if(c&&b){var d=c.position(),e=c.outerHeight();a.currentCalendarDropdownOffset(parseInt(d.top,10)+e)}a.currentCalendarDropdown(b)},this.dayNamesResizeBinding=_.throttle(_.bind(this.resize,this),50),this.customscrollTop=c.observable(0),this.fullcalendarOptions={header:!0,editable:!this.isPublic,selectable:!this.isPublic,allDayText:ac.i18n("CALENDAR/TITLE_ALLDAY"),dayNames:this.aDayNames,isRTL:ac.isRTL(),firstHour:8,columnFormat:{month:"dddd",week:"dddd d",day:"dddd d"},titleFormat:{month:"MMMM yyyy",week:"MMMM d[ yyyy]{ '-'[ MMMM] d yyyy}",day:"MMMM D, YYYY"},select:_.bind(this.createEventFromGrid,this),eventClick:_.bind(this.openEditEventForm,this),eventDragStop:_.bind(this.refreshDatePicker,this),eventResizeStop:_.bind(this.refreshDatePicker,this),eventDrop:_.bind(this.moveEvent,this),eventResize:_.bind(this.resizeEvent,this),viewRender:_.bind(this.displayViewCallback,this)},this.revertFunction=null,this.calendarSharing=ec.User.AllowCalendar&&ec.User.CalendarSharing,this.defaultViewName=c.computed(function(){var a="month";switch(ec.User.CalendarDefaultTab){case _b.CalendarDefaultTab.Day:a="agendaDay";break;case _b.CalendarDefaultTab.Week:a="agendaWeek";break;case _b.CalendarDefaultTab.Month:a="month"}return a},this)}function Ub(){this.isPublic=fc,this.publicHash=fc?ec.FileStoragePubHash:"",this.groups=c.observableArray(),this.folders=c.observableArray(),this.files=c.observableArray(),this.uploadingFiles=c.observableArray(),this.selected=c.observable(!1),this.storageType=c.observable(_b.FileStorageType.Private),this.rootPath=c.computed(function(){var a=ac.i18n("FILESTORAGE/TAB_PRIVATE_FILES");return this.isPublic?a=ec.FileStoragePubParams.Name:this.storageType()===_b.FileStorageType.Corporate&&(a=ac.i18n("FILESTORAGE/TAB_CORPORATE_FILES")),a},this),this.iPathIndex=c.observable(-1),this.aPath=c.observableArray(),this.dropPath=c.observable(""),this.path=c.computed(function(){var a=_.map(this.aPath(),function(a){return a.fileName()});return a.join("/")},this),this.path.subscribe(function(a){this.dropPath(a)},this),this.collection=c.computed(function(){var a=_.union(this.files(),this.getUploadingFiles());return a.sort(function(a,b){return a.fileName()===b.fileName()?0:a.fileName()<b.fileName()?-1:1}),_.union(this.folders(),a)},this),this.columnCount=c.observable(1),this.selector=new l(this.collection,null,_.bind(this.onItemDelete,this),_.bind(this.onItemDblClick,this),_.bind(this.onEnter,this),this.columnCount,!0,!0,!0),this.storageType.subscribe(function(){this.selector.listCheckedAndSelected(!1)},this),this.searchPattern=c.observable(""),this.isSearchFocused=c.observable(!1),this.renameCommand=ac.createCommand(this,this.executeRename,function(){return 1===this.selector.listCheckedAndSelected().length}),this.deleteCommand=ac.createCommand(this,this.executeDelete,function(){var a=this.selector.listCheckedAndSelected();return 0<a.length}),this.downloadCommand=ac.createCommand(this,this.executeDownload,function(){var a=this.selector.listCheckedAndSelected();return 1===a.length&&!a[0].isFolder()}),this.shareCommand=ac.createCommand(this,this.executeShare,function(){var a=this.selector.listCheckedAndSelected();return 1===a.length}),this.sendCommand=ac.createCommand(this,this.executeSend,function(){var a=this.selector.listCheckedAndSelected(),b=_.filter(a,function(a){return!a.isFolder()},this);return b.length>0}),this.uploaderButton=c.observable(null),this.uploaderArea=c.observable(null),this.bDragActive=c.observable(!1),this.bDragActiveComp=c.computed(function(){var a=this.bDragActive();return a&&""===this.searchPattern()},this),this.uploadError=c.observable(!1),this.quota=c.observable(0),this.used=c.observable(0),this.quotaDesc=c.observable(""),this.quotaProc=c.observable(-1),c.computed(function(){if(!ec.App.ShowQuotaBar)return!0;var a=this.quota(),b=this.used(),c=a>0?Math.ceil(b/a*100):-1;return c=c>100?100:c,this.quotaProc(c),this.quotaDesc(c>-1?ac.i18n("MAILBOX/QUOTA_TOOLTIP",{PROC:c,QUOTA:ac.friendlySize(a)}):""),!0},this),this.dragover=c.observable(!1),this.loading=c.observable(!1),this.fileListInfoText=c.computed(function(){var a="";return this.loading()||0===this.collection().length&&(a=""!==this.searchPattern()?ac.i18n("FILESTORAGE/INFO_NO_ITEMS_FOUND"):""===this.path()?ac.i18n("FILESTORAGE/INFO_FILESTORAGE_IS_EMTY"):ac.i18n("FILESTORAGE/INFO_FOLDER_IS_EMPY")),a},this),this.dragAndDropHelperBinded=_.bind(this.dragAndDropHelper,this),this.lastPath=c.observable(null)}function Vb(){var a=this,b=function(b){return function(){a.executeChangeState(b),a.isQuickReplyHidden(!a.bAgent),b===_b.HelpdeskThreadStates.Resolved&&a.selectedItem(null)}};this.bRtl=ac.isRTL(),this.iAutoCheckTimer=0,this.bExtApp=fc,this.ajaxSendFunc=this.bExtApp?"sendExt":"send",this.bAgent=ec.User.IsHelpdeskAgent,this.singleMode=ec.SingleMode,this.externalUrl=c.observable(ec.HelpdeskIframeUrl),this.loadingList=c.observable(!0),this.loadingViewPane=c.observable(!1),this.loadingMoreMessages=c.observable(!1),this.threads=c.observableArray([]),this.posts=c.observableArray([]),this.iPingInterval=-1,this.iPingStartTimer=-1,this.selectedItem=c.observable(null),this.selectedItem.subscribe(function(){this.subject(this.selectedItem()?this.bExtApp?this.selectedItem().sSubject:this.selectedItem().sFromFull:""),this.internalNote(!1),!this.bExtApp&&this.selectedItem()&&cc.ContactsCache.getContactByEmail(this.selectedItem().sEmail,this.onOwnerContactResponse,this),clearInterval(this.iPingInterval),clearTimeout(this.iPingStartTimer),this.watchers([]),this.selectedItem()&&(this.iPingStartTimer=setTimeout(_.bind(function(){this.executeThreadPing(this.selectedItem().Id),clearInterval(this.iPingInterval),this.iPingInterval=setInterval(_.bind(function(){this.executeThreadPing(this.selectedItem().Id)},this),18e4)},this),5e3))},this),this.listFilter=c.observable(this.bAgent?_b.HelpdeskFilters.Open:_b.HelpdeskFilters.All),this.listFilter.subscribe(function(){this.requestThreadsList()},this),this.prevListFilter=c.observable(""),this.hasMorePosts=c.computed(function(){var a=this.selectedItem();return a&&a.postsCount()>this.posts().length},this),this.selector=new l(this.threads,_.bind(this.onItemClick,this),_.bind(this.onItemDelete,this),_.bind(this.onItemDblClick,this),null,null,!1,!1,!1,!0),this.checkStarted=c.observable(!1),this.checkAll=this.selector.koCheckAll(),this.checkAllIncomplite=this.selector.koCheckAllIncomplete(),this.ThreadsPerPage=10,this.oPageSwitcher=new qb(0,this.ThreadsPerPage),this.oPageSwitcher.currentPage.subscribe(function(){this.requestThreadsList()},this),this.isSearchFocused=c.observable(!1),this.searchPattern=c.observable(""),this.search=c.observable(""),this.search.subscribe(function(a){this.searchPattern(a)},this),this.searchText=c.computed(function(){return ac.i18n("HELPDESK/INFO_SEARCH_RESULT",{SEARCH:this.search()})},this),this.searchSubmitCommand=ac.createCommand(this,function(){this.oPageSwitcher.currentPage(1),this.search(this.searchPattern()),this.requestThreadsList()}),this.deleteCommand=ac.createCommand(this,this.executeDelete,this.isEnableListActions),this.openNewWindowCommand=ac.createCommand(this,this.executeOpenNewWindow,this.isEnableListActions),this.checkCommand=ac.createCommand(this,function(){this.requestThreadsList(),this.requestPosts(),this.startAutochekmail()}),this.closeCommand=ac.createCommand(this,b(_b.HelpdeskThreadStates.Resolved),this.isEnableListActions),this.waitCommand=ac.createCommand(this,b(_b.HelpdeskThreadStates.Waiting),this.isEnableListActions),this.pendingCommand=ac.createCommand(this,b(_b.HelpdeskThreadStates.Pending),this.isEnableListActions),this.deferCommand=ac.createCommand(this,b(_b.HelpdeskThreadStates.Deferred),this.isEnableListActions),this.answerCommand=ac.createCommand(this,b(_b.HelpdeskThreadStates.Answered),this.isEnableListActions),this.postCommand=ac.createCommand(this,this.executePostCreate,function(){return!!this.selectedItem()&&this.posts().length>0&&this.replyText().length>0&&this.allAttachmentsUploaded()}),this.visibleNewThread=c.observable(!1),this.newThreadText=c.observable(""),this.newThreadCreating=c.observable(!1),this.createThreadCommand=ac.createCommand(this,this.executeThreadCreate,function(){return this.visibleNewThread()&&this.newThreadText().length>0&&!this.newThreadCreating()}),this.createThreadButtonText=c.computed(function(){return this.newThreadCreating()?ac.i18n("HELPDESK/BUTTON_SENDING"):ac.i18n("HELPDESK/BUTTON_CREATE")},this),this.showThreadsByOwnerCommand=ac.createCommand(this,this.executeShowThreadsByOwner),this.commandGetOlderPosts=function(){var a=this.posts(),b=a[0]?a[0].Id:0;this.requestPosts(null,b)},this.externalContentUrl=c.observable(""),ec.HelpdeskIframeUrl&&(this.bAgent?this.externalContentUrl=c.computed(function(){var a="",b=this.selectedItem();return b&&(a=b.Email()),a?ec.HelpdeskIframeUrl.replace(/\[EMAIL\]/g,a):""},this):ec.User.Email&&(this.externalContentUrl=c.computed(function(){return ec.HelpdeskIframeUrl.replace(/\[EMAIL\]/g,ec.User.Email)},this))),this.clientDetailsVisible=c.observable(cc.Storage.hasData("HelpdeskUserDetails")?cc.Storage.getData("HelpdeskUserDetails"):!0),this.clientDetailsVisible.subscribe(function(a){cc.Storage.setData("HelpdeskUserDetails",a)},this),this.subject=c.observable(""),this.watchers=c.observableArray([]),this.ownerExistsInContacts=c.observable(!1),this.ownerContactInfoReceived=c.observable(!1),this.ownerContact=c.observable(this.bExtApp?null:new Z),this.hasOwnerContact=c.computed(function(){return!this.singleMode&&this.ownerContactInfoReceived()&&this.ownerExistsInContacts()},this),this.visibleAddToContacts=c.computed(function(){return!this.singleMode&&this.ownerContactInfoReceived()&&!this.ownerExistsInContacts()},this),this.contactCardWidth=c.observable(0),this.viewAllMailsWithContactBinded=_.bind(this.viewAllMailsWithContact,this),this.uploadedFiles=c.observableArray([]),this.allAttachmentsUploaded=c.computed(function(){var a=_.filter(this.uploadedFiles(),function(a){return!a.uploaded()});return 0===a.length},this),this.uploaderButton=c.observable(null),this.uploaderButtonCompose=c.observable(null),this.uploaderArea=c.observable(null),this.bDragActive=c.observable(!1),this.internalNote=c.observable(!1),this.isQuickReplyHidden=c.observable(!this.bAgent),this.domQuickReply=c.observable(null),this.replySendingStarted=c.observable(!1),this.replyPaneVisible=c.observable(!0),this.replyText=c.observable(""),this.replyTextFocus=c.observable(!1),this.isQuickReplyActive=c.observable(!1),this.replyTextFocus.subscribe(function(){this.replyTextFocus()&&this.isQuickReplyActive(!0)},this),this.isQuickReplyActive.subscribe(function(){this.isQuickReplyActive()&&this.replyTextFocus(!0)},this),this.isEmptyQuickReplyPane=c.computed(function(){return 0===this.replyText().length&&!this.internalNote()&&0===this.uploadedFiles().length},this),this.isSearch=c.computed(function(){return""!==this.search()},this),this.isEmptyList=c.computed(function(){return 0===this.threads().length},this),this.dynamicEmptyListInfo=this.bAgent?c.computed(function(){return this.isEmptyList()&&this.isSearch()?ac.i18n("HELPDESK/INFO_SEARCH_EMPTY"):ac.i18n("HELPDESK/INFO_EMPTY_OPEN_THREAD_LIST_AGENT")},this):c.computed(function(){return this.isEmptyList()&&this.isSearch()?ac.i18n("HELPDESK/INFO_SEARCH_EMPTY"):ac.i18n("HELPDESK/INFO_EMPTY_THREAD_LIST")},this),this.simplePreviewPane=c.computed(function(){var a=this.selectedItem();return a?a.ItsMe:!this.bAgent},this),this.allowInternalNote=c.computed(function(){return!this.simplePreviewPane()},this),this.scrollToTopTrigger=c.observable(!1),this.scrollToBottomTrigger=c.observable(!1),this.allowDownloadAttachmentsLink=!1,this.newThreadButtonWidth=c.observable(0),this.requestFromLogin()}function Wb(){this.oScreens={},this.currentScreen=c.observable(""),this.popupVisibility=c.observable(!1),this.informationScreen=c.observable(null),this.popups=[]}function Xb(){this.currentAccountId=ec.Accounts.currentId,this.currentAccountId.subscribe(function(a){var b=ec.Accounts.getAccount(a),c=this.oFolderListItems[a],d={Action:"FolderList",AccountID:a};b&&(_.delay(_.bind(b.updateQuotaParams,b),5e3),this.messagesLoading(!0),c?this.folderList(c):(this.folderList(new U),this.messages([]),ac.log("currentAccountId.subscribe currentMessage = null"),this.currentMessage(null),cc.Ajax.send(d,this.onFolderListResponse,this)))},this),this.editedAccountId=ec.Accounts.editedId,this.editedAccountId.subscribe(function(a){var b=this.oFolderListItems[a],c={};b?this.editedFolderList(b):this.currentAccountId()!==a&&(this.editedFolderList(new U),c={Action:"FolderList",AccountID:a},cc.Ajax.send(c,this.onFolderListResponse,this))},this),this.oFolderListItems={},this.quotaChangeTrigger=c.observable(!1),this.checkMailStarted=c.observable(!1),this.folderList=c.observable(new U),this.editedFolderList=c.observable(new U),this.newMessagesCount=c.computed(function(){var a=this.folderList().inboxFolder();return a?a.unseenMessageCount():0},this),this.newMessagesCount.subscribe(function(){ac.log("New messages count",this.newMessagesCount())},this),this.messages=c.observableArray([]),this.messages.subscribe(function(){cc.Prefetcher.startThreadListPrefetch()},this),this.uidList=c.observable(new W),this.page=c.observable(1),this.messagesLoading=c.observable(!0),this.messagesLoadingError=c.observable(!1),this.currentMessage=c.observable(null),this.currentMessage.subscribe(function(){ac.log("Current message",this.currentMessage()),this.currentMessage()&&dc.runPluginHook("view-message",[ec.Accounts.currentId(),this.currentMessage().folder(),this.currentMessage().uid()])},this),this.deletedDraftMessageUid=c.observable(""),this.aResponseHandlers=[],ec.User.useThreads.subscribe(function(){_.each(this.oFolderListItems,function(a){_.each(a.collection(),function(a){a.markHasChanges(),a.removeAllMessageListsFromCacheIfHasChanges()},this)},this),this.messages([])},this),this.iAutoCheckMailTimer=-1}function Yb(){this.contacts={},this.responseHandlers={},this.vcardAttachments=[],this.recivedAnim=c.observable(!1).extend({autoResetToFalse:500})}function Zb(){this.calendars=c.observableArray([]),this.calendarsLoadingStarted=c.observable(!1),this.icalAttachments=[],this.recivedAnim=c.observable(!1).extend({autoResetToFalse:500}),this.calendarSettingsChanged=c.observable(!1),this.calendarChanged=c.observable(!1)}function $b(){this.browser=new f,this.headerTabs=c.observableArray([]),this.screensTitle={},this.Ajax=new g,this.Routing=new h,this.Screens=new Wb,this.Links=new i,this.Api=new m,this.MessageSender=new j,this.Prefetcher=new k,this.MailCache=null,this.ContactsCache=new Yb,this.CalendarCache=new Zb,this.Storage=new n,this.Phone=new o,this.$downloadIframe=null,this.currentScreen=this.Screens.currentScreen,this.currentScreen.subscribe(this.setTitle,this),this.focused=c.observable(!0),this.focused.subscribe(this.setTitle,this),this.init(),this.newMessagesCount=this.MailCache.newMessagesCount,this.newMessagesCount.subscribe(this.setTitle,this),this.currentMessage=this.MailCache.currentMessage,this.currentMessage.subscribe(this.setTitle,this),this.notification=null,this.initHeaderInfo()}var _b={},ac={},bc=b.pSevenI18N||{},cc={},dc={},ec=b.pSevenAppData||{},fc=!1,gc=a("html"),hc=-1<navigator.userAgent.indexOf("iPhone")||-1<navigator.userAgent.indexOf("iPod")||-1<navigator.userAgent.indexOf("iPad"),ic=-1<navigator.userAgent.toLowerCase().indexOf("android"),jc=hc||ic,kc=["image/jpeg","image/png","image/gif","text/html","text/plain","text/css","text/rfc822-headers","message/delivery-status","application/x-httpd-php","application/javascript"];b.Modernizr&&navigator&&b.Modernizr.addTest("pdf",function(){for(var a=navigator.mimeTypes,b=0,c=a.length;c>b;b++)if("application/pdf"===a[b].type)return!0;return!1}),f.prototype.getIeVersion=function(){var a=navigator.userAgent.toLowerCase(),b=ac.pInt(a.slice(a.indexOf("msie")+4,a.indexOf(";",a.indexOf("msie")+4)));return b},g.prototype.hasOpenedRequests=function(){return this.aRequests.length>0},g.prototype.isSearchMessages=function(){var a=!1;return _.each(this.aRequests,function(b){b&&b.Parameters&&"MessageList"===b.Parameters.Action&&""!==b.Parameters.Search&&(a=!0)},this),a},g.prototype.isAllowedActionWithoutAuth=function(a){var b=["Login","LoginLanguageUpdate","Logout","AccountCreate"];return-1!==_.indexOf(b,a)},g.prototype.isAllowedExtAction=function(a){return"SocialRegister"===a||"HelpdeskRegister"===a||"HelpdeskForgot"===a||"HelpdeskLogin"===a||"Logout"===a},g.prototype.doSend=function(b,c,d,e){var f=_.bind(e||null,this,b,c,d),g=_.bind(this.fail,this,b,c,d),h=_.bind(this.always,this,b),i=null;dc.runPluginHook&&dc.runPluginHook("ajax-default-request",[b.Action,b]),ec.Token&&(b.Token=ec.Token),this.abortRequests(b),ac.log("Ajax request send",b.Action,b),i=a.ajax({url:this.sUrl,type:"POST",async:!0,dataType:"json",data:b,success:f,error:g,complete:h}),this.aRequests.push({Parameters:b,Xhr:i})},g.prototype.send=function(a,b,c){var d=void 0===a.AccountID,e=d||ec.Accounts.hasAccountWithId(a.AccountID);a&&(ec.Auth&&e||this.isAllowedActionWithoutAuth(a.Action))&&(d&&"Login"!==a.Action&&(a.AccountID=ec.Accounts.currentId()),this.doSend(a,b,c,this.done))},g.prototype.sendExt=function(a,b,c){var d=["SocialRegister","HelpdeskRegister","HelpdeskForgot","HelpdeskLogin","HelpdeskForgotChangePassword","Logout","CalendarList","EventList","FilesPub"],e=-1!==_.indexOf(d,a.Action);a&&(ec.Auth||e)&&(ec.TenantHash&&(a.TenantHash=ec.TenantHash),this.doSend(a,b,c,this.doneExt))},g.prototype.abortRequests=function(a){switch(a.Action){case"MessageMove":case"MessageDelete":this.abortRequestByActionName("MessageList",{Folder:a.Folder}),this.abortRequestByActionName("Message");break;case"MessageList":case"MessageSetSeen":this.abortRequestByActionName("MessageList",{Folder:a.Folder});break;case"FolderClear":this.abortRequestByActionName("MessageList",{Folder:a.Folder}),this.abortRequestByActionName("FolderCounts");break;case"ContactList":case"GlobalContactList":this.abortRequestByActionName("ContactList"),this.abortRequestByActionName("GlobalContactList");break;case"Contact":case"GlobalContact":this.abortRequestByActionName("Contact"),this.abortRequestByActionName("GlobalContact");break;case"EventUpdate":this.abortRequestByActionName("EventUpdate",{calendarId:a.calendarId,uid:a.uid})}},g.prototype.abortRequestByActionName=function(a,b){var c;_.each(this.aRequests,function(d,e){if(c=!1,d&&d.Parameters.Action===a)switch(a){case"MessageList":b.Folder===d.Parameters.Folder&&(c=!0);break;case"EventUpdate":b.calendarId===d.Parameters.calendarId&&b.uid===d.Parameters.uid&&(c=!0);break;default:c=!0}c&&(d.Xhr.abort(),this.aRequests[e]=void 0)},this),this.aRequests=_.compact(this.aRequests)},g.prototype.abortAllRequests=function(){_.each(this.aRequests,function(a){a&&a.Xhr.abort()},this),this.aRequests=[]},g.prototype.done=function(a,b,c,d,e){var f=this.isAllowedActionWithoutAuth(a.Action),g=ec.Accounts.hasAccountWithId(a.AccountID),h=a.AccountID===ec.Accounts.defaultId();if(ac.log("Ajax request done",a.Action,e,ac.getAjaxDataForLog(a.Action,d),a),f||g){if(d&&!d.Result)switch(d.ErrorCode){case _b.Errors.InvalidToken:f||cc.tokenProblem();break;case _b.Errors.AuthError:h&&!f&&(this.abortAllRequests(),cc.authProblem())}this.executeResponseHandler(b,c,d,a)}},g.prototype.doneExt=function(a,b,c,d){this.executeResponseHandler(b,c,d,a)},g.prototype.fail=function(a,b,c,d,e,f){var g={Result:!1,ErrorCode:0};switch(ac.log("Ajax request fail",a.Action,e,a),e){case"abort":g={Result:!1,ErrorCode:_b.Errors.NotDisplayedError};break;default:case"error":case"parseerror":g=""===f?{Result:!1,ErrorCode:_b.Errors.NotDisplayedError}:{Result:!1,ErrorCode:_b.Errors.DataTransferFailed}}this.executeResponseHandler(b,c,g,a)},g.prototype.executeResponseHandler=function(a,b,c,d){c||(c={Result:!1,ErrorCode:0}),dc.runPluginHook&&dc.runPluginHook("ajax-default-response",[d.Action,c]),"function"==typeof a&&a.apply(b,[c,d])},g.prototype.always=function(a){_.each(this.aRequests,function(b,c){b&&_.isEqual(b.Parameters,a)&&(this.aRequests[c]=void 0)},this),this.aRequests=_.compact(this.aRequests)},_b.Screens={Login:"login",Information:"information",Header:"header",Mailbox:"mailbox",BottomMailbox:"bottommailbox",SingleMessageView:"single-message-view",Compose:"compose",SingleCompose:"single-compose",Settings:"settings",Contacts:"contacts",Calendar:"calendar",FileStorage:"files",Helpdesk:"helpdesk",SingleHelpdesk:"single-helpdesk"},_b.MailboxLayout={Side:0,Bottom:1},_b.CalendarDefaultTab={Day:1,Week:2,Month:3},_b.TimeFormat={F24:0,F12:1},_b.Errors={InvalidToken:101,AuthError:102,DataBaseError:104,LicenseProblem:105,DemoLimitations:106,Captcha:107,AccessDenied:108,CanNotGetMessage:202,ImapQuota:205,NotSavedInSentItems:304,CanNotChangePassword:502,AccountOldPasswordNotCorrect:503,FetcherIncServerNotAvailable:702,FetcherLoginNotCorrect:703,HelpdeskThrowInWebmail:805,HelpdeskUserNotExists:807,HelpdeskUserNotActivated:808,MailServerError:901,DataTransferFailed:1100,NotDisplayedError:1155},_b.FolderTypes={Inbox:1,Sent:2,Drafts:3,Spam:4,Trash:5,Virus:6,Starred:7,System:9,User:10},_b.FolderFilter={Flagged:"flagged"},_b.LoginFormType={Email:0,Login:3,Both:4},_b.LoginSignMeType={DefaultOff:0,DefaultOn:1,Unuse:2},_b.ReplyType={Reply:"reply",ReplyAll:"reply-all",Resend:"resend",Forward:"forward"},_b.Importance={Low:5,Normal:3,High:1},_b.Sensivity={Nothing:0,Confidential:1,Private:2,Personal:3},_b.ContactEmailType={Personal:"Personal",Business:"Business",Other:"Other"},_b.ContactPhoneType={Mobile:"Mobile",Personal:"Personal",Business:"Business"},_b.ContactAddressType={Personal:"Personal",Business:"Business"},_b.ContactSortType={Email:"Email",Name:"Name",Frequency:"Frequency"},_b.SaveMail={Hidden:0,Checked:1,Unchecked:2},_b.SettingsTab={Common:"common",EmailAccounts:"accounts",Calendar:"calendar",MobileSync:"mobile_sync",OutLookSync:"outlook_sync",Helpdesk:"helpdesk"},_b.AccountSettingsTab={Properties:"properties",Signature:"signature",Filters:"filters",Autoresponder:"autoresponder",Forward:"forward",Folders:"folders",FetcherInc:"fetcher-inc",FetcherOut:"fetcher-out",FetcherSig:"fetcher-sig",IdentityProperties:"identity-properties",IdentitySignature:"identity-signature"},_b.ContactsGroupListType={Personal:0,SubGroup:1,Global:2},_b.IcalType={Request:"REQUEST",Reply:"REPLY",Cancel:"CANCEL",Save:"SAVE"},_b.IcalConfig={Accepted:"ACCEPTED",Declined:"DECLINED",Tentative:"TENTATIVE",NeedsAction:"NEEDS-ACTION"},_b.IcalConfigInt={Accepted:1,Declined:2,Tentative:3,NeedsAction:0},_b.Key={Tab:9,Enter:13,Shift:16,Ctrl:17,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Up:38,Down:40,Left:37,Right:39,Del:46,a:65,c:67,f:70,n:78,p:80,q:81,r:82,s:83,v:86,F5:116,Comma:188,Dot:190},_b.MouseKey={Left:0,Middle:1,Right:2},_b.FileStorageType={Private:0,Corporate:1},_b.HelpdeskThreadStates={None:0,Pending:1,Waiting:2,Answered:3,Resolved:4,Deferred:5},_b.HelpdeskPostType={Normal:0,Internal:1,System:2},_b.HelpdeskFilters={All:0,Pending:1,Resolved:2,InWork:3,Open:4,Archived:9},_b.CalendarAccess={Full:0,Write:1,Read:2},_b.CalendarEditRecurrenceEvent={None:0,OnlyThisInstance:1,AllEvents:2},_b.CalendarRepeatPeriod={None:0,Daily:1,Weekly:2,Monthly:3,Yearly:4},_b.DesktopNotifications={Allowed:0,NotAllowed:1,Denied:2,NotSupported:9},_b.PhoneAction={Settings:"settings",Incoming:"incoming",Outgoing:"outgoing"},_b.HtmlEditorImageSizes={Small:"small",Medium:"medium",Large:"large",Original:"original"},c.bindingHandlers.command={init:function(b,d,e,f){var g=a(b),h=d();if(!h||!h.enabled||!h.canExecute)throw new Error("You are not using command function");g.addClass("command"),c.bindingHandlers[g.is("form")?"submit":"click"].init.apply(f,arguments)},update:function(b,c){var d=!0,e=a(b),f=c();d=f.enabled(),e.toggleClass("command-not-enabled",!d),d&&(d=f.canExecute(),e.toggleClass("unavailable",!d)),e.toggleClass("command-disabled disable disabled",!d),e.toggleClass("command-disabled",!d)}},c.bindingHandlers.onEnter={init:function(d,e,f,g){c.bindingHandlers.event.init(d,function(){return{keyup:function(c,f){f&&13===b.parseInt(f.keyCode,10)&&(a(d).trigger("change"),e().call(this,c))}}},f,g)}},c.bindingHandlers.onCtrlEnter={init:function(d,e,f,g){c.bindingHandlers.event.init(d,function(){return{keydown:function(c,f){return f&&13===b.parseInt(f.keyCode,10)&&f.ctrlKey?(a(d).trigger("change"),e().call(this,c),!1):!0}}},f,g)}},c.bindingHandlers.onEsc={init:function(d,e,f,g){c.bindingHandlers.event.init(d,function(){return{keyup:function(c,f){f&&27===b.parseInt(f.keyCode,10)&&(a(d).trigger("change"),e().call(this,c))}}},f,g)}},c.bindingHandlers.onFocusSelect={init:function(a,b,d,e){c.bindingHandlers.event.init(a,function(){return{focus:function(){a.select()},mouseup:function(){return!1}}},d,e)}},c.bindingHandlers.onFocusMoveCaretToEnd={init:function(a,b,d,e){c.bindingHandlers.event.init(a,function(){return{focus:function(){ac.moveCaretToEnd(a)}}},d,e)}},c.bindingHandlers.onEnterChange={init:function(d,e,f,g){c.bindingHandlers.event.init(d,function(){return{keyup:function(c,e){e&&13===b.parseInt(e.keyCode,10)&&a(d).trigger("change")}}},f,g)}},c.bindingHandlers.jhasfocus={init:function(b,c){a(b).on("focus",function(){c()(!0)}).on("blur",function(){c()(!1)})},update:function(b,d){c.utils.unwrapObservable(d())?a(b).is(":focus")||a(b).focus():a(b).is(":focus")&&a(b).blur()}},c.bindingHandlers.fadeIn={update:function(b,d){c.utils.unwrapObservable(d())&&a(b).hide().fadeIn("fast")}},c.bindingHandlers.fadeOut={update:function(b,d){c.utils.unwrapObservable(d())&&a(b).fadeOut()}},c.bindingHandlers.i18n={init:function(b,c){var d=a(b).data("i18n"),e=d?ac.i18n(d):d;if(""!==e)switch(c()){case"value":a(b).val(e);break;case"text":a(b).text(e);break;case"html":a(b).html(e);break;case"title":a(b).attr("title",e);break;case"placeholder":a(b).attr({placeholder:e})}}},c.bindingHandlers.link={init:function(b,d){a(b).attr("href",c.utils.unwrapObservable(d()))}},c.bindingHandlers.title={init:function(b,d){a(b).attr("title",c.utils.unwrapObservable(d()))},update:function(b,d){a(b).attr("title",c.utils.unwrapObservable(d()))}},c.bindingHandlers.initDom={init:function(b,c){if(c())if(_.isArray(c()))for(var d=c(),e=d.length-1;e>=0;e--)d[e](a(b));else c()(a(b))}},c.bindingHandlers.customScrollbar={init:function(b,c){if(!jc){var d=a(b),e=c();e=e,d.addClass("scroll-wrap").customscroll(e),ac.isUnd(e.reset)||(b._customscroll_reset=_.throttle(function(){d.data("customscroll").reset()},100)),!ac.isUnd(e.scrollToTopTrigger)&&ac.isFunc(e.scrollToTopTrigger.subscribe)&&e.scrollToTopTrigger.subscribe(function(){d.data("customscroll")&&d.data("customscroll").scrollToTop()
}),!ac.isUnd(e.scrollToBottomTrigger)&&ac.isFunc(e.scrollToBottomTrigger.subscribe)&&e.scrollToBottomTrigger.subscribe(function(){d.data("customscroll")&&d.data("customscroll").scrollToBottom()}),!ac.isUnd(e.scrollTo)&&ac.isFunc(e.scrollTo.subscribe)&&e.scrollTo.subscribe(function(){d.data("customscroll")&&d.data("customscroll").scrollTo(e.scrollTo())})}},update:function(b,c){jc||(b._customscroll_reset&&b._customscroll_reset(),ac.isUnd(c().top)||a(b).data("customscroll").vertical.set(c().top))}},c.bindingHandlers.customOptions={init:function(){return{controlsDescendantBindings:!0}},update:function(a,b,d,e,f){for(var g=0,h=0,i=c.utils.arrayMap(c.utils.arrayFilter(a.childNodes,function(a){return a.tagName&&"OPTION"===a.tagName&&a.selected}),function(a){return c.selectExtensions.readValue(a)||a.innerText||a.textContent}),j=a.scrollTop,k=c.utils.unwrapObservable(b());a.length>0;)c.cleanNode(a.options[0]),a.remove(0);if(k){"number"!=typeof k.length&&(k=[k]);var l=d().optionsBind;for(g=0,h=k.length;h>g;g++){var m=document.createElement("OPTION"),n=c.utils.unwrapObservable(k[g]);c.selectExtensions.writeValue(m,n),m.appendChild(document.createTextNode(n)),a.appendChild(m),l&&(m.setAttribute("data-bind",l),c.applyBindings(f.createChildContext(n),m))}var o=a.getElementsByTagName("OPTION"),p=0,q=navigator.userAgent.indexOf("MSIE 6")>=0;for(g=0,h=o.length;h>g;g++)c.utils.arrayIndexOf(i,c.selectExtensions.readValue(o[g]))>=0&&(q?o[g].setAttribute("selected",!0):o[g].selected=!0,p++);a.scrollTop=j,p<i.length&&c.utils.triggerEvent(a,"change")}}},c.bindingHandlers.splitter={init:function(b,c){var d=a(b),e=c();setTimeout(function(){d.splitter(_.defaults(e,{}))},1)}},c.bindingHandlers.dropdown={init:function(b,c,d,e){var f=a(b),g=_.defaults(c(),{disabled:"disabled",expand:"expand",control:!0,container:".dropdown_content",passClick:!0,trueValue:!0}),h=g.control?f.find(".control"):f,i=a(document),j=function(){ac.isUnd(g.callback)||g.callback.call(e,f.hasClass(g.expand)?g.trueValue:!1,f)},k=function(a){a.stopPropagation()};g.passClick||(f.find(g.container).click(k),h.click(k)),f.removeClass(g.expand),g.close&&g.close.subscribe&&g.close.subscribe(function(a){a||(i.unbind("click.dropdown"),f.removeClass(g.expand)),j()}),h.click(function(){f.hasClass(g.disabled)||(f.toggleClass(g.expand),_.defer(function(){j()}),f.hasClass(g.expand)&&(g.close&&g.close.subscribe&&g.close(!0),_.defer(function(){i.on("click.dropdown",function(a){(g.passClick||a.button!==_b.MouseKey.Right)&&(i.unbind("click.dropdown"),g.close&&g.close.subscribe&&g.close(!1),f.removeClass(g.expand),j())})})))})}},c.bindingHandlers.customSelect={init:function(b,c,d,e){var f=a(b),g=_.defaults(c(),{disabled:"disabled",selected:"selected",expand:"expand",control:!0,input:!1}),h=[],i=g.control?f.find(".control"):f,j=f.find(".dropdown_content"),k=f.find(".link"),l=function(b){_.each(h,function(a){a.removeClass(g.selected)});var c=_.find(g.options,function(a){return a[g.optionsValue]===b});return ac.isUnd(c)&&(c=g.options[0]),h[_.indexOf(g.options,c)].addClass(g.selected),k.text(a.trim(c[g.optionsText])),c[g.optionsValue]},m=function(){j.empty(),h=[],_.each(g.options,function(b){var c=a('<span class="item"></span>').text(b[g.optionsText]).data("value",b[g.optionsValue]),d=b.isDisabled;d?c.data("isDisabled",d).addClass("disabled"):c.data("isDisabled",d).removeClass("disabled"),h.push(c),j.append(c)},this)};m(),j.on("click",".item",function(){var b=a(this);b.data("isDisabled")||g.value(b.data("value"))}),!g.input&&g.value&&g.value.subscribe&&(g.value.subscribe(function(){var a=l(g.value());g.value()!==a&&g.value(a)},e),g.value.valueHasMutated()),g.alarmOptions&&g.alarmOptions.subscribe(function(){m()},e),f.removeClass(g.expand),i.click(function(){f.hasClass(g.disabled)||(f.toggleClass(g.expand),f.hasClass(g.expand)&&_.defer(function(){a(document).one("click",function(){f.removeClass(g.expand)})}))})}},c.bindingHandlers.moveToFolderFilter={init:function(b,c){var d=a(b),e=_.defaults(c(),{disabled:"disabled",selected:"selected",expand:"expand",control:!0,container:".content"}),f=e.control?d.find(".control"):d,g=d.find(e.container),h=d.find(".link");d.removeClass(e.expand),e.options.subscribe(function(a){var b=e.value(),c=_.find(a,function(a){return a.id===b});c||e.value("")}),e.value&&e.value.subscribe&&(e.value.subscribe(function(b){var c=_.isArray(e.options)?e.options:e.options(),d=_.find(c,function(a){return a[e.optionsValue]===b});d||(d=_.find(c,function(a){return""===a[e.optionsValue]}),d&&""!==b&&e.value("")),d&&h.text(a.trim(d[e.optionsText]))}),e.value.valueHasMutated()),g.on("click",".item",function(){var b=a(this).data("value");e.value(b)}),f.click(function(){d.hasClass(e.disabled)||(d.toggleClass(e.expand),d.hasClass(e.expand)&&_.defer(function(){a(document).one("click",function(){d.removeClass(e.expand)})}))})},update:function(b,c){var d=_.defaults(c(),{disabled:"disabled",selected:"selected",expand:"expand",control:!0,container:".content"}),e=a(b).find(d.container),f=_.isArray(d.options)?d.options:d.options(),g=d.value?d.value():"";e.empty(),_.each(f,function(b){var c=a('<span class="item"></span>').text(b[d.optionsText]).data("value",b[d.optionsValue]);g===b[d.optionsValue]&&c.addClass("selected"),e.append(c)})}},c.bindingHandlers.contactcard={init:function(b,c){var d=a(b),e=!1,f=_.defaults(c(),{disabled:"disabled",expand:"expand",control:!0}),g=f.control?d.find(".control"):d;void 0!==f.trigger&&void 0!==f.trigger.subscribe&&(d.removeClass(f.expand),g.bind({mouseover:function(){!d.hasClass(f.disabled)&&f.trigger()&&(e=!0,_.delay(function(){e&&(void 0!==f.controlWidth&&void 0!==f.controlWidth.subscribe&&f.controlWidth(g.width()),d.addClass(f.expand))},200))},mouseout:function(){f.trigger()&&(e=!1,_.delay(function(){e||d.removeClass(f.expand)},200))}}))}},c.bindingHandlers.checkmail={update:function(b,c){var d=b.oOptions||null,e=b.jqElement||null,f=b.oIconIE||null,g=c(),h=g.state;void 0!==g.state&&(e||(b.jqElement=e=a(b)),d||(b.oOptions=d=_.defaults(g,{activeClass:"process",duration:800})),ac.deferredUpdate(e,h,d.duration,function(a,c){if(cc.browser.ie9AndBelow)if(f||(b.oIconIE=f=e.find(".icon")),!f.__intervalIE&&c){var g=0,h="";f.__intervalIE=setInterval(function(){h="0px -"+20*g+"px",g=7>g?g+1:0,f.css({"background-position":h})},1e3/12)}else f.css({"background-position":"0px 0px"}),clearInterval(f.__intervalIE),f.__intervalIE=null;else a.toggleClass(d.activeClass,c)}))}},c.bindingHandlers.heightAdjust={update:function(b,c){var d=b.jqElement||null,e=0,f=c().location;d||(b.jqElement=d=a(b)),_.delay(function(){_.each(c().elements,function(a){var b=a();b&&(e+=b.is(":visible")?b.outerHeight():0)}),"top"===f||void 0===f?d.css({"padding-top":e,"margin-top":-e}):"bottom"===f&&d.css({"padding-bottom":e,"margin-bottom":-e})},400)}},c.bindingHandlers.triggerInview={update:function(b,c){c().trigger().length<=0||_.defer(function(){var d=a(b),e=d.height(),f=c(),g=null,h=null;f=f,g=d.find(f.selector),g.each(function(){this.$el=a(this),this.inviewHeight=this.$el.height(),this.inview=!1}),h=_.debounce(function(){g.each(function(){var a=this.inview||!1,b=this.$el.position().top+parseInt(this.$el.css("margin-top"),10);b>0&&e>b?a||(this.inview=!0,this.$el.trigger("inview")):this.inview=!1})},2e3),d.scroll(h),h()})}},c.bindingHandlers.watchWidth={init:function(c,d){a(b).bind("resize",function(){d()(a(c).outerWidth())})}},c.bindingHandlers.columnCalc={init:function(c,d){var e=a(c),f=d().prop,g=null,h=0;g=e.find(d().itemSelector),void 0!==g[0]&&(h=g.outerWidth(!0),h=1>=h?1:h,f&&a(b).bind("resize",function(){var a=e.width();f(a>0?Math.floor(a/h):1)}))}},c.bindingHandlers.quickReplyAnim={update:function(b,c){var d=b.jqTextarea||null,e=b.jqStatus||null,f=b.jqButtons||null,g=b.jqElement||null,h=b.oPrevActions||null,i=c(),j=null;j=_.defaults(i,{saveAction:!1,sendAction:!1,activeAction:!1}),g||(b.jqElement=g=a(b),b.jqTextarea=d=g.find("textarea"),b.jqStatus=e=g.find(".status"),b.jqButtons=f=g.find(".buttons"),b.oPrevActions=h={saveAction:null,sendAction:null,activeAction:null}),g.is(":visible")&&(cc.browser.ie9AndBelow?(!d||g.defualtHeight||d.defualtHeight||(g.defualtHeight=g.outerHeight(),d.defualtHeight=d.outerHeight(),e.defualtHeight=f.outerHeight(),f.defualtHeight=f.outerHeight()),_.defer(function(){var a=h.activeAction!==j.activeAction,b=h.sendAction!==j.sendAction,c=h.saveAction!==j.saveAction;a&&(j.activeAction?(d.animate({height:d.defualtHeight+50},300),g.animate({"max-height":g.defualtHeight+f.defualtHeight+50},300)):(d.animate({height:d.defualtHeight},300),g.animate({"max-height":g.defualtHeight},300))),(b||c)&&(j.sendAction?(g.animate({"max-height":"30px"},300),e.animate({"max-height":"30px",opacity:1},300)):j.saveAction?g.animate({"max-height":0},300):(g.animate({"max-height":g.defualtHeight+f.defualtHeight+50},300),e.animate({"max-height":0,opacity:0},300)))})):(g.toggleClass("saving",j.saveAction),g.toggleClass("sending",j.sendAction),g.toggleClass("active",j.activeAction))),_.defer(function(){h=j})}},c.extenders.reversible=function(a){var b=a();return a.commit=function(){b=a()},a.revert=function(){a(b)},a.commitedValue=function(){return b},a.changed=function(){return b!==a()},a},c.extenders.autoResetToFalse=function(a,c){return a.iTimeout=0,a.subscribe(function(d){d&&(b.clearTimeout(a.iTimeout),a.iTimeout=b.setTimeout(function(){a.iTimeout=0,a(!1)},ac.pInt(c)))}),a},ac.createCommand=function(a,b,d){var e=b?function(){return e.canExecute&&e.canExecute()?b.apply(a,Array.prototype.slice.call(arguments)):!1}:function(){};return e.enabled=c.observable(!0),d=ac.isUnd(d)?!0:d,e.canExecute=ac.isFunc(d)?c.computed(function(){return e.enabled()&&d.call(a)}):c.computed(function(){return e.enabled()&&!!d}),e},c.bindingHandlers.autocomplete={init:function(b,c){function d(a){return a.split(/,\s*/)}function e(a){return d(a).pop()}var f=c(),g=a(b);f&&g&&g[0]&&g.autocomplete({minLength:1,source:function(a,b){f(e(a.term),b)},search:function(){var a=e(this.value);return a.length<1?!1:!0},focus:function(){return!1},select:function(a,b){var c=d(this.value),e=null;return c.pop(),c.push(b.item.value),c.push(""),this.value=c.join(", ").slice(0,-2),g.trigger("change"),e=function(a){var b=a.value.length;a.blur(),a.focus(),a.setSelectionRange&&a.setSelectionRange(b,b)},e(g[0]),!1}})}},c.bindingHandlers.autocompleteSimple={init:function(b,c){var d=a(b),e=c(),f=e.callback,g=e.dataAccessor?e.dataAccessor:null;f&&d&&d[0]&&(a.widget("custom.autocomplete",a.ui.autocomplete,{_renderMenu:function(b,c){var d=this,e="";a.each(c,function(a,c){c.category&&c.category!==e&&(b.append("<li class='ui-autocomplete-category'>"+c.category+"</li>"),e=c.category),d._renderItemData(b,c)})}}),d.autocomplete({minLength:1,source:function(a,b){f(a.term,b)},focus:function(){return!1},select:function(a,b){return _.delay(function(){d.trigger("change")},5),g&&g(b.item),!0}}))}},c.bindingHandlers.draggablePlace={init:function(b,d,e,f){var g=e?e():null;a(b).draggable({distance:20,handle:".dragHandle",cursorAt:{top:0,left:0},helper:function(a){return d().call(f,a&&a.target?c.dataFor(a.target):null)},start:g&&g.draggableDragStartCallback?g.draggableDragStartCallback:ac.emptyFunction,stop:g&&g.draggableDragStopCallback?g.draggableDragStopCallback:ac.emptyFunction}).on("mousedown",function(){ac.removeActiveFocus()})}},c.bindingHandlers.droppable={init:function(b,c){var d=c(),e=d.valueFunc,f=d.switchObserv;!1!==e&&a(b).droppable({hoverClass:"droppableHover",drop:function(a,b){e(a,b)}}),f&&e!==!1&&(f.subscribe(function(c){a(b).data().droppable&&(c?a(b).droppable("disable"):a(b).droppable("enable"))},this),f.valueHasMutated())}},c.bindingHandlers.draggable={init:function(b,d){a(b).attr("draggable",c.utils.unwrapObservable(d()))}},c.bindingHandlers.autosize={init:function(b,c){var d=a(b),e=c(),f=d.height(),g=d.outerHeight(),h=d.innerHeight(),i=g-h,j=h-f,k=e.minHeight?e.minHeight:0,l=e.maxHeight?e.maxHeight:0,m=e.scrollableHeight?e.scrollableHeight:1e3,n=e.autosizeTrigger?e.autosizeTrigger:null,o=function(a){var b=0;cc.browser.firefox&&(b=2*parseInt(d.css("padding-top"),10)),l?setTimeout(function(){d.prop("scrollHeight")<l?(d.height(k-j-i),d.height(d.prop("scrollHeight")+b-j)):d.height(l-j-i)},100):(a||d.prop("scrollHeight")<m)&&setTimeout(function(){d.height(k-j-i),d.height(d.prop("scrollHeight")+b-j)},100)};d.on("keydown",function(){o()}),d.on("paste",function(){o()}),n&&n.subscribe(function(a){o(a)},this),o()}},c.bindingHandlers.customBind={init:function(a,b,d,e){var f=b(),g=f.onKeydown?f.onKeydown:null,h=f.onKeyup?f.onKeyup:null,i=f.onPaste?f.onPaste:null,j=f.onInput?f.onInput:null,k=f.valueObserver?f.valueObserver:null;c.bindingHandlers.event.init(a,function(){return{keydown:function(b,c){return g&&g.call(this,a,c,k),!0},keyup:function(b,c){return h&&h.call(this,a,c,k),!0},paste:function(b,c){return i&&i.call(this,a,c,k),!0},input:function(b,c){return j&&j.call(this,a,c,k),!0}}},d,e)}},c.bindingHandlers.fade={init:function(b,c){var d=a(b),e=a('<span class="faded"></span>'),f=_.defaults(c(),{color:null,css:"fadeout"}),g=f.color,h=f.css,i=function(a){if(""!==a){var b=j(a),c="rgba("+b.r+","+b.g+","+b.b;k(a,c)}},j=function(a){var b=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return a=a.replace(b,function(a,b,c,d){return b+b+c+c+d+d}),c?{r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16)}:null},k=function(a,b){ac.isRTL()?e.css("filter","progid:DXImageTransform.Microsoft.gradient(startColorstr='"+a+"', endColorstr='"+a+"',GradientType=1 )").css("background-image","-webkit-gradient(linear, left top, right top, color-stop(0%,"+b+",1)), color-stop(100%,"+b+",0)))").css("background-image","-moz-linear-gradient(left, "+b+",1)0%, "+b+",0)100%)").css("background-image","-webkit-linear-gradient(left, "+b+"1)0%,"+b+",0)100%)").css("background-image","-o-linear-gradient(left, "+b+",1)0%,"+b+",0)100%)").css("background-image","-ms-linear-gradient(left, "+b+",1)0%,"+b+",0)100%)").css("background-image","linear-gradient(left, "+b+",1)0%,"+b+",0)100%)"):e.css("filter","progid:DXImageTransform.Microsoft.gradient(startColorstr='"+a+"', endColorstr='"+a+"',GradientType=1 )").css("background-image","-webkit-gradient(linear, left top, right top, color-stop(0%,"+b+",0)), color-stop(100%,"+b+",1)))").css("background-image","-moz-linear-gradient(left, "+b+",0)0%, "+b+",1)100%)").css("background-image","-webkit-linear-gradient(left, "+b+",0)0%,"+b+",1)100%)").css("background-image","-o-linear-gradient(left, "+b+",0)0%,"+b+",1)100%)").css("background-image","-ms-linear-gradient(left, "+b+",0)0%,"+b+",1)100%)").css("background-image","linear-gradient(left, "+b+",0)0%,"+b+",1)100%)")};d.parent().addClass(h),d.after(e),void 0!==f.color.subscribe&&(i(g()),g.subscribe(function(a){i(a)},this))}},c.bindingHandlers.highlighter={init:function(d,e,f,g){function h(b){if(v){var c=0,d=k.text(),e=d.split(q),f=[],g='<span class="search_highlight">$&</span>';a.each(e,function(b,c){_.any(p,function(a){return a===c})?a.each(c,function(b,c){f.push(a(c.replace(/(.)/,g)))}):a.each(c,function(a,b){" "===b?f.push(document.createTextNode("")):f.push(document.createTextNode(b))})}),b?k.empty().append(f):(c=i(),k.empty().append(f),j(c))}}function i(){var a,c,e,f,g=0;return"undefined"!=typeof b.getSelection?(a=b.getSelection().getRangeAt(0),c=a.cloneRange(),c.selectNodeContents(d),c.setEnd(a.endContainer,a.endOffset),g=c.toString().length):"undefined"!=typeof document.selection&&"Control"!==document.selection.type&&(e=document.selection.createRange(),f=document.body.createTextRange(),f.moveToElementText(d),f.setEndPoint("EndToEnd",e),g=f.text.length),g}function j(a){var c,e,f;if(!d)return!1;if(document.createRange)c=document.createRange(),c.selectNodeContents(d),c.setStart(d,a),c.setEnd(d,a),e=b.getSelection(),e.removeAllRanges(),e.addRange(c);else{if(d.createTextRange)return f=d.createTextRange(),f.collapse(!0),f.moveEnd(a),f.moveStart(a),f.select(),!0;if(d.setSelectionRange)return d.setSelectionRange(a,a),!0}return!1}var k=a(d),l=e(),m=l.valueObserver?l.valueObserver:null,n=l.highlighterValueObserver?l.highlighterValueObserver:null,o=l.highlightTrigger?l.highlightTrigger:null,p=["from:","to:","subject:","text:","email:","has:","date:","text:","body:"],q=function(){var b="";return a.each(p,function(a,c){b=a?b+"|\\b"+c:b+"\\b"+c}),new RegExp("("+b+")","g")}(),r=function(a){return a.replace(/[\s]+/," ")},s=-1,t=b.navigator.language||b.navigator.userLanguage,u=["zh","zh-TW","zh-CN","zh-HK","zh-SG","zh-MO","ja","ja-JP","ko","ko-KR","vi","vi-VN","th","th-TH"],v=!_.include(u,t);c.bindingHandlers.event.init(d,function(){return{keydown:function(a,b){return b.keyCode!==_b.Key.Enter},keyup:function(a,b){var c=[_b.Key.Left,_b.Key.Right,_b.Key.Home,_b.Key.End],d=-1!==ac.inArray(b.keyCode,c);return b.keyCode===_b.Key.Enter||b.keyCode===_b.Key.Shift||b.keyCode===_b.Key.Ctrl||d||(b.ctrlKey||s===_b.Key.Ctrl)&&b.keyCode===_b.Key.a||(m(r(k.text())),h(!1)),s=b.keyCode,!0},paste:function(){return setTimeout(function(){m(r(k.text())),h(!1)},0),!0}}},f,g),setTimeout(function(){h(!0)},0),o.notifySubscribers(),o.subscribe(function(a){setTimeout(function(){h(!!a)},0)},this),n.subscribe(function(){k.text(m())},this)}},h.prototype.init=function(a){this.defaultScreen=a,e.initialized.removeAll(),e.changed.removeAll(),e.initialized.add(this.parseRouting,this),e.changed.add(this.parseRouting,this),e.init(),e.initialized.removeAll()},h.prototype.finalize=function(){e.dispose(),this.setHashFromString("")},h.prototype.setHashFromString=function(a){var b=location.hash===decodeURIComponent(a);return b||(ac.log("Set hash from string",a),location.hash=a),b},h.prototype.replaceHashFromString=function(a){location.hash!==a&&(ac.log("Replace hash from string",a),location.replace(a))},h.prototype.setHash=function(a){return this.setHashFromString(this.buildHashFromArray(a))},h.prototype.replaceHash=function(a){this.replaceHashFromString(this.buildHashFromArray(a))},h.prototype.setLastMailboxHash=function(){this.setHashFromString(this.lastMailboxRouting)},h.prototype.setLastHelpdeskHash=function(){this.setHashFromString(this.lastHelpdeskRouting)},h.prototype.setPreviousHash=function(){location.hash=this.previousHash},h.prototype.buildHashFromArray=function(a){var b=0,c=0,d="";if(_.isArray(a))for(c=a.length;c>b;b++)a[b]=encodeURIComponent(a[b]);else a=[encodeURIComponent(a.toString())];return d=a.join("/"),""!==d&&(d="#"+d),d},h.prototype.getHashFromHref=function(){var a=location.href.indexOf("#"),b="";return-1!==a&&(b=location.href.substr(a+1)),b},h.prototype.isSingleMode=function(){var a=this.getHashFromHref(),b=a.split("/"),c=decodeURIComponent(b.shift())||_b.Screens.Mailbox,d=c===_b.Screens.SingleMessageView||c===_b.Screens.SingleCompose||c===_b.Screens.SingleHelpdesk;return this.currentScreen=c,d},h.prototype.goDirectly=function(a,b){e.stop(),this.setHash(a),this.parseRouting(b),e.init()},h.prototype.parseRouting=function(b){var c=this.getHashFromHref(),d=c.split("/"),e=decodeURIComponent(d.shift())||this.defaultScreen,f=_.find(_b.Screens,function(a){return a===e},this),g=0,h=d.length;for(e===_b.Screens.Mailbox&&(this.lastMailboxRouting=c),e===_b.Screens.Helpdesk&&(this.lastHelpdeskRouting=c),this.previousHash=this.currentHash,this.currentHash=c;h>g;g++)d[g]=decodeURIComponent(d[g]);switch(a.isArray(b)&&(d=_.union(d,b)),this.currentScreen=e,e){case _b.Screens.SingleMessageView:case _b.Screens.SingleCompose:case _b.Screens.SingleHelpdesk:ec.SingleMode=!0,cc.Screens.showCurrentScreen(e,d);break;default:f||(e=this.defaultScreen),ec.SingleMode=!1,cc.Screens.showNormalScreen(_b.Screens.Header),cc.Screens.showCurrentScreen(e,d);break;case _b.Screens.Mailbox:ec.SingleMode=!1,cc.Screens.showNormalScreen(_b.Screens.Header),ec.User.Layout===_b.MailboxLayout.Side?cc.Screens.showCurrentScreen(_b.Screens.Mailbox,d):cc.Screens.showCurrentScreen(_b.Screens.BottomMailbox,d)}this.resizeAll()},i.prototype.mailbox=function(a,b,c,d,e){var f=[_b.Screens.Mailbox];return b=ac.isNormal(b)?ac.pInt(b):1,c=ac.isNormal(c)?ac.pString(c):"",d=ac.isNormal(d)?ac.pString(d):"",e=ac.isNormal(e)?ac.pString(e):"",a&&""!==a&&(e&&""!==e?f.push("filter:"+e):f.push(a)),b>1&&f.push("p"+b),c&&""!==c&&f.push("msg"+c),d&&""!==d&&f.push(d),f},i.prototype.inbox=function(){return this.mailbox()},i.prototype.parseMailbox=function(a){var b="INBOX",c=1,d="",e="",f="",g="";return a.length>0&&(ac.isNormal(a[0])&&(b=ac.pString(a[0]),b==="filter:"+_b.FolderFilter.Flagged&&(b="INBOX",f=_b.FolderFilter.Flagged)),a[1]&&(g=ac.pString(a[1]),this.isPageParam(g)?(c=ac.pInt(g.substr(1)),0>=c&&(c=1)):this.isMsgParam(g)?d=g.substr(3):e=g),""===e&&(a[2]&&(g=ac.pString(a[2]),this.isMsgParam(g)?d=g.substr(3):e=g),a[3]&&(e=ac.pString(a[3])))),{Folder:b,Page:c,Uid:d,Search:e,Filters:f}},i.prototype.isPageParam=function(a){return"p"===a.substr(0,1)&&/^[1-9][\d]*$/.test(a.substr(1))},i.prototype.isMsgParam=function(a){return"msg"===a.substr(0,3)&&/^[1-9][\d]*$/.test(a.substr(3))},i.prototype.compose=function(){var a=ec.SingleMode?_b.Screens.SingleCompose:_b.Screens.Compose;return[a]},i.prototype.composeFromMessage=function(a,b,c){var d=ec.SingleMode?_b.Screens.SingleCompose:_b.Screens.Compose;return[d,a,b,c]},i.prototype.composeWithToField=function(a){var b=ec.SingleMode?_b.Screens.SingleCompose:_b.Screens.Compose;return[b,"to",a]},i.prototype.parseToAddr=function(a){var b=decodeURI(ac.pString(a)),c=-1!==b.indexOf("mailto:"),d=[],e=[],f="",g="",h="",i="";return c&&(d=b.replace(/^mailto:/,"").split("?"),b=d[0],2===d.length&&(e=d[1].split("&"),_.each(e,function(a){var b=a.split("=");if(2===b.length)switch(b[0]){case"subject":f=b[1];break;case"cc":g=b[1];break;case"bcc":h=b[1];break;case"body":i=b[1]}}))),{to:b,hasMailto:c,subject:f,cc:g,bcc:h,body:i}},j.prototype.setReplyData=function(a,b,c,d){this.replyText(a),this.replyDraftUid(b),this.replyCc(c||""),this.replyBcc(d||"")},j.prototype.send=function(a,b,c,d,e,f,g){var h="",i=cc.MailCache.folderList().sentFolderFullName(),j=cc.MailCache.folderList().draftsFolderFullName(),k=ec.Accounts.getCurrent().email(),l=b.To.indexOf(k)>-1||b.Cc.indexOf(k)>-1||b.Bcc.indexOf(k)>-1;switch(ec.User.SaveRepliedToCurrFolder&&!l&&ac.isNonEmptyArray(b.DraftInfo,3)&&(i=b.DraftInfo[2]),b.Action=a,b.IsHtml="1",b.ShowReport=d,a){case"MessageSend":h=ac.i18n("COMPOSE/INFO_SENDING"),c&&(b.SentFolder=i),""!==b.DraftUid&&(b.DraftFolder=j);break;case"MessageSave":h=ac.i18n("COMPOSE/INFO_SAVING"),b.DraftFolder=j}d&&cc.Api.showLoading(h),g?this.postponedMailData={Parameters:b,MessageSendResponseHandler:e,MessageSendResponseContext:f}:cc.Ajax.send(b,e,f)},j.prototype.sendPostponedMail=function(a){var b=this.postponedMailData,c=cc.MailCache.folderList().draftsFolderFullName();""!==a&&(b.Parameters.DraftUid=a,b.Parameters.DraftFolder=c),this.postponedMailData&&(cc.Ajax.send(b.Parameters,b.MessageSendResponseHandler,b.MessageSendResponseContext),this.postponedMailData=null)},j.prototype.sendReplyMessage=function(a,b,c,d,e){var f=null;cc.MailCache.currentMessage()&&(f=this.getReplyDataFromMessage(cc.MailCache.currentMessage(),_b.ReplyType.ReplyAll,ec.Accounts.currentId(),null,b,c),f.Bcc="",f.Importance=_b.Importance.Normal,f.Sensivity=_b.Sensivity.Nothing,f.ReadingConfirmation="0",f.IsQuickReply=!0,f.Attachments=this.convertAttachmentsForSending(f.Attachments),this.send(a,f,ec.User.getSaveMailInSentItems(),!1,d,e))},j.prototype.convertAttachmentsForSending=function(a){var b={};return _.each(a,function(a){b[a.tempName()]=[a.fileName(),a.cid(),a.inline()?"1":"0",a.linked()?"1":"0"]}),b},j.prototype.onMessageSendOrSaveResponse=function(a,c){var d,e,f,g=ec.SingleMode?b.opener.App:cc,h=!!a.Result;switch(cc.Api.hideLoading(),c.Action){case"MessageSave":h?(c.ShowReport&&cc.Api.showReport(ac.i18n("COMPOSE/REPORT_MESSAGE_SAVED")),a.Result.NewUid||(ec.App.AutoSave=!1)):c.ShowReport&&cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("COMPOSE/ERROR_MESSAGE_SAVING"));break;case"MessageSend":h||a.ErrorCode===_b.Errors.NotSavedInSentItems?(h||a.ErrorCode!==_b.Errors.NotSavedInSentItems?c.IsQuickReply?cc.Api.showReport(ac.i18n("COMPOSE/REPORT_MESSAGE_SENT")):g.Api.showReport(ac.i18n("COMPOSE/REPORT_MESSAGE_SENT")):cc.Api.showError(ac.i18n("WARNING/SENT_EMAIL_NOT_SAVED")),_.isArray(c.DraftInfo)&&3===c.DraftInfo.length&&(f=c.DraftInfo[0],e=c.DraftInfo[1],d=c.DraftInfo[2],cc.MailCache.markMessageReplied(c.AccountID,d,e,f))):cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("COMPOSE/ERROR_MESSAGE_SENDING")),c.SentFolder&&g.MailCache.removeMessagesFromCacheForFolder(c.SentFolder)}return c.DraftFolder&&g.MailCache.removeMessagesFromCacheForFolder(c.DraftFolder),{Action:c.Action,Result:h,NewUid:a.Result?a.Result.NewUid:""}},j.prototype.getReplyDataFromMessage=function(a,b,c,d,e,f){var g=null,h={DraftInfo:[],DraftUid:"",To:"",Cc:"",Bcc:"",Subject:"",Attachments:[],InReplyTo:a.messageId(),References:this.getReplyReferences(a)},i=a.oReplyTo.getFull(),j=a.oTo.getFull();switch(""===i&&(i=a.oFrom.getFull()),e&&""!==e||(e=this.replyText(),this.replyText("")),"forward"===b?h.Text=e+this.getForwardMessageBody(a):"resend"===b?(g=a.getDomText(),h.Text=g.length>0?g.html():"",h.Cc=a.cc(),h.Bcc=a.bcc()):h.Text=e+this._getReplyMessageBody(a,c,d),f?h.DraftUid=f:(h.DraftUid=this.replyDraftUid(),this.replyDraftUid("")),b){case _b.ReplyType.Reply:h.DraftInfo=[_b.ReplyType.Reply,a.uid(),a.folder()],h.To=i,h.Subject=this.replySubjectAdd(ac.i18n("COMPOSE/REPLY_PREFIX"),a.subject()),h.Attachments=_.filter(a.attachments(),function(a){return a.linked()});break;case _b.ReplyType.ReplyAll:h.DraftInfo=[_b.ReplyType.ReplyAll,a.uid(),a.folder()],h.To=i,h.Cc=this._getReplyAllCcAddr(a,c,d),h.Subject=this.replySubjectAdd(ac.i18n("COMPOSE/REPLY_PREFIX"),a.subject()),h.Attachments=_.filter(a.attachments(),function(a){return a.linked()});break;case _b.ReplyType.Resend:h.DraftInfo=[_b.ReplyType.Resend,a.uid(),a.folder(),a.cc(),a.bcc()],h.To=j,h.Subject=a.subject(),h.Attachments=a.attachments();break;case _b.ReplyType.Forward:h.DraftInfo=[_b.ReplyType.Forward,a.uid(),a.folder()],h.Subject=this.replySubjectAdd(ac.i18n("COMPOSE/FORWARD_PREFIX"),a.subject()),h.Attachments=a.attachments()}return h},j.prototype.getReplyReferences=function(a){var b=a.references(),c=a.messageId(),d=b.indexOf(c);return-1===d&&(b+=" "+c),b},j.prototype._getReplyMessageBody=function(a,b,c){var d=a.getDomText(),e=d.length>0?d.html():"",f=ac.i18n("COMPOSE/REPLY_MESSAGE_TITLE",{DATE:a.oDateModel.getDate(),TIME:a.oDateModel.getTime(),SENDER:ac.encodeHtml(a.oFrom.getFull())}),g="<br /><br />"+this.getSignatureText(b,c)+"<br /><br />"+f+"<blockquote>"+e+"</blockquote>";return g},j.prototype.getSignatureText=function(a,b){var c=ec.Accounts.getAccount(a),d=c.signature(),e=d&&d.options()?'<div data-anchor="signature">'+d.signature()+"</div>":"";return b&&b.accountId()===a&&null!==b.signature()&&(e='<div data-anchor="signature">'+b.signature()+"</div>"),e},j.prototype.getFetcherOrIdentityByRecipients=function(a,b){var c=ec.Accounts.getAccount(b),d=null;return c&&(c.fetchers()&&(d=_.find(c.fetchers().collection(),function(b){var c=_.find(a,function(a){return a.sEmail===b.email()}),d=!!c;return d})),d||(d=_.find(c.identities()||[],function(b){var c=_.find(a,function(a){return a.sEmail===b.email()}),d=!!c;return d}))),d},j.prototype.getForwardMessageBody=function(a){var b=a.getDomText(),c=b.length>0?b.html():"",d=ac.encodeHtml(a.oCc.getFull()),e=""!==d?ac.i18n("COMPOSE/FORWARD_MESSAGE_BODY_CC",{CCADDR:d}):"",f=ac.i18n("COMPOSE/FORWARD_MESSAGE_TITLE",{FROMADDR:ac.encodeHtml(a.oFrom.getFull()),TOADDR:ac.encodeHtml(a.oTo.getFull()),CCPART:e,FULLDATE:a.oDateModel.getFullDate(),SUBJECT:a.subject()}),g="<br /><br />"+f+"<br /><br />"+c;return g},j.prototype._getReplyAllCcAddr=function(a,b,c){var d=new O,e=_.union(a.oTo.aCollection,a.oCc.aCollection,a.oBcc.aCollection),f=_.find(ec.Accounts.collection(),function(a){return a.id()===b},this),g=new N,h=new N;return g.sEmail=f.email(),h.sEmail=c?c.email():"",d.addCollection(e),d.excludeCollection(_.union(a.oFrom.aCollection,[g,h])),d.getFull()},j.prototype.replySubjectAdd=function(a,c){var d=null,e=ac.trim(c);return null===(d=new b.RegExp("^"+a+"[\\s]?\\:(.*)$","gi").exec(c))||ac.isUnd(d[1])?null===(d=new b.RegExp("^("+a+"[\\s]?[\\[\\(]?)([\\d]+)([\\]\\)]?[\\s]?\\:.*)$","gi").exec(c))||ac.isUnd(d[1])||ac.isUnd(d[2])||ac.isUnd(d[3])?e=a+": "+c:(e=d[1]+(ac.pInt(d[2])+1)+d[3],e=d[1]+(ac.pInt(d[2])+1)+d[3]):e=a+"[2]: "+d[1],e},j.prototype.getHtmlFromText=function(a){return a.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/\r/g,"").replace(/\n/g,"<br />")},k.prototype.init=function(){setInterval(_.bind(function(){this.prefetchStarted(!1),this.start()},this),2e3)},k.prototype.start=function(){var a=cc.MailCache.folderList();ec.SingleMode||cc.Ajax.hasOpenedRequests()||this.prefetchStarted()||(a&&a.inboxFolder()&&cc.MailCache.requestMessageList(a.inboxFolder().fullName(),1,"",_b.FolderFilter.Flagged,!1,!1),ec.App.AllowPrefetch&&!cc.Ajax.hasOpenedRequests()&&(this.startThreadListPrefetch(),this.startMessagesPrefetch(),this.startOtherPagesPrefetch(),this.startOtherFoldersPrefetch()))},k.prototype.startOtherPagesPrefetch=function(){var a=cc.MailCache.folderList().currentFolder();this.startPagePrefetch(a,cc.MailCache.page()+1),this.startPagePrefetch(a,cc.MailCache.page()-1)},k.prototype.startPagePrefetch=function(a,b){if(!this.prefetchStarted()&&a){var c=cc.MailCache.uidList(),d=(b-1)*ec.User.MailsPerPage,e=b>0&&d<c.resultCount(),f={folder:a.fullName(),page:b,search:c.search()},g=null;e&&!a.hasListBeenRequested(f)&&(g=cc.MailCache.requestMessageList(f.folder,f.page,f.search,"",!1,!1),g&&g.RequestStarted&&this.prefetchStarted(!0))}},k.prototype.startOtherFoldersPrefetch=function(){if(!this.prefetchStarted()){var a=cc.MailCache.folderList().sentFolder(),b=cc.MailCache.folderList().draftsFolder(),c=cc.MailCache.folderList().inboxFolder(),d=c?c.subfolders():[],e=_.filter(cc.MailCache.folderList().collection(),function(a){return!a.isSystem()},this),f=_.union(d,e),g=f.length>0?f[0]:null,h=f.length>1?f[1]:null,i=f.length>2?f[2]:null;this.startFolderPrefetch(c),this.startFolderPrefetch(a),this.startFolderPrefetch(b),this.startFolderPrefetch(g),this.startFolderPrefetch(h),this.startFolderPrefetch(i)}},k.prototype.startFolderPrefetch=function(a){if(!this.prefetchStarted()&&a){var b=1,c="",d={folder:a.fullName(),page:b,search:c},e=null;a.hasListBeenRequested(d)||(e=cc.MailCache.requestMessageList(d.folder,d.page,d.search,"",!1,!1),e&&e.RequestStarted&&this.prefetchStarted(!0))}},k.prototype.startThreadListPrefetch=function(){var a=[],b=cc.MailCache.getCurrentFolder();this.prefetchStarted()||(_.each(cc.MailCache.messages(),function(c){!this.prefetchStarted()&&c.threadCount()>0&&_.each(c.threadUids(),function(c){var d=b.oMessages[c];d&&b.hasThreadUidBeenRequested(c)||a.push(c)})},this),a.length>0&&(a=a.slice(0,ec.User.MailsPerPage),b.addRequestedThreadUids(a),b.loadThreadMessages(a),this.prefetchStarted(!0)))},k.prototype.startMessagesPrefetch=function(){var a=cc.MailCache.currentAccountId(),b=cc.MailCache.getCurrentFolder(),c=0,d=ec.App.MaxPrefetchBodiesSize,e=[],f=null,g=2048,h=function(a){var f=!a.deleted()&&!a.completelyFilled(),h=!_.find(e,function(b){return b===a.uid()},this),i=!b.hasUidBeenRequested(a.uid());c+a.textSize()+g<d&&f&&h&&i&&(e.push(a.uid()),c+=a.textSize()+g)};b&&b.selected()&&!this.prefetchStarted()&&(_.each(cc.MailCache.messages(),h),_.each(b.oMessages,h),e.length>0&&(b.addRequestedUids(e),f={AccountID:a,Action:"Messages",Folder:b.fullName(),Uids:e},cc.Ajax.send(f,this.onPrefetchResponse,this),this.prefetchStarted(!0)))},k.prototype.onPrefetchResponse=function(a,b){var c=cc.MailCache.getFolderByFullName(b.AccountID,b.Folder);_.isArray(a.Result)&&_.each(a.Result,function(a){c.parseAndCacheMessage(a,!1,!1)})},ac.inArray=a.inArray,ac.isFunc=a.isFunction,ac.trim=a.trim,ac.emptyFunction=function(){},ac.isUnd=function(a){return void 0===a},ac.isNull=function(a){return null===a},ac.isNormal=function(a){return!ac.isUnd(a)&&!ac.isNull(a)},ac.isNumeric=function(a){return ac.isNormal(a)?/^[1-9]+[0-9]*$/.test(a.toString()):!1
},ac.pInt=function(a){return ac.isNormal(a)&&""!==a?b.parseInt(a,10):0},ac.pString=function(a){return ac.isNormal(a)?a.toString():""},ac.isNonEmptyArray=function(a,b){return b=b||1,_.isArray(a)&&b<=a.length},ac.pImport=function(a,b,c){a[b]=c},ac.pExport=function(a,b,c){return ac.isUnd(a[b])?c:a[b]},ac.encodeHtml=function(a){return a?a.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""},ac.i18n=function(a,b,c,d){var e="",f=ac.isUnd(bc[a])?ac.isNormal(c)?c:a:bc[a];if(ac.isUnd(d)||(f=function(a,b){var c=ac.getPlural(ec.User.DefaultLanguage,a),d=b.split("|");return d&&d[c]?d[c]:d&&d[0]?d[0]:b}(d,f)),ac.isNormal(b))for(e in b)b.hasOwnProperty(e)&&(f=f.replace("%"+e+"%",b[e]));return f},ac.roundNumber=function(a,b){return Math.round(a*Math.pow(10,b))/Math.pow(10,b)},ac.friendlySize=function(a){var b=1024,c=b*b,d=b*b*b;return a=ac.pInt(a),a>=d?ac.roundNumber(a/d,1)+ac.i18n("MAIN/GIGABYTES"):a>=c?ac.roundNumber(a/c,1)+ac.i18n("MAIN/MEGABYTES"):a>=b?ac.roundNumber(a/b,0)+ac.i18n("MAIN/KILOBYTES"):a+ac.i18n("MAIN/BYTES")},ac.timeOutAction=function(){var a={};return function(c,d,e){ac.isUnd(a[c])&&(a[c]=0),b.clearTimeout(a[c]),a[c]=b.setTimeout(d,e)}}(),ac.$log=null,ac.log=function(){function b(a,b){return"string"==typeof b&&b.length>50?b.substring(0,50):b}if(ec&&ec.ClientDebug&&!cc.browser.ie9AndBelow){var c=ac.$log||a('<div style="display: none;"></div>').appendTo("body"),d=c.html(),e=d.split(/<br {0,1}\/{0,1}><br {0,1}\/{0,1}>/),f=[];_.each(arguments,function(a){var c="string"==typeof a?a:JSON.stringify(a,b);0===f.length&&(c="<b>"+c+"</b>"),f.push(c)}),ac.$log=c,e.length>200&&e.shift(),e.push(ac.encodeHtml(f.join(", "))),c.html(e.join("<br /><br />"))}},ac.getAjaxDataForLog=function(a,b){var c=b;if(b&&b.Result)switch(a){case"MessageList":case"MessageListByUids":c={Result:{Uids:b.Result.Uids,UidNext:b.Result.UidNext,FolderHash:b.Result.FolderHash,MessageCount:b.Result.MessageCount,MessageUnseenCount:b.Result.MessageUnseenCount,MessageResultCount:b.Result.MessageResultCount}};break;case"Message":c={Result:{Folder:b.Result.Folder,Uid:b.Result.Uid,Subject:b.Result.Subject,Size:b.Result.Size,TextSize:b.Result.TextSize,From:b.Result.From,To:b.Result.To}};break;case"Messages":c={Result:_.map(b.Result,function(a){return{Uid:a.Uid,Subject:a.Subject}})}}else b&&(c={Result:b.Result,ErrorCode:b.ErrorCode});return c},ac.getEmailParts=function(a){for(var b=a.indexOf('"'),c=a.indexOf('"',b+1),d=a.indexOf("<",c),e=-1,f=-1,g="",h="";-1!==d;)e=d,d=a.indexOf("<",d+1);return d=e,f=a.indexOf(">",d+1),-1===d?h=ac.trim(a):(g=-1===b?ac.trim(a.substring(0,d)):ac.trim(a.substring(b+1,c)),h=ac.trim(a.substring(d+1,f))),{name:g,email:h,FullEmail:a}},ac.isCorrectEmail=function(a){return!!a.match(/^[A-Z0-9\"!#\$%\^\{\}`~&'\+\-=_\.]+@[A-Z0-9\.\-]+$/i)},ac.getIncorrectEmailsFromAddressString=function(a){for(var b=a.replace(/"[^"]*"/g,"").replace(/;/g,",").split(","),c=[],d=0,e=b.length,f="",g=null;e>d;d++)f=ac.trim(b[d]),f.length>0&&(g=ac.getEmailParts(ac.trim(b[d])),ac.isCorrectEmail(g.email)||c.push(g.email));return c},ac.getArrayRecipients=function(a){if(!a)return[];for(var b=[],c=ac.trim(a)+" ",d=0,e=0,f=!1,g='"',h=!1,i=!1,j=0,k=c.length,l="",m="",n=null,o=!1,p=0,q=0;k>j;){switch(l=c.substring(j,j+1)){case"'":case'"':f?g===l&&(f=!1):h||i||(g=l,f=!0);break;case"<":f||h||i||(h=!0);break;case">":h&&(h=!1);break;case"(":f||h||i||(i=!0);break;case")":i&&(i=!1);break;default:if(","!==l&&";"!==l&&j!==k-1)break;if(!h&&!i&&!f){if(e=j!==k-1?j:k,m=c.substring(d,e),ac.trim(m).length>0){for(n=ac.getEmailParts(m),o=!1,p=b.length,q=0;p>q;q++)b[q].email===n.email&&(o=!0);!o&&ac.isCorrectEmail(n.email)&&b.push(n)}d=j+1}}j++}return b},ac.getImportContactsLink=function(){return"?/ImportContacts/"},ac.getExportContactsLink=function(){return"?/Raw/Contacts/"},ac.getExportCalendarLinkByHash=function(a,b){return"?/Raw/Calendar/"+a+"/"+b},ac.getDownloadLinkByHash=function(a,b,c,d){return c=ac.isUnd(c)?!1:!!c,d=ac.isUnd(d)?"":d,"?/Raw/Download/"+a+"/"+b+"/"+(c?"1":"0")+(""===d?"":"/"+d)},ac.getViewLinkByHash=function(a,b,c,d){return c=ac.isUnd(c)?!1:!!c,d=ac.isUnd(d)?"":d,"?/Raw/View/"+a+"/"+b+"/"+(c?"1":"0")+(""===d?"":"/"+d)},ac.getViewThumbnailLinkByHash=function(a,b,c,d){return c=ac.isUnd(c)?!1:!!c,d=ac.isUnd(d)?"":d,"?/Raw/Thumbnail/"+a+"/"+b+"/"+(c?"1":"0")+(""===d?"":"/"+d)},ac.getFilestorageDownloadLinkByHash=function(a,b,c){var d="?/Raw/FilesDownload/"+a+"/"+b;return this.isUnd(c)||(d=d+"/0/"+c),d},ac.getFilestorageViewLinkByHash=function(a,b,c){var d="?/Raw/FilesView/"+a+"/"+b;return this.isUnd(c)||(d=d+"/0/"+c),d},ac.getFilestoragePublicViewLinkByHash=function(a){return"?/Window/Files/0/"+a},ac.getFilestoragePublicDownloadLinkByHash=function(a){return"?/Raw/FilesPub/0/"+a},ac.daysInMonth=function(a,b){return a>0&&13>a&&b>0?new Date(b,a,0).getDate():31},ac.getAppPath=function(){return b.location.protocol+"//"+b.location.host+b.location.pathname},ac.WindowOpener={_iDefaultRatio:.8,_aOpenedWins:[],openMessage:function(a,b){if(a){var c=a.folder(),d=a.uid(),e="",f=null;e=b?cc.Routing.buildHashFromArray([_b.Screens.SingleCompose,"drafts",c,d]):cc.Routing.buildHashFromArray([_b.Screens.SingleMessageView,c,"msg"+d]),f=this.openTab(e)}},openTab:function(a){var c=null;return c=b.open(a,"_blank"),c.focus(),c.name=ec.Accounts.currentId(),this._aOpenedWins.push(c),c},open:function(a,c,d){var e=d?",menubar=yes":",menubar=no",f="location=no,toolbar=no,status=no,scrollbars=yes,resizable=yes"+e,g=null;return c=c.replace(/\W/g,""),f+=this._getSizeParameters(),g=b.open(a,c,f),g.focus(),g.name=ec.Accounts.currentId(),this._aOpenedWins.push(g),g},closeAll:function(){for(var a=this._aOpenedWins.length,b=0,c=null;a>b;b++)c=this._aOpenedWins[b],c.closed||c.close();this._aOpenedWins=[]},_getSizeParameters:function(){var a=b.screen.width,c=Math.ceil(a*this._iDefaultRatio),d=Math.ceil((a-c)/2),e=b.screen.height,f=Math.ceil(e*this._iDefaultRatio),g=Math.ceil((e-f)/2);return",width="+c+",height="+f+",top="+g+",left="+d}},ac.moveCaretToEnd=function(a){var b,c;a.createTextRange?(b=a.createTextRange(),b.collapse(!1),b.select()):a.setSelectionRange&&(c=2*a.value.length,a.setSelectionRange(c,c))},ac.delegateRun=function(a,b,c){a&&a[b]&&a[b].apply(a,_.isArray(c)?c:[])},ac.strRepeat=function(a,b){return new Array(b+1).join(a)},ac.deferredUpdate=function(a,c,d,e){!a.__interval&&c?(a.__state=!0,e(a,!0),a.__interval=b.setInterval(function(){a.__state||(e(a,!1),b.clearInterval(a.__interval),a.__interval=null)},d)):c||(a.__state=!1)},ac.draggableMessages=function(){return a('<div class="draggable draggableMessages"><div class="content"><span class="count-text"></span></div></div>').appendTo("#pSevenHidden")},ac.draggableContacts=function(){return a('<div class="draggable draggableContacts"><div class="content"><span class="count-text"></span></div></div>').appendTo("#pSevenHidden")},ac.removeActiveFocus=function(){if(document&&document.activeElement&&document.activeElement.blur){var b=a(document.activeElement);(b.is("input")||b.is("textarea"))&&document.activeElement.blur()}},ac.uiDropHelperAnim=function(b,c){var d=c.helper.clone().appendTo("#pSevenHidden"),e=a(b.target).find(".animGoal"),f=e[0]?e.offset():a(b.target).offset();d.animate({left:f.left+"px",top:f.top+"px","font-size":"0px",opacity:0},800,"easeOutQuint",function(){a(this).remove()})},ac.isTextFieldFocused=function(){var a=document&&document.activeElement?document.activeElement.tagName:null,b=document&&document.activeElement?document.activeElement.contentEditable:null;return"INPUT"===a||"TEXTAREA"===a||"IFRAME"===a||"true"===b},ac.removeSelection=function(){b.getSelection?b.getSelection().removeAllRanges():document.selection&&document.selection.empty()},ac.getMonthNamesArray=function(){for(var a=ac.i18n("DATETIME/MONTH_NAMES").split(" "),b=12,c=a.length;b>c;c++)a[c]="";return a},ac.getPlural=function(a,b){var c=0;switch(b=ac.pInt(b),a){case"Arabic":c=0===b?0:1===b?1:2===b?2:b%100>=3&&10>=b%100?3:b%100>=11?4:5;break;case"Bulgarian":c=1===b?0:1;break;case"Chinese-Simplified":c=0;break;case"Chinese-Traditional":c=1===b?0:1;break;case"Czech":c=1===b?0:b>=2&&4>=b?1:2;break;case"Danish":c=1===b?0:1;break;case"Dutch":c=1===b?0:1;break;case"English":c=1===b?0:1;break;case"Estonian":c=1===b?0:1;break;case"Finish":c=1===b?0:1;break;case"French":c=1===b?0:1;break;case"German":c=1===b?0:1;break;case"Greek":c=1===b?0:1;break;case"Hebrew":c=1===b?0:1;break;case"Hungarian":c=1===b?0:1;break;case"Italian":c=1===b?0:1;break;case"Japanese":c=0;break;case"Korean":c=0;break;case"Latvian":c=b%10===1&&b%100!==11?0:0!==b?1:2;break;case"Lithuanian":c=b%10===1&&b%100!==11?0:b%10>=2&&(10>b%100||b%100>=20)?1:2;break;case"Norwegian":c=1===b?0:1;break;case"Persian":c=0;break;case"Polish":c=1===b?0:b%10>=2&&4>=b%10&&(10>b%100||b%100>=20)?1:2;break;case"Portuguese-Portuguese":c=1===b?0:1;break;case"Portuguese-Brazil":c=1===b?0:1;break;case"Romanian":c=1===b?0:0===b||b%100>0&&20>b%100?1:2;break;case"Russian":c=b%10===1&&b%100!==11?0:b%10>=2&&4>=b%10&&(10>b%100||b%100>=20)?1:2;break;case"Serbian":c=b%10===1&&b%100!==11?0:b%10>=2&&4>=b%10&&(10>b%100||b%100>=20)?1:2;break;case"Spanish":c=1===b?0:1;break;case"Swedish":c=1===b?0:1;break;case"Thai":c=0;break;case"Turkish":c=1===b?0:1;break;case"Ukrainian":c=b%10===1&&b%100!==11?0:b%10>=2&&4>=b%10&&(10>b%100||b%100>=20)?1:2;break;default:c=0}return c},ac.getFileExtension=function(a){var b="",c=a.lastIndexOf(".");return c>-1&&(b=a.substr(c+1)),b},ac.getFileNameWithoutExtension=function(a){var b=a,c=a.lastIndexOf(".");return c>-1&&(b=a.substr(0,c)),b},ac.defaultOptionsAfterRender=function(a,b){b&&(ac.isUnd(b.disable)||c.applyBindingsToNode(a,{disable:b.disable},b))},ac.getDateFormatForMoment=function(a){var b="MM/DD/YYYY";switch(a){case"MM/DD/YYYY":b="MM/DD/YYYY";break;case"DD/MM/YYYY":b="DD/MM/YYYY";break;case"DD Month YYYY":b="DD MMMM YYYY"}return b},ac.getDateFormatForDatePicker=function(a){var b="mm/dd/yy";switch(a){case"MM/DD/YYYY":b="mm/dd/yy";break;case"DD/MM/YYYY":b="dd/mm/yy";break;case"DD Month YYYY":b="dd MM yy"}return b},ac.getDateFormatsForSelector=function(){return _.map(ec.App.DateFormats,function(a){switch(a){case"MM/DD/YYYY":return{name:ac.i18n("DATETIME/DATEFORMAT_MMDDYYYY"),value:a};case"DD/MM/YYYY":return{name:ac.i18n("DATETIME/DATEFORMAT_DDMMYYYY"),value:a};case"DD Month YYYY":return{name:ac.i18n("DATETIME/DATEFORMAT_DDMONTHYYYY"),value:a};default:return{name:a,value:a}}})},ac.getTitleForEvent=function(a){var b=ac.trim(a.replace(/[\n\r]/," ")),c=b.indexOf(" ",180);return c>=0&&(b=b.substring(0,c)+"..."),b.length>200&&(b=b.substring(0,200)+"..."),b},ac.getFormattedPhone=function(a){var b,c={"+7":"8"},d=/#/g.test(a)?a.split("#")[1]:a.replace(/[()\s_\-]/g,""),e=(a+"").slice(0,2);return b=_.any(c,function(a,b){return b===e},this),b?d.replace(e,c[e]):d.replace(/[+]/g,"")},ac.desktopNotify=function(){var a,c=0;return function(d,e,f,g,h,i){if("show"===d){var j,k=null,l={phone:"skins/Default/images/logo.png"},m={body:f,icon:l[g]||!1};if(b.Notification&&b.Notification.permission)switch(k=b.Notification,b.Notification.permission.toLowerCase()){case"granted":j=_b.DesktopNotifications.Allowed;break;case"denied":j=_b.DesktopNotifications.Denied;break;case"default":j=_b.DesktopNotifications.NotAllowed}else b.webkitNotifications&&b.webkitNotifications.checkPermission&&(k=b.webkitNotifications,j=b.webkitNotifications.checkPermission());k&&j===_b.DesktopNotifications.Allowed&&(a&&a.close(),a=new b.Notification(e,m),clearTimeout(c),i&&(c=setTimeout(function(){a.close()},i)),a.onclick=function(){h&&h(),a.close()})}else"hide"===d&&a&&a.close()}}(),ac.isRTL=function(){return gc.hasClass("rtl")},ac.shadeColor=function(a,c){var d=!1,e=0,f=0,g=0,h=0;return"#"===a[0]&&(a=a.slice(1),d=!0),e=b.parseInt(a,16),f=(e>>16)+c,f>255?f=255:0>f&&(f=0),g=(e>>8&255)+c,g>255?g=255:0>g&&(g=0),h=(255&e)+c,h>255?h=255:0>h&&(h=0),(d?"#":"")+(h|g<<8|f<<16).toString(16)},ac.extend=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a},l.prototype.iTimer=0,l.prototype.bResetCheckedOnClick=!1,l.prototype.bCheckOnSelect=!1,l.prototype.bUnselectOnCtrl=!1,l.prototype.bDisableMultiplySelection=!1,l.prototype.setBeforeSelectCallback=function(a){this.fBeforeSelectCallback=a||null},l.prototype.initOnApplyBindings=function(b,d,e,f,g){a(document).on("keydown",this.onKeydownBinded),this.oListScope=f,this.oScrollScope=g,this.sActionSelector=b,this.sSelectabelSelector=d,this.sCheckboxSelector=e;var h=this,i=function(a,b){var c=0,d=0,e=null,f=!1,g=!1,i=[],j=!1;if(a=a?a:null,b&&b.shiftKey&&null!==a&&null!==h.oLast&&a!==h.oLast)for(i=h.list(),j=a.checked(),c=0,d=i.length;d>c;c++)e=i[c],f=!1,(e===h.oLast||e===a)&&(f=!0),f&&(g=!g),(g||f)&&e.checked(j);a&&(h.oLast=a)};a(this.oListScope).on("dblclick",b,function(a){var b=c.dataFor(this);!b||!a||a.ctrlKey||a.altKey||a.shiftKey||h.onDblClick(b)}),jc&&a(this.oListScope).on("touchstart",b,function(b){if(b){var c=b.timeStamp,d=a(this).data("lastTouch")||c,e=c-d,f=b.originalEvent&&b.originalEvent.touches?b.originalEvent.touches.length:0;a(this).data("lastTouch",c),!e||e>250||f>1||(b.preventDefault(),a(this).trigger("dblclick"))}}),a(this.oListScope).on("click",b,function(a){var b=!0,d=null,e=c.dataFor(this);e&&a&&(a.shiftKey?(b=!1,h.bDisableMultiplySelection||(null===h.oLast&&(h.oLast=e),e.checked(!e.checked()),i(e,a))):a.ctrlKey&&(b=!1,h.bDisableMultiplySelection||(h.oLast=e,d=h.itemSelected(),!d||d.checked()||e.checked()||d.checked(!0),h.bUnselectOnCtrl&&e===h.itemSelected()?(e.checked(!e.selected()),h.itemSelected(null)):e.checked(!e.checked()))),b&&h.onSelect(e))}),a(this.oListScope).on("click",e,function(a){var b=c.dataFor(this);b&&a&&!h.bDisableMultiplySelection&&(a.shiftKey?(null===h.oLast&&(h.oLast=b),i(b,a)):h.oLast=b),a&&a.stopPropagation&&a.stopPropagation()}),a(this.oListScope).on("dblclick",e,function(a){a&&a.stopPropagation&&a.stopPropagation()})},l.prototype.getResultSelection=function(a,b){var c=this,d=!1,e=!1,f=null,g=this.iFactor,h=!!this.multiplyLineFactor,i=0,j=0,k=[];if(!a&&-1<ac.inArray(b,[this.KeyUp,this.KeyDown,this.KeyLeft,this.KeyRight,_b.Key.PageUp,_b.Key.PageDown,_b.Key.Home,_b.Key.End]))k=this.list(),k&&0<k.length&&(-1<ac.inArray(b,[this.KeyDown,this.KeyRight,_b.Key.PageUp,_b.Key.Home])?f=k[0]:-1<ac.inArray(b,[this.KeyUp,this.KeyLeft,_b.Key.PageDown,_b.Key.End])&&(f=k[k.length-1]));else if(a&&(k=this.list(),j=k?k.length:0,j>0))if(_b.Key.Home===b||_b.Key.PageUp===b||_b.Key.End===b||_b.Key.PageDown===b||h&&(_b.Key.Left===b||_b.Key.Right===b)||!h&&(_b.Key.Up===b||_b.Key.Down===b))_.each(k,function(g){if(!d)switch(b){case c.KeyUp:case c.KeyLeft:a===g?d=!0:f=g;break;case _b.Key.Home:case _b.Key.PageUp:f=g,d=!0;break;case c.KeyDown:case c.KeyRight:e?(f=g,d=!0):a===g&&(e=!0);break;case _b.Key.End:case _b.Key.PageDown:f=g}});else if(h&&this.KeyDown===b){for(;j>i;i++)if(a===k[i]){i+=g,i>j-1&&(i-=g),f=k[i];break}}else if(h&&this.KeyUp===b)for(i=j;i>=0;i--)if(a===k[i]){i-=g,0>i&&(i+=g),f=k[i];break}return f},l.prototype.shiftClickResult=function(a,b,c){if(b){var d=!!this.multiplyLineFactor,e=!1,f=!1;-1<ac.inArray(c,d?[_b.Key.Left,_b.Key.Right]:[_b.Key.Up,_b.Key.Down])?b.checked(!b.checked()):-1<ac.inArray(c,d?[_b.Key.Up,_b.Key.Down,_b.Key.PageUp,_b.Key.PageDown,_b.Key.Home,_b.Key.End]:[_b.Key.Left,_b.Key.Right,_b.Key.PageUp,_b.Key.PageDown,_b.Key.Home,_b.Key.End])&&(f=!b.checked(),_.each(this.list(),function(c){var d=!1;(c===a||b===c)&&(e=!e,d=!0),(e||d)&&(c.checked(f),d=!1)}),d&&a&&(c===_b.Key.Up||c===_b.Key.Down)&&a.checked(!a.checked()))}},l.prototype.clickNewSelectPosition=function(a,c){var d=this,e=0,f=null,g=this.itemSelected();f=this.getResultSelection(g,a),f?(c&&this.shiftClickResult(f,g,a),f&&this.fBeforeSelectCallback?(this.fBeforeSelectCallback(f,function(a){a&&(d.itemSelected(f),e=0===d.iTimer?50:150,0!==d.iTimer&&b.clearTimeout(d.iTimer),d.iTimer=b.setTimeout(function(){d.iTimer=0,d.onSelect(f,!1)},e))}),this.scrollToSelected()):(this.itemSelected(f),e=0===this.iTimer?50:150,0!==this.iTimer&&b.clearTimeout(this.iTimer),this.iTimer=b.setTimeout(function(){d.iTimer=0,d.onSelect(f)},e),this.scrollToSelected())):g&&c&&-1<ac.inArray(a,[this.KeyUp,this.KeyDown,this.KeyLeft,this.KeyRight,_b.Key.PageUp,_b.Key.PageDown,_b.Key.Home,_b.Key.End])&&g.checked(!g.checked())},l.prototype.onKeydown=function(a){var b=!0,c=0;return this.useKeyboardKeys()&&a&&!ac.isTextFieldFocused()&&(c=a.keyCode,a.ctrlKey||this.KeyUp!==c&&this.KeyDown!==c&&this.KeyLeft!==c&&this.KeyRight!==c&&_b.Key.PageUp!==c&&_b.Key.PageDown!==c&&_b.Key.Home!==c&&_b.Key.End!==c?_b.Key.Del!==c||a.ctrlKey||a.shiftKey?_b.Key.Enter===c?0<this.list().length&&!a.ctrlKey&&(this.onEnter(this.itemSelected()),b=!1):a.ctrlKey&&_b.Key.a===c&&(this.checkAll(!(this.checkAll()&&!this.isIncompleteChecked())),b=!1):0<this.list().length&&(this.onDelete(),b=!1):(this.clickNewSelectPosition(c,a.shiftKey),b=!1)),b},l.prototype.onDelete=function(){this.fDeleteCallback.call(this,this.listCheckedOrSelected()),this.itemSelected(null),this.listChecked(!1)},l.prototype.onEnter=function(a){var b=this;a&&this.fBeforeSelectCallback?this.fBeforeSelectCallback(a,function(c){c&&(b.itemSelected(a),b.fEnterCallback.call(this,a))}):(this.itemSelected(a),this.fEnterCallback.call(this,a))},l.prototype.selectionFunc=function(a){this.itemSelected(null),this.bResetCheckedOnClick&&this.listChecked(!1),this.itemSelected(a),this.fSelectCallback.call(this,a)},l.prototype.onSelect=function(a,b){if(b=ac.isUnd(b)?!0:!!b,this.fBeforeSelectCallback&&b){var c=this;this.fBeforeSelectCallback(a,function(b){b&&c.selectionFunc(a)})}else this.selectionFunc(a)},l.prototype.onDblClick=function(a){this.fDblClickCallback.call(this,a)},l.prototype.koCheckAll=function(){return c.computed({read:this.checkAll,write:this.checkAll,owner:this})},l.prototype.koCheckAllIncomplete=function(){return c.computed({read:this.isIncompleteChecked,write:this.isIncompleteChecked,owner:this})},l.prototype.scrollToSelected=function(){if(!this.oListScope||!this.oScrollScope)return!1;var b=20,c=a(this.sSelectabelSelector,this.oScrollScope),d=c.position(),e=this.oListScope.height(),f=c.outerHeight();return d&&(d.top<0||d.top+f>e)?(d.top<0?this.oScrollScope.scrollTop(this.oScrollScope.scrollTop()+d.top-b):this.oScrollScope.scrollTop(this.oScrollScope.scrollTop()+d.top-e+f+b),!0):!1},function(a){a.fn.splitter=function(c){return c=c||{},this.each(function(){var d=!1,e=c.name,f=0,g=0,h={},i={},j=function(b){d=!0,s.addClass(p.activeClass),p._posSplit=-((t?q._overallWidth-b[p.eventPos]:b[p.eventPos])-r.get(0)[p.pxSplit]),a("body").attr({unselectable:"on"}).addClass("unselectable"),a(document).bind("mousemove",k).bind("mouseup",l)},k=function(a){var b=(t?q._overallWidth-a[p.eventPos]:a[p.eventPos])+p._posSplit;m(b),ac.isFunc(c.resizeFunc)&&c.resizeFunc()},l=function u(){s.removeClass(p.activeClass),a("body").attr({unselectable:"off"}).removeClass("unselectable"),e&&cc.Storage.setData(e+"ResizerWidth",r.get(0)[p.pxSplit]),a(document).unbind("mousemove",k).unbind("mouseup",u),ac.isFunc(c.resizeFunc)&&c.resizeFunc()},m=function(a){a=b.Math.max(r.get(0)._min,q._overallWidth-r.get(1)._max,b.Math.min(a,r.get(0)._max,q._overallWidth-r.get(1)._min)),r.get(0).$.css(p.split,a),r.get(1).$.css(p.split,q._overallWidth-a),cc.browser.ie8AndBelow||r.trigger("resize")},n=function(a){for(var c=0,d=1;d<arguments.length;d++)c+=b.Math.max(b.parseInt(a.css(arguments[d]),10)||0,0);return c},o=(c.splitHorizontal?"h":c.splitVertical?"v":c.type)||"v",p=a.extend({activeClass:"active",pxPerKey:8,tabIndex:0,accessKey:""},{v:{keyLeft:39,keyRight:37,type:"v",eventPos:"pageX",origin:"left",split:"width",pxSplit:"offsetWidth",side1:"Left",side2:"Right",fixed:"height",pxFixed:"offsetHeight",side3:"Top",side4:"Bottom"},h:{keyTop:40,keyBottom:38,type:"h",eventPos:"pageY",origin:"top",split:"height",pxSplit:"offsetHeight",side1:"Top",side2:"Bottom",fixed:"width",pxFixed:"offsetWidth",side3:"Left",side4:"Right"}}[o],c),q=a(this),r=a(">*:not(css3pie)",q).each(function(){this.$=a(this)}),s=a(".resize_handler",r.get(0)).attr({unselectable:"on"}).bind("mousedown",j),t="rtl"===q.css("direction");r.get(0)._paneName=p.side1,r.get(1)._paneName=p.side2,r.each(function(){this._min=p["min"+this._paneName]||n(this.$,"min-"+p.split),this._max=p["max"+this._paneName]||n(this.$,"max-"+p.split)||9999,this._init=void 0===p["size"+this._paneName]?b.parseInt(a.css(this,p.split),10):p["size"+this._paneName]}),f=e?cc.Storage.getData(e+"ResizerWidth")||r.get(0)._init:r.get(0)._init,isNaN(f)&&(f=q[0][p.pxSplit],f=b.Math.round(f/r.length)),p.resizeToWidth&&!cc.browser.ie8AndBelow&&a(b).bind("resize",function(a){a.target===this&&q.trigger("resize")}),q.bind("resize",function(a,b,c){var e=a.target.className+"_"+c;d&&(h={}),a.target===this&&(q._overallWidth=q[0][p.pxSplit],q._overallWidth<=0||(g=p.sizeRight||p.sizeBottom?q._overallWidth-r.get(1)[p.pxSplit]:r.get(0)[p.pxSplit],isNaN(b)?b=g:c&&(d=!1,h[e]?(b=h[e],h[e]=null):(b===g?(h[e]=null,b=i[e]):h[e]=i[e]=g,_.each(h,function(a,b){b!==e&&(h[b]=null)}))),m(b)))}).trigger("resize",[f])})}}(jQuery),m.prototype.openComposeMessage=function(a){cc.Routing.setHash(cc.Links.composeWithToField(a))},m.prototype.showLoading=function(a){cc.Screens.showLoading(a)},m.prototype.hideLoading=function(){cc.Screens.hideLoading()},m.prototype.showReport=function(a,b){cc.Screens.showReport(a,b)},m.prototype.showError=function(a,b,c){cc.Screens.showError(a,b,c)},m.prototype.hideError=function(){cc.Screens.hideError()},m.prototype.showErrorByCode=function(a,b){switch(a){case _b.Errors.AuthError:this.showError(ac.i18n("WARNING/LOGIN_PASS_INCORRECT"));break;case _b.Errors.DemoLimitations:this.showError(ac.i18n("DEMO/WARNING_THIS_FEATURE_IS_DISABLED"));break;case _b.Errors.Captcha:this.showError(ac.i18n("WARNING/CAPTCHA_IS_INCORRECT"));break;case _b.Errors.CanNotGetMessage:this.showError(ac.i18n("MESSAGE/ERROR_MESSAGE_DELETED"));break;case _b.Errors.CanNotChangePassword:this.showError(ac.i18n("WARNING/UNABLE_CHANGE_PASSWORD"));break;case _b.Errors.AccountOldPasswordNotCorrect:this.showError(ac.i18n("WARNING/CURRENT_PASSWORD_NOT_CORRECT"));break;case _b.Errors.FetcherIncServerNotAvailable:this.showError(ac.i18n("WARNING/FETCHER_SAVE_ERROR"));break;case _b.Errors.FetcherLoginNotCorrect:this.showError(ac.i18n("WARNING/FETCHER_SAVE_ERROR"));break;case _b.Errors.HelpdeskUserNotExists:this.showError(ac.i18n("HELPDESK/ERROR_FORGOT_NO_ACCOUNT"));break;case _b.Errors.MailServerError:this.showError(ac.i18n("WARNING/CANT_CONNECT_TO_SERVER"));break;case _b.Errors.DataTransferFailed:this.showError(ac.i18n("WARNING/DATA_TRANSFER_FAILED"));break;case _b.Errors.NotDisplayedError:break;default:b&&b.length>0&&this.showError(b)}},dc.addScreenToHeader=function(a,b,c,d,e){cc.addScreenToHeader(a,b,c,d,e)},dc.aSettingsTabs=[],dc.addSettingsTab=function(a){a.TabName&&(_b.SettingsTab[a.TabName]=a.TabName,dc.aSettingsTabs.push(a))},dc.getPluginsSettingsTabs=function(){return dc.aSettingsTabs},dc.getSetting=function(a){return ec.App[a]},dc.getPluginSettings=function(a){return ec&&ec.Plugins?ec.Plugins[a]:null},dc.oPluginHooks={},dc.addPluginHook=function(b,c){ac.isFunc(c)&&(a.isArray(this.oPluginHooks[b])||(this.oPluginHooks[b]=[]),this.oPluginHooks[b].push(c))},dc.runPluginHook=function(b,c){a.isArray(this.oPluginHooks[b])&&(c=c||[],_.each(this.oPluginHooks[b],function(a){a.apply(null,c)}))},dc.sendAjaxRequest=function(a,b,c){cc.Ajax.send(a,b,c)},dc.i18n=function(a,b,c,d){return ac.i18n(a,b,c,d)},dc.getArrayRecipients=function(a){return ac.getArrayRecipients(a)},n.prototype.setData=function(a,b){Data.setVar(a,b)},n.prototype.removeData=function(a){Data.setVar(a,"")},n.prototype.getData=function(a){return Data.getVar(a)},n.prototype.hasData=function(a){return Data.hasVar(a)},o.prototype.init=function(){a.ajaxSettings.cache=!0,this.provider=new r},o.prototype.log=function(){},o.prototype.call=function(a){this.provider.call(a),this.action("outgoing")},o.prototype.answer=function(){this.action("incoming_connect"),this.provider.answer(),this.hideAll()},o.prototype.hangup=function(){this.action("online"),this.provider.hangup(),this.hideAll()},o.prototype.hideAll=function(){var a=this;cc.Screens.hidePopup(I),cc.desktopNotify("hide"),this.timer("stop"),setTimeout(function(){a.phoneReport("")},2e3)},o.prototype.reconnect=function(a,b){var c,d=this;clearInterval(this.reconnectInterval),arguments.length&&(c=a,this.reconnectInterval=setInterval(function(){c>0?d.phoneReport(ac.i18n("Reconnect in "+c+" seconds")):0>=c&&(d.phoneReport(ac.i18n("Connecting...")),clearInterval(d.reconnectInterval),c=a,b()),c--},1e3))},o.prototype.timer=function(a){var b=this,c=0,d=0,e=function(a){var b=a.toString();return 1===b.length?b="0"+b:b};"start"===a?this.timerInterval=setInterval(function(){60===c&&(c=0,d++),b.phoneReport(ac.i18n("passed time "+e(d)+":"+e(c))),c++},1e3):"stop"===a&&clearInterval(this.timerInterval)},o.prototype.showError=function(a){1===ac.pInt(a)&&cc.Api.showError(ac.i18n("PHONE/ERROR_SERVER_UNAVAILABLE"),!1,!0)},o.prototype.hideError=function(){cc.Api.hideError()},o.prototype.showPopup=function(a){cc.Screens.showPopup(I,[a])},o.prototype.hidePopup=function(){cc.Screens.hidePopup(I)},o.prototype.phoneSupport=function(a,b){var c=function(){try{try{var a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");try{a.AllowScriptAccess="always"}catch(b){return"6,0,0"}}catch(b){}return new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version").replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(b){try{if(navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin)return(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]).description.replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(c){}}return"0,0,0"};!a||cc.browser.chrome||b||hc?hc?this.phoneReport("Device not supported"):b&&"0,0,0"===c()?this.phoneReport("Please install flash player"):b&&c()<b&&this.phoneReport("Please reinstall flash player"):this.phoneReport("Browser not supported")},o.prototype.incomingCall=function(a){var b=this,c={Action:"ContactSuggestions",Search:a,PhoneOnly:"1"},d=function(a){b.phoneReport(ac.i18n("PHONE/INCOMING_CALL_FROM")+" "+a),b.showPopup({Action:_b.PhoneAction.Incoming,PhoneNumber:a}),cc.desktopNotify("show",a+" calling...","Click here to answer.\r\n To drop the call, click End in the web interface.","",b.answer.bind(b))};this.action("incoming"),a&&cc.Ajax.send(c,function(b){b&&b.Result&&b.Result.List&&b.Result.List[0]?_.each(b.Result.List[0].Phones,function(c){var e,f=b.Result.List[0],g=/[()\s_\-]/g,h=a.replace(g,""),i=c.replace(g,"");h===i&&(e=""===f.Name?f.Email+" "+c:f.Name+" "+c,d(e))},this):d(a)},this)},p.prototype.init=function(){var b=this;a.getScript("static/js/sipml.js",function(a,c){"success"===c&&(b.voiceApp(!0),SIPml.setDebugLevel("fatal"),SIPml.init(b.createStackBinded,b.createStackErrorBinded))})},p.prototype.setConfigs=function(){this.stackConf({realm:ec.User.VoiceRealm,impi:ec.User.VoiceImpi,impu:"sip:"+ec.User.VoiceImpi+"@"+ec.User.VoiceRealm,password:ec.User.VoicePassword,enable_rtcweb_breaker:!0,websocket_proxy_url:ec.User.VoiceWebsocketProxyUrl,events_listener:{events:"*",listener:this.eventSessionBinded}}),this.registerConf({audio_remote:this.audioRemote,expires:3600,events_listener:{events:"*",listener:this.eventSessionBinded},sip_caps:[{name:"+g.oma.sip-im",value:null},{name:"+audio",value:null},{name:"language",value:'"en,fr"'}]}),this.hangupConf({events_listener:{events:"*",listener:this.eventSessionBinded}})},p.prototype.createStackError=function(){this.log("Failed to initialize the engine")},p.prototype.log=function(a){b.console&&b.console.log&&b.console.log("*************************************************** "+a)},p.prototype.createStack=function(){this.stack(new SIPml.Stack(this.stackConf())),this.stack().start()},p.prototype.register=function(){this.registerSession(this.stack().newSession("register",this.registerConf())),this.registerSession().register()},p.prototype.call=function(a){this.isStarted()?(this.action("outgoing"),this.callSession(this.stack().newSession("call-audio",this.registerConf())),this.callSession().call(a),this.log(this.callSession().getRemoteFriendlyName())):(this.hasFatalError(!1),this.createStack())},p.prototype.answer=function(){this.callSession()&&this.callSession().accept(this.registerConf())},p.prototype.hangup=function(){this.callSession()&&this.callSession().hangup(this.hangupConf())},p.prototype.eventSession=function(a){this.log(a.type+" ("+a.description+")");var b=a.type;switch(b){case"starting":break;case"started":this.phone.hideError(),this.isStarted(!0),this.register();break;case"stopping":case"stopped":this.isStarted(!1),this.createStack();break;case"failed_to_stop":break;case"failed_to_start":this.isStarted(!1),this.phone.reconnect(30,this.createStack.bind(this));break;case"connecting":break;case"connected":this.phoneReport(ac.i18n("PHONE/CONNECTED")),"In call"===a.description&&cc.desktopNotify("hide");break;case"terminating":this.phoneReport(ac.i18n("PHONE/CALL_TERMINATING")),_.delay(_.bind(function(){this.action("")},this),1500);break;case"terminated":this.phoneReport(ac.i18n("PHONE/TERMINATED")),"Disconnected"===a.description&&this.createStack();break;case"i_ao_request":this.phoneReport(ac.i18n("PHONE/RINGING"));break;case"media_added":break;case"media_removed":break;case"i_request":break;case"o_request":break;case"sent_request":break;case"cancelled_request":break;case"i_new_call":this.callSession(a.newSession),this.action("incoming"),this.phone.showPopup({Action:_b.PhoneAction.Incoming,PhoneNumber:this.callSession().getRemoteFriendlyName()});break;case"i_new_message":break;case"m_permission_requested":break;case"m_permission_accepted":"incoming"===this.action()?this.phoneReport(ac.i18n("PHONE/INCOMING_CALL_FROM")+" "+this.callSession().getRemoteFriendlyName()):this.phoneReport(ac.i18n("PHONE/CALL_IN_PROGRESS"));break;case"m_permission_refused":break;case"transport_error":break;case"global_error":break;case"message_error":break;case"webrtc_error":}},q.prototype.init=function(){var b=this;a.getScript("static/js/swfobject.js",function(a,c){"success"===c&&(b.voiceApp(!0),swfobject.embedSWF("static/freeswitch.swf","flash","214","137","9.0.0","expressInstall.swf",{rtmp_url:"rtmp://217.199.220.26/phone"},{allowScriptAccess:"always",bgcolor:"#ece9e0"},[],!1),b.callbacks())})},q.prototype.log=function(a){b.console&&b.console.log&&b.console.log(a)},q.prototype.showPrivacy=function(){this.phone.showPopup({Action:_b.PhoneAction.Settings,Callback:this.launchFlash.bind(this)});var b=a("#fake_flash"),c=b.offset(),d=b.width();this.jqFlash.css("left",c.left+d/2-107),this.jqFlash.css("top",c.top),this.jqFlash.css("visibility","visible"),this.flash.showPrivacy()},q.prototype.checkMic=function(){return this.flash.isMuted()},q.prototype.login=function(a,b){this.flash.login(a,b)},q.prototype.newCall=function(){},q.prototype.call=function(){this.flash.makeCall("sip:7002@217.199.220.24","7003@217.199.220.26",[])},q.prototype.answer=function(a){this.flash.answer(a)},q.prototype.hangup=function(a){this.flash.hangup(a)},q.prototype.addCall=function(){},q.prototype.launchFlash=function(){this.jqFlash.css("top","-200px")},q.prototype.callbacks=function(){var c=this;b.onInit=function(){c.log("**************** onInit"),c.initStatus(!0)},b.onConnected=function(b){c.log("**************** onConnected ("+b+")"),c.connectStatus(!0),c.sessionid(b),c.jqFlash=a("#flash"),c.flash=c.jqFlash[0],c.checkMic()&&c.showPrivacy(),c.login("7003@217.199.220.26","7003voippassword")},b.onDisconnected=function(){c.log("**************** onDisconnected")},b.onEvent=function(a){c.log("**************** onEvent ("+a+")")},b.onLogin=function(a,b,d){c.log("**************** onLogin ("+a+", "+b+", "+d+")")},b.onLogout=function(a,b){c.log("**************** onLogout ("+a+", "+b+")")},b.onMakeCall=function(a,b,d){c.log("**************** onMakeCall ("+a+", "+b+", "+d+")")},b.onHangup=function(a,b){c.log("**************** onHangup ("+a+", "+b+")")
},b.onIncomingCall=function(a,b,d,e,f){c.log("**************** onIncomingCall ("+a+", "+b+", "+d+", "+e+", "+f+")"),c.addCall(a,b,d)},b.onDisplayUpdate=function(a,b,d){c.log("**************** onDisplayUpdate ("+a+", "+b+", "+d+")")},b.onCallState=function(a,b){c.log("**************** onCallState ("+a+", "+b+")"),c.callState(b)},b.onDebug=function(a){c.log("**************** onDebug ("+a+")")},b.onAttach=function(a){c.log("**************** onAttach ("+a+")")}},r.prototype.init=function(){cc.Ajax.send({Action:"GetTwilioToken"},this.onTokenResponse,this)},r.prototype.onTokenResponse=function(b){var c=0,d=this;b&&b.Result&&(a.ajaxSettings.cache=!0,a.getScript("//static.twilio.com/libs/twiliojs/1.1/twilio.min.js",function(a,e){"success"===e?d.setupDevice(b.Result):d.phoneReport("Unknown error"),clearTimeout(c)}),c=setTimeout(function(){d.init()},1e4))},r.prototype.setupDevice=function(a){var b=this;this.phone.phoneSupport(!1,"10,1,000"),this.device=Twilio.Device,this.device.setup(a,{}),this.device.ready(function(a){b.phone.log("**************** ready ",a),b.voiceApp(!0),b.phone.action("online"),b.phoneReport("")}),this.device.offline(function(a){b.phone.log("**************** offline ",a),b.phone.action("offline")}),this.device.error(function(a){b.phone.log("**************** error ",a),b.phone.action("offline")}),this.device.connect(function(a){b.phone.log("**************** connect ",a),b.phone.timer("start")}),this.device.disconnect(function(a){b.phone.log("**************** disconnect ",a),b.phone.hideAll(),b.phone.action("online")}),this.device.incoming(function(a){b.phone.log("**************** incoming ",a),b.connection=a,b.phone.incomingCall(a.parameters.From)}),this.device.cancel(function(a){b.phone.log("**************** cancel ",a),b.phone.hideAll(),b.phone.action("online")}),this.device.presence(function(a){b.phone.log("**************** presence ",a)})},r.prototype.call=function(a){var b={PhoneNumber:a,Direction:"outbound"};this.connection=this.device.connect(b)},r.prototype.answer=function(){this.phoneReport("Incoming: "+this.connection.parameters.From),this.connection.accept()},r.prototype.hangup=function(){"pending"===this.connection.status()?this.connection.reject():this.connection.disconnect(),"closed"!==this.connection.status()&&_.delay(_.bind(function(){this.hangup()},this),1e3)},s.prototype.onShow=function(a,b,c,d){this.alertDesc(a),this.closeCallback=b||null,this.title(c||""),this.okButtonText(d||ac.i18n("MAIN/BUTTON_OK"))},s.prototype.popupTemplate=function(){return"Popups_AlertPopupViewModel"},s.prototype.onEnterHandler=function(){this.close()},s.prototype.close=function(){ac.isFunc(this.closeCallback)&&this.closeCallback(),this.closeCommand()},t.prototype.onShow=function(a,b,c,d,e){this.title(c||""),this.okButtonText(d||ac.i18n("MAIN/BUTTON_OK")),this.cancelButtonText(e||ac.i18n("MAIN/BUTTON_CANCEL")),ac.isFunc(b)&&(this.fConfirmCallback=b,this.confirmDesc(a))},t.prototype.popupTemplate=function(){return"Popups_ConfirmPopupViewModel"},t.prototype.onEnterHandler=function(){this.yesClick()},t.prototype.yesClick=function(){this.fConfirmCallback&&this.fConfirmCallback(!0),this.closeCommand()},t.prototype.noClick=function(){this.fConfirmCallback&&this.fConfirmCallback(!1),this.closeCommand()},u.prototype.popupTemplate=function(){return"Popups_AccountCreatePopupViewModel"},u.prototype.onShow=function(){this.friendlyNameFocus(!0),this.init()},u.prototype.init=function(){this.isFirstStep(!0),this.friendlyName(""),this.email(""),this.incomingMailLogin(""),this.incLoginFocused(!1),this.incomingMailPassword(""),this.incomingMailPort(143),this.incomingMailServer(""),this.outgoingMailLogin(""),this.outgoingMailPassword(""),this.outgoingMailPort(25),this.outgoingMailServer(""),this.outServerFocused(!1),this.useSmtpAuthentication(!0)},u.prototype.onFirstSaveClick=function(){var a={Action:"EmailDomainData",Email:this.email()};this.loading(!0),cc.Ajax.send(a,this.onEmailDomainDataResponse,this)},u.prototype.onSecondSaveClick=function(){var a={Action:"AccountCreate",AccountID:this.editedAccountId(),FriendlyName:this.friendlyName(),Email:this.email(),IncomingMailLogin:this.incomingMailLogin(),IncomingMailPassword:this.incomingMailPassword(),IncomingMailServer:this.incomingMailServer(),IncomingMailPort:parseInt(this.incomingMailPort(),10),OutgoingMailServer:this.outgoingMailServer(),OutgoingMailLogin:this.outgoingMailLogin(),OutgoingMailPassword:this.outgoingMailPassword(),OutgoingMailPort:parseInt(this.outgoingMailPort(),10),OutgoingMailAuth:this.useSmtpAuthentication()?2:0};this.loading(!0),cc.Ajax.send(a,this.onAccountCreateResponse,this)},u.prototype.onCancelClick=function(){this.closeCommand(),this.init()},u.prototype.onEmailDomainDataResponse=function(a){this.loading(!1),this.incomingMailLogin(this.email()),this.isFirstStep(!1),a.Result&&(this.incomingMailPort(a.Result.IncomingMailPort),this.incomingMailServer(a.Result.IncomingMailServer),this.outgoingMailPort(a.Result.OutgoingMailPort),this.outgoingMailServer(a.Result.OutgoingMailServer))},u.prototype.onAccountCreateResponse=function(a,b){if(this.loading(!1),a.Result){var c=new L,d=parseInt(a.Result,10);c.init(d,b.Email,b.FriendlyName),c.updateExtended(b),ec.Accounts.addAccount(c),ec.Accounts.changeEditedAccount(d),this.closeCommand(),this.init()}else cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("WARNING/CREATING_ACCOUNT_ERROR"))},v.prototype.popupTemplate=function(){return"Popups_AccountCreateIdentityPopupViewModel"},v.prototype.onShow=function(a){var b=new Q;b.accountId(a),this.oIdentityPropertiesViewModel.populate(b)},v.prototype.cancel=function(){this.closeCommand()},w.prototype.popupTemplate=function(){return"Popups_FetcherAddPopupViewModel"},w.prototype.onShow=function(){this.incomingMailServer(""),this.incomingMailPort(110),this.incomingMailLogin(""),this.incomingMailPassword(""),this.folder(""),this.outgoingMailServer(""),this.outgoingMailPort(25),this.leaveMessagesOnServer(!0)},w.prototype.onSaveClick=function(){if(this.isEmptyRequiredFields())cc.Api.showError(ac.i18n("WARNING/FETCHER_CREATE_ERROR"));else{var a={Action:"FetcherCreate",AccountID:this.defaultAccountId(),Folder:this.folder(),IncomingMailServer:this.incomingMailServer(),IncomingMailPort:parseInt(this.incomingMailPort(),10),IncomingMailLogin:this.incomingMailLogin(),IncomingMailPassword:""===this.incomingMailPassword()?"******":this.incomingMailPassword(),LeaveMessagesOnServer:this.leaveMessagesOnServer()?1:0};this.loading(!0),cc.Ajax.send(a,this.onAddFetcherResponse,this)}},w.prototype.onAddFetcherResponse=function(a){this.loading(!1),a.Result?(ec.Accounts.populateFetchers(),this.closeCommand()):cc.Api.showErrorByCode(a.ErrorCode)},w.prototype.onCancelClick=function(){this.closeCommand()},w.prototype.isEmptyRequiredFields=function(){switch(""){case this.incomingMailServer():return this.serverIsSelected(!0),!0;case this.incomingMailLogin():return this.loginIsSelected(!0),!0;case this.incomingMailPassword():return this.passwordIsSelected(!0),!0;default:return!1}},w.prototype.onAddNewFolderClick=function(){cc.Screens.showPopup(y)},x.prototype.onShow=function(){var a=cc.MailCache.editedFolderList();this.sSentFolderOld=a.sentFolderFullName(),this.sDraftFolderOld=a.draftsFolderFullName(),this.sSpamFolderOld=a.spamFolderFullName(),this.sTrashFolderOld=a.trashFolderFullName(),this.folders(a),this.sentFolderFullName(this.sSentFolderOld),this.draftsFolderFullName(this.sDraftFolderOld),this.spamFolderFullName(this.sSpamFolderOld),this.trashFolderFullName(this.sTrashFolderOld)},x.prototype.popupTemplate=function(){return"Popups_FolderSystemPopupViewModel"},x.prototype.onResponseSetupSystemFolders=function(a){a&&a.Result!==!1&&cc.MailCache.getFolderList(ec.Accounts.editedId())},x.prototype.onOKClick=function(){var a=this.folders(),b={Action:"SetupSystemFolders",AccountID:ec.Accounts.editedId(),Sent:a.sentFolderFullName(),Drafts:a.draftsFolderFullName(),Trash:a.trashFolderFullName(),Spam:a.spamFolderFullName()};cc.Ajax.send(b,this.onResponseSetupSystemFolders,this),this.closeCommand()},x.prototype.onCancelClick=function(){var a=this.folders();a.sentFolderFullName(this.sSentFolderOld),a.draftsFolderFullName(this.sDraftFolderOld),a.spamFolderFullName(this.sSpamFolderOld),a.trashFolderFullName(this.sTrashFolderOld),this.closeCommand()},y.prototype.popupTemplate=function(){return"Popups_FolderCreatePopupViewModel"},y.prototype.onShow=function(){this.folderNameFocus(!0)},y.prototype.onHide=function(){this.parentFolder=c.observable(""),this.folderName=c.observable("")},y.prototype.onResponseFolderCreate=function(a){this.loading(!1),a.Result?(this.folderName(""),this.parentFolder(""),cc.MailCache.getFolderList(ec.Accounts.editedId()),this.closeCommand()):cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("SETTINGS/ACCOUNT_FOLDERS_CANT_CREATE_FOLDER"))},y.prototype.onOKClick=function(){var a=""===this.parentFolder()?this.namespace():this.parentFolder(),b={Action:"FolderCreate",AccountID:ec.Accounts.editedId(),FolderNameInUtf8:this.folderName(),FolderParentFullNameRaw:a,Delimiter:this.folders().delimiter()};this.loading(!0),cc.Ajax.send(b,this.onResponseFolderCreate,this)},y.prototype.onCancelClick=function(){this.closeCommand()},z.prototype.onShow=function(a){this.isHelpdesk(a),this.init()},z.prototype.popupTemplate=function(){return"Popups_ChangePasswordPopupViewModel"},z.prototype.init=function(){this.currentPassword(""),this.newPassword(""),this.confirmPassword("")},z.prototype.onResponse=function(a){a.Result===!1?cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("SETTINGS/ACCOUNT_PROPERTIES_NEW_PASSWORD_UPDATE_ERROR")):(cc.Api.showReport(ac.i18n("SETTINGS/ACCOUNT_PROPERTIES_CHANGE_PASSWORD_SUCCESS")),this.closeCommand(),this.init())},z.prototype.onOKClick=function(){var a=null;this.confirmPassword()!==this.newPassword()?cc.Api.showError(ac.i18n("WARNING/PASSWORDS_DO_NOT_MATCH")):this.isHelpdesk()?(a={Action:"HelpdeskUpdateUserPassword",CurrentPassword:this.currentPassword(),NewPassword:this.newPassword()},cc.Ajax.sendExt(a,this.onResponse,this)):(a={Action:"UpdateAccountPassword",AccountID:ec.Accounts.editedId(),CurrentIncomingMailPassword:this.currentPassword(),NewIncomingMailPassword:this.newPassword()},cc.Ajax.send(a,this.onResponse,this))},z.prototype.onCancelClick=function(){this.closeCommand()},A.prototype.onShow=function(a){this.folderNameFocus(!0),ac.isFunc(a)&&(this.fCallback=a)},A.prototype.popupTemplate=function(){return"Popups_FileStorageFolderCreatePopupViewModel"},A.prototype.onOKClick=function(){this.fCallback&&(this.fCallback(this.folderName()),this.folderName("")),this.closeCommand()},A.prototype.onCancelClick=function(){this.closeCommand()},B.prototype.onShow=function(a,b){this.item=a,this.name=this.item.nameForEdit,this.nameFocus(!0),ac.isFunc(b)&&(this.fCallback=b)},B.prototype.popupTemplate=function(){return"Popups_FileStorageRenamePopupViewModel"},B.prototype.onOKClick=function(){this.fCallback&&this.fCallback(this.item),this.closeCommand()},B.prototype.onCancelClick=function(){this.closeCommand()},C.prototype.onShow=function(a){this.item=a,this.pub(""),cc.Ajax.send({Action:"FilesMin",Account:ec.Accounts.defaultId(),Type:a.storageType(),Path:a.path(),Name:a.fileName(),Size:a.size(),IsFolder:a.isFolder()},this.onFilesMinResponse,this)},C.prototype.onFilesMinResponse=function(a,b){if(a.Result){var c=b.IsFolder?"?files-pub=":ec.App.ServerUseUrlRewrite?"share/":"?/Min/Share/";this.pub(ac.getAppPath()+c+a.Result),this.pubFocus(!0),this.item.shared(!0)}},C.prototype.popupTemplate=function(){return"Popups_FileStorageSharePopupViewModel"},C.prototype.onOKClick=function(){this.closeCommand()},C.prototype.onFilesMinDeleteResponse=function(){this.closeCommand()},C.prototype.onCancelSharingClick=function(){this.item&&(cc.Ajax.send({Action:"FilesMinDelete",Account:ec.Accounts.defaultId(),Type:this.item.storageType(),Path:this.item.path(),Name:this.item.fileName()},this.onFilesMinDeleteResponse,this),this.item.shared(!1))},D.prototype.clearFields=function(){this.calendarName(""),this.calendarDescription(""),this.selectedColor(this.colors[0]),this.calendarId(null)},D.prototype.onShow=function(a,b,c){this.clearFields(),ac.isFunc(a)&&(this.fCallback=a),ac.isUnd(b)||(this.colors(b),this.selectedColor(b[0])),ac.isUnd(c)||(this.calendarName(c.name?c.name():""),this.calendarDescription(c.description?c.description():""),this.selectedColor(c.color?c.color():""),this.calendarId(c.id?c.id:null))},D.prototype.popupTemplate=function(){return"Popups_CalendarCreatePopupViewModel"},D.prototype.onSaveClick=function(){""===this.calendarName()?cc.Screens.showPopup(s,[ac.i18n("CALENDAR/WARNING_BLANK_CALENDAR_NAME")]):(this.fCallback&&(this.fCallback(this.calendarName(),this.calendarDescription(),this.selectedColor(),this.calendarId()),this.clearFields()),this.closeCommand())},D.prototype.onCancelClick=function(){this.closeCommand()},E.prototype.onShow=function(a,b){ac.isFunc(a)&&(this.fCallback=a),ac.isUnd(b)||(this.selectedColor(b.color()),this.calendarId(b.id),this.calendarUrl(b.davUrl()+b.url()),this.exportUrl(b.exportUrl()),this.icsLink(b.davUrl()+b.url()+"?export"),this.isPublic(b.isPublic()),this.shares(b.shares().slice(0)),this.oldShares(b.shares().slice(0)),this.owner(b.owner()),this.sharedToAll(b.isSharedToAll()),this.sharedToAllAccess(b.sharedToAllAccess))},E.prototype.popupTemplate=function(){return"Popups_CalendarSharePopupViewModel"},E.prototype.onSaveClick=function(){this.fCallback&&(this.addShare(),this.fCallback(this.calendarId(),this.isPublic(),this.shares(),this.sharedToAll(),this.sharedToAllAccess())),this.closePopup()},E.prototype.onCancelClick=function(){this.shares(this.oldShares()),this.closePopup()},E.prototype.closePopup=function(){this.cleanAll(),this.closeCommand()},E.prototype.cleanAll=function(){this.newShare(""),this.newShareAccess(_b.CalendarAccess.Read),this.shareToAllAccess=c.observable(_b.CalendarAccess.Read),this.shareAutocompleteItem(null),this.canAdd(!1)},E.prototype.addShare=function(){var a=this.shareAutocompleteItem()?this.shareAutocompleteItem().email:this.newShare();this.canAdd()?(this.shares.push({name:this.shareAutocompleteItem()?this.shareAutocompleteItem().name:"",email:a,access:this.newShareAccess()}),this.cleanAll()):(this.whomAnimate(a),this.recivedAnim(!0))},E.prototype.removeShare=function(a){this.shares.remove(a)},E.prototype.autocompleteCallback=function(a,b){var c={Action:"ContactSuggestions",Search:a,GlobalOnly:"1"};this.shareAutocompleteItem(null),a=ac.trim(a),""!==a?cc.Ajax.send(c,function(a){var c=[];a&&a.Result&&a.Result&&a.Result.List&&(c=_.map(a.Result.List,function(a){return a&&a.Email&&a.Email!==this.owner()?a.Name&&0<ac.trim(a.Name).length?a.ForSharedToAll?{value:a.Name,name:a.Name,email:a.Email}:{value:'"'+a.Name+'" <'+a.Email+">",name:a.Name,email:a.Email}:{value:a.Email,name:"",email:a.Email}:null},this),c=_.compact(c),this.newShareList(c),this.setGlobal(this.newShare(),c)),b(c)},this):b([])},E.prototype.setGlobal=function(a,b){var c=_.any(b,function(b){return b.email===a},this),d=_.any(this.shares(),function(b){return b.email===a},this);this.canAdd(c&&!d)},F.prototype.onShow=function(a,b){ac.isFunc(a)&&(this.fCallback=a),ac.isUnd(b)||(this.selectedColor(b.color()),this.calendarId(b.id),this.calendarUrl(b.davUrl()+b.url()),this.exportUrl(b.exportUrl()),this.icsLink(b.davUrl()+b.url()+"?export"),this.isPublic(b.isPublic()),this.pubUrl(b.pubUrl()),this.exportUrl(b.exportUrl()))},F.prototype.popupTemplate=function(){return"Popups_CalendarGetLinkPopupViewModel"},F.prototype.onCancelClick=function(){this.fCallback&&this.fCallback(this.calendarId(),this.isPublic()),this.closeCommand()},G.prototype.createDatePickerObject=function(b,c){a(b).datepicker({showOtherMonths:!0,selectOtherMonths:!0,monthNames:ac.getMonthNamesArray(),dayNamesMin:ac.i18n("DATETIME/DAY_NAMES_MIN").split(" "),firstDay:ec.User.CalendarWeekStartsOn,showOn:"both",buttonText:"",buttonImage:"skins/Default/images/calendar-icon.png",buttonImageOnly:!0,dateFormat:this.dateFormatDatePicker,onSelect:c}),a(b).mousedown(function(){a("#ui-datepicker-div").toggle()})},G.prototype.initializeDatePickers=function(){this.createDatePickerObject(this.startDom(),this.selectStartDate.bind(this)),this.createDatePickerObject(this.endDom(),this.selectEndDate.bind(this)),this.createDatePickerObject(this.repeatEndDom(),ac.emptyFunction())},G.prototype.onShow=function(a){var b=this.defaultAccount,c=b?b.email():"",d=b?b.friendlyName():"";this.isMyEvent(c===(a.Owner||c)),this.callbackSave=a.CallbackSave,this.callbackDelete=a.CallbackDelete,this.callbackAttendeeActionDecline=a.CallbackAttendeeActionDecline,this.timeFormatMoment=a.TimeFormat,this.dateFormatMoment=ac.getDateFormatForMoment(a.DateFormat),this.dateFormatDatePicker=ac.getDateFormatForDatePicker(a.DateFormat),this.initializeDatePickers(),this.startDate(a.StartMoment.format(this.dateFormatMoment)),this.startDom().datepicker("setDate",a.StartMoment.toDate()),this.startTime(a.StartMoment.format(this.timeFormatMoment)),this.endDate(a.EndMoment?a.EndMoment.format(this.dateFormatMoment):this.startDate()),this.endDom().datepicker("setDate",a.EndMoment?a.EndMoment.toDate():a.StartMoment.toDate()),this.endTime(a.EndMoment?a.EndMoment.format(this.timeFormatMoment):this.startTime()),this.allDay(a.AllDay),this.calendars=a.Calendars,this.calendars&&this.calendarsList(_.filter(this.calendars.collection(),function(a){return a.isEditable()})),this.selectedCalendar(a.SelectedCalendar),this.selectedCalendar.valueHasMutated(),this.calendarId(this.selectedCalendar()),this.editableSwitch(this.selectedCalendarIsShared(),this.selectedCalendarIsEditable(),this.isMyEvent()),this.changeCalendarColor(this.selectedCalendar()),this.id(a.ID||null),this.uid(a.Uid||null),this.recurrenceId(a.RecurrenceId||null),this.subject(a.Subject||""),this.location(a.Location||""),this.description(a.Description||""),this.allEvents(a.AllEvents||_b.CalendarEditRecurrenceEvent.AllEvents),this.displayedAlarms(this.getDisplayedAlarms(a.Alarms||[])),this.appointment(a.Appointment),this.attendees(a.Attendees||[]),this.setCurrentAttenderStatus(c,a.Attendees||[]),this.owner(a.Owner||c),this.ownerName(a.OwnerName||d),this.guestAutocomplete(""),this.excluded(a.Excluded||!1),this.repeatRuleParse(a.RRule||null),null===this.id()&&this.subjectFocus(!0),this.selectStartDate(),this.selectEndDate(),this.autosizeTrigger.notifySubscribers(!0),this.modified=!1},G.prototype.popupTemplate=function(){return"Popups_CalendarCreateEventPopupViewModel"},G.prototype.changeCalendarColor=function(a){if(ac.isFunc(this.calendars.getCalendarById)){var b=this.calendars.getCalendarById(a);b&&(this.calendarColor(""),this.calendarColor(b.color()))}},G.prototype.onSaveClick=function(){if(""===this.subject())cc.Screens.showPopup(s,[ac.i18n("CALENDAR/WARNING_EVENT_BLANK_SUBJECT"),_.bind(function(){this.subjectFocus(!0)},this)]);else{if(this.callbackSave){var a=this.repeatPeriod(),b="",c=null,d=0,e=0,f=0,g={calendarId:this.calendarId(),newCalendarId:this.selectedCalendar(),id:this.id(),uid:this.uid(),recurrenceId:this.recurrenceId(),allEvents:this.allEvents(),subject:this.subject(),title:ac.getTitleForEvent(this.subject()),start:this.getDateFromStr(this.startDate(),this.startTime()),end:this.getDateFromStr(this.endDate(),this.endTime()),allDay:this.allDay(),location:this.location(),description:this.description(),alarms:this.getAlarmsArray(this.displayedAlarms()),attendees:this.attendees(),owner:this.owner(),modified:this.modified};a&&(b=this.repeatEndDom().datepicker("getDate"),c=b?this.getUnixTimestamp(b):null,d=this.repeatInterval(),e=this.repeatWeekNum(),f=this.repeatEnd(),a===_b.CalendarRepeatPeriod.Daily?g.rrule={byDays:[],count:null,end:2,interval:1,period:a,until:c,weekNum:null}:a===_b.CalendarRepeatPeriod.Weekly?g.rrule={byDays:this.getDays(),count:null,end:0,interval:d,period:a,until:null,weekNum:null}:a===_b.CalendarRepeatPeriod.Monthly?g.rrule={byDays:[],count:null,end:0,interval:1,period:a,until:null,weekNum:null}:a===_b.CalendarRepeatPeriod.Yearly&&(g.rrule={byDays:[],count:null,end:0,interval:1,period:a,until:null,weekNum:null})),this.callbackSave(g)}this.closePopup()}},G.prototype.closePopup=function(){this.hideAll(),this.cleanAll(),this.closeCommand()},G.prototype.hideAll=function(){this.dateEdit(!1),this.repeatEdit(!1),this.guestsEdit(!1)},G.prototype.cleanAll=function(){this.repeatPeriod(0),this.repeatInterval(1),this.repeatEnd(0),this.repeatCount(null),this.repeatWeekNum(null),this.weekDays(!1),this.weekMO(!1),this.weekTU(!1),this.weekWE(!1),this.weekTH(!1),this.weekFR(!1),this.weekSA(!1),this.weekSU(!1),this.attendees([])},G.prototype.onDeleteClick=function(){if(this.callbackDelete){var a={calendarId:this.selectedCalendar(),id:this.id(),uid:this.uid(),recurrenceId:this.recurrenceId(),allEvents:this.allEvents(),subject:this.subject(),title:ac.getTitleForEvent(this.subject()),start:this.getDateFromStr(this.startDate(),this.startTime()),end:this.getDateFromStr(this.endDate(),this.endTime()),allDay:this.allDay(),location:this.location(),description:this.description()};this.callbackDelete(a)}this.closePopup()},G.prototype.showDates=function(a,b){b.stopPropagation(),this.dateEdit(!this.dateEdit())},G.prototype.showGuests=function(){if(this.attendees().length>0){var a=ac.i18n("CALENDAR/CONFIRM_CLOSE_ATTENDEERS"),b=_.bind(function(a){a&&(this.guestsEdit(!1),this.guestEmailFocus(!1),this.attendees([]))},this);cc.Screens.showPopup(t,[a,b])}else this.guestsEdit(!this.guestsEdit()),this.guestEmailFocus(!this.guestEmailFocus())},G.prototype.onAddGuestClick=function(){var a=this.guestAutocompleteItem(),b=this.guestAutocomplete(),c=a||{name:"",email:b},d=_.any(this.attendees(),function(a){return a.email===c.email});""===c.email?cc.Api.showErrorByCode(0,ac.i18n("CALENDAR/EVENT_ERROR_ENTER_EMAIL")):c.email===this.owner()?this.recivedAnim(!0):d?this.recivedAnim(!0):this.attendees.push({status:0,name:c.name,email:c.email}),this.whomAnimate(c.email),this.guestAutocomplete("")},G.prototype.getDisplayedAlarms=function(a){var b,d,e=[];return _.each(a,function(a){b=this["alarm"+a]=c.observable(a),b.subscribe(function(){this.disableAlarms()},this),d=a>0&&60>a?ac.i18n("CALENDAR/ALARM_MINUTES_PLURAL",{COUNT:a},null,a):a>=60&&1440>a?ac.i18n("CALENDAR/ALARM_HOURS_PLURAL",{COUNT:a/60},null,a/60):a>=1440&&10080>a?ac.i18n("CALENDAR/ALARM_DAYS_PLURAL",{COUNT:a/1440},null,a/1440):ac.i18n("CALENDAR/ALARM_WEEKS_PLURAL",{COUNT:a/10080},null,a/10080),e.push({value:a,alarm:b,text:d,isDisabled:!1})},this),e},G.prototype.getDisplayedPeriods=function(){return[{label:ac.i18n("CALENDAR/EVENT_REPEAT_NEVER"),value:0},{label:ac.i18n("CALENDAR/EVENT_REPEAT_DAILY"),value:1},{label:ac.i18n("CALENDAR/EVENT_REPEAT_WEEKLY"),value:2},{label:ac.i18n("CALENDAR/EVENT_REPEAT_MONTHLY"),value:3},{label:ac.i18n("CALENDAR/EVENT_REPEAT_YEARLY"),value:4}]},G.prototype.getDisplayedIntervals=function(){for(var a=1,b=[];30>=a;a++)b.push({label:a+ac.i18n("th"),value:a});return b},G.prototype.getDisplayedTimes=function(a){var b=[];switch(a){case"HH:mm":b=[{value:"00:00",text:"00:00"},{value:"00:30",text:"00:30"},{value:"01:00",text:"01:00"},{value:"01:30",text:"01:30"},{value:"02:00",text:"02:00"},{value:"02:30",text:"02:30"},{value:"03:00",text:"03:00"},{value:"03:30",text:"03:30"},{value:"04:00",text:"04:00"},{value:"04:30",text:"04:30"},{value:"05:00",text:"05:00"},{value:"05:30",text:"05:30"},{value:"06:00",text:"06:00"},{value:"06:30",text:"06:30"},{value:"07:00",text:"07:00"},{value:"07:30",text:"07:30"},{value:"08:00",text:"08:00"},{value:"08:30",text:"08:30"},{value:"09:00",text:"09:00"},{value:"09:30",text:"09:30"},{value:"10:00",text:"10:00"},{value:"10:30",text:"10:30"},{value:"11:00",text:"11:00"},{value:"11:30",text:"11:30"},{value:"12:00",text:"12:00"},{value:"12:30",text:"12:30"},{value:"13:00",text:"13:00"},{value:"13:30",text:"13:30"},{value:"14:00",text:"14:00"},{value:"14:30",text:"14:30"},{value:"15:00",text:"15:00"},{value:"15:30",text:"15:30"},{value:"16:00",text:"16:00"},{value:"16:30",text:"16:30"},{value:"17:00",text:"17:00"},{value:"17:30",text:"17:30"},{value:"18:00",text:"18:00"},{value:"18:30",text:"18:30"},{value:"19:00",text:"19:00"},{value:"19:30",text:"19:30"},{value:"20:00",text:"20:00"},{value:"20:30",text:"20:30"},{value:"21:00",text:"21:00"},{value:"21:30",text:"21:30"},{value:"22:00",text:"22:00"},{value:"22:30",text:"22:30"},{value:"23:00",text:"23:00"},{value:"23:30",text:"23:30"}];break;case"hh:mm A":b=[{value:"12:00 AM",text:"12:00 AM"},{value:"12:30 AM",text:"12:30 AM"},{value:"01:00 AM",text:"01:00 AM"},{value:"01:30 AM",text:"01:30 AM"},{value:"02:00 AM",text:"02:00 AM"},{value:"02:30 AM",text:"02:30 AM"},{value:"03:00 AM",text:"03:00 AM"},{value:"03:30 AM",text:"03:30 AM"},{value:"04:00 AM",text:"04:00 AM"},{value:"04:30 AM",text:"04:30 AM"},{value:"05:00 AM",text:"05:00 AM"},{value:"05:30 AM",text:"05:30 AM"},{value:"06:00 AM",text:"06:00 AM"},{value:"06:30 AM",text:"06:30 AM"},{value:"07:00 AM",text:"07:00 AM"},{value:"07:30 AM",text:"07:30 AM"},{value:"08:00 AM",text:"08:00 AM"},{value:"08:30 AM",text:"08:30 AM"},{value:"09:00 AM",text:"09:00 AM"},{value:"09:30 AM",text:"09:30 AM"},{value:"10:00 AM",text:"10:00 AM"},{value:"10:30 AM",text:"10:30 AM"},{value:"11:00 AM",text:"11:00 AM"},{value:"11:30 AM",text:"11:30 AM"},{value:"12:00 PM",text:"12:00 PM"},{value:"12:30 PM",text:"12:30 PM"},{value:"01:00 PM",text:"01:00 PM"},{value:"01:30 PM",text:"01:30 PM"},{value:"02:00 PM",text:"02:00 PM"},{value:"02:30 PM",text:"02:30 PM"},{value:"03:00 PM",text:"03:00 PM"},{value:"03:30 PM",text:"03:30 PM"},{value:"04:00 PM",text:"04:00 PM"},{value:"04:30 PM",text:"04:30 PM"},{value:"05:00 PM",text:"05:00 PM"},{value:"05:30 PM",text:"05:30 PM"},{value:"06:00 PM",text:"06:00 PM"},{value:"06:30 PM",text:"06:30 PM"},{value:"07:00 PM",text:"07:00 PM"},{value:"07:30 PM",text:"07:30 PM"},{value:"08:00 PM",text:"08:00 PM"},{value:"08:30 PM",text:"08:30 PM"},{value:"09:00 PM",text:"09:00 PM"},{value:"09:30 PM",text:"09:30 PM"},{value:"10:00 PM",text:"10:00 PM"},{value:"10:30 PM",text:"10:30 PM"},{value:"11:00 PM",text:"11:00 PM"},{value:"11:30 PM",text:"11:30 PM"}]}return b},G.prototype.getAlarmsArray=function(a){var b=[];return _.each(a,function(a){b.push(a.alarm())},this),_.sortBy(b,function(a){return-a})},G.prototype.addFirstAlarm=function(){if(this.displayedAlarms().length){var a=ac.i18n("CALENDAR/CONFIRM_CLOSE_ALARMS"),b=_.bind(function(a){a&&this.displayedAlarms.removeAll()},this);cc.Screens.showPopup(t,[a,b])}else this.displayedAlarms(this.getDisplayedAlarms([this.alarmOptions()[0].value]))},G.prototype.addAlarm=function(){var a,b,d=0;b=_.sortBy(this.displayedAlarms(),function(a){return a.alarm()}),_.each(b,function(a){var b=a.alarm();5!==b&&5>=d?d=5:10!==b&&10>=d?d=10:15!==b&&15>=d?d=15:30!==b&&30>=d?d=30:1440!==b&&1440>=d&&(d=1440)}),a=this.getDisplayedAlarms([d])[0],this["alarm"+d]=c.observable(d),this.displayedAlarms.push(a)},G.prototype.removeAlarm=function(a){this.displayedAlarms.remove(a)},G.prototype.removeGuest=function(a){this.attendees.remove(a)},G.prototype.disableAlarms=function(){_.each(this.alarmOptions(),function(a){a.isDisabled=_.any(this.displayedAlarms(),function(b){return b.alarm()===a.value})},this),this.alarmOptions.valueHasMutated()},G.prototype.autocompleteCallback=function(a,b){var c={Action:"ContactSuggestions",Search:a,GlobalOnly:"0"};this.guestAutocompleteItem(null),a=ac.trim(a),""!==a?cc.Ajax.send(c,function(a){var c=[];a&&a.Result&&a.Result&&a.Result.List&&(c=_.map(a.Result.List,function(a){return a&&a.Email&&a.Email!==this.owner()?a.Name&&0<ac.trim(a.Name).length?{value:'"'+a.Name+'" <'+a.Email+">",name:a.Name,email:a.Email}:{value:a.Email,name:"",email:a.Email}:null},this),c=_.compact(c)),b(c)},this):b([])},G.prototype.repeatRuleParse=function(a){var b=this.allEvents();this.repeatEndDom().datepicker("option","minDate",this.datepickerGetDate(this.endDom())),a&&b===_b.CalendarEditRecurrenceEvent.AllEvents&&(this.repeatPeriod(a.period),this.repeatInterval(a.interval),this.repeatEnd(a.end),this.repeatCount(a.count),this.repeatWeekNum(a.weekNum),a.until&&this.datepickerSetDate(this.repeatEndDom(),new Date(1e3*a.until)),a.byDays.length&&(this.weekDays(!0),_.each(a.byDays,function(a){this["week"+a](!0)},this)))},G.prototype.getDays=function(){var a=[];return this.weekMO()&&a.push("MO"),this.weekTU()&&a.push("TU"),this.weekWE()&&a.push("WE"),this.weekTH()&&a.push("TH"),this.weekFR()&&a.push("FR"),this.weekSA()&&a.push("SA"),this.weekSU()&&a.push("SU"),a},G.prototype.onMainPanelClick=function(){this.dateEdit()&&this.dateEdit(!1)},G.prototype.onKeydown=function(a,b){b.keyCode===_b.Key.Enter&&b.preventDefault()},G.prototype.onKeyup=function(a,b){"event_subject"!==b.target.id&&"event_location"!==b.target.id||b.keyCode!==_b.Key.Enter||this.onSaveClick()},G.prototype.onPaste=function(a,b,c){var d=c().replace(/[\r\n\t]+/gm," ");c(d)},G.prototype.selectStartDate=function(){if(this.startDate()&&this.endDate()){var a=this.dateFormatMoment,b=this.timeFormatMoment,c=this.datepickerGetDate(this.startDom()),d=moment(this.getDateFromStr(moment(c).format(a),this.startTime())).toDate(),e=this.datepickerGetDate(this.endDom()),f=moment(this.getDateFromStr(moment(e).format(a),this.endTime())).toDate(),g=this.getUnixTimestamp(d),h=this.getUnixTimestamp(f),i=moment(d),j=moment(f),k=i.format(a),l=i.format(b),m=j.format(a),n=j.format(b);this.isEvOneDay(k===m),this.isEvOneTime(l===n),g>h&&(this.datepickerSetDate(this.endDom(),d),this.endDate(k),this.endTime(l),this.isEvOneDay(!0),this.isEvOneTime(!0)),this.startDate(k),this.startTime(l),this.yearlyDate(i.format(this.getPartOfDate(this.dateFormatMoment.slice(0,-5)))),this.monthlyDate(i.format(this.getPartOfDate(this.dateFormatMoment.slice(0,2))))}},G.prototype.selectEndDate=function(){if(this.endDate()&&this.startDate()){var a=this.dateFormatMoment,b=this.timeFormatMoment,c=this.datepickerGetDate(this.endDom()),d=moment(this.getDateFromStr(moment(c).format(a),this.endTime())).toDate(),e=this.datepickerGetDate(this.startDom()),f=moment(this.getDateFromStr(moment(e).format(a),this.startTime())).toDate(),g=this.getUnixTimestamp(d),h=this.getUnixTimestamp(f),i=moment(d),j=moment(f),k=i.format(a),l=i.format(b),m=j.format(a),n=j.format(b);this.isEvOneDay(k===m),this.isEvOneTime(l===n),h>g&&(this.datepickerSetDate(this.startDom(),d),this.startDate(k),this.startTime(l),this.isEvOneDay(!0),this.isEvOneTime(!0)),this.endDate(k),this.endTime(l),this.repeatEndDom().datepicker("option","minDate",d),this.isRepeat()||this.datepickerSetDate(this.repeatEndDom(),i.add("days",7).toDate())}},G.prototype.getUnixTimestamp=function(a){return Number(moment(a).format("X"))},G.prototype.datepickerGetDate=function(a){return a.datepicker("getDate")},G.prototype.datepickerSetDate=function(a,b){a.datepicker("setDate",b)},G.prototype.getDateFromStr=function(a,b){return moment(a+" "+b,this.dateFormatMoment+" "+this.timeFormatMoment).toDate()},G.prototype.getPartOfDate=function(a){var b="MM/DD";switch(a){case"MM/DD":b="MM/DD";break;case"DD/MM":b="DD/MM";break;case"DD MMMM":b="DD MMMM";break;case"DD":b="DD"}return b},G.prototype.setActualTime=function(){var a=moment();a.minutes()>30?a.minutes(60):a.minutes(30),a.seconds(0),a.milliseconds(0),this.startTime(a.format(this.timeFormatMoment)),this.endTime(a.add("minutes",30).format(this.timeFormatMoment))},G.prototype.onProcessAppointmentResponse=function(a){a.Result||cc.Api.showErrorByCode(0,ac.i18n("WARNING/UNKNOWN_ERROR"))},G.prototype.doProcessAppointment=function(a){var b={Action:"EventUpdateAppointment",actionAppointment:a,calendarId:this.selectedCalendar(),uid:this.uid},c=this.attendees(),d=this.defaultAccount?this.defaultAccount.email():"",e=_.find(this.attendees(),function(a){return a.email===d},this),f=this.calendars.getCalendarById(this.selectedCalendar());e&&(cc.Ajax.send(b,this.onProcessAppointmentResponse,this),e.status=a,this.attendees([]),this.attendees(c),this.setCurrentAttenderStatus(e.email,this.attendees()),a===_b.IcalConfigInt.Declined&&f&&this.callbackAttendeeActionDecline&&ac.isFunc(this.callbackAttendeeActionDecline)&&(this.callbackAttendeeActionDecline(f,this.id()),this.closePopup()))
},G.prototype.editableSwitch=function(a,b,c){this.isEditable(a&&b&&c||!a&&b&&c||a&&b&&!c),this.isEditableReminders(b)},G.prototype.setCurrentAttenderStatus=function(a,b){var c=_.find(b,function(b){return b.email===a});this.attenderStatus(c?c.status:0)},G.prototype.getAttenderTextStatus=function(a){switch(a){case 0:a="pending";break;case 1:a="accepted";break;case 2:a="declined";break;case 3:a="tentative"}return a},H.prototype.onShow=function(a){ac.isFunc(a)&&(this.fCallback=a)},H.prototype.popupTemplate=function(){return"Popups_CalendarEditRecurrenceEventPopupViewModel"},H.prototype.onlyThisInstanceButtonClick=function(){this.fCallback&&this.fCallback(_b.CalendarEditRecurrenceEvent.OnlyThisInstance),this.closeCommand()},H.prototype.allEventsButtonClick=function(){this.fCallback&&this.fCallback(_b.CalendarEditRecurrenceEvent.AllEvents),this.closeCommand()},H.prototype.cancelButtonClick=function(){this.fCallback&&this.fCallback(_b.CalendarEditRecurrenceEvent.None),this.closeCommand()},I.prototype.popupTemplate=function(){return"Popups_PhonePopupViewModel"},I.prototype.onShow=function(a){this.action(a.Action||""),this.phoneNumber(a.PhoneNumber||""),this.callback=a.Callback||null},I.prototype.onCancelClick=function(){this.phone.hidePopup()},I.prototype.onOKClick=function(){this.phone.hidePopup(),this.callback&&this.callback()},I.prototype.answer=function(){this.phone.answer()},I.prototype.hangup=function(){this.phone.hangup()},J.prototype.parse=function(a){this.AllowUsersChangeInterfaceSettings=!!a.AllowUsersChangeInterfaceSettings,this.AllowUsersChangeEmailSettings=!!a.AllowUsersChangeEmailSettings,this.AllowUsersAddNewAccounts=ac.isUnd(a.AllowUsersAddNewAccounts)?this.AllowUsersChangeEmailSettings:!!a.AllowUsersAddNewAccounts,this.SiteName=ac.pString(a.SiteName),this.Languages=a.Languages,this.Themes=a.Themes,this.DateFormats=a.DateFormats,this.AttachmentSizeLimit=ac.pInt(a.AttachmentSizeLimit),this.ImageUploadSizeLimit=ac.pInt(a.ImageUploadSizeLimit),this.FileSizeLimit=ac.pInt(a.FileSizeLimit),this.AutoSave=!!a.AutoSave,this.IdleSessionTimeout=ac.pInt(a.IdleSessionTimeout),this.AllowInsertImage=!!a.AllowInsertImage,this.AllowBodySize=!!a.AllowBodySize,this.MaxBodySize=ac.pInt(a.MaxBodySize),this.MaxSubjectSize=ac.pInt(a.MaxSubjectSize),this.AllowPrefetch=!!a.AllowPrefetch,this.AllowFetcher=!!a.AllowFetcher,this.LoginFormType=ac.pInt(a.LoginFormType),this.LoginSignMeType=ac.pInt(a.LoginSignMeType),this.LoginAtDomainValue=ac.pString(a.LoginAtDomainValue),this.DemoWebMail=!!a.DemoWebMail,this.DemoWebMailLogin=ac.pString(a.DemoWebMailLogin),this.DemoWebMailPassword=ac.pString(a.DemoWebMailPassword),this.GoogleAnalyticsAccount=a.GoogleAnalyticsAccount,this.ShowQuotaBar=!!a.ShowQuotaBar,this.ServerUseUrlRewrite=!!a.ServerUseUrlRewrite,this.AllowLanguageOnLogin=!!a.AllowLanguageOnLogin,this.FlagsLangSelect=!!a.FlagsLangSelect,this.DefaultLanguage=ac.pString(a.DefaultLanguage),this.LoginDescription=ac.pString(a.LoginDescription),this.CustomLoginUrl=ac.pString(a.CustomLoginUrl),this.CustomLogoutUrl=ac.pString(a.CustomLogoutUrl),this.IosDetectOnLogin=a.IosDetectOnLogin,""!==a.DefaultLanguageShort&&(this.DefaultLanguageShort=a.DefaultLanguageShort)},K.prototype.getSaveMailInSentItems=function(){var a=!0;switch(this.SaveMail){case _b.SaveMail.Unchecked:a=!1;break;case _b.SaveMail.Checked:case _b.SaveMail.Hidden:a=!0}return a},K.prototype.getUseSaveMailInSentItems=function(){var a=!1;switch(this.SaveMail){case _b.SaveMail.Unchecked:case _b.SaveMail.Checked:a=!0;break;case _b.SaveMail.Hidden:a=!1}return a},K.prototype.parse=function(a){var b=null;null!==a&&(this.IdUser=ac.pInt(a.IdUser),this.MailsPerPage=ac.pInt(a.MailsPerPage),this.ContactsPerPage=ac.pInt(a.ContactsPerPage),this.AutoCheckMailInterval=ac.pInt(a.AutoCheckMailInterval),this.DefaultEditor=ac.pInt(a.DefaultEditor),this.Layout=ac.pInt(a.Layout),this.DefaultTheme=ac.pString(a.DefaultTheme),this.DefaultLanguage=ac.pString(a.DefaultLanguage),this.DefaultDateFormat=ac.pString(a.DefaultDateFormat),this.defaultTimeFormat(ac.pInt(a.DefaultTimeFormat)),this.ThreadsEnabled=!!a.ThreadsEnabled,this.useThreads(!!a.UseThreads),this.SaveRepliedToCurrFolder=!!a.SaveRepliedMessagesToCurrentFolder,this.AllowCompose=!!a.AllowCompose,this.AllowReply=!!a.AllowReply,this.AllowForward=!!a.AllowForward,this.SaveMail=ac.pInt(a.SaveMail),this.OutlookSyncEnable=!!a.OutlookSyncEnable,this.MobileSyncEnable=!!a.MobileSyncEnable,this.ShowPersonalContacts=!!a.ShowPersonalContacts,this.ShowGlobalContacts=!!a.ShowGlobalContacts,this.ShowContacts=this.ShowPersonalContacts||this.ShowGlobalContacts,this.IsFilesSupported=!!a.IsFilesSupported,this.IsHelpdeskSupported=!!a.IsHelpdeskSupported,this.IsHelpdeskAgent=!!a.IsHelpdeskAgent,this.LastLogin=ac.pInt(a.LastLogin),this.AllowCalendar=!!a.AllowCalendar,this.CalendarSharing=!!a.CalendarSharing,this.CalendarAppointments=!!a.CalendarAppointments,this.IsDemo=!!a.IsDemo,this.AllowVoice=!!a.AllowVoice,this.VoiceRealm=a.VoiceRealm,this.VoiceWebsocketProxyUrl=a.VoiceWebsocketProxyUrl,this.VoiceOutboundProxyUrl=a.VoiceOutboundProxyUrl,this.VoiceCallerID=a.VoiceCallerID,this.VoiceImpi=a.VoiceImpi,this.VoiceImpu=a.VoiceImpu,this.VoicePassword=a.VoicePassword,this.VoiceProvider=a.VoiceRealm,this.AllowHelpdeskNotifications=a.AllowHelpdeskNotifications,b=a.Calendar,b&&(this.CalendarShowWeekEnds=!!b.ShowWeekEnds,this.CalendarShowWorkDay=!!b.ShowWorkDay,this.CalendarWorkDayStarts=ac.pInt(b.WorkDayStarts),this.CalendarWorkDayEnds=ac.pInt(b.WorkDayEnds),this.CalendarWeekStartsOn=ac.pInt(b.WeekStartsOn),this.CalendarDefaultTab=ac.pInt(b.DefaultTab)))},K.prototype.updateCommonSettings=function(a,b,c,d,e,f,g,h,i,j,k){(this.DefaultTheme!==f||this.DefaultLanguage!==g||this.DefaultDateFormat!==h||this.defaultTimeFormat()!==i)&&this.needToReloadCalendar(!0),this.MailsPerPage=a,this.ContactsPerPage=b,this.AutoCheckMailInterval=c,cc.MailCache.setAutocheckmailTimer(),this.DefaultEditor=d,this.Layout=e,this.DefaultTheme=f,this.DefaultLanguage=g,this.DefaultDateFormat=h,this.defaultTimeFormat(i),this.useThreads("1"===j),this.SaveRepliedToCurrFolder="1"===k},K.prototype.updateCalendarSettings=function(a,b,c,d,e,f){(this.CalendarShowWeekEnds!==a||this.CalendarShowWorkDay!==b||this.CalendarWorkDayStarts!==c||this.CalendarWorkDayEnds!==d||this.CalendarWeekStartsOn!==e||this.CalendarDefaultTab!==f)&&this.needToReloadCalendar(!0),this.CalendarShowWeekEnds=a,this.CalendarShowWorkDay=b,this.CalendarWorkDayStarts=c,this.CalendarWorkDayEnds=d,this.CalendarWeekStartsOn=e,this.CalendarDefaultTab=f},K.prototype.updateHelpdeskSettings=function(a){this.AllowHelpdeskNotifications=a},K.prototype.isNeedToReloadCalendar=function(){var a=this.needToReloadCalendar();return this.needToReloadCalendar(!1),a},K.prototype.onSyncSettingsResponse=function(a){a.Result?(this.mobileSync(a.Result.Mobile),this.outlookSync(a.Result.Outlook)):cc.Api.showErrorByCode(a.ErrorCode)},K.prototype.requestSyncSettings=function(){(null===this.mobileSync()||null===this.outlookSync())&&cc.Ajax.send({Action:"SyncSettings"},this.onSyncSettingsResponse,this)},L.prototype.init=function(a,b,c){this.id(a),this.email(b),this.friendlyName(c)},L.prototype.onQuotaParamsResponse=function(a){a&&a.Result&&_.isArray(a.Result)&&2===a.Result.length&&(this.quota(ac.pInt(a.Result[1])),this.usedSpace(ac.pInt(a.Result[0])),cc.MailCache.quotaChangeTrigger(!cc.MailCache.quotaChangeTrigger()))},L.prototype.updateQuotaParams=function(){var a={Action:"Quota",AccountID:this.id()};ec.App&&ec.App.ShowQuotaBar&&cc.Ajax.send(a,this.onQuotaParamsResponse,this)},L.prototype.parse=function(a,b){var c=new hb;this.init(parseInt(a.AccountID,10),ac.pString(a.Email),ac.pString(a.FriendlyName)),c.parse(this.id(),a.Signature),this.signature(c),this.isCurrent(b===this.id()),this.isEdited(b===this.id())},L.prototype.requestExtensions=function(){if(!this.extensionsRequested()&&cc.Ajax){var a=b.jstz?b.jstz.determine():null;cc.Ajax.send({AccountID:this.id(),Action:"IsAuth",ClientTimeZone:a?a.name():""},this.onIsAuthResponse,this)}},L.prototype.onIsAuthResponse=function(a){var b=!!a.Result,c=b?a.Result.Extensions:[];b&&(this.setExtensions(c),this.extensionsRequested(!0))},L.prototype.setExtensions=function(a){_.isArray(a)&&this.extensions(a)},L.prototype.extensionExists=function(a){return-1===_.indexOf(this.extensions(),a)?!1:!0},L.prototype.updateExtended=function(a){a&&(this.isExtended(!0),a.FriendlyName&&this.friendlyName(a.FriendlyName),a.IncomingMailLogin&&this.incomingMailLogin(a.IncomingMailLogin),a.IncomingMailPort&&this.incomingMailPort(a.IncomingMailPort),a.IncomingMailServer&&this.incomingMailServer(a.IncomingMailServer),a.IsInternal&&this.isInternal(a.IsInternal),a.IsLinked&&this.isLinked(a.IsLinked),a.IsDefault&&this.isDefault(a.IsDefault),a.OutgoingMailAuth&&this.outgoingMailAuth(a.OutgoingMailAuth),a.OutgoingMailLogin&&this.outgoingMailLogin(a.OutgoingMailLogin),a.OutgoingMailPort&&this.outgoingMailPort(a.OutgoingMailPort),a.OutgoingMailServer&&this.outgoingMailServer(a.OutgoingMailServer),this.setExtensions(a.Extensions))},L.prototype.changeAccount=function(){ec.Accounts.changeCurrentAccount(this.id())},L.prototype.getFetcherOrIdentityByEmail=function(a){var b=this.fetchers()?this.fetchers().collection():[],c=null;return c=_.find(b,function(b){return b.email()===a}),c||(c=_.find(this.identities()||[],function(b){return b.email()===a})),c},M.prototype.changeCurrentAccount=function(a){var b=this.getCurrent(),c=this.getAccount(a);c&&this.currentId()!==a&&(b.isCurrent(!1),this.currentId(a),c.isCurrent(!0),cc.Routing.setHash(cc.Links.inbox()))},M.prototype.changeEditedAccount=function(a){var b=this.getEdited(),c=this.getAccount(a);c&&this.editedId()!==a&&(b.isEdited(!1),this.editedId(a),c.isEdited(!0))},M.prototype.parse=function(a,b){var c=null,d=!1;_.isArray(b)&&this.collection(_.map(b,function(b){var c=new L;return c.parse(b,a),c.id()===a&&(d=!0),c})),!d&&this.collection.length>0&&(c=this.collection()[0],a=c.id(),d=!0),d&&(this.defaultId(a),this.currentId(a),this.editedId(a))},M.prototype.getAccount=function(a){var b=_.find(this.collection(),function(b){return b.id()===a},this);return b},M.prototype.getCurrent=function(){var a=_.find(this.collection(),function(a){return a.id()===this.currentId()},this);return a},M.prototype.getDefault=function(){var a=_.find(this.collection(),function(a){return a.id()===this.defaultId()},this);return a},M.prototype.getEmail=function(){var a="",b=ec.Accounts.getCurrent();return b&&(a=b.email()),a},M.prototype.getEdited=function(){var a=_.find(this.collection(),function(a){return a.id()===this.editedId()},this);return a},M.prototype.addAccount=function(a){this.collection.push(a)},M.prototype.deleteAccount=function(a){this.currentId()===a&&this.changeCurrentAccount(this.defaultId()),this.editedId()===a&&this.changeEditedAccount(this.defaultId()),this.collection.remove(function(b){return b.id()===a})},M.prototype.hasAccountWithId=function(a){var b=_.find(this.collection(),function(b){return b.id()===a},this);return!!b},M.prototype.doFirstRequests=function(){this.populateFetchers(),this.populateIdentities()},M.prototype.populateFetchers=function(){ec.App.AllowFetcher&&cc.Ajax.send({Action:"FetcherList",AccountID:ec.Accounts.defaultId()},this.onFetcherListResponse,this)},M.prototype.onFetcherListResponse=function(a){var b=null,c=this.getDefault();ac.isNonEmptyArray(a.Result)&&(b=new kb,b.parse(ec.Accounts.defaultId(),a.Result)),c.fetchers(b)},M.prototype.populateIdentities=function(){ec.AllowIdentities&&cc.Ajax.send({Action:"GetIdentities"},this.onIdentitiesResponse,this)},M.prototype.onIdentitiesResponse=function(a){var b={};ac.isNonEmptyArray(a.Result)&&_.each(a.Result,function(a){var c=new Q,d=-1;c.parse(a),d=c.accountId(),b[d]||(b[d]=[]),b[d].push(c)}),_.each(this.collection(),function(a){var c=b[a.id()];ac.isNonEmptyArray(c)||(c=[]),a.identities(c)})},N.prototype.parse=function(a){null!==a&&(this.sName=ac.pString(a.DisplayName),"string"!=typeof this.sName&&(this.sName=""),this.sEmail=ac.pString(a.Email),"string"!=typeof this.sEmail&&(this.sEmail=""))},N.prototype.getEmail=function(){return this.sEmail},N.prototype.getName=function(){return this.sName},N.prototype.getDisplay=function(){return this.sName.length>0?this.sName:this.sEmail},N.prototype.getFull=function(){var a="";return a=this.sEmail.length>0?this.sName.length>0?'"'+this.sName+'" <'+this.sEmail+">":this.sEmail:this.sName},O.prototype.parse=function(a){this.aCollection=_.map(a,function(a){var b=new N;return b.parse(a),b})},O.prototype.addCollection=function(a){_.each(a,function(a){var b=_.find(this.aCollection,function(b){return a.sEmail===b.sEmail});b||this.aCollection.push(a)},this)},O.prototype.excludeCollection=function(a){_.each(a,function(a){this.aCollection=_.filter(this.aCollection,function(b){return a.sEmail!==b.sEmail})},this)},O.prototype.getFirstEmail=function(){return this.aCollection.length>0?this.aCollection[0].getEmail():""},O.prototype.getFirstName=function(){return this.aCollection.length>0?this.aCollection[0].getName():""},O.prototype.getDisplay=function(a,b){var c=_.map(this.aCollection,function(c){return a&&b===c.sEmail?a:c.getDisplay(a)});return c.join(", ")},O.prototype.getFull=function(){var a=_.map(this.aCollection,function(a){return a.getFull()});return a.join(", ")},P.prototype.parse=function(a){this.oMoment=moment.unix(a)},P.prototype.setDate=function(a,b,c){this.oMoment=moment([a,b,c])},P.prototype.getTimeFormat=function(){return ec.User.defaultTimeFormat()===_b.TimeFormat.F24?"HH:mm":"hh:mm A"},P.prototype.getFullDate=function(){return this.oMoment?this.oMoment.format("ddd, MMM D, YYYY, "+this.getTimeFormat()):""},P.prototype.getMidDate=function(){return this.getShortDate(!0)},P.prototype.getShortDate=function(a){var b="",c=null;return this.oMoment&&(c=moment(),c.format("L")===this.oMoment.format("L")?b=this.oMoment.format(this.getTimeFormat()):(b=c.clone().subtract("days",1).format("L")===this.oMoment.format("L")?ac.i18n("DATETIME/YESTERDAY"):c.year()===this.oMoment.year()?this.oMoment.format("MMM D"):this.oMoment.format("MMM D, YYYY"),(ac.isUnd(a)?1:!a)||(b+=", "+this.oMoment.format(this.getTimeFormat())))),b},P.prototype.getDate=function(){return this.oMoment?this.oMoment.format("ddd, MMM D, YYYY"):""},P.prototype.getTime=function(){return this.oMoment?this.oMoment.format(this.getTimeFormat()):""},P.prototype.convertDate=function(a){var b=ac.getDateFormatForMoment(ec.User.DefaultDateFormat)+" "+this.getTimeFormat();return moment(1e3*a).format(b)},Q.prototype.parse=function(a){"Object/CIdentity"===a["@Object"]&&(this.enabled(!!a.Enabled),this.email(ac.pString(a.Email)),this.friendlyName(ac.pString(a.FriendlyName)),this.accountId(ac.pInt(a.IdAccount)),this.id(ac.pInt(a.IdIdentity)),this.signature(ac.pString(a.Signature)),this.useSignature(!!a.UseSignature))},R.prototype.dataObjectName="",R.prototype.isVisibleViewLink=function(){return this.uploaded()&&!this.uploadError()&&this.isViewMimeType()},R.prototype.parse=function(a,b){a["@Object"]===this.dataObjectName&&(this.fileName(ac.pString(a.FileName)),this.tempName(ac.pString(a.TempName)),""===this.tempName()&&this.tempName(this.fileName()),this.type(ac.pString(a.MimeType)),this.size(a.EstimatedSize?parseInt(a.EstimatedSize,10):parseInt(a.SizeInBytes,10)),this.thumb(!!a.Thumb),this.hash(ac.pString(a.Hash)),this.accountId(b),this.visibleExpandLink(!!a.Expand),this.uploadUid(this.hash()),this.uploaded(!0),ac.isFunc(this.additionalParse)&&this.additionalParse(a))},R.prototype.downloadFile=function(a){a&&a.downloadByUrl||(a=cc),a&&this.downloadLink().length>0&&"#"!==this.downloadLink()&&a.downloadByUrl(this.downloadLink())},R.prototype.expandFile=function(){cc.Ajax.send({Action:"ExpandAttachment",RawKey:this.hash()})},R.prototype.viewFile=function(){this.viewCommonFile()},R.prototype.viewCommonFile=function(){var a=null,b=ac.getAppPath()+this.viewLink();this.visibleViewLink()&&this.viewLink().length>0&&"#"!==this.viewLink()&&(b=ac.getAppPath()+this.viewLink(),a=ac.WindowOpener.open(b,b,!1),a&&a.focus())},R.prototype.eventDragStart=function(a,b){var c=b.originalEvent||b;return a&&c&&c.dataTransfer&&c.dataTransfer.setData&&c.dataTransfer.setData("DownloadURL",this.generateTransferDownloadUrl()),!0},R.prototype.generateTransferDownloadUrl=function(){var a=this.downloadLink();return"http"!==a.substr(0,4)&&(a=b.location.protocol+"//"+b.location.host+b.location.pathname+a),this.type()+":"+this.fileName()+":"+a},R.prototype.onUploadSelect=function(a,b){this.fileName(b.FileName),this.type(b.Type),this.size(ac.pInt(b.Size)),this.uploadUid(a),this.uploaded(!1),this.visibleSpinner(!1),this.statusText(""),this.progressPercent(0),this.visibleProgress(!1)},R.prototype.onUploadStart=function(){this.visibleSpinner(!0),this.visibleProgress(!0)},R.prototype.onUploadProgress=function(a,b){b>0&&(this.progressPercent(Math.ceil(a/b*100)),this.visibleProgress(!0))},R.prototype.onUploadComplete=function(a,b,c){var d=!b||!c||c.Error||!1,e=c&&"size"===c.Error?ac.i18n("COMPOSE/UPLOAD_ERROR_SIZE"):ac.i18n("COMPOSE/UPLOAD_ERROR_UNKNOWN");this.visibleSpinner(!1),this.progressPercent(0),this.visibleProgress(!1),this.uploaded(!0),this.uploadError(d),this.statusText(d?e:ac.i18n("COMPOSE/UPLOAD_COMPLETE")),d||(this.fillDataAfterUploadComplete(c,a),setTimeout(function(a){return function(){a.statusText("")}}(this),3e3))},R.prototype.fillDataAfterUploadComplete=function(){},ac.extend(S,R),S.prototype.isVisibleViewLink=function(){return this.uploaded()&&!this.uploadError()&&(this.isViewMimeType()||this.isMessageType())},S.prototype.dataObjectName="Object/CApiMailAttachment",S.prototype.additionalParse=function(a){this.mimePartIndex(ac.pString(a.MimePartIndex)),this.cid(ac.pString(a.CID)),this.inline(!!a.IsInline),this.linked(!!a.IsLinked)},S.prototype.setMessageData=function(a,b){this.folderName(a),this.messageUid(b)},S.prototype.onMessageResponse=function(a){var b=a.Result,c=new V;b&&this.oNewWindow&&(c.parse(b,a.AccountID,!1,!0),this.messagePart(c),this.messagePart().viewMessage(this.oNewWindow),this.oNewWindow=void 0)},S.prototype.viewFile=function(){this.isMessageType()?this.viewMessageFile():this.viewCommonFile()},S.prototype.viewMessageFile=function(){var b=null,c='<div style="margin: 30px; text-align: center; font: normal 14px Tahoma;">'+ac.i18n("MAIN/LOADING")+"</div>";b=ac.WindowOpener.open("",this.fileName()),b&&(this.messagePart()?this.messagePart().viewMessage(b):(a(b.document.body).html(c),this.oNewWindow=b,cc.Ajax.send({Action:"Message",Folder:this.folderName(),Uid:this.messageUid(),Rfc822MimeIndex:this.mimePartIndex()},this.onMessageResponse,this)),b.focus())},S.prototype.viewCommonFile=function(){var a=null,b=ac.getAppPath()+this.viewLink();this.visibleViewLink()&&this.viewLink().length>0&&"#"!==this.viewLink()&&(b=ac.getAppPath()+this.viewLink(),a=ac.WindowOpener.open(b,b,!1),a&&a.focus())},S.prototype.fillDataAfterUploadComplete=function(a,b){this.cid(b),this.tempName(a.Result.Attachment.TempName),this.type(a.Result.Attachment.MimeType),this.size(a.Result.Attachment.Size),this.hash(a.Result.Attachment.Hash),this.accountId(a.AccountID)},S.prototype.parseFromContact=function(a,b){this.fileName(a.Name.toString()),this.tempName(a.TempName?a.TempName.toString():this.fileName()),this.type(a.MimeType.toString()),this.size(parseInt(a.Size,10)),this.hash(a.Hash),this.accountId(b),this.uploadUid(this.hash()),this.uploaded(!0),this.uploadStarted(!1)},S.prototype.errorFromContact=function(){this.uploaded(!0),this.uploadError(!0),this.uploadStarted(!1),this.statusText(ac.i18n("COMPOSE/UPLOAD_ERROR_UNKNOWN"))},T.prototype.hideThreadMessages=function(a){_.each(a.threadUids(),function(a){var b=this.oMessages[a];b&&(b.deleted()||(b.threadShowAnimation(!1),b.threadHideAnimation(!0),setTimeout(function(){b.threadHideAnimation(!1)},1e3)))},this)},T.prototype.getThreadMessages=function(a){var b=[],c=[],d=[],e=0,f=null,g=50;return _.each(a.threadUids(),function(h){if(e<a.threadCountForLoad()){var i=this.oMessages[h];i?i.deleted()||(i.markAsThreadPart(g),b.push(i),d.push(i.uid()),e++,f=i):(c.push(h),d.push(h),e++)}else d.push(h)},this),a.threadLoading()||this.loadThreadMessages(c),a.changeThreadUids(d,b.length),f&&b.length<a.threadUids().length&&f.showNextLoadingLink(_.bind(a.increaseThreadCountForLoad,a)),this.addThreadUidsToUidLists(a.uid(),a.threadUids()),b},T.prototype.computeUnreadThreadCount=function(a){var b=0;_.each(a.threadUids(),function(a){var c=this.oMessages[a];!c||c.deleted()||c.seen()||b++},this),a.threadUnreedCount(b)},T.prototype.addThreadUidsToUidLists=function(a,b){_.each(this.oUids,function(c){_.each(c,function(c){c.addThreadUids(a,b)})})},T.prototype.loadThreadMessages=function(a){if(a.length>0){var b={Action:"MessageListByUids",Folder:this.fullName(),Uids:a};cc.Ajax.send(b,this.onMessageListByUidsResponse,this)}},T.prototype.getUidsWithThread=function(a){var b=[];return _.each(a,function(a){var c=this.oMessages[a];c&&!c.threadOpened()&&(b=_.union(b,c.threadUids()))},this),_.union(a,b)},T.prototype.parseAndCacheMessage=function(a,b,c){var d=a.Uid.toString(),e=this.oMessages[d]?this.oMessages[d]:new V,f=e.threadPart()||b;return e.parse(a,this.iAccountId,f,c),this.oMessages[e.uid()]=e,e},T.prototype.onMessageListByUidsResponse=function(a){var b=a.Result;b&&"Collection/MessageCollection"===b["@Object"]&&(_.each(b["@Collection"],function(a){this.parseAndCacheMessage(a,!0,!0)},this),cc.MailCache.showOpenedThreads(this.fullName()))},T.prototype.addRequestedUids=function(a){this.aRequestedUids=_.union(this.aRequestedUids,a)},T.prototype.hasUidBeenRequested=function(a){return-1!==_.indexOf(this.aRequestedUids,a)},T.prototype.addRequestedThreadUids=function(a){this.aRequestedThreadUids=_.union(this.aRequestedThreadUids,a)},T.prototype.hasThreadUidBeenRequested=function(a){return-1!==_.indexOf(this.aRequestedThreadUids,a)},T.prototype.hasListBeenRequested=function(a){var b=_.where(this.requestedLists,a),c=b.length>0;return c||this.requestedLists.push(a),c},T.prototype.markMessageReplied=function(a,b){var c=this.oMessages[a];if(c)switch(b){case _b.ReplyType.Reply:case _b.ReplyType.ReplyAll:c.answered(!0);break;case _b.ReplyType.Forward:c.forwarded(!0)}},T.prototype.removeAllMessages=function(){var a=null;this.oMessages={},this.oUids={},this.messageCount(0),this.unseenMessageCount(0),this.realUnseenMessageCount(0),a=this.getUidList("",""),a.resultCount(0)},T.prototype.removeAllMessageListsFromCacheIfHasChanges=function(){this.hasChanges()&&(this.oUids={},this.requestedLists=[],this.aRequestedThreadUids=[],this.hasChanges(!1))},T.prototype.removeFlaggedMessageListsFromCache=function(){_.each(this.oUids,function(a,b){delete this.oUids[b][_b.FolderFilter.Flagged]},this)},T.prototype.setRelevantInformation=function(a,b,c,d,e){var f=this.hasExtendedInfo()&&(this.hash()!==b||this.realUnseenMessageCount()!==d);return this.uidNext(a),this.hash(b),this.hasExtendedInfo()&&e||(this.messageCount(c),this.unseenMessageCount(d),0===d&&this.unseenMessageCount.valueHasMutated()),this.realUnseenMessageCount(d),this.hasExtendedInfo(!0),f&&this.markHasChanges(),f},T.prototype.markHasChanges=function(){this.hasChanges(!0)},T.prototype.addMessagesCountsDiff=function(a,b){var c=this.messageCount()+a,d=this.unseenMessageCount()+b;0>c&&(c=0),this.messageCount(c),0>d&&(d=0),d>c&&(d=c),this.unseenMessageCount(d)},T.prototype.markDeletedByUids=function(a){var b=0,c=0;return _.each(a,function(a){var d=this.oMessages[a];d&&(b++,d.seen()||c++,d.deleted(!0))},this),this.addMessagesCountsDiff(-b,-c),{MinusDiff:b,UnseenMinusDiff:c}},T.prototype.revertDeleted=function(a){var b=0,c=0;return _.each(a,function(a){var d=this.oMessages[a];d&&d.deleted()&&(b++,d.seen()||c++,d.deleted(!1))},this),this.addMessagesCountsDiff(b,c),{PlusDiff:b,UnseenPlusDiff:c}},T.prototype.commitDeleted=function(a){_.each(this.oUids,function(b){_.each(b,function(b){b.deleteUids(a)})})},T.prototype.getUidList=function(a,b){var c=null;return void 0===this.oUids[a]&&(this.oUids[a]={}),void 0===this.oUids[a][b]&&(c=new W,c.search(a),c.filters(b),this.oUids[a][b]=c),this.oUids[a][b]},T.prototype.parse=function(a,b){var c="",d=cc.Storage.getData("folderAccordion")||[];return"Object/Folder"===a["@Object"]?(this.parentFullName(b),c=ac.pString(a.Name),this.name(c),this.nameForEdit(c),this.fullName(ac.pString(a.FullNameRaw)),this.fullNameHash(ac.pString(a.FullNameHash)),this.routingHash(cc.Routing.buildHashFromArray([_b.Screens.Mailbox,this.fullName()])),this.delimiter(a.Delimiter),this.type(a.Type),this.subscribed(a.IsSubscribed),this.selectable(a.IsSelectable),this.existen(a.IsExisten),a.Extended&&this.setRelevantInformation(a.Extended.UidNext.toString(),a.Extended.Hash,a.Extended.MessageCount,a.Extended.MessageUnseenCount,!1),_.find(d,function(a){return a===this.name()},this)&&this.expanded(!0),a.SubFolders):null},T.prototype.onMessageResponse=function(a,b){var c=a.Result,d=null,e=c?c.Uid.toString():b.Uid.toString(),f=this.oMessages[e],g=f?f.selected():!1;c?(f=this.parseAndCacheMessage(c,!1,!0),f&&f.ical()&&f.ical().isReplyType()&&cc.CalendarCache&&cc.CalendarCache.calendarChanged(!0)):(g&&cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("WARNING/UNKNOWN_ERROR")),f=null),d=this.aResponseHandlers[e],d&&(d.handler.call(d.context,f,e),delete this.aResponseHandlers[e])},T.prototype.getCompletelyFilledMessage=function(a,b,c){var d=this.oMessages[a],e={Action:"Message",Folder:this.fullName(),Uid:a};a.length>0&&(d&&d.completelyFilled()?b&&c&&b.call(c,d,a):(b&&c&&(this.aResponseHandlers[a]={handler:b,context:c}),cc.Ajax.send(e,this.onMessageResponse,this)))},T.prototype.showExternalPictures=function(a){var b=this.oMessages[a];void 0!==b&&b.showExternalPictures()},T.prototype.alwaysShowExternalPicturesForSender=function(a){_.each(this.oMessages,function(b){var c=b.oFrom.aCollection;c.length>0&&c[0].sEmail===a&&b.alwaysShowExternalPicturesForSender()},this)},T.prototype.executeGroupOperation=function(a,b,c){var d=0;_.each(this.oMessages,function(e){b.length>0?_.each(b,function(b){e&&e.uid()===b&&e[a]()!==c&&(e[a](c),d++)}):e[a](c)}),0===b.length&&(d=c?this.unseenMessageCount():this.messageCount()-this.unseenMessageCount()),"seen"===a&&d>0&&(c?this.addMessagesCountsDiff(0,-d):this.addMessagesCountsDiff(0,d))},T.prototype.emptyFolder=function(){var a=ac.i18n("MAILBOX/CONFIRM_EMPTY_FOLDER"),b=_.bind(this.clearFolder,this);this.enableEmptyFolder()&&cc.Screens.showPopup(t,[a,b])},T.prototype.clearFolder=function(a){var b={Action:"FolderClear",Folder:this.fullName()};this.enableEmptyFolder()&&a&&(cc.Ajax.send(b),this.removeAllMessages(),cc.MailCache.onClearFolder(this))},T.prototype.getNameWhithLevel=function(){var a=this.level();return!this.isNamespace()&&a>0&&a--,ac.strRepeat("",3*a)+this.name()},T.prototype.onAccordion=function(){var a=!this.expanded(),b=cc.Storage.getData("folderAccordion")||[];a?b.push(this.name()):b=_.reject(b,function(a){return a===this.name()},this),cc.Storage.setData("folderAccordion",b),this.expanded(a),cc.MailCache.countMessages(this)},U.prototype.getFoldersWithoutCountInfo=function(){var a=_.compact(_.map(this.oNamedCollection,function(a,b){return a.canBeSelected()&&!a.hasExtendedInfo()?b:null}));return a},U.prototype.getInboxAndCurrentFoldersArray=function(){var a=[this.inboxFolderFullName()];return this.currentFolderType()!==_b.FolderTypes.Inbox&&a.push(this.currentFolderFullName()),_.compact(a)},U.prototype.setCurrentFolder=function(a,b){var c=this.getFolderByFullName(a);null===c&&(c=this.inboxFolder()),null!==c&&(this.currentFolder()&&(this.currentFolder().selected(!1),this.oStarredFolder&&this.oStarredFolder.selected(!1)),this.currentFolder(c),b===_b.FolderFilter.Flagged?this.oStarredFolder&&this.oStarredFolder.selected(!0):this.currentFolder().selected(!0))},U.prototype.getFolderByType=function(a){switch(a){case _b.FolderTypes.Inbox:return this.inboxFolder();case _b.FolderTypes.Sent:return this.sentFolder();case _b.FolderTypes.Drafts:return this.draftsFolder();case _b.FolderTypes.Trash:return this.trashFolder();case _b.FolderTypes.Spam:return this.spamFolder()}return null},U.prototype.getFolderByFullName=function(a){var b=this.oNamedCollection[a];return b?b:null},U.prototype.parse=function(a,b,c){this.iAccountId=a,this.sNamespace=ac.pString(b.Namespace),this.bInitialized(!0),this.sNamespaceFolder=this.sNamespace.length>0?this.sNamespace.substring(0,this.sNamespace.length-1):this.sNamespace,this.collection(this.parseRecursively(b["@Collection"],c))},U.prototype.parseRecursively=function(a,b,c,d){var e=this,f=[],g=0,h=0,i=null,j="",k=null,l=[],m=!1,n=ec.Accounts.getAccount(this.iAccountId),o=function(){var a=e.getFolderByType(_b.FolderTypes.Spam);n&&n.extensionExists("AllowSpamFolderExtension")||(a.type(_b.FolderTypes.User),e.spamFolder(null))},p=function(){n&&n.extensionsRequested()&&(o(),n.extensionsRequestedSubscription.dispose(),n.extensionsRequestedSubscription=void 0)},q=function(){e.createStarredFolder(c),e.oStarredFolder&&f.push(e.oStarredFolder)};if(d=d||"",ac.isUnd(c)&&(c=-1),c++,_.isArray(a))for(h=a.length;h>g;g++){switch(j=ac.pString(a[g].FullNameRaw),i=b[j],i||(i=new T),i.iAccountId=this.iAccountId,k=i.parse(a[g],d),m=this.sNamespace===i.fullName()+i.delimiter(),i.isNamespace(m),i.level(c),this.oNamedCollection[i.fullName()]=i,i.type()){case _b.FolderTypes.Inbox:this.inboxFolder(i);break;case _b.FolderTypes.Sent:this.sentFolder(i);break;case _b.FolderTypes.Drafts:this.draftsFolder(i);break;case _b.FolderTypes.Trash:this.trashFolder(i);break;case _b.FolderTypes.Spam:this.spamFolder(i),n.extensionsRequested()?o():n.extensionsRequestedSubscription=n.extensionsRequested.subscribe(p)}f.push(i),null===k&&i.type()===_b.FolderTypes.Inbox?q():null!==k&&(l=this.parseRecursively(k["@Collection"],b,c,i.fullName()),i.type()===_b.FolderTypes.Inbox&&(i.isNamespace()?(this.createStarredFolder(c+1),this.oStarredFolder&&l.unshift(this.oStarredFolder)):q()),i.subfolders(l))}return f},U.prototype.createStarredFolder=function(a){var b=new T;b.iAccountId=this.iAccountId,b.virtual(!0),b.level(a),b.fullName("filter:"+_b.FolderFilter.Flagged),b.name(ac.i18n("MAIN/FOLDER_STARRED")),b.type(_b.FolderTypes.Starred),b.routingHash(cc.Routing.buildHashFromArray([_b.Screens.Mailbox,b.fullName()])),this.oStarredFolder=b},U.prototype.getOptions=function(a,b,c,d){var e="",f=function(a){var g=0,h=0,i=null,j=[];for(ac.isUnd(b)&&(b=!1),ac.isUnd(c)&&(c=!1),ac.isUnd(d)&&(d=!1),g=0,h=a.length;h>g;g++)i=a[g],i.virtual()||(i.type()===_b.FolderTypes.Inbox||!c)&&c||j.push({id:i.fullName(),name:new Array(i.level()+1).join(e)+i.name(),displayName:new Array(i.level()+1).join(e)+i.displayName(),disable:i.isSystem()&&!b||!d&&!i.canBeSelected()}),j=j.concat(f(i.subfolders()));return j},g=f(this.collection());return ac.isUnd(a)||g.unshift({id:"",name:a,displayName:a,disable:!1}),g},U.prototype.getRecursivelyMessageCount=function(a){var b=0,c=0,d=null,e=0;for(b=0,c=a.length;c>b;b++)d=a[b],d.virtual()||(e+=d.messageCount()+this.getRecursivelyMessageCount(d.subfolders()));return e},U.prototype.deleteFolder=function(a){var b=function(c){return a&&a.fullName()===c.fullName()?!0:(c.subfolders.remove(b),!1)};this.collection.remove(b)},V.prototype.viewMessage=function(b){var c=this.getDomText(ac.getAppPath()),d="";this.textBodyForNewWindow(c.html()),d=a(this.domMessageForPrint()).html(),b&&(a(b.document.body).html(d),b.focus(),_.each(this.attachments(),function(c){var d=a(b.document.body).find("[data-hash='download-"+c.hash()+"']");d.on("click",_.bind(c.downloadFile,c)),d=a(b.document.body).find("[data-hash='view-"+c.hash()+"']"),d.on("click",_.bind(c.viewFile,c))},this))},V.prototype.fillFromOrToText=function(){var a=cc.MailCache.getFolderByFullName(this.accountId(),this.folder()),b=ec.Accounts.getAccount(this.accountId());a.type()===_b.FolderTypes.Drafts||a.type()===_b.FolderTypes.Sent?this.fromOrToText(this.oTo.getDisplay(ac.i18n("MESSAGE/ME_RECIPIENT"),b.email())):this.fromOrToText(this.oFrom.getDisplay(ac.i18n("MESSAGE/ME_SENDER"),b.email()))},V.prototype.changeThreadUids=function(a,b){this.threadUids(a),this.threadLoading(b<Math.min(this.threadUids().length,this.threadCountForLoad()))
},V.prototype.showNextLoadingLink=function(a){this.threadNextLoadingLinkVisible()&&(this.threadNextLoadingVisible(!0),this.threadFunctionLoadNext=a)},V.prototype.increaseThreadCountForLoad=function(){this.threadCountForLoad(this.threadCountForLoad()+5),cc.MailCache.showOpenedThreads(this.folder())},V.prototype.loadNextMessages=function(){this.threadFunctionLoadNext&&(this.threadFunctionLoadNext(),this.threadNextLoadingLinkVisible(!1),this.threadFunctionLoadNext=null)},V.prototype.markAsThreadPart=function(a){var b=this;ac.log("Mark as thread part",this.threadPart(),this.uid()),this.threadPart(!0),this.threadUids([]),this.threadNextLoadingVisible(!1),this.threadNextLoadingLinkVisible(!0),this.threadFunctionLoadNext=null,this.threadHideAnimation(!1),setTimeout(function(){b.threadShowAnimation(!0)},a)},V.prototype.parse=function(a,b,c,d){var e=null,f=null,g="",h="";d&&this.threadPart(c),"Object/MessageListItem"===a["@Object"]&&(this.seen(!!a.IsSeen),this.flagged(!!a.IsFlagged),this.answered(!!a.IsAnswered),this.forwarded(!!a.IsForwarded),a.Custom&&(this.Custom=a.Custom)),("Object/Message"===a["@Object"]||"Object/MessageListItem"===a["@Object"])&&(this.accountId(b),this.folder(a.Folder),this.uid(ac.pString(a.Uid)),this.subject(ac.pString(a.Subject)),this.messageId(ac.pString(a.MessageId)),this.size(a.Size),this.textSize(a.TextSize),this.oDateModel.parse(a.TimeStampInUTC),this.oFrom.parse(a.From),this.oTo.parse(a.To),this.fillFromOrToText(),this.oCc.parse(a.Cc),this.oBcc.parse(a.Bcc),this.oSender.parse(a.Sender),this.oReplyTo.parse(a.ReplyTo),this.fullDate(this.oDateModel.getFullDate()),this.fullFrom(this.oFrom.getFull()),this.to(this.oTo.getFull()),this.cc(this.oCc.getFull()),this.bcc(this.oBcc.getFull()),this.hasAttachments(!!a.HasAttachments),"Object/MessageListItem"===a["@Object"]&&d&&this.threadUids(_.map(a.Threads,function(a){return a.toString()},this)),this.importance(a.Priority),_.isArray(a.DraftInfo)&&this.draftInfo(a.DraftInfo),this.sensitivity(a.Sensitivity),this.hash(ac.pString(a.Hash)),"Object/Message"===a["@Object"]&&(this.inReplyTo(a.InReplyTo),this.references(a.References),this.readingConfirmation(a.ReadingConfirmation),g=ac.pString(a.Html),h=ac.pString(a.Plain),""!==g?(this.text(g),this.isPlain(!1)):(this.text(""!==h?"<div>"+h+"</div>":""),this.isPlain(!0)),this.rtl(a.Rtl),this.hasExternals(!!a.HasExternals),this.foundedCids(a.FoundedCIDs),this.parseAttachments(a.Attachments,b),this.safety(a.Safety),null!==a.ICAL&&(e=new X,e.parse(a.ICAL),this.ical(e)),null!==a.VCARD&&(f=new Y,f.parse(a.VCARD),this.vcard(f)),this.completelyFilled(!0)))},V.prototype.getDomText=function(b){var c=this.$text;return b=b||"",(null===this.$text||""!==b)&&(this.completelyFilled()?(this.$text=a(this.text()),this.showInlinePictures(b),this.safety()===!0&&this.alwaysShowExternalPicturesForSender(),c=this.$text):c=a("")),c.clone()},V.prototype.parseAttachments=function(a,b){_.isArray(a)&&this.attachments(_.map(a,function(a){var c=new S;return c.parse(a,b),c.setMessageData(this.folder(),this.uid()),c},this))},V.prototype.parseAddressArray=function(a){var b=[];return _.isArray(a)&&(b=_.map(a,function(a){var b=new N;return b.parse(a),b})),b},V.prototype.findAttachmentByCid=function(a){return a="<"+a+">",_.find(this.attachments(),function(b){return b.cid()===a})},V.prototype.showInlinePictures=function(b){var c=this;this.foundedCids().length>0&&(a("[data-x-src-cid]",this.$text).each(function(){var d=a(this).attr("data-x-src-cid"),e=c.findAttachmentByCid(d);e&&e.viewLink().length>0&&a(this).attr("src",b+e.viewLink())}),a("[data-x-style-cid]",this.$text).each(function(){var b="",d=a(this).attr("data-x-style-cid-name"),e=a(this).attr("data-x-style-cid"),f=c.findAttachmentByCid(e);f&&f.viewLink().length>0&&""!==d&&(b=ac.trim(a(this).attr("style")),b=""===b?"":";"===b.substr(-1)?b+" ":b+"; ",a(this).attr("style",b+d+": url('"+f.viewLink()+"')"))}))},V.prototype.showExternalPictures=function(){a("[data-x-src]",this.$text).each(function(){a(this).attr("src",a(this).attr("data-x-src")).removeAttr("data-x-src")}),a("[data-x-style-url]",this.$text).each(function(){var b=ac.trim(a(this).attr("style"));b=""===b?"":";"===b.substr(-1)?b+" ":b+"; ",a(this).attr("style",b+a(this).attr("data-x-style-url")).removeAttr("data-x-style-url")}),this.isExternalsShown(!0)},V.prototype.alwaysShowExternalPicturesForSender=function(){this.completelyFilled()&&(this.isExternalsAlwaysShown(!0),this.isExternalsShown()||this.showExternalPictures())},V.prototype.openThread=function(){if(this.threadCountVisible()){var a=this.folder();this.threadOpened(!this.threadOpened()),this.threadOpened()?cc.MailCache.showOpenedThreads(a):(cc.MailCache.hideThreads(this),setTimeout(function(){cc.MailCache.showOpenedThreads(a)},500))}},V.prototype.downloadAllAttachments=function(){if(""!==this.allAttachmentsHash)cc.downloadByUrl(ac.getDownloadLinkByHash(this.accountId(),this.allAttachmentsHash));else{var a=_.filter(this.attachments(),function(a){return!a.linked()}),b=_.map(a,function(a){return a.hash()});cc.Ajax.send({Action:"MessageZipAttachments",Hashes:b},this.onMessageZipAttachments,this)}},V.prototype.onMessageZipAttachments=function(a){a.Result&&(this.allAttachmentsHash=a.Result,cc.downloadByUrl(ac.getDownloadLinkByHash(this.accountId(),this.allAttachmentsHash)))},V.prototype.saveAttachmentsToFiles=function(){var a=_.filter(this.attachments(),function(a){return!a.linked()}),b=_.map(a,function(a){return a.hash()});cc.Ajax.send({Action:"MessageAttachmentsSaveToFiles",Attachments:b},this.onMessageAttachmentsSaveToFilesResponse,this)},V.prototype.onMessageAttachmentsSaveToFilesResponse=function(a){a.Result&&cc.Api.showReport(ac.i18n("MESSAGE/REPORT_ATTACHMENTS_SAVED_TO_FILES"))},V.prototype.downloadAllAttachmentsSeparately=function(){_.each(this.attachments(),function(a){a.linked()||a.downloadFile(cc)})},V.prototype.toJSON=function(){return{uid:this.uid(),accountId:this.accountId(),to:this.to(),subject:this.subject(),threadPart:this.threadPart(),threadUids:this.threadUids(),threadOpened:this.threadOpened()}},W.prototype.addThreadUids=function(a,b){-1!==_.indexOf(this.collection(),a)&&(this.threadUids[a]=b)},W.prototype.setUidsAndCount=function(a){"Collection/MessageCollection"===a["@Object"]&&(_.each(a.Uids,function(b,c){this.collection()[c+a.Offset]=b.toString()},this),this.resultCount(a.MessageResultCount))},W.prototype.getUidsForOffset=function(a,b){for(var c=0,d=this.collection().length,e="",f=0,g=[],h=null;d>c;c++)c>=a&&f<ec.User.MailsPerPage&&(e=this.collection()[c],h=b[e],(h&&!h.deleted()||void 0===e)&&(f++,void 0!==e&&g.push(e)));return g},W.prototype.deleteUids=function(a){for(var b=0,c=this.collection().length,d="",e=[],f=0;c>b;b++)d=this.collection()[b],-1===_.indexOf(a,d)?e.push(d):f++;this.collection(e),this.resultCount(this.resultCount()-f)},X.prototype.fillDecisions=function(){var a=ec.Accounts.getCurrent(),b=a?a.email():"";switch(this.cancelDecision(ac.i18n("MESSAGE/APPOINTMENT_CANCELED",{SENDER:b})),this.icalConfig()){case _b.IcalConfig.Accepted:this.replyDecision(ac.i18n("MESSAGE/APPOINTMENT_ACCEPTED",{SENDER:b}));break;case _b.IcalConfig.Declined:this.replyDecision(ac.i18n("MESSAGE/APPOINTMENT_DECLINED",{SENDER:b}));break;case _b.IcalConfig.Tentative:this.replyDecision(ac.i18n("MESSAGE/APPOINTMENT_TENTATIVELY_ACCEPTED",{SENDER:b}))}},X.prototype.parse=function(a){var b="";a&&"Object/CApiMailIcs"===a["@Object"]&&(b=ac.pString(a.Description),this.uid(ac.pString(a.Uid)),this.file(ac.pString(a.File)),this.type(a.Type),this.location(ac.pString(a.Location)),this.description(b.replace(/\r/g,"").replace(/\n/g,"<br />")),this.when(ac.pString(a.When)),this.calendarId(ac.pString(a.CalendarId)),this.selectedCalendar(ac.pString(a.CalendarId)))},X.prototype.acceptAppointment=function(){this.calendarId(this.selectedCalendar()),this.changeAndSaveConfig(_b.IcalConfig.Accepted)},X.prototype.tentativeAppointment=function(){this.calendarId(this.selectedCalendar()),this.changeAndSaveConfig(_b.IcalConfig.Tentative)},X.prototype.declineAppointment=function(){this.calendarId(""),this.selectedCalendar(""),this.changeAndSaveConfig(_b.IcalConfig.Declined)},X.prototype.changeAndSaveConfig=function(a){this.icalConfig()===a||a===_b.IcalConfig.Declined&&this.icalConfig()===_b.IcalConfig.NeedsAction||cc.CalendarCache.recivedAnim(!0),this.changeConfig(a),this.doProcessAppointment()},X.prototype.changeConfig=function(a){this.type(this.icalType()+"-"+a)},X.prototype.onProcessAppointmentResponse=function(a){a.Result?cc.CalendarCache&&cc.CalendarCache.calendarChanged(!0):cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("WARNING/UNKNOWN_ERROR"))},X.prototype.doProcessAppointment=function(){var a={Action:"ProcessAppointment",AppointmentAction:this.icalConfig(),CalendarId:this.selectedCalendar(),File:this.file()};cc.Ajax.send(a,this.onProcessAppointmentResponse,this)},X.prototype.onAddEventResponse=function(a){a.Result?a.Result.Uid&&this.uid(a.Result.Uid):cc.Api.showErrorByCode(a.ErrorCode)},X.prototype.addEvent=function(){var a={Action:"SaveIcs",CalendarId:this.selectedCalendar(),File:this.file()};cc.Ajax.send(a,this.onAddEventResponse,this),this.isJustSaved(!0),this.calendarId(this.selectedCalendar()),setTimeout(_.bind(function(){this.isJustSaved(!1)},this),2e4),cc.CalendarCache.recivedAnim(!0)},X.prototype.onEventDelete=function(){this.calendarId(""),this.selectedCalendar(""),this.changeConfig(_b.IcalConfig.NeedsAction)},X.prototype.onEventTentative=function(){this.changeConfig(_b.IcalConfig.Tentative)},X.prototype.onEventAccept=function(){this.changeConfig(_b.IcalConfig.Accepted)},X.prototype.firstCalendarName=function(){return this.calendars()[0]?this.calendars()[0].name:""},Y.prototype.parse=function(a){a&&"Object/CApiMailVcard"===a["@Object"]&&(this.uid(ac.pString(a.Uid)),this.file(ac.pString(a.File)),this.name(ac.pString(a.Name)),this.email(ac.pString(a.Email)),this.isExists(!!a.Exists))},Y.prototype.onAddContactResponse=function(a){a&&a.Result&&a.Result.Uid&&this.uid(a.Result.Uid)},Y.prototype.addContact=function(){var a={Action:"SaveVcf",File:this.file()};cc.Ajax.send(a,this.onAddContactResponse,this),this.isJustSaved(!0),this.isExists(!0),setTimeout(_.bind(function(){this.isJustSaved(!1)},this),2e4),cc.ContactsCache.recivedAnim(!0)},Z.birthdayMonths=ac.getMonthNamesArray(),Z.birthdayMonthSelect=[{text:ac.i18n("DATETIME/MONTH"),value:"0"},{text:Z.birthdayMonths[0],value:"1"},{text:Z.birthdayMonths[1],value:"2"},{text:Z.birthdayMonths[2],value:"3"},{text:Z.birthdayMonths[3],value:"4"},{text:Z.birthdayMonths[4],value:"5"},{text:Z.birthdayMonths[5],value:"6"},{text:Z.birthdayMonths[6],value:"7"},{text:Z.birthdayMonths[7],value:"8"},{text:Z.birthdayMonths[8],value:"9"},{text:Z.birthdayMonths[9],value:"10"},{text:Z.birthdayMonths[10],value:"11"},{text:Z.birthdayMonths[11],value:"12"}],Z.birthdayYearSelect=[{text:ac.i18n("DATETIME/YEAR"),value:"0"}],Z.prototype.getSendMailLink=function(a){var b=this.getFullEmail(a),c=cc.Links.composeWithToField(b),d=cc.Routing.buildHashFromArray(c);return d},Z.prototype.clear=function(){this.isNew(!1),this.readOnly(!1),this.idContact(""),this.idUser(""),this.global(!1),this.itsMe(!1),this.edited(!1),this.extented(!1),this.personalCollapsed(!1),this.businessCollapsed(!1),this.otherCollapsed(!1),this.groupsCollapsed(!1),this.displayName(""),this.firstName(""),this.lastName(""),this.nickName(""),this.skype(""),this.facebook(""),this.primaryEmail(this.sEmailDefaultType),this.primaryPhone(this.sPhoneDefaultType),this.primaryAddress(this.sAddressDefaultType),this.personalEmail(""),this.personalStreetAddress(""),this.personalCity(""),this.personalState(""),this.personalZipCode(""),this.personalCountry(""),this.personalWeb(""),this.personalFax(""),this.personalPhone(""),this.personalMobile(""),this.businessEmail(""),this.businessCompany(""),this.businessDepartment(""),this.businessJob(""),this.businessOffice(""),this.businessStreetAddress(""),this.businessCity(""),this.businessState(""),this.businessZipCode(""),this.businessCountry(""),this.businessWeb(""),this.businessFax(""),this.businessPhone(""),this.otherEmail(""),this.otherBirthdayMonth("0"),this.otherBirthdayDay("0"),this.otherBirthdayYear("0"),this.otherNotes(""),this.etag(""),this.groups([])},Z.prototype.switchToNew=function(){this.clear(),this.edited(!0),this.extented(!1),this.isNew(!0),this.displayNameFocused(!0)},Z.prototype.switchToView=function(){this.edited(!1),this.extented(!1)},Z.prototype.toObject=function(){var a={ContactId:this.idContact(),PrimaryEmail:this.primaryEmail(),PrimaryPhone:this.primaryPhone(),PrimaryAddress:this.primaryAddress(),UseFriendlyName:"1",Title:"",FullName:this.displayName(),FirstName:this.firstName(),LastName:this.lastName(),NickName:this.nickName(),Global:this.global()?"1":"0",ItsMe:this.itsMe()?"1":"0",Skype:this.skype(),Facebook:this.facebook(),HomeEmail:this.personalEmail(),HomeStreet:this.personalStreetAddress(),HomeCity:this.personalCity(),HomeState:this.personalState(),HomeZip:this.personalZipCode(),HomeCountry:this.personalCountry(),HomeFax:this.personalFax(),HomePhone:this.personalPhone(),HomeMobile:this.personalMobile(),HomeWeb:this.personalWeb(),BusinessEmail:this.businessEmail(),BusinessCompany:this.businessCompany(),BusinessJobTitle:this.businessJob(),BusinessDepartment:this.businessDepartment(),BusinessOffice:this.businessOffice(),BusinessStreet:this.businessStreetAddress(),BusinessCity:this.businessCity(),BusinessState:this.businessState(),BusinessZip:this.businessZipCode(),BusinessCountry:this.businessCountry(),BusinessFax:this.businessFax(),BusinessPhone:this.businessPhone(),BusinessWeb:this.businessWeb(),OtherEmail:this.otherEmail(),Notes:this.otherNotes(),ETag:this.etag(),BirthdayDay:this.otherBirthdayDay(),BirthdayMonth:this.otherBirthdayMonth(),BirthdayYear:this.otherBirthdayYear(),GroupsIds:this.groups()};return a},Z.prototype.parse=function(a){if(a&&"Object/CContact"===a["@Object"]){var b=0,c=0,d=0,e=[];switch(this.idContact(ac.pExport(a,"IdContact","").toString()),this.idUser(ac.pExport(a,"IdUser","").toString()),this.global(!!ac.pExport(a,"Global",!1)),this.itsMe(!!ac.pExport(a,"ItsMe",!1)),this.readOnly(!!ac.pExport(a,"ReadOnly",!1)),this.displayName(ac.pExport(a,"FullName","")),this.firstName(ac.pExport(a,"FirstName","")),this.lastName(ac.pExport(a,"LastName","")),this.nickName(ac.pExport(a,"NickName","")),this.skype(ac.pExport(a,"Skype","")),this.facebook(ac.pExport(a,"Facebook","")),b=ac.pInt(ac.pExport(a,"PrimaryEmail",0))){case 1:b=_b.ContactEmailType.Business;break;case 2:b=_b.ContactEmailType.Other;break;default:case 0:b=_b.ContactEmailType.Personal}switch(this.primaryEmail(b),c=ac.pInt(ac.pExport(a,"PrimaryPhone",0))){case 2:c=_b.ContactPhoneType.Business;break;case 1:c=_b.ContactPhoneType.Personal;break;default:case 0:c=_b.ContactPhoneType.Mobile}switch(this.primaryPhone(c),d=ac.pInt(ac.pExport(a,"PrimaryAddress",0))){case 1:d=_b.ContactAddressType.Business;break;default:case 0:d=_b.ContactAddressType.Personal}this.primaryAddress(d),this.personalEmail(ac.pExport(a,"HomeEmail","")),this.personalStreetAddress(ac.pExport(a,"HomeStreet","")),this.personalCity(ac.pExport(a,"HomeCity","")),this.personalState(ac.pExport(a,"HomeState","")),this.personalZipCode(ac.pExport(a,"HomeZip","")),this.personalCountry(ac.pExport(a,"HomeCountry","")),this.personalWeb(ac.pExport(a,"HomeWeb","")),this.personalFax(ac.pExport(a,"HomeFax","")),this.personalPhone(ac.pExport(a,"HomePhone","")),this.personalMobile(ac.pExport(a,"HomeMobile","")),this.businessEmail(ac.pExport(a,"BusinessEmail","")),this.businessCompany(ac.pExport(a,"BusinessCompany","")),this.businessDepartment(ac.pExport(a,"BusinessDepartment","")),this.businessJob(ac.pExport(a,"BusinessJobTitle","")),this.businessOffice(ac.pExport(a,"BusinessOffice","")),this.businessStreetAddress(ac.pExport(a,"BusinessStreet","")),this.businessCity(ac.pExport(a,"BusinessCity","")),this.businessState(ac.pExport(a,"BusinessState","")),this.businessZipCode(ac.pExport(a,"BusinessZip","")),this.businessCountry(ac.pExport(a,"BusinessCountry","")),this.businessWeb(ac.pExport(a,"BusinessWeb","")),this.businessFax(ac.pExport(a,"BusinessFax","")),this.businessPhone(ac.pExport(a,"BusinessPhone","")),this.otherEmail(ac.pExport(a,"OtherEmail","")),this.otherBirthdayMonth(ac.pExport(a,"BirthdayMonth","0").toString()),this.otherBirthdayDay(ac.pExport(a,"BirthdayDay","0").toString()),this.otherBirthdayYear(ac.pExport(a,"BirthdayYear","0").toString()),this.otherNotes(ac.pExport(a,"Notes","")),this.etag(ac.pExport(a,"ETag","")),e=ac.pExport(a,"GroupsIds",[]),_.isArray(e)&&this.groups(e)}},Z.prototype.getFullEmail=function(a){var b=a;return""!==this.displayName()&&(b=""!==a?'"'+this.displayName()+'" <'+a+">":this.displayName()),b},Z.prototype.getEmailsString=function(){return _.uniq(_.without([this.email(),this.personalEmail(),this.businessEmail(),this.otherEmail()],"")).join(",")},Z.prototype.viewAllMails=function(){cc.MailCache.searchMessagesInInbox("email:"+this.getEmailsString())},Z.prototype.sendThisContact=function(){cc.Routing.goDirectly(cc.Links.compose(),["vcard",this])},Z.prototype.isStrLink=function(a){return/^http/.test(a)},Z.prototype.onCallClick=function(a){cc.Phone.call(ac.getFormattedPhone(a))},$.prototype.clear=function(){this.isNew(!1),this.idGroup(""),this.idUser(""),this.name(""),this.nameFocused(!1),this.edited(!1)},$.prototype.switchToNew=function(){this.clear(),this.edited(!0),this.isNew(!0),this.nameFocused(!0)},$.prototype.switchToView=function(){this.edited(!1)},$.prototype.toObject=function(){return{GroupId:this.idGroup(),Name:this.name()}},$.prototype.viewAllMails=function(a){var b="email:";a&&(_.each(a,function(a){_.each(a.Emails,function(a){b=b+a+","})}),cc.MailCache.searchMessagesInInbox(b))},ab.prototype.parse=function(a,b){a&&"Object/CContactListItem"===ac.pExport(a,"@Object","")&&(this.sId=ac.pString(a.Id),this.sName=ac.pString(a.Name),this.sEmail=ac.pString(a.Email),this.bIsGroup=!!a.IsGroup,this.bReadOnly=!!a.ReadOnly,this.bItsMe=!!a.ItsMe,this.bGlobal=ac.isUnd(b)?!1:!!b)},ab.prototype.IsGroup=function(){return this.bIsGroup},ab.prototype.Global=function(){return this.bGlobal},ab.prototype.ReadOnly=function(){return this.bReadOnly},ab.prototype.ItsMe=function(){return this.bItsMe},ab.prototype.Id=function(){return this.sId},ab.prototype.Name=function(){return this.sName},ab.prototype.Email=function(){return this.sEmail},ab.prototype.EmailAndName=function(){return this.sName&&this.sEmail&&0<this.sName.length&&0<this.sEmail.length?'"'+this.sName+'" <'+this.sEmail+">":this.sEmail},bb.prototype.parse=function(a){this.id=ac.pString(a.Id),this.name(ac.pString(a.Name)),this.description(ac.pString(a.Description)),this.owner(ac.pString(a.Owner)),this.active(cc.Storage.hasData(this.id)?cc.Storage.getData(this.id):!0),this.isDefault=!!a.IsDefault,this.access=a.Access,this.isShared(!!a.Shared),this.isSharedToAll(!!a.SharedToAll),this.sharedToAllAccess=a.SharedToAllAccess,this.isPublic(!!a.IsPublic);var b=ac.pString(a.Color);this.color(b),this.url(ac.pString(a.Url)),this.davUrl(ac.pString(a.ServerUrl)),this.exportUrl(ac.getAppPath()+"?/Raw/Calendars/0/"+ac.pString(a.ExportHash)),this.pubUrl(ac.getAppPath()+"?calendar-pub="+ac.pString(a.PubHash)),this.shares(a.Shares||[]),_.each(a.Events,function(a){this.addEvent(a)},this)},bb.prototype.eventExists=function(a){return _.find(this.events,function(b){return a===b.id})},bb.prototype.addEvent=function(a){a&&!this.eventExists(a.id)&&(a.backgroundColor=this.color(),a.borderColor=this.color(),a.title=ac.getTitleForEvent(a.subject),this.isEditable()||(a.className="fc-event-readonly"),this.events.push(a))},bb.prototype.removeEvent=function(a){this.events=_.filter(this.events,function(b){return b.id!==a},this)},bb.prototype.removeEventByUid=function(a,b){ac.isUnd(b)&&(b=!1),this.events=_.filter(this.events,function(c){return!(c.uid===a||b&&c.excluded)},this)},bb.prototype.removeEvents=function(){this.events=[]},bb.prototype.isEditable=function(){return this.access!==_b.CalendarAccess.Read},bb.prototype.isOwner=function(){return this.account&&this.account.email()===this.owner()},cb.prototype.pickCurrentCalendar=function(a){var b=_.find(this.collection(),function(a){return a.active()&&a.access===_b.CalendarAccess.Write},this);this.currentCal()&&this.currentCal().active()||(a&&a.active()?this.currentCal(a):!this.defaultCal()||!this.defaultCal().active()&&b?b&&this.currentCal(b):this.currentCal(this.defaultCal()))},cb.prototype.hideOtherCalendars=function(a){_.each(this.collection(),function(b){b.active(b.id===a)},this)},cb.prototype.getCalendarById=function(a){var b=_.find(this.collection(),function(b){return b.id===a},this);return b},cb.prototype.getEvents=function(){var a=[];return _.each(this.collection(),function(b){b.active()&&(a=_.union(a,b.events))},this),a},cb.prototype.parseAndAddCalendar=function(a){var b=0,c=new bb;return c.parse(a),c.active.subscribe(function(a){this.parentOnCalendarActiveChange(c);var b=c.active()?c:this.defaultCal();this.pickCurrentCalendar(b),cc.Storage.setData(c.id,a)},this),c.isDefault&&this.defaultCal(c),b=this.calendarExists(c.id),b||0===b?this.collection.splice(b,1,c):this.collection.push(c),c},cb.prototype.calendarExists=function(a){var b=_.indexOf(_.map(this.collection(),function(a){return a.id}),a);return 0>b?!1:b},cb.prototype.removeCalendar=function(a){this.collection(_.filter(this.collection(),function(b){return b.id!==a},this))},cb.prototype.clearCollection=function(){this.collection.removeAll()},cb.prototype.getColors=function(){return _.map(this.collection(),function(a){return a.color()},this)},ac.extend(db,R),db.prototype.parse=function(a,b){var c=new P;this.isFolder(!!a.IsFolder),this.fileName(ac.pString(a.Name)),this.path(ac.pString(a.Path)),this.storageType(ac.pInt(a.Type)),this.shared(!!a.Shared),this.isFolder()||(this.size(ac.pInt(a.Size)),c.parse(a.LastModified),this.lastModified(c.getShortDate()),this.owner(ac.pString(a.Owner)),this.hash(ac.pString(a.Hash)),this.publicHash(b))},db.prototype.onUploadSelectOwn=function(a,b,c,d,e,f){var g=new P,h=new Date;this.onUploadSelect(a,b),g.parse(h.getTime()/1e3),this.fileName(c),this.lastModified(g.getShortDate()),this.owner(d),this.path(e),this.storageType(f)},eb.prototype.parse=function(a){if(this.Id=a.IdHelpdeskPost,this.IdThread=a.IdHelpdeskThread,this.IdOwner=a.IdOwner,this.bThreadOwner=a.IsThreadOwner,this.sFrom=ac.isNonEmptyArray(a.Owner)?a.Owner[1]||a.Owner[0]||"":"",this.sDate=P.prototype.convertDate(a.Created),this.iType=a.Type,this.bSysType=a.SystemType,this.sText=ac.pString(a.Text),this.itsMe(a.ItsMe),a.Attachments){var b=0,c=0,d=null,e=[];for(c=a.Attachments.length;c>b;b++)a.Attachments[b]&&"Object/CHelpdeskAttachment"===ac.pExport(a.Attachments[b],"@Object","")&&(d=new gb,d.parse(a.Attachments[b]),e.push(d));this.attachments(e)}},fb.prototype.parse=function(a){this.Id=a.IdHelpdeskThread,this.ThreadHash=ac.pString(a.ThreadHash),this.IdOwner=a.IdOwner,this.ItsMe=!!a.ItsMe,this.sSubject=ac.pString(a.Subject),this.sDate=moment(1e3*a.Updated).fromNow(!1),this.aOwner=ac.isNonEmptyArray(a.Owner)?a.Owner:["",""],this.sEmail=this.aOwner[0]||"",this.sName=this.aOwner[1]||"",this.sFrom=this.sName||this.sEmail,this.sFromFull=ac.trim(""===this.sName?this.sEmail:this.sName+(""!==this.sEmail?" ("+this.sEmail+")":"")),this.postsCount(a.PostCount),this.state(a.Type),this.unseen(!a.IsRead)},fb.prototype.Name=function(){return this.sName},fb.prototype.Email=function(){return this.sEmail},ac.extend(gb,R),gb.prototype.dataObjectName="Object/CHelpdeskAttachment",gb.prototype.fillDataAfterUploadComplete=function(a){this.tempName(a.Result.HelpdeskFile.TempName),this.type(a.Result.HelpdeskFile.MimeType),this.hash(a.Result.HelpdeskFile.Hash)},hb.prototype.parse=function(a,b){this.iAccountId=a,this.options(parseInt(b.Options,10)),this.signature(b.Signature)},ib.prototype.parse=function(a,b){this.iAccountId=a,this.enable=!!b.Enable,this.subject=ac.pString(b.Subject),this.message=ac.pString(b.Message)},kb.prototype.parse=function(a,b){this.accountId=a;var c=[],d=0,e=0,f=null,g=null;if(_.isArray(b))for(e=b.length;e>d;d++)g=b[d],f=new jb,f.id(g.IdFetcher),f.accountId(g.IdAccount),f.isEnabled(g.IsEnabled),f.isLocked(g.IsLocked),f.email(g.Email),f.userName(g.Name),f.folder(g.Folder),f.signatureOptions(g.SignatureOptions||0),f.signature(g.Signature),f.incomingMailServer(g.IncomingMailServer),f.incomingMailPort(g.IncomingMailPort),f.incomingMailLogin(g.IncomingMailLogin),f.leaveMessagesOnServer(g.LeaveMessagesOnServer),f.isOutgoingEnabled(g.IsOutgoingEnabled),f.outgoingMailServer(g.OutgoingMailServer),f.outgoingMailPort(g.OutgoingMailPort),f.outgoingMailAuth(g.OutgoingMailAuth),c.push(f);this.collection(c)},kb.prototype.getFetcher=function(a){var b=null,c=0,d=0,e=this.collection();for(d=e.length;d>c;c++)e[c].id()===a&&(b=e[c]);return b},lb.prototype.parse=function(a,b){this.iAccountId=a,this.enable=!!b.Enable,this.email=ac.pString(b.Email)},mb.prototype.parse=function(a,b){var c=0,d=b.length,e=null;if(this.iAccountId=a,_.isArray(b))for(d=b.length;d>c;c++)e=new nb(a),e.parse(b[c]),this.collection.push(e)},nb.prototype.parse=function(a){this.enable(!!a.Enable),this.field(ac.pInt(a.Field)),this.condition(ac.pInt(a.Condition)),this.filter(ac.pString(a.Filter)),this.action(ac.pInt(a.Action)),this.folder(ac.pString(a.FolderFullName))},nb.prototype.toString=function(){var a=[this.enable(),this.field(),this.condition(),this.filter(),this.action(),this.folder()];return a.join(":")},ob.prototype.showLoading=function(a){a&&""!==a?this.loadingMessage(a):this.loadingMessage(ac.i18n("MAIN/LOADING")),this.loadingVisible(!0)},ob.prototype.hideLoading=function(){this.loadingVisible(!1)},ob.prototype.showReport=function(a,b){var c=this;b=b||5e3,a&&""!==a?(this.reportMessage(a),this.reportVisible(!0),isNaN(this.iReportTimeout)||clearTimeout(this.iReportTimeout),this.iReportTimeout=setTimeout(function(){c.reportVisible(!1)},b)):this.reportVisible(!1)},ob.prototype.showError=function(a,b,c){var d=this;a&&""!==a?(this.errorNotHide(!!c),this.errorMessage(a),this.errorVisible(!0),this.isHtmlError(b),clearTimeout(this.iErrorTimeout),c||(this.iErrorTimeout=setTimeout(function(){d.errorVisible(!1)},5e3))):this.errorVisible(!1)},ob.prototype.hideError=function(){this.errorVisible(!1)},pb.prototype.gotoMailbox=function(){return cc.Routing.setLastMailboxHash(),!1},pb.prototype.onRoute=function(){this.changeCurrentAccount()},pb.prototype.changeCurrentAccount=function(){this.email(ec.Accounts.getEmail())},pb.prototype.logout=function(){cc.logout()},qb.prototype.clear=function(){this.currentPage(1),this.count(0)},qb.prototype.setCount=function(a){this.count(a),this.currentPage()>this.pagesCount()&&this.currentPage(this.pagesCount())},qb.prototype.setPage=function(a,b){this.perPage(b),a>this.pagesCount()?this.currentPage(this.pagesCount()):this.currentPage(a)},qb.prototype.clickPage=function(a){var b=a.number;1>b&&(b=1),b>this.pagesCount()&&(b=this.pagesCount()),this.currentPage(b)},qb.prototype.clickFirstPage=function(){this.currentPage(1)},qb.prototype.clickPreviousPage=function(){var a=this.firstPage()-1;1>a&&(a=1),this.currentPage(a)},qb.prototype.clickNextPage=function(){var a=this.lastPage()+1;a>this.pagesCount()&&(a=this.pagesCount()),this.currentPage(a)},qb.prototype.clickLastPage=function(){this.currentPage(this.pagesCount())},rb.prototype.init=function(){a(document.body).on("click",_.bind(function(){this.closeAllPopups()},this)),a(this.colorPickerDropdownDom()).on("click",function(a){a.stopPropagation()}),a(this.insertLinkDropdownDom()).on("click",function(a){a.stopPropagation()}),a(this.insertImageDropdownDom()).on("click",function(a){a.stopPropagation()}),this.initEditorUploader()},rb.prototype.showLinkPopup=function(b){var c=a(this.workareaDom()),d=c.position(),e=b.position(),f=b.height();this.linkHref(b.attr("href")||b.text()),this.linkPopupLeft(Math.round(e.left+d.left)),this.linkPopupTop(Math.round(e.top+f+d.top)),this.visibleLinkPopup(!0)},rb.prototype.hideLinkPopup=function(){this.visibleLinkPopup(!1)},rb.prototype.showChangeLink=function(){this.visibleLinkHref(!0),this.hideLinkPopup()},rb.prototype.changeLink=function(){this.oCrea.changeLink(this.linkHref()),this.hideChangeLink()},rb.prototype.hideChangeLink=function(){this.visibleLinkHref(!1)},rb.prototype.showImagePopup=function(b,c){var d=a(this.workareaDom()),e=d.position(),f=d.offset();this.imagePopupLeft(Math.round(c.pageX+e.left-f.left)),this.imagePopupTop(Math.round(c.pageY+e.top-f.top)),this.visibleImagePopup(!0)},rb.prototype.hideImagePopup=function(){this.visibleImagePopup(!1)},rb.prototype.resizeImage=function(a){var b={width:"auto"};switch(a){case _b.HtmlEditorImageSizes.Small:b.width="300px";break;case _b.HtmlEditorImageSizes.Medium:b.width="600px";break;case _b.HtmlEditorImageSizes.Large:b.width="1200px";break;case _b.HtmlEditorImageSizes.Original:b.width="auto"}this.oCrea.changeCurrentImage(b),this.visibleImagePopup(!1)},rb.prototype.onImageOver=function(b){if("IMG"===b.target.nodeName&&!this.visibleImagePopup()){this.imageSelected(!0),this.tooltipText(ac.i18n("HTMLEDITOR/CLICK_TO_EDIT_IMAGE"));var c=this,d=a(this.workareaDom()),e=d.position(),f=d.offset();d.bind("mousemove.image",function(a){c.tooltipPopupTop(Math.round(a.pageY+e.top-f.top)),c.tooltipPopupLeft(Math.round(a.pageX+e.left-f.left))})}return!0},rb.prototype.onImageOut=function(){if(this.imageSelected()){this.imageSelected(!1);var b=a(this.workareaDom());b.unbind("mousemove.image")}return!0},rb.prototype.initCrea=function(a,b){this.oCrea?(this.setText(a),this.oCrea.setTabIndex(b)):(this.init(),this.oCrea=new Crea({creaId:this.creaId,tabindex:b,text:a,fontNameArray:this.aFonts,defaultFontName:this.iDefaultFont,defaultFontSize:this.iDefaultSize,enableDrop:!1,onCursorMove:_.bind(this.setFontValuesFromText,this),onFocus:_.bind(this.onCreaFocus,this),onUrlIn:_.bind(this.showLinkPopup,this),onUrlOut:_.bind(this.hideLinkPopup,this),onImageSelect:_.bind(this.showImagePopup,this),onImageBlur:_.bind(this.hideImagePopup,this),onItemOver:_.bind(this.onImageOver,this),onItemOut:_.bind(this.onImageOut,this)},this.isEnable()))},rb.prototype.setFocus=function(){this.oCrea&&this.oCrea.setFocus(!1)},rb.prototype.changeSignatureContent=function(a){this.oCrea&&this.oCrea.changeSignatureContent(a)},rb.prototype.setFontValuesFromText=function(){this.lockFontSubscribing(!0),this.selectedFont(this.oCrea.getFontName()),this.selectedSize(this.oCrea.getFontSize()),this.lockFontSubscribing(!1)},rb.prototype.getText=function(a){return this.oCrea?this.oCrea.getText(a):""},rb.prototype.setText=function(a){this.oCrea&&(this.oCrea.setText(a),this.inactive.valueHasMutated())},rb.prototype.removeAllTags=function(a){return a.replace(/<style>.*<\/style>/g,"").replace(/<[^>]*>/g,"")},rb.prototype.setActivitySource=function(a){this.activitySource=a,this.activitySource.subscribe(function(){this.inactive(0===ac.pInt(this.activitySource()))},this),this.inactive(0===ac.pInt(this.activitySource()))},rb.prototype.onCreaFocus=function(){this.oCrea&&(this.closeAllPopups(),this.activitySource(1))},rb.prototype.closeAllPopups=function(){this.visibleInsertLinkPopup(!1),this.visibleInsertImagePopup(!1),this.visibleFontColorPopup(!1)},rb.prototype.insertLink=function(){this.visibleInsertLinkPopup()||(this.linkForInsert(this.oCrea.getSelectedText()),this.closeAllPopups(),this.visibleInsertLinkPopup(!0),this.linkFocused(!0))},rb.prototype.insertLinkFromPopup=function(a,b){this.linkForInsert().length>0&&this.oCrea.insertLink(this.linkForInsert()),this.closeInsertLinkPopup(a,b)},rb.prototype.closeInsertLinkPopup=function(a,b){this.visibleInsertLinkPopup(!1),b&&b.stopPropagation()},rb.prototype.textColor=function(){this.closeAllPopups(),this.visibleFontColorPopup(!0),this.oFontColorPicker.onShow(),this.oBackColorPicker.onShow()},rb.prototype.colorToHex=function(a){if("#"===a.substr(0,1))return a;for(var b=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(a),c=parseInt(b[2],10),d=parseInt(b[3],10),e=parseInt(b[4],10),f=e|d<<8|c<<16,g=f.toString(16);g.length<6;)g="0"+g;
return b[1]+"#"+g},rb.prototype.setTextColorFromPopup=function(a){this.oCrea.textColor(this.colorToHex(a)),this.visibleFontColorPopup(!1)},rb.prototype.setBackColorFromPopup=function(a){this.oCrea.backgroundColor(this.colorToHex(a)),this.visibleFontColorPopup(!1)},rb.prototype.insertImage=function(){return this.allowInsertImage()&&!this.visibleInsertImagePopup()&&(this.imagePathFromWeb(""),this.closeAllPopups(),this.visibleInsertImagePopup(!0),this.initUploader()),!0},rb.prototype.insertWebImageFromPopup=function(a,b){this.allowInsertImage()&&this.imagePathFromWeb().length>0&&this.oCrea.insertImage(this.imagePathFromWeb()),this.closeInsertImagePopup(a,b)},rb.prototype.clearImages=function(){this.uploadedImagePathes([])},rb.prototype.insertComputerImageFromPopup=function(b,c){var d=ac.getViewLinkByHash(ec.Accounts.currentId(),c.Hash),e=!1;this.allowInsertImage()&&d.length>0&&(e=this.oCrea.insertImage(d),e&&(a(this.oCrea.$editableArea).find('img[src="'+d+'"]').attr("data-x-src-cid",b),c.CID=b,this.uploadedImagePathes.push(c))),this.closeInsertImagePopup()},rb.prototype.closeInsertImagePopup=function(a,b){this.visibleInsertImagePopup(!1),b&&b.stopPropagation()},rb.prototype.initUploader=function(){this.imageUploaderButton()&&!this.oJua&&(this.oJua=new Jua({action:"?/Upload/Attachment/",name:"jua-uploader",queueSize:2,clickElement:this.imageUploaderButton(),disableMultiple:!0,disableAjaxUpload:!1,disableDragAndDrop:!0,hidden:{Token:function(){return ec.Token},AccountID:function(){return ec.Accounts.currentId()}}}),this.oJua.on("onSelect",_.bind(this.onFileUploadSelect,this)).on("onComplete",_.bind(this.onFileUploadComplete,this)))},rb.prototype.initEditorUploader=function(){if(ec.App.AllowInsertImage&&this.uploaderAreaDom()&&!this.editorUploader){var a=null,b=null;this.oParent&&this.oParent.composeUploaderDragOver&&this.oParent.onFileUploadProgress&&this.oParent.onFileUploadStart&&this.oParent.onFileUploadComplete?(a=_.bind(function(){this.editorUploaderBodyDragOver(!0),this.oParent.composeUploaderDragOver(!0)},this),b=_.bind(function(){this.editorUploaderBodyDragOver(!1),this.oParent.composeUploaderDragOver(!1)},this),this.editorUploader=new Jua({action:"?/Upload/Attachment/",name:"jua-uploader",queueSize:1,dragAndDropElement:this.uploaderAreaDom(),disableMultiple:!0,disableAjaxUpload:!1,disableDragAndDrop:!1,hidden:{Token:function(){return ec.Token},AccountID:function(){return ec.Accounts.currentId()}}}),this.editorUploader.on("onDragEnter",_.bind(this.oParent.composeUploaderDragOver,this.oParent,!0)).on("onDragLeave",_.bind(this.oParent.composeUploaderDragOver,this.oParent,!1)).on("onBodyDragEnter",a).on("onBodyDragLeave",b).on("onProgress",_.bind(this.oParent.onFileUploadProgress,this.oParent)).on("onSelect",_.bind(this.onEditorDrop,this)).on("onStart",_.bind(this.oParent.onFileUploadStart,this.oParent)).on("onComplete",_.bind(this.oParent.onFileUploadComplete,this.oParent))):(a=_.bind(this.editorUploaderBodyDragOver,this,!0),b=_.bind(this.editorUploaderBodyDragOver,this,!1),this.editorUploader=new Jua({queueSize:1,dragAndDropElement:this.uploaderAreaDom(),disableMultiple:!0,disableAjaxUpload:!1,disableDragAndDrop:!1}),this.editorUploader.on("onBodyDragEnter",a).on("onBodyDragLeave",b).on("onSelect",_.bind(this.onEditorDrop,this)))}},rb.prototype.onEditorDrop=function(a,c){var d=null,e=null,f=this,g=!1,h=Math.random().toString();if(c&&c.File)if(ec.App.AllowInsertImage&&0===c.File.type.indexOf("image/"))e=c.File,ec.App.ImageUploadSizeLimit>0&&e.size>ec.App.ImageUploadSizeLimit?cc.Screens.showPopup(s,[ac.i18n("COMPOSE/UPLOAD_ERROR_SIZE")]):(d=new b.FileReader,g=this.oCrea.bFocused,g||this.oCrea.setFocus(!0),this.oCrea.insertHtml('<img id="'+e.name+"_"+h+'" src="skins/Default/images/wait.gif" />'),g||this.oCrea.fixFirefoxCursorBug(),d.onload=function(){return function(a){f.oCrea.$editableArea.find('img[id="'+e.name+"_"+h+'"]').attr("src",a.target.result)}}(),d.readAsDataURL(e));else{if(this.oParent&&this.oParent.onFileUploadSelect)return this.oParent.onFileUploadSelect(a,c),!0;cc.Screens.showPopup(s,[ac.i18n("HTMLEDITOR/UPLOAD_ERROR_NOT_IMAGE")])}return!1},rb.prototype.isFileImage=function(b){if("string"==typeof b.Type)return-1!==b.Type.indexOf("image");var c=b.FileName.lastIndexOf("."),d=b.FileName.substr(c+1),e=["jpg","jpeg","gif","tif","tiff","png"];return-1!==a.inArray(d,e)},rb.prototype.onFileUploadSelect=function(a,b){return this.isFileImage(b)?(this.closeInsertImagePopup(),!0):(cc.Screens.showPopup(s,[ac.i18n("HTMLEDITOR/UPLOAD_ERROR_NOT_IMAGE")]),!1)},rb.prototype.onFileUploadComplete=function(a,b,c){var d="";c&&c.Result?c.Result.Error?(d="size"===c.Result.Error?ac.i18n("COMPOSE/UPLOAD_ERROR_SIZE"):ac.i18n("COMPOSE/UPLOAD_ERROR_UNKNOWN"),cc.Screens.showPopup(s,[d])):(this.oCrea.setFocus(!0),this.insertComputerImageFromPopup(a,c.Result.Attachment)):cc.Screens.showPopup(s,[ac.i18n("COMPOSE/UPLOAD_ERROR_UNKNOWN")])},sb.prototype.onShow=function(){a(this.colorPickerDom()).find("span.color-item").on("click",function(b){return function(){b.setColorFromPopup(a(this).data("color"))}}(this))},sb.prototype.setColorFromPopup=function(a){this.pickHandler.call(this.pickContext,a)},tb.prototype.hangup=function(){this.phone.hangup()},tb.prototype.call=function(){cc.Phone.call(ac.getFormattedPhone(this.input()))},tb.prototype.answer=function(){this.phone.answer()},tb.prototype.end=function(){this.action("online"),this.phone.reconnect()},tb.prototype.multiAction=function(){var a=this;"offline_active"===this.action()?this.action("offline"):"online"===this.action()?(this.action("online_active"),_.delay(function(){a.inputFocus(!0)},500)):"online_active"===this.action()&&this.input().length>0?(this.action("outgoing"),this.call()):"online"===this.action()&&0===this.input().length?_.delay(function(){a.inputFocus(!0)},500):("outgoing"===this.action()||"incoming"===this.action()||"outgoing_connect"===this.action()||"incoming_connect"===this.action())&&(this.hangup(),this.input(""))},tb.prototype.phoneClick=function(){},tb.prototype.autocompleteCallback=function(a,b){var c={Action:"ContactSuggestions",Search:a,PhoneOnly:"1"};this.phoneAutocompleteItem(null),a=ac.trim(a),""!==a?cc.Ajax.send(c,function(a){var c,d=[];a&&a.Result&&a.Result.List&&(_.each(a.Result.List,function(a){c=a.Name+" "+a.Email,_.each(a.Phones,function(a){d.push({label:a,category:c})},this)},this),d=_.compact(d)),b(d)},this):b([])},ub.prototype.__name="CLoginViewModel",ub.prototype.onShow=function(){this.emailVisible()?this.emailFocus(!0):this.loginFocus(!0),gc.toggleClass("screen-login-langblock",!this.viewLanguagesAsDropdown()),gc.toggleClass("screen-login-description",""!==this.loginDescription())},ub.prototype.signIn=function(){this.sendRequest()},ub.prototype.onResponse=function(a){!1===a.Result?(this.loading(!1),cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("WARNING/LOGIN_PASS_INCORRECT"))):b.location.reload()},ub.prototype.sendRequest=function(){var a={Action:"Login",Email:this.email(),IncLogin:this.login(),IncPassword:this.password(),SignMe:this.signMe()?"1":"0"};this.loading(!0),cc.Ajax.send(a,this.onResponse,this)},ub.prototype.changeLanguage=function(a){a&&this.allowLanguages()&&(this.currentLanguage(a),cc.Ajax.send({Action:"LoginLanguageUpdate",Language:a},function(){b.location.reload()},this))},wb.prototype.changeRoutingForMessageList=function(a,b,c,d,e){var f=cc.Routing.setHash(cc.Links.mailbox(a,b,c,d,e));f&&d.length>0&&this.search()===d&&this.listChangedThrottle(!this.listChangedThrottle())},wb.prototype.onEnterPress=function(a){a.openThread()},wb.prototype.onMessageDblClick=function(a){var b=this.folderList().getFolderByFullName(a.folder());b.type()===_b.FolderTypes.Drafts?cc.Routing.setHash(cc.Links.composeFromMessage("drafts",a.folder(),a.uid())):ac.WindowOpener.openMessage(a)},wb.prototype.onFolderListSubscribe=function(){this.setCurrentFolder(),this.requestMessageList()},wb.prototype.onRoute=function(a){var b=cc.Links.parseMailbox(a),c=this.currentPage()!==b.Page||this.folderFullName()!==b.Folder||this.filters()!==b.Filters||this.search()!==b.Search;this.pageSwitcherLocked(!0),this.folderFullName()!==b.Folder||this.search()!==b.Search||this.filters()!==b.Filters?this.oPageSwitcher.clear():this.oPageSwitcher.setPage(b.Page,ec.User.MailsPerPage),this.pageSwitcherLocked(!1),b.Page!==this.oPageSwitcher.currentPage()&&cc.Routing.replaceHash(cc.Links.mailbox(b.Folder,this.oPageSwitcher.currentPage(),b.Uid,b.Search,b.Filters)),this.currentPage(this.oPageSwitcher.currentPage()),this.folderFullName(b.Folder),this.filters(b.Filters),this.search(b.Search),this.searchInput(this.search()),this.searchSpan.notifySubscribers(),this.setCurrentFolder(),c&&this.requestMessageList(),this.highlightTrigger.notifySubscribers(!0)},wb.prototype.setCurrentFolder=function(){this.folderList().setCurrentFolder(this.folderFullName(),this.filters())},wb.prototype.requestMessageList=function(){var a=this.folderList().currentFolderFullName(),b=this.oPageSwitcher.currentPage();a.length>0?cc.MailCache.changeCurrentMessageList(a,b,this.search(),this.filters()):(this.isLoading(!0),this.isError(!1),cc.MailCache.getFolderList(ec.Accounts.currentId()))},wb.prototype.calculateSearchStringFromAdvancedForm=function(){var b=this.searchInputFrom(),c=this.searchInputTo(),d=this.searchInputSubject(),e=this.searchInputText(),f=[],g=function(b){return b=a.trim(b).replace(/"/g,'\\"'),(-1<b.indexOf(" ")||-1<b.indexOf('"'))&&(b='"'+b+'"'),b};return""!==b&&f.push("from:"+g(b)),""!==c&&f.push("to:"+g(c)),""!==d&&f.push("subject:"+g(d)),""!==e&&f.push("text:"+g(e)),f.join(" ")},wb.prototype.onSearchClick=function(){var a=this.folderList().currentFolderFullName(),b=1,c=this.searchInput();this.bAdvancedSearch()&&(c=this.calculateSearchStringFromAdvancedForm(),this.searchInput(c),this.bAdvancedSearch(!1)),this.changeRoutingForMessageList(a,b,"",c,this.filters())},wb.prototype.onRetryClick=function(){this.requestMessageList()},wb.prototype.onClearSearchClick=function(){var a=this.folderList().currentFolderFullName(),b=this.currentMessage()?this.currentMessage().uid():"",c="",d=1;this.changeRoutingForMessageList(a,d,b,c,this.filters())},wb.prototype.onStopSearchClick=function(){this.onClearSearchClick()},wb.prototype.routeForMessage=function(a){if(ac.log("Route for message",a),null!==a){var b=this.folderList().currentFolderFullName(),c=this.oPageSwitcher.currentPage(),d=a.uid(),e=this.search();""!==d&&this.changeRoutingForMessageList(b,c,d,e,this.filters())}},wb.prototype.onApplyBindings=function(b){var d=this,e=_.bind(function(a){a&&a.stopPropagation&&a.stopPropagation()},this);a(".message_list",b).on("click",".message_sub_list .item .flag",function(a){d.onFlagClick(c.dataFor(this)),a&&a.stopPropagation&&a.stopPropagation()}).on("dblclick",".message_sub_list .item .flag",e).on("click",".message_sub_list .item .thread",e).on("dblclick",".message_sub_list .item .thread",e),this.selector.initOnApplyBindings(".message_sub_list .item",".message_sub_list .selected.item",".message_sub_list .item .custom_checkbox",a(".message_list",b),a(".message_list .scroll-inner",b))},wb.prototype.onFlagClick=function(a){cc.MailCache.executeGroupOperation("MessageSetFlagged",[a.uid()],"flagged",!a.flagged())},wb.prototype.executeMarkAsRead=function(){cc.MailCache.executeGroupOperation("MessageSetSeen",this.collectionCheckedUids(),"seen",!0)},wb.prototype.executeMarkAsUnread=function(){cc.MailCache.executeGroupOperation("MessageSetSeen",this.collectionCheckedUids(),"seen",!1)},wb.prototype.executeFlag=function(){cc.MailCache.executeGroupOperation("MessageSetFlagged",this.collectionCheckedUids(),"flagged",!0)},wb.prototype.executeUnflag=function(){cc.MailCache.executeGroupOperation("MessageSetFlagged",this.collectionCheckedUids(),"flagged",!1)},wb.prototype.executeMarkAllRead=function(){cc.MailCache.executeGroupOperation("MessageSetAllSeen",[],"seen",!0)},wb.prototype.executeMoveToFolder=function(a){cc.MailCache.moveMessagesToFolder(a,this.collectionCheckedUids())},wb.prototype.onDeletePress=function(a){var b=_.map(a,function(a){return a.uid()});b.length>0&&this.deleteMessages(b)},wb.prototype.executeDelete=function(){this.deleteMessages(this.collectionCheckedUids())},wb.prototype.deleteMessages=function(a){var b=this.folderList().currentFolderFullName(),c=this.folderList().trashFolder(),d=c&&b===c.fullName(),e=this.folderList().spamFolder(),f=e&&b===e.fullName(),g=function(b){b&&cc.MailCache.deleteMessages(a)};f?cc.MailCache.deleteMessages(a):d?cc.Screens.showPopup(t,[ac.i18n("MAILBOX/CONFIRM_MESSAGES_DELETE"),g]):c?cc.MailCache.moveMessagesToFolder(c.fullName(),this.collectionCheckedUids()):c||cc.Screens.showPopup(t,[ac.i18n("MAILBOX/CONFIRM_MESSAGES_DELETE_NO_TRASH_FOLDER"),g])},wb.prototype.executeSpam=function(){var a=this.folderList().spamFolderFullName();this.folderList().currentFolderFullName()!==a&&cc.MailCache.moveMessagesToFolder(a,this.collectionCheckedUids())},wb.prototype.executeNotSpam=function(){var a=this.folderList().inboxFolder();a&&this.folderList().currentFolderFullName()!==a.fullName()&&cc.MailCache.moveMessagesToFolder(a.fullName(),this.collectionCheckedUids())},wb.prototype.fillAdvancedSearch=function(a){a&&(this.searchInputFrom(""),this.searchInputTo(""),this.searchInputSubject(""),this.searchInputText(""),this.bAdvancedSearch(!0))},xb.prototype.resizeDblClick=function(b,c){c.preventDefault(),c.stopPropagation?c.stopPropagation():c.cancelBubble=!0,ac.removeSelection(),this.jqPanelHelper||(this.jqPanelHelper=a(".MailLayout .panel_helper")),this.jqPanelHelper.trigger("resize",[295,"min"])},xb.prototype.notifySender=function(){this.currentMessage()&&""!==this.currentMessage().readingConfirmation()&&(cc.Ajax.send({Action:"MessageSendConfirmation",Confirmation:this.currentMessage().readingConfirmation(),Subject:ac.i18n("MESSAGE/RETURN_RECEIPT_MAIL_SUBJECT"),Text:ac.i18n("MESSAGE/RETURN_RECEIPT_MAIL_TEXT",{EMAIL:this.fullFrom(),SUBJECT:this.subject()}),ConfirmFolder:this.currentMessage().folder(),ConfirmUid:this.currentMessage().uid()}),this.currentMessage().readingConfirmation(""))},xb.prototype.viewAllMailsWithContact=function(){var a=this.fromEmail();this.hasFromContact()&&(a=this.fromContact().getEmailsString()),ec.SingleMode&&b.opener&&b.opener.App?(b.opener.App.MailCache.searchMessagesInCurrentFolder("email:"+a),b.opener.focus(),b.close()):cc.MailCache.searchMessagesInCurrentFolder("email:"+a)},xb.prototype.onMessagesSubscribe=function(){!this.currentMessage()&&this.uid().length>0&&(ac.log("onMessagesSubscribe"),cc.MailCache.setCurrentMessage(this.uid(),this.folder()))},xb.prototype.onFromContactResponse=function(a){a?(this.fromContact(a),this.fromExistsInContacts(!0)):(this.fromContact(new Z),this.fromExistsInContacts(!1)),this.fromContactInfoReceived(!0)},xb.prototype.onCurrentMessageSubscribe=function(){var b=this.currentMessage(),c="",d="",e="",f=[],g=b?ec.Accounts.getAccount(b.accountId()):null;this.replyText(""),this.replyDraftUid(""),this.replyCc(""),this.replyBcc(""),b&&this.uid()===b.uid()?(this.subject(b.subject()),this.from(b.oFrom.getDisplay()),this.fromEmail(b.oFrom.getFirstEmail()),this.fromName(b.oFrom.getFirstName()),this.fromContactInfoReceived(!1),b.completelyFilled()&&this.fromEmail()&&""!==this.fromEmail()&&cc.ContactsCache.getContactByEmail(this.fromEmail(),this.onFromContactResponse,this),this.fullFrom(b.oFrom.getFull()),this.to(b.oTo.getFull()),this.cc(b.oCc.getFull()),this.bcc(b.oBcc.getFull()),c=b.oTo.getDisplay(ac.i18n("MESSAGE/ME_RECIPIENT"),g.email()),d=b.oCc.getDisplay(ac.i18n("MESSAGE/ME_RECIPIENT"),g.email()),e=b.oBcc.getDisplay(ac.i18n("MESSAGE/ME_RECIPIENT"),g.email()),c.length>0&&f.push(c),d.length>0&&f.push(d),e.length>0&&f.push(e),this.allRecipients(f.join(", ")),this.midDate(b.oDateModel.getMidDate()),this.fullDate(b.oDateModel.getFullDate()),this.isLoading(""!==b.uid()&&!b.completelyFilled()),this.setMessageBody(),this.rtlMessage(b.rtl()),this.attachments(b.attachments()),null!==this.ical()&&this.ical().animation(!1),this.ical(b.ical()),null!==this.ical()&&_.defer(_.bind(function(){this.ical().animation(!0)},this)),this.vcard(b.vcard()),b.completelyFilled()?b.completelyFilledSubscription?(b.completelyFilledSubscription.dispose(),b.completelyFilledSubscription=void 0):b.completelyFilledSingleModeSubscription&&(b.completelyFilledSingleModeSubscription.dispose(),b.completelyFilledSingleModeSubscription=void 0):this.singleMode()?b.completelyFilledSingleModeSubscription=b.completelyFilled.subscribe(this.onCurrentMessageSubscribe,this):b.completelyFilledSubscription=b.completelyFilled.subscribe(this.onCurrentMessageSubscribe,this)):(this.isLoading(!1),a(this.domTextBody()).empty(),this.rtlMessage(!1),this.attachments([]),this.visiblePicturesControl(!1),this.visibleShowPicturesLink(!1),this.ical(null),this.vcard(null))},xb.prototype.setMessageBody=function(){if(this.currentMessage()){var b=this.currentMessage(),c=b.text(),d=c.length,e=5e6,f=a(this.domTextBody());this.textBody(c),_.defer(_.bind(function(){var a=this.currentMessage();f.empty(),a.isPlain()||d>e?f.html(c):(f.append(a.getDomText().html()),this.visiblePicturesControl(a.hasExternals()&&!a.isExternalsAlwaysShown()),this.visibleShowPicturesLink(!a.isExternalsShown()),this.doHidingBlockquotes())},this))}},xb.prototype.doHidingBlockquotes=function(){var b=120,c=80;a(a("blockquote",a(this.domTextBody())).get().reverse()).each(function(){var d=a(this),e=d.parents("blockquote"),f=a('<span class="blockquote_toggle"></span>').html(ac.i18n("MESSAGE/SHOW_QUOTED_TEXT")),g=!0;0===e.length&&d.height()>b&&(d.addClass("blockquote_before_toggle").after(f).wrapInner('<div class="blockquote_content"></div>'),f.bind("click",function(){g?(d.height("auto"),f.html(ac.i18n("MESSAGE/HIDE_QUOTED_TEXT")),g=!1):(d.height(c),f.html(ac.i18n("MESSAGE/SHOW_QUOTED_TEXT")),g=!0),d.toggleClass("collapsed",g)}),d.height(c).toggleClass("collapsed",g))})},xb.prototype.onRoute=function(a){var b=cc.Links.parseMailbox(a);this.uid(b.Uid),this.folder(b.Folder),ac.log("onRoute"),cc.MailCache.setCurrentMessage(this.uid(),this.folder()),this.contentHasFocus(!0)},xb.prototype.showPictures=function(){cc.MailCache.showExternalPictures(!1),this.visibleShowPicturesLink(!1),this.setMessageBody()},xb.prototype.alwaysShowPictures=function(){var a=this.currentMessage()?this.currentMessage().oFrom.getFirstEmail():"";a.length>0&&cc.Ajax.send({Action:"EmailSafety",Email:a}),cc.MailCache.showExternalPictures(!0),this.visiblePicturesControl(!1),this.setMessageBody()},xb.prototype.showDetails=function(){this.detailsVisible(!0)},xb.prototype.hideDetails=function(){this.detailsVisible(!1)},xb.prototype.toggleDownloadMenu=function(){this.downloadMenuExpanded(!this.downloadMenuExpanded())},xb.prototype.openInNewWindow=function(){var a=cc.MailCache.folderList().currentFolder(),b=a.type()===_b.FolderTypes.Drafts;ac.WindowOpener.openMessage(this.currentMessage(),b)},xb.prototype.addToContacts=function(){cc.ContactsCache.addToContacts(this.fromName(),this.fromEmail(),this.onAddToContactsResponse,this)},xb.prototype.onAddToContactsResponse=function(a,b){a.Result&&""!==b.HomeEmail&&b.HomeEmail===this.fromEmail()&&(cc.Api.showReport(ac.i18n("CONTACTS/REPORT_CONTACT_SUCCESSFULLY_ADDED")),cc.ContactsCache.clearInfoAboutEmail(this.fromEmail()),cc.ContactsCache.getContactByEmail(this.fromEmail(),this.onFromContactResponse,this))},xb.prototype.executePrevMessage=function(){},xb.prototype.executeNextMessage=function(){},xb.prototype.executeReplyOrResend=function(a){this.currentMessage()&&(cc.MessageSender.setReplyData(this.replyHtmlText(),this.replyDraftUid(),this.replyCc(),this.replyBcc()),this.replyText(""),this.replyDraftUid(""),this.replyCc(""),this.replyBcc(""),cc.Routing.setHash(cc.Links.composeFromMessage(a,this.currentMessage().folder(),this.currentMessage().uid())))},xb.prototype.executeReplyOrForward=function(a){this.currentMessage()&&(cc.MessageSender.setReplyData(this.replyHtmlText(),this.replyDraftUid()),this.replyText(""),this.replyDraftUid(""),cc.Routing.setHash(cc.Links.composeFromMessage(a,this.currentMessage().folder(),this.currentMessage().uid())))},xb.prototype.executeReply=function(){this.executeReplyOrForward(_b.ReplyType.Reply)},xb.prototype.executeReplyAll=function(){this.executeReplyOrForward(_b.ReplyType.ReplyAll)},xb.prototype.executeResend=function(){this.executeReplyOrResend(_b.ReplyType.Resend)},xb.prototype.executeForward=function(){this.executeReplyOrForward(_b.ReplyType.Forward)},xb.prototype.executePrint=function(){var b=ac.WindowOpener.open("",this.subject()+"-print"),c=this.currentMessage().getDomText(ac.getAppPath()),d="";this.textBodyForNewWindow(c.html()),d=a(this.domMessageForPrint()).html(),a(b.document.body).html(d),b.print()},xb.prototype.executeSave=function(){this.currentMessage()&&cc.downloadByUrl(this.currentMessage().downloadLink())},xb.prototype.changeAddMenuVisibility=function(){var a=!this.visibleAddMenu();this.visibleAddMenu(a)},xb.prototype.onMessageSendOrSaveResponse=function(a,b){var c=cc.MessageSender.onMessageSendOrSaveResponse(a,b);switch(c.Action){case"MessageSend":this.replySendingStarted(!1),c.Result&&this.replyText("");break;case"MessageSave":this.replySavingStarted(!1),c.Result&&this.replyDraftUid(c.NewUid)}},xb.prototype.sendReplyMessage=function(){""!==this.replyText()&&(this.replySendingStarted(!0),cc.MessageSender.sendReplyMessage("MessageSend",this.replyHtmlText(),this.replyDraftUid(),this.onMessageSendOrSaveResponse,this),this.replyTextFocus(!1))},xb.prototype.saveReplyMessage=function(){""!==this.replyText()&&(this.replySavingStarted(!0),cc.MessageSender.sendReplyMessage("MessageSave",this.replyHtmlText(),this.replyDraftUid(),this.onMessageSendOrSaveResponse,this))},xb.prototype.downloadAllAttachments=function(){this.currentMessage()&&this.currentMessage().downloadAllAttachments()},xb.prototype.saveAttachmentsToFiles=function(){this.currentMessage()&&this.currentMessage().saveAttachmentsToFiles()},xb.prototype.downloadAllAttachmentsSeparately=function(){this.currentMessage()&&this.currentMessage().downloadAllAttachmentsSeparately()},xb.prototype.onApplyBindings=function(b){a(b).on("mousedown","a",function(b){if(b&&3!==b.which){var c=a(this).attr("href");if(c&&"mailto:"===c.toString().toLowerCase().substr(0,7))return cc.Api.openComposeMessage(c.toString().substr(7)),!1}return!0})},yb.prototype.resizeDblClick=function(b,c){c.preventDefault(),c.stopPropagation?c.stopPropagation():c.cancelBubble=!0,ac.removeSelection(),this.jqPanelHelper||(this.jqPanelHelper=a(".MailLayout .panel_helper")),this.jqPanelHelper.trigger("resize",[600,"max"])},yb.prototype.onRoute=function(a){this.oMessageList.onRoute(a),this.oMessagePane.onRoute(a)},yb.prototype.onShow=function(){this.oMessageList.selector.useKeyboardKeys(!0)},yb.prototype.onHide=function(){this.oMessageList.selector.useKeyboardKeys(!1)},yb.prototype.onApplyBindings=function(){var b=this;this.oMessageList.onApplyBindings(this.$viewModel),this.oMessagePane.onApplyBindings(this.$viewModel),a(this.domFolderList()).on("click","span.folder",function(){b.oMessageList.executeMoveToFolder(a(this).data("folder"))})},yb.prototype.getThreadCheckedUidsFromList=function(a){var b=cc.MailCache.folderList().currentFolder(),c=[];return _.each(a,function(a){a.threadCount()>0&&!a.threadOpened()&&_.each(a.threadUids(),function(a){var d=b.oMessages[a];d&&d.checked()&&c.push(a)})}),c},yb.prototype.dragAndDropHelper=function(b){b&&b.checked(!0);var c=this.oMessageList.selector.itemSelected(),d=ac.draggableMessages(),e=this.selectedUids(),f=e.length;return 0===e.length&&c&&(e=[c.uid()],f=1),d.data("p7-message-list-folder",this.folderList().currentFolderFullName()),d.data("p7-message-list-uids",e),a(".count-text",d).text(ac.i18n("MAILBOX/DRAG_TEXT_PLURAL",{COUNT:f},null,f)),d},yb.prototype.messagesDrop=function(a,b,c){if(a){var d=c&&c.helper?c.helper:null,e=d?d.data("p7-message-list-folder"):"",f=d?d.data("p7-message-list-uids"):null;""!==e&&null!==f&&(ac.uiDropHelperAnim(b,c),this.oMessageList.executeMoveToFolder(a.fullName()))}},yb.prototype.searchFocus=function(){this.oMessageList.selector.useKeyboardKeys()&&!ac.isTextFieldFocused()&&this.oMessageList.isFocused(!0)},zb.prototype.__name="CComposeViewModel",zb.prototype.isEnableSending=function(){var a=0===this.toAddr().length&&0===this.ccAddr().length&&0===this.bccAddr().length,b=0!==this.folderList().iAccountId;return b&&!this.sending()&&!a&&this.allAttachmentsUploaded()},zb.prototype.isEnableSaving=function(){var a=0!==this.folderList().iAccountId;return a&&!this.sending()&&!this.saving()},zb.prototype.onApplyBindings=function(){var b=_.bind(function(a,b){this.autocompleteCallback(a.term,b)},this);this.initUploader(),a(this.toAddrDom()).inputosaurus({width:"auto",parseOnBlur:!0,autoCompleteSource:b,change:_.bind(function(a){this.lockToAddr(!0),this.toAddr(a.target.value),this.lockToAddr(!1)},this),copy:_.bind(function(a){this.inputosaurusBuffer=a},this),paste:_.bind(function(){var a=this.inputosaurusBuffer||"";return this.inputosaurusBuffer="",a},this),mobileDevice:jc}),a(this.ccAddrDom()).inputosaurus({width:"auto",parseOnBlur:!0,autoCompleteSource:b,change:_.bind(function(a){this.lockCcAddr(!0),this.ccAddr(a.target.value),this.lockCcAddr(!1)},this),copy:_.bind(function(a){this.inputosaurusBuffer=a},this),paste:_.bind(function(){var a=this.inputosaurusBuffer||"";return this.inputosaurusBuffer="",a},this),mobileDevice:jc}),a(this.bccAddrDom()).inputosaurus({width:"auto",parseOnBlur:!0,autoCompleteSource:b,change:_.bind(function(a){this.lockBccAddr(!0),this.bccAddr(a.target.value),this.lockBccAddr(!1)},this),copy:_.bind(function(a){this.inputosaurusBuffer=a},this),paste:_.bind(function(){var a=this.inputosaurusBuffer||"";return this.inputosaurusBuffer="",a},this),mobileDevice:jc})},zb.prototype.getMessageOnRoute=function(){var a=this.routeParams(),b="",c="";""!==this.routeType()&&3===a.length&&(b=a[1],c=a[2],cc.MailCache.getMessage(b,c,this.onMessageResponse,this)),this.routeParams([])},zb.prototype.onShow=function(){this.useSaveMailInSentItems(ec.User.getUseSaveMailInSentItems()),this.saveMailInSentItems(ec.User.getSaveMailInSentItems()),this.oHtmlEditor.initCrea(this.textBody(),"7"),this.oHtmlEditor.clearImages(),this.commitedTextBody(this.oHtmlEditor.getText()),this.shown(!0),this.startAutosaveTimer(),this.focusAfterFilling(),gc.addClass("screen-compose"),this.oJua&&this.oJua.setDragAndDropEnabledStatus(!0)},zb.prototype.onRoute=function(a){var c="",d={};switch(this.changeSenderAccountId(ec.Accounts.currentId()),this.messageUploadAttachmentsStarted(!1),this.draftUid(""),this.draftInfo.removeAll(),this.setDataFromMessage(new V),this.isDraftsCleared(!1),this.routeType(a.length>0?a[0]:""),this.routeType()){case _b.ReplyType.Reply:case _b.ReplyType.ReplyAll:case _b.ReplyType.Resend:case _b.ReplyType.Forward:case"drafts":this.routeParams(a),0!==this.folderList().iAccountId&&this.getMessageOnRoute();break;default:c=cc.MessageSender.getSignatureText(this.senderAccountId(),null),ec.SingleMode&&b.opener&&b.opener.oMessageParametersFromCompose?(this.setMessageDataInSingleMode(b.opener.oMessageParametersFromCompose),b.opener.oMessageParametersFromCompose=void 0):""!==c&&this.textBody("<br /><br />"+c),"to"===this.routeType()&&2===a.length&&(d=cc.Links.parseToAddr(a[1]),this.toAddr(d.to),d.hasMailto&&(this.subject(d.subject),this.ccAddr(d.cc),this.bccAddr(d.bcc),this.textBody(d.body))),"vcard"===this.routeType()&&2===a.length&&this.addContactAsAttachment(a[1]),"file"===this.routeType()&&2===a.length&&this.addFilesAsAttachment(a[1])}this.visibleCc(""!==this.ccAddr()),this.visibleBcc(""!==this.bccAddr()),this.commit(this.oHtmlEditor.getText()),this.focusAfterFilling()},zb.prototype.focusAfterFilling=function(){0===this.toAddr().length?this.toAddrFocused(!0):0===this.subject().length?this.subjectFocused(!0):this.oHtmlEditor.setFocus()},zb.prototype.onHide=function(){this.shown(!1),this.stopAutosaveTimer(),this.oHtmlEditor.closeAllPopups(),gc.removeClass("screen-compose"),this.oJua&&this.oJua.setDragAndDropEnabledStatus(!1)},zb.prototype.sendingAndSavingSubscription=function(){(this.sending()||this.saving())&&this.stopAutosaveTimer(),this.sending()||this.saving()||this.startAutosaveTimer()},zb.prototype.stopAutosaveTimer=function(){b.clearTimeout(this.autoSaveTimer)},zb.prototype.startAutosaveTimer=function(){if(this.shown()){var a=_.bind(this.executeSave,this,!0);this.stopAutosaveTimer(),ec.App.AutoSave&&(this.autoSaveTimer=b.setTimeout(a,15e3))}},zb.prototype.onMessageResponse=function(a){var b=null,c=null;if(null===a)this.setDataFromMessage(new V);else{switch(this.routeType()){case _b.ReplyType.Reply:case _b.ReplyType.ReplyAll:case _b.ReplyType.Resend:c=cc.MessageSender.getFetcherOrIdentityByRecipients(a.oTo.aCollection,a.accountId()),c&&this.selectedFetcherOrIdentity(c),b=cc.MessageSender.getReplyDataFromMessage(a,this.routeType(),this.senderAccountId(),c),this.draftInfo(b.DraftInfo),this.draftUid(b.DraftUid),this.toAddr(b.To),this.ccAddr(b.Cc),this.bccAddr(b.Bcc),this.subject(b.Subject),this.textBody(b.Text),this.attachments(b.Attachments),this.inReplyTo(b.InReplyTo),this.references(b.References);break;case _b.ReplyType.Forward:c=cc.MessageSender.getFetcherOrIdentityByRecipients(a.oTo.aCollection,a.accountId()),c&&this.selectedFetcherOrIdentity(c),b=cc.MessageSender.getReplyDataFromMessage(a,this.routeType(),this.senderAccountId(),c),this.draftInfo(b.DraftInfo),this.draftUid(b.DraftUid),this.toAddr(b.To),this.ccAddr(b.Cc),this.subject(b.Subject),this.textBody(b.Text),this.attachments(b.Attachments),this.inReplyTo(b.InReplyTo),this.references(b.References);break;case"drafts":this.draftUid(a.uid()),this.setDataFromMessage(a)}this.routeType("")}this.attachments().length>0&&this.requestAttachmentsTempName(),this.visibleCc(""!==this.ccAddr()),this.visibleBcc(""!==this.bccAddr()),this.commit(this.oHtmlEditor.getText()),this.focusAfterFilling()},zb.prototype.changeSenderAccountId=function(a,b,c){ec.Accounts.hasAccountWithId(a)?this.senderAccountId(a):ec.Accounts.hasAccountWithId(this.senderAccountId())||this.senderAccountId(ec.Accounts.currentId()),this.fillSenderList(b,c)},zb.prototype.fillSenderList=function(a,b){var c=[],d=ec.Accounts.getAccount(this.senderAccountId());d&&(c.push({fullEmail:d.fullEmail(),id:""}),d.fetchers()?_.each(d.fetchers().collection(),function(a){var b=a.fullEmail();a.isOutgoingEnabled()&&b.length>0&&c.push({fullEmail:b,id:"fetcher"+a.id()})},this):d.fetchersSubscribtion||(d.fetchersSubscribtion=d.fetchers.subscribe(function(){this.fillSenderList(a,b)},this)),_.isArray(d.identities())?_.each(d.identities(),function(a){a.enabled()&&c.push({fullEmail:a.fullEmail(),id:ac.pString(a.id())})},this):d.identitiesSubscribtion||(d.identitiesSubscribtion=d.identities.subscribe(function(){this.fillSenderList(a,b)},this))),this.senderList(c.length>0?c:[]),a&&""!==a?this.changeSelectedSenderByEmail(a):this.selectedFetcherOrIdentity(b||null)},zb.prototype.changeSelectedSenderByEmail=function(a){var b=ec.Accounts.getAccount(this.senderAccountId()),c=b?b.getFetcherOrIdentityByEmail(a):null;c&&c.id()&&this.selectedFetcherOrIdentity(c)},zb.prototype.changeSignature=function(){var a="",b=ec.Accounts.getAccount(this.senderAccountId()),c=this.selectedFetcherOrIdentity();b&&(a=c&&c.accountId()===b.id()?c.signature():b.signature()&&b.signature().options()?b.signature().signature():"",this.oHtmlEditor.changeSignatureContent(a))},zb.prototype.setDataFromMessage=function(a){var b=a.getDomText().html();this.draftInfo(a.draftInfo()),this.inReplyTo(a.inReplyTo()),this.references(a.references()),this.toAddr(a.oTo.getFull()),this.ccAddr(a.oCc.getFull()),this.bccAddr(a.oBcc.getFull()),this.subject(a.subject()),this.attachments(a.attachments()),this.textBody(b?b:a.text()),this.selectedImportance(a.importance()),this.selectedSensitivity(a.sensitivity()),this.readingConfirmation(a.readingConfirmation()),this.changeSenderAccountId(a.accountId(),a.oFrom.getFirstEmail())},zb.prototype.addFilesAsAttachment=function(a){var b=null,c=[],d=null;_.each(a,function(a){b=new S,b.fileName(a.fileName()),b.hash(a.hash()),b.uploadStarted(!0),this.attachments.push(b),c.push(a.hash())
},this),c.length>0&&(d={Action:"FilesUpload",Hashes:c},this.messageUploadAttachmentsStarted(!0),cc.Ajax.send(d,this.onFilesUpload,this))},zb.prototype.onFilesUpload=function(b,c){var d=b.Result,e=c.Hashes;this.messageUploadAttachmentsStarted(!1),a.isArray(d)?_.each(d,function(a){var c=_.find(this.attachments(),function(b){return b.hash()===a.Hash});c&&(c.parseFromContact(a,b.AccountID),c.hash(a.NewHash))},this):_.each(e,function(a){var b=_.find(this.attachments(),function(b){return b.hash()===a});b&&b.errorFromContact()},this)},zb.prototype.addContactAsAttachment=function(a){var b=new S,c=null;a&&(b.fileName("contact-"+a.idContact()+".vcf"),b.uploadStarted(!0),this.attachments.push(b),c={Action:"ContactVCardUpload",ContactId:a.idContact(),Global:a.global()?"1":"0",Name:b.fileName()},this.messageUploadAttachmentsStarted(!0),cc.Ajax.send(c,this.onContactVCardUpload,this))},zb.prototype.onContactVCardUpload=function(a,b){var c=a.Result,d=null;this.messageUploadAttachmentsStarted(!1),c?(d=_.find(this.attachments(),function(a){return a.fileName()===c.Name&&a.uploadStarted()}),d&&d.parseFromContact(c,a.AccountID)):(d=_.find(this.attachments(),function(a){return a.fileName()===b.Name&&a.uploadStarted()}),d&&d.errorFromContact())},zb.prototype.requestAttachmentsTempName=function(){var a=_.map(this.attachments(),function(a){return a.uploadStarted(!0),a.hash()}),b={Action:"MessageUploadAttachments",Attachments:a};a.length>0&&(this.messageUploadAttachmentsStarted(!0),cc.Ajax.send(b,this.onMessageUploadAttachmentsResponse,this))},zb.prototype.onMessageUploadAttachmentsResponse=function(a){this.messageUploadAttachmentsStarted(!1),a.Result&&_.each(a.Result,_.bind(this.setAttachTepmNameByHash,this))},zb.prototype.setAttachTepmNameByHash=function(a,b){_.each(this.attachments(),function(c){c.hash()===a&&(c.tempName(b),c.uploadStarted(!1))})},zb.prototype.setMessageDataInSingleMode=function(a){this.draftInfo(a.draftInfo),this.draftUid(a.draftUid),this.inReplyTo(a.inReplyTo),this.references(a.references),this.toAddr(a.toAddr),this.ccAddr(a.ccAddr),this.bccAddr(a.bccAddr),this.subject(a.subject),this.attachments(_.map(a.attachments,function(a){var b=new S;return b.parse(a,this.senderAccountId()),b},this)),this.textBody(a.textBody),this.selectedImportance(a.selectedImportance),this.selectedSensitivity(a.selectedSensitivity),this.readingConfirmation(a.readingConfirmation),this.changeSenderAccountId(a.senderAccountId,"",a.selectedFetcherOrIdentity)},zb.prototype.isEmpty=function(){var a=ac.trim(this.toAddr()),b=ac.trim(this.ccAddr()),c=ac.trim(this.bccAddr()),d=ac.trim(this.subject()),e=this.oHtmlEditor.getText(),f=ac.trim(e.replace(/<br *\/{0,1}>/gi,"\n").replace(/<[^>]*>/g,"").replace(/&nbsp;/g," "));return""===a&&""===b&&""===c&&""===d&&0===this.attachments().length&&""===f},zb.prototype.commit=function(a){this.toAddr.commit(),this.ccAddr.commit(),this.bccAddr.commit(),this.subject.commit(),this.commitedTextBody(a),this.attachmentsChanged(!1)},zb.prototype.isChanged=function(){return this.toAddr.changed()||this.ccAddr.changed()||this.bccAddr.changed()||this.subject.changed()||this.commitedTextBody()!==this.oHtmlEditor.getText()||this.attachmentsChanged()},zb.prototype.executeBackToList=function(){this.isChanged()&&!this.isEmpty()&&this.executeSave(!0),ec.SingleMode?b.close():this.shown()&&cc.Routing.setPreviousHash()},zb.prototype.onFileUploadSelect=function(a,b){var c,d=ac.i18n("COMPOSE/UPLOAD_ERROR_FILENAME_SIZE",{FILENAME:b.FileName});return ec.App.AttachmentSizeLimit>0&&b.Size>ec.App.AttachmentSizeLimit?(cc.Screens.showPopup(s,[d]),!1):(c=new S,c.onUploadSelect(a,b),this.attachments.push(c),this.attachmentsChanged(!0),!0)},zb.prototype.getAttachmentByUid=function(a){return _.find(this.attachments(),function(b){return b.uploadUid()===a})},zb.prototype.onFileUploadStart=function(a){var b=this.getAttachmentByUid(a);b&&b.onUploadStart()},zb.prototype.onFileUploadProgress=function(a,b,c){var d=this.getAttachmentByUid(a);d&&d.onUploadProgress(b,c)},zb.prototype.onFileUploadComplete=function(a,b,c){var d=this.getAttachmentByUid(a);d&&d.onUploadComplete(a,b,c)},zb.prototype.onFileRemove=function(a){var b=this.getAttachmentByUid(a);this.oJua&&this.oJua.cancel(a),this.attachments.remove(b),this.attachmentsChanged(!0)},zb.prototype.initUploader=function(){this.composeUploaderButton()&&(this.oJua=new Jua({action:"?/Upload/Attachment/",name:"jua-uploader",queueSize:2,clickElement:this.composeUploaderButton(),dragAndDropElement:this.composeUploaderDropPlace(),disableAjaxUpload:!1,disableFolderDragAndDrop:!1,disableDragAndDrop:!1,hidden:{Token:function(){return ec.Token},AccountID:function(){return ec.Accounts.currentId()}}}),this.oJua.on("onDragEnter",_.bind(this.composeUploaderDragOver,this,!0)).on("onDragLeave",_.bind(this.composeUploaderDragOver,this,!1)).on("onBodyDragEnter",_.bind(this.composeUploaderBodyDragOver,this,!0)).on("onBodyDragLeave",_.bind(this.composeUploaderBodyDragOver,this,!1)).on("onProgress",_.bind(this.onFileUploadProgress,this)).on("onSelect",_.bind(this.onFileUploadSelect,this)).on("onStart",_.bind(this.onFileUploadStart,this)).on("onComplete",_.bind(this.onFileUploadComplete,this)),this.allowDragNDrop(this.oJua.isDragAndDropSupported()))},zb.prototype.getSendSaveParameters=function(a){var b=cc.MessageSender.convertAttachmentsForSending(this.attachments());return _.each(this.oHtmlEditor.uploadedImagePathes(),function(a){b[a.TempName]=[a.Name,a.CID,"1","1"]}),{AccountID:this.senderAccountId(),FetcherID:this.selectedFetcherOrIdentity()&&this.selectedFetcherOrIdentity().FETCHER?this.selectedFetcherOrIdentity().id():"",IdentityID:this.selectedFetcherOrIdentity()&&!this.selectedFetcherOrIdentity().FETCHER?this.selectedFetcherOrIdentity().id():"",DraftInfo:this.draftInfo(),DraftUid:this.draftUid(),To:this.toAddr(),Cc:this.ccAddr(),Bcc:this.bccAddr(),Subject:this.subject(),Text:this.oHtmlEditor.getText(a),Importance:this.selectedImportance(),Sensivity:this.selectedSensitivity(),ReadingConfirmation:this.readingConfirmation()?"1":"0",Attachments:b,InReplyTo:this.inReplyTo(),References:this.references()}},zb.prototype.onMessageSendOrSaveResponse=function(a,b){var c=cc.MessageSender.onMessageSendOrSaveResponse(a,b);switch(this.commit(b.Text),c.Action){case"MessageSave":c.Result&&c.NewUid&&this.draftUid(c.NewUid),this.saving(!1);break;case"MessageSend":c.Result&&(cc.MailCache.deletedDraftMessageUid(this.draftUid()),this.executeBackToList()),this.sending(!1)}},zb.prototype.verifyDataForSending=function(){var a=ac.getIncorrectEmailsFromAddressString(this.toAddr()),b=ac.getIncorrectEmailsFromAddressString(this.ccAddr()),c=ac.getIncorrectEmailsFromAddressString(this.bccAddr()),d=_.union(a,b,c),e=ac.i18n("COMPOSE/WARNING_INPUT_CORRECT_EMAILS")+d.join(", ");return d.length>0?(cc.Screens.showPopup(s,[e]),!1):!0},zb.prototype.executeSend=function(){this.isEnableSending()&&this.verifyDataForSending()&&(this.sending(!0),this.requiresPostponedSending(!this.allowStartSending()),cc.MessageSender.send("MessageSend",this.getSendSaveParameters(!0),this.saveMailInSentItems(),!0,this.onMessageSendOrSaveResponse,this,this.requiresPostponedSending()))},zb.prototype.executeSaveCommand=function(){this.executeSave(!1)},zb.prototype.executeSave=function(a){this.isEnableSaving()&&(!a||this.isChanged()?(this.saving(!0),cc.MessageSender.send("MessageSave",this.getSendSaveParameters(!1),this.saveMailInSentItems(),!a,this.onMessageSendOrSaveResponse,this)):a&&this.startAutosaveTimer())},zb.prototype.changeBccVisibility=function(){this.visibleBcc(!this.visibleBcc()),this.visibleBcc()?this.bccAddrFocused(!0):this.toAddrFocused(!0)},zb.prototype.changeCcVisibility=function(){this.visibleCc(!this.visibleCc()),this.visibleCc()?this.ccAddrFocused(!0):this.toAddrFocused(!0)},zb.prototype.getMessageDataForSingleMode=function(){var a=_.map(this.attachments(),function(a){return{"@Object":"Object/CApiMailAttachment",FileName:a.fileName(),TempName:a.tempName(),MimeType:a.type(),MimePartIndex:a.mimePartIndex(),EstimatedSize:a.size(),CID:a.cid(),IsInline:a.inline(),IsLinked:a.linked(),Hash:a.hash()}});return{draftInfo:this.draftInfo(),draftUid:this.draftUid(),inReplyTo:this.inReplyTo(),references:this.references(),senderAccountId:this.senderAccountId(),selectedFetcherOrIdentity:this.selectedFetcherOrIdentity(),toAddr:this.toAddr(),ccAddr:this.ccAddr(),bccAddr:this.bccAddr(),subject:this.subject(),attachments:a,textBody:this.oHtmlEditor.getText(),selectedImportance:this.selectedImportance(),selectedSensitivity:this.selectedSensitivity(),readingConfirmation:this.readingConfirmation()}},zb.prototype.openInNewWindow=function(){b.oMessageParametersFromCompose=this.getMessageDataForSingleMode(),ac.WindowOpener.openTab("#"+_b.Screens.SingleCompose),this.commit(this.oHtmlEditor.getText()),this.executeBackToList()},zb.prototype.computeHeight=function(){var b=this.messageForm(),c=this.messageFields();b&&c&&_.defer(function(){var d=a(c).outerHeight();a(b).css({"padding-top":d,"margin-top":-d})})},zb.prototype.autocompleteCallback=function(a,b){var c={Action:"ContactSuggestions",Search:a};a=ac.trim(a),""!==a?cc.Ajax.send(c,function(a){var c=[];a&&a.Result&&a.Result&&a.Result.List&&(c=_.map(a.Result.List,function(a){var b="",c=a.Email;return a.IsGroup?b=a.Name&&0<ac.trim(a.Name).length?'"'+a.Name+'" ('+a.Email+")":"("+a.Email+")":a.Name&&0<ac.trim(a.Name).length?(b='"'+a.Name+'" <'+a.Email+">",c=b):b=a.Email,{label:b,value:c}}),c=_.compact(c)),b(c)},this):b([])},Ab.prototype.onFileImportStart=function(){this.importing(!0)},Ab.prototype.onFileImportComplete=function(a,b,c){if(this.importing(!1),this.oParent.requestContactList(),b&&c&&c.Result){var d=ac.pInt(c.Result.ImportedCount);d>0?cc.Api.showReport(ac.i18n("CONTACTS/CONTACT_IMPORT_HINT_PLURAL",{NUM:d},null,d)):cc.Api.showError(ac.i18n("WARNING/CONTACTS_IMPORT_NO_CONTACTS"))}else cc.Api.showError(ac.i18n("WARNING/CONTACTS_IMPORT_ERROR"))},Ab.prototype.onApplyBindings=function(b){this.oJua=new Jua({action:"?/Upload/Contacts/",name:"jua-uploader",queueSize:1,clickElement:a("#jue_import_button",b),disableAjaxUpload:!1,disableDragAndDrop:!0,disableMultiple:!0,hidden:{Token:function(){return ec.Token},AccountID:function(){return ec.Accounts.currentId()}}}),this.oJua.on("onStart",_.bind(this.onFileImportStart,this)).on("onComplete",_.bind(this.onFileImportComplete,this))},Bb.prototype.executeSave=function(a){var b={},c=[];a===this.selectedItem()&&(a instanceof Z&&!a.readOnly()?(_.each(this.groupFullCollection(),function(a){a&&a.checked()&&c.push(a.Id())}),a.groups(c),b=a.toObject(),b.Action=a.isNew()?"ContactCreate":"ContactUpdate",a.edited()&&a.edited(!1),a.isNew()&&this.selectedItem(null),cc.Ajax.send(b,this.onContactCreateResponse,this)):a instanceof $&&!a.readOnly()&&(b=a.toObject(),b.Action=a.isNew()?"GroupCreate":"GroupUpdate",a.edited()&&a.edited(!1),a.isNew()&&this.selectedItem(null),cc.Ajax.send(b,this.onGroupCreateResponse,this)))},Bb.prototype.executeBackToList=function(){cc.Routing.setLastMailboxHash()},Bb.prototype.executeNewContact=function(){var a=this.selectedGroupInList();this.oContactModel.switchToNew(),this.oContactModel.groups(a?[a.Id()]:[]),this.selectedItem(this.oContactModel),this.selector.itemSelected(null)},Bb.prototype.executeNewGroup=function(){this.oGroupModel.switchToNew(),this.selectedItem(this.oGroupModel),this.selector.itemSelected(null)},Bb.prototype.executeDelete=function(){var a=this,b=this.selectedContact(),c=this.selector.listCheckedOrSelected(),d=_.map(c,function(a){return a.ReadOnly()?"":a.Id()});d=_.compact(d),0<d.length&&(_.each(c,function(a){a&&(cc.ContactsCache.clearInfoAboutEmail(a.Email()),!b||a.IsGroup()||a.ReadOnly()||b.readOnly()||b.idContact()!==a.Id()||(b=null,this.selectedContact(null)))},this),_.each(this.collection(),function(a){-1<ac.inArray(a,c)&&a.deleted(!0)}),_.delay(function(){a.collection.remove(function(a){return a.deleted()})},500),cc.Ajax.send({Action:"ContactDelete",ContactsId:d.join(",")},this.requestContactList,this),cc.ContactsCache.markVcardsNonexistent(d))},Bb.prototype.executeRemoveFromGroup=function(){var a=this,b=this.selectedGroupInList(),c=this.selector.listCheckedOrSelected(),d=_.map(c,function(a){return a.ReadOnly()?"":a.Id()});d=_.compact(d),b&&0<d.length&&(_.each(this.collection(),function(a){-1<ac.inArray(a,c)&&a.deleted(!0)}),_.delay(function(){a.collection.remove(function(a){return a.deleted()})},500),cc.Ajax.send({Action:"RemoveContactsFromGroup",GroupId:b.Id(),ContactsId:d.join(",")},this.requestContactList,this))},Bb.prototype.executeImport=function(){this.selectedItem(null),this.oContactImportViewModel.visibility(!0),this.selector.itemSelected(null),this.selectedGroupType(_b.ContactsGroupListType.Personal)},Bb.prototype.executeExport=function(){cc.downloadByUrl(ac.getExportContactsLink())},Bb.prototype.executeCancel=function(){var a=this.selectedItem();a&&(a instanceof Z&&!a.readOnly()?a.isNew()?this.selectedItem(null):a.edited()&&a.edited(!1):a instanceof $&&!a.readOnly()&&(a.isNew()?this.selectedItem(null):a.edited()&&a.edited(!1))),this.oContactImportViewModel.visibility(!1)},Bb.prototype.executeAddContactsToGroup=function(a,b,c){a&&_.isArray(b)&&0<b.length&&(a.recivedAnim(!0),cc.Ajax.send({Action:"AddContactsToGroup",Global:c?"1":"0",GroupId:a.Id(),ContactsId:b.join(",")},this.requestContactList,this))},Bb.prototype.executeAddContactsToGroupId=function(a,b,c){a&&_.isArray(b)&&0<b.length&&cc.Ajax.send({Action:"AddContactsToGroup",Global:c?"1":"0",GroupId:a,ContactsId:b.join(",")},this.requestContactList,this)},Bb.prototype.executeAddSelectedContactsToGroup=function(a){var b=!1,c=this.selector.listCheckedOrSelected(),d=[];a&&_.isArray(c)&&0<c.length&&_.each(c,function(a){a&&!a.IsGroup()&&(b=a.Global(),d.push(a.Id()))},this),this.executeAddContactsToGroup(a,d,b)},Bb.prototype.groupsInContactView=function(a){var b=[],c=[];return a&&!a.groupsIsEmpty()&&(c=a.groups(),b=_.filter(this.groupFullCollection(),function(a){return 0<=ac.inArray(a.Id(),c)})),b},Bb.prototype.isEnableAddContacts=function(){return 0<this.selector.listCheckedOrSelected().length},Bb.prototype.isEnableRemoveContactsFromGroup=function(){return 0<this.selector.listCheckedOrSelected().length},Bb.prototype.isEnableDeleting=function(){return 0<this.selector.listCheckedOrSelected().length},Bb.prototype.onShow=function(){this.selector.useKeyboardKeys(!0),this.oPageSwitcher.perPage(ec.User.ContactsPerPage),this.oPageSwitcher.currentPage(1),this.requestContactList()},Bb.prototype.onHide=function(){this.selector.listCheckedOrSelected(!1),this.selector.useKeyboardKeys(!1),this.selectedItem(null)},Bb.prototype.onApplyBindings=function(){this.selector.initOnApplyBindings(".contact_sub_list .item",".contact_sub_list .selected.item",".contact_sub_list .item .custom_checkbox",a(".contact_list",this.$viewModel),a(".contact_list .scroll-inner",this.$viewModel));var b=this,d=!1;this.$viewModel.on("click",".content .item.add_to .dropdown_helper .item",function(){a(this).hasClass("new-group")?b.executeNewGroup():b.executeAddSelectedContactsToGroup(c.dataFor(this))}),this.showPersonalContacts(!!ec.User.ShowPersonalContacts),this.showGlobalContacts(!!ec.User.ShowGlobalContacts),this.selectedGroupType.valueHasMutated(),this.oContactImportViewModel.onApplyBindings(this.$viewModel),this.requestGroupFullList(),a(document).on("keyup",function(a){var c=a.keyCode,e=b.collection()[0],f=b.isSearchFocused(),g=!1;a&&c===_b.Key.s?b.searchFocus():e&&(g=e.selected(),e&&f&&a&&c===_b.Key.Down?(b.isSearchFocused(!1),b.selector.itemSelected(e),d=!0):!f&&d&&g&&a&&c===_b.Key.Up?(b.isSearchFocused(!0),b.selector.itemSelected(!1),d=!1):g?d=!0:g||(d=!1))})},Bb.prototype.requestContactList=function(){this.loadingList(!0),cc.Ajax.send({Action:_b.ContactsGroupListType.Global===this.selectedGroupType()?"GlobalContactList":"ContactList",Offset:(this.oPageSwitcher.currentPage()-1)*ec.User.ContactsPerPage,Limit:ec.User.ContactsPerPage,SortField:this.sortType(),SortOrder:this.sortOrder()?"1":"0",Search:this.search(),GroupId:this.selectedGroupInList()?this.selectedGroupInList().Id():""},this.onContactListResponse,this)},Bb.prototype.requestGroupFullList=function(){cc.Ajax.send({Action:"GroupFullList"},this.onGroupListResponse,this)},Bb.prototype.requestContact=function(a){this.loadingViewPane(!0),a&&cc.Ajax.send({Action:a.Global()?"GlobalContact":"Contact",ContactId:a.Id()},this.onContactResponse,this)},Bb.prototype.requestContactById=function(a,b){this.loadingViewPane(!0),a&&cc.Ajax.send({Action:b?"GlobalContact":"Contact",ContactId:a},this.onContactResponse,this)},Bb.prototype.viewGroup=function(a){if(a&&a.IsGroup()){var b=_.find(this.groupFullCollection(),function(b){return b&&a&&b===a});b&&(this.oGroupModel.clear(),this.oGroupModel.idGroup(b.Id()).name(b.Name()),this.oPageSwitcher.currentPage(1),this.selectedGroupInList(b),this.selectedItem(this.oGroupModel),this.selector.itemSelected(null),this.selector.listCheckedOrSelected(!1))}},Bb.prototype.deleteGroup=function(a){a&&(cc.Ajax.send({Action:"GroupDelete",GroupId:a.idGroup()},this.requestGroupFullList,this),this.selectedGroupType(_b.ContactsGroupListType.Personal),this.groupFullCollection.remove(function(b){return b&&b.Id()===a.idGroup()}))},Bb.prototype.mailGroup=function(a){a&&cc.Ajax.send({Action:"ContactList",Offset:0,Limit:99,SortField:_b.ContactSortType.Email,SortOrder:"1",GroupId:a.idGroup()},function(a){if(a&&a.Result&&a.Result.List){var b=0,c=0,d=[],e=null,f=[],g=a.Result.List;for(c=g.length;c>b;b++)g[b]&&"Object/CContactListItem"===ac.pExport(g[b],"@Object","")&&(e=new ab,e.parse(g[b]),f.push(e));d=_.map(f,function(a){return a.EmailAndName()}),d=_.compact(d),cc.Api.openComposeMessage(d.join(", "))}},this)},Bb.prototype.dragAndDropHelper=function(b){b&&b.checked(!0);var c=this.selector.itemSelected(),d=ac.draggableMessages(),e=this.selector.listCheckedOrSelected().length,f=e>0?_.map(this.selector.listCheckedOrSelected(),function(a){return a.Id()}):[];return c&&!c.checked()&&c.checked(!0),d.data("p7-contatcs-type",this.selectedGroupType()),d.data("p7-contatcs-uids",f),a(".count-text",d).text(ac.i18n("CONTACTS/DRAG_TEXT_PLURAL",{COUNT:e},null,e)),d},Bb.prototype.contactsDrop=function(a,b,c){if(a){var d=c&&c.helper?c.helper:null,e=d?d.data("p7-contatcs-type"):null,f=d?d.data("p7-contatcs-uids"):null;null!==e&&null!==f&&(ac.uiDropHelperAnim(b,c),this.executeAddContactsToGroup(a,f,_b.ContactsGroupListType.Global===e))}},Bb.prototype.searchFocus=function(){this.selector.useKeyboardKeys()&&!ac.isTextFieldFocused()&&this.isSearchFocused(!0)},Bb.prototype.onContactDblClick=function(){var a=this.selectedContact();a&&cc.Api.openComposeMessage(a.email())},Bb.prototype.onClearSearchClick=function(){this.search(""),this.searchSubmitCommand()},Bb.prototype.onContactResponse=function(a){if(a&&a.Action&&a.Result){var b=new Z,c=this.selector.itemSelected();b.parse(a.Result),c&&c.Id()===b.idContact()&&this.selectedItem(b)}},Bb.prototype.onContactCreateResponse=function(a){a&&a.Action&&a.Result&&(cc.Api.showReport(ac.i18n("CONTACTS/REPORT_CONTACT_SUCCESSFULLY_ADDED")),this.requestContactList())},Bb.prototype.onContactListResponse=function(a){if(a&&a.Action&&a.Result){var b=0,c=0,d=[],e="GlobalContactList"===a.Action,f=this.selector.itemSelected(),g=null,h=this.selector.listChecked(),i=h&&0<h.length?_.map(h,function(a){return a.Id()}):[],j=null;for(c=a.Result.List.length;c>b;b++)a.Result.List[b]&&"Object/CContactListItem"===ac.pExport(a.Result.List[b],"@Object","")&&(j=new ab,j.parse(a.Result.List[b],e),d.push(j));f&&(g=_.find(d,function(a){return f.Id()===a.Id()})),i&&0<i.length&&_.each(d,function(a){a.checked(-1<ac.inArray(a.Id(),i))}),this.collection(d),this.loadingList(!1),this.oPageSwitcher.setCount(ac.pInt(a.Result.ContactCount)),g&&this.selector.itemSelected(g),this.selectedGroupContactsList(a.Result.List)}},Bb.prototype.onGroupListResponse=function(a){if(a&&a.Action&&a.Result){var b=0,c=0,d=[],e=_.find(this.groupFullCollection(),function(a){return a.selected()}),f=null;for(this.groupFullCollection(d),c=a.Result.length;c>b;b++)a.Result[b]&&"Object/CContactListItem"===ac.pExport(a.Result[b],"@Object","")&&(f=new ab,f.parse(a.Result[b]),f.IsGroup()&&(e&&e.Id()===f.Id()&&this.selectedGroupInList(f),d.push(f)));this.groupFullCollection(d)}},Bb.prototype.onGroupCreateResponse=function(a){if(a&&a.Action&&a.Result){var b=_.map(this.selector.listChecked(),function(a){return a.Id()});this.executeAddContactsToGroupId(a.Result.IdGroup,b,_b.ContactsGroupListType.Global===this.selectedGroupType()),this.selectedItem(null),this.selector.itemSelected(null),cc.Api.showReport(ac.i18n("CONTACTS/REPORT_GROUP_SUCCESSFULLY_ADDED")),this.requestContactList(),this.requestGroupFullList()}},Cb.prototype.onHide=function(a){var b=null,c=this.tab();this.confirmSaving(c),b=this.getCurrentViewModel(),b&&ac.isFunc(b.onHide)&&b.onHide(a),gc.removeClass("non-adjustable")},Cb.prototype.onShow=function(a){var b=null,c=this.tab();this.confirmSaving(c),b=this.getCurrentViewModel(),b&&ac.isFunc(b.onShow)&&b.onShow(a),gc.addClass("non-adjustable")},Cb.prototype.viewTab=function(a){var b=this.getViewModel(_b.SettingsTab.Common),c=b?_b.SettingsTab.Common:_b.SettingsTab.EmailAccounts,d=this.getViewModel(a),e=-1===ac.inArray(a,_b.SettingsTab);a=d&&e?a:c,this.tab(a)},Cb.prototype.onRoute=function(a){var b=null,c=this.tab();_.isArray(a)&&a.length>0&&(c=a[0]),b=this.getCurrentViewModel(),b&&ac.isFunc(b.onHide)&&b.onHide(a),this.confirmSaving(this.tab()),this.viewTab(c),b=this.getCurrentViewModel(),b&&ac.isFunc(b.onRoute)&&b.onRoute(a)},Cb.prototype.confirmSaving=function(a){var b=this.getViewModel(a),c=ac.i18n("SETTINGS/CONFIRM_SETTINGS_SAVE"),d=_.bind(function(a){b&&(a?b.onSaveClick&&b.onSaveClick():b.init&&b.init())},this);b&&ac.isFunc(b.isChanged)&&b.isChanged()&&cc.Screens.showPopup(t,[c,d])},Cb.prototype.getViewModel=function(a){return _.find(this.aTabs,function(b){return b.TabName===a})},Cb.prototype.getCurrentViewModel=function(){return this.getViewModel(this.tab())},Cb.prototype.showTab=function(a){cc.Routing.setHash([_b.Screens.Settings,a])},Cb.prototype.onResponseFolderDelete=function(a){a.Result?cc.MailCache.getFolderList(ec.Accounts.editedId()):cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"))},Cb.prototype.deleteFolder=function(a,b,c){var d={Action:"FolderDelete",AccountID:ec.Accounts.editedId(),Folder:a.fullName()};c&&b&&a&&(b.remove(function(b){return a.fullName()===b.fullName()?!0:!1}),cc.Ajax.send(d,this.onResponseFolderDelete,this))},Cb.prototype.onResponseFolderSubscribe=function(a){a.Result?cc.MailCache.getFolderList(ec.Accounts.editedId()):cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"))},Cb.prototype.onSubscribeFolderClick=function(a){var b={Action:"FolderSubscribe",AccountID:ec.Accounts.editedId(),Folder:a.fullName(),SetAction:a.subscribed()?0:1};a&&a.canSubscribe()&&(a.subscribed(!a.subscribed()),cc.Ajax.send(b,this.onResponseFolderSubscribe,this))},Cb.prototype.onDeleteFolderClick=function(a,b){var c=ac.i18n("SETTINGS/ACCOUNT_FOLDERS_CONFIRMATION_DELETE"),d=this.getCollectionFromParent(b),e=_.bind(this.deleteFolder,this,a,d),f=this.getViewModel(_b.SettingsTab.EmailAccounts);a&&a.canDelete()?cc.Screens.showPopup(t,[c,e]):f&&f.oAccountFolders.highlighted(!0)},Cb.prototype.onResponseFolderRename=function(a){a.Result?cc.MailCache.getFolderList(ec.Accounts.editedId()):cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"))},Cb.prototype.folderEditOnEnter=function(a){var b={Action:"FolderRename",AccountID:ec.Accounts.editedId(),PrevFolderFullNameRaw:a.fullName(),NewFolderNameInUtf8:a.nameForEdit()};cc.Ajax.send(b,this.onResponseFolderRename,this),a.name(a.nameForEdit()),a.edited(!1)},Cb.prototype.folderEditOnEsc=function(a){a.edited(!1)},Cb.prototype.getCollectionFromParent=function(a){return a.subfolders?a.subfolders:a.collection},Cb.prototype.canMoveFolderUp=function(a,b,c){var d=this.getCollectionFromParent(c),e=d()[b-1],f="";return b>0&&e&&(f=d()[b-1].fullName()),0!==b&&a&&a.fullName()!==cc.MailCache.editedFolderList().inboxFolderFullName()&&cc.MailCache.editedFolderList().inboxFolderFullName()!==f},Cb.prototype.canMoveFolderDown=function(a,b,c){var d=this.getCollectionFromParent(c);return b!==d().length-1&&a.fullName()!==cc.MailCache.editedFolderList().inboxFolderFullName()},Cb.prototype.moveFolderUp=function(a,b,c){var d=this.getCollectionFromParent(c),e=b-2,f=e>=0?d()[e].fullName():"",g=d()[b]?d()[b].fullName():"";this.canMoveFolderUp(a,b,c)&&d&&(d.splice(b,1),d.splice(b-1,0,a),this.folderListOrderNameUpdate(a,f,g),this.folderListOrderUpdateDebounce())},Cb.prototype.moveFolderDown=function(a,b,c){var d=this.getCollectionFromParent(c),e=d()[b].fullName(),f=d()[b+2]?d()[b+2].fullName():"";this.canMoveFolderDown(a,b,c)&&d&&(d.splice(b,1),d.splice(b+1,0,a),this.folderListOrderNameUpdate(a,e,f),this.folderListOrderUpdateDebounce())},Cb.prototype.afterSortableFolderMove=function(a){var b=a.item,c=a.sourceParent(),d=a.targetIndex-1,e=d>=0?c[d].fullName():"",f=a.targetIndex+1,g=c[f]?c[f].fullName():"";this.folderListOrderNameUpdate(b,e,g),this.folderListOrderUpdateDebounce()},Cb.prototype.folderListOrderUpdate=function(){var a=[],b=[],c=null;this.bAllowFolderListOrderNameUpdate||(a=cc.MailCache.editedFolderList().getOptions(),b=_.map(a,function(a){return a&&a.id?a.id:null}),c={Action:"FolderListOrderUpdate",AccountID:ec.Accounts.editedId(),FolderList:_.compact(b)},cc.Ajax.send(c,this.onResponseFolderListOrderUpdate,this))},Cb.prototype.onResponseFolderListOrderUpdate=function(a){a.Result?cc.MailCache.getFolderList(ec.Accounts.editedId()):cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"))},Cb.prototype.folderListOrderNameUpdate=function(a,b,c){var d=null,e=null;this.bAllowFolderListOrderNameUpdate&&(d=cc.MailCache.editedFolderList().getFolderByFullName(a.parentFullName()),e={Action:"FolderListOrderNameUpdate",FolderName:a.fullName(),AboveName:b,BelowName:c,ParentName:a.parentFullName(),ParentDelimiter:d?d.delimiter():""},cc.Ajax.send(e,this.onResponseFolderListOrderNameUpdate,this))},Cb.prototype.onResponseFolderListOrderNameUpdate=function(){var a=ec.Accounts.editedId();clearTimeout(this.iUpdateFolderListTimer),this.iUpdateFolderListTimer=setTimeout(function(){cc.MailCache.getFolderList(a)},5e3)},Db.prototype.TemplateName="Settings_CommonSettingsViewModel",Db.prototype.TabName=_b.SettingsTab.Common,Db.prototype.TabTitle=ac.i18n("SETTINGS/TAB_COMMON"),Db.prototype.setMessagesPerPage=function(a){var b=this.rangeOfNumbers;-1===_.indexOf(b,a)&&(b=_.sortBy(_.union(b,[a]),function(a){return a},this)),this.messagesPerPageValues(b),this.messagesPerPage(a)},Db.prototype.setContactsPerPage=function(a){var b=this.rangeOfNumbers;-1===_.indexOf(b,a)&&(b=_.sortBy(_.union(b,[a]),function(a){return a},this)),this.contactsPerPageValues(b),this.contactsPerPage(a)},Db.prototype.init=function(){this.selectedSkin(ec.User.DefaultTheme),this.layout(ec.User.Layout),this.selectedLanguage(ec.User.DefaultLanguage),this.setMessagesPerPage(ec.User.MailsPerPage),this.setContactsPerPage(ec.User.ContactsPerPage),this.autocheckmailInterval(ec.User.AutoCheckMailInterval),this.richText(ec.User.DefaultEditor),this.timeFormat(ec.User.defaultTimeFormat()),this.dateFormat(ec.User.DefaultDateFormat),this.useThreads(ec.User.useThreads()),this.saveRepliedToCurrFolder(ec.User.SaveRepliedToCurrFolder)},Db.prototype.getState=function(){var a=[this.selectedSkin(),this.layout(),this.selectedLanguage(),this.messagesPerPage(),this.contactsPerPage(),this.autocheckmailInterval(),this.richText(),this.timeFormat(),this.dateFormat(),this.useThreads(),this.saveRepliedToCurrFolder()];return a.join(":")},Db.prototype.updateFirstState=function(){this.firstState=this.getState()},Db.prototype.isChanged=function(){return this.firstState&&this.getState()!==this.firstState?!0:!1},Db.prototype.onResponse=function(a,c){var d=!1;this.loading(!1),a.Result===!1?cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED")):(cc.CalendarCache.calendarSettingsChanged(!0),d=c.DefaultTheme!==ec.User.DefaultTheme||c.DefaultLanguage!==ec.User.DefaultLanguage,d?b.location.reload():(this.setMessagesPerPage(c.MailsPerPage),this.setContactsPerPage(c.ContactsPerPage),ec.User.updateCommonSettings(c.MailsPerPage,c.ContactsPerPage,c.AutoCheckMailInterval,c.DefaultEditor,c.Layout,c.DefaultTheme,c.DefaultLanguage,c.DefaultDateFormat,c.DefaultTimeFormat,c.UseThreads,c.SaveRepliedMessagesToCurrentFolder),cc.Api.showReport(ac.i18n("SETTINGS/COMMON_REPORT_UPDATED_SUCCESSFULLY"))))},Db.prototype.onSaveClick=function(){var a={Action:"UpdateUserSettings",MailsPerPage:parseInt(this.messagesPerPage(),10),ContactsPerPage:parseInt(this.contactsPerPage(),10),AutoCheckMailInterval:parseInt(this.autocheckmailInterval(),10),DefaultEditor:parseInt(this.richText(),10),Layout:parseInt(this.layout(),10),DefaultTheme:this.selectedSkin(),DefaultLanguage:this.selectedLanguage(),DefaultDateFormat:this.dateFormat(),DefaultTimeFormat:parseInt(this.timeFormat(),10),UseThreads:this.useThreads()?"1":"0",SaveRepliedMessagesToCurrentFolder:this.saveRepliedToCurrFolder()?"1":"0"};this.loading(!0),this.updateFirstState(),cc.Ajax.send(a,this.onResponse,this)},Eb.prototype.TemplateName="Settings_EmailAccountsSettingsViewModel",Eb.prototype.TabName=_b.SettingsTab.EmailAccounts,Eb.prototype.TabTitle=ac.i18n("SETTINGS/TAB_EMAIL_ACCOUNTS"),Eb.prototype.isChanged=function(){return!1},Eb.prototype.onRoute=function(a){var b=ec.Accounts.getEdited();b&&(_.isArray(a)&&a.length>1&&this.tab(a[1]),this.confirmSaving(_b.AccountSettingsTab.Properties),this.viewCurrentTab(a))},Eb.prototype.confirmSaving=function(a,b,c){var d=this.getViewModel(a),e={},f=ac.i18n("SETTINGS/CONFIRM_SETTINGS_SAVE"),g=_.bind(function(a){d&&(a?d.onSaveClick&&d.saveData(e):d.updateFirstState())},this);b=ac.isUnd(b)?!1:b,c=ac.isUnd(c)?null:c,!b&&d&&ac.isFunc(d.isChanged)&&d.isChanged()&&(e=d.prepareParameters(),cc.Screens.showPopup(t,[f,g]))},Eb.prototype.onHide=function(){this.confirmSaving(this.tab())},Eb.prototype.viewCurrentTab=function(a){var b=ec.Accounts.getEdited(),c=null,d=this.isTabAllowed(this.tab(),b);b&&(d?(c=this.getCurrentViewModel(),c&&(ac.isFunc(c.onHide)&&c.onHide(a),ac.isFunc(c.onShow)&&c.onShow(a,b))):(this.tab(_b.AccountSettingsTab.Properties),cc.Routing.replaceHash([_b.Screens.Settings,_b.SettingsTab.EmailAccounts,_b.AccountSettingsTab.Properties]),this.editedFetcherId(null),this.editedIdentityId(null)))},Eb.prototype.getViewModel=function(a){switch(a){case _b.AccountSettingsTab.Folders:return this.oAccountFolders;case _b.AccountSettingsTab.Filters:return this.oAccountFilters;case _b.AccountSettingsTab.Forward:return this.oAccountForward;case _b.AccountSettingsTab.Signature:return this.oAccountSignature;case _b.AccountSettingsTab.Autoresponder:return this.oAccountAutoresponder;case _b.AccountSettingsTab.FetcherInc:return this.oFetcherIncoming;case _b.AccountSettingsTab.FetcherOut:return this.oFetcherOutgoing;case _b.AccountSettingsTab.FetcherSig:return this.oFetcherSignature;case _b.AccountSettingsTab.IdentityProperties:return this.oIdentityProperties;case _b.AccountSettingsTab.IdentitySignature:return this.oIdentityProperties;default:case _b.AccountSettingsTab.Properties:return this.oAccountProperties}},Eb.prototype.getCurrentViewModel=function(){return this.getViewModel(this.tab())},Eb.prototype.isTabAllowed=function(a,b){var c=[_b.AccountSettingsTab.Properties,_b.AccountSettingsTab.Signature,_b.AccountSettingsTab.Folders,_b.AccountSettingsTab.FetcherInc,_b.AccountSettingsTab.FetcherOut,_b.AccountSettingsTab.FetcherSig];return b.extensionExists("AllowSieveFiltersExtension")&&c.push(_b.AccountSettingsTab.Filters),b.extensionExists("AllowForwardExtension")&&c.push(_b.AccountSettingsTab.Forward),b.extensionExists("AllowAutoresponderExtension")&&c.push(_b.AccountSettingsTab.Autoresponder),ec.AllowIdentities&&this.editedIdentityId()&&(c.push(_b.AccountSettingsTab.IdentityProperties),c.push(_b.AccountSettingsTab.IdentitySignature)),-1!==ac.inArray(a,c)
},Eb.prototype.onTabClick=function(a){cc.Routing.setHash([_b.Screens.Settings,_b.SettingsTab.EmailAccounts,a])},Eb.prototype.onResponseAccountDelete=function(a,c){a.Result?(ec.Accounts.deleteAccount(c.AccountIDToDelete),this.changeAccount(this.editedAccountId()),this.defaultAccountId()===c.AccountIDToDelete&&(cc.Routing.setHash([]),b.location.reload())):cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"))},Eb.prototype.deleteAccount=function(a,b){var c={Action:"AccountDelete",AccountIDToDelete:a};b&&cc.Ajax.send(c,this.onResponseAccountDelete,this)},Eb.prototype.onAccountDelete=function(a){var b=_.bind(this.deleteAccount,this,a),c=ec.Accounts.getAccount(a);this.allowUsersChangeInterfaceSettings&&cc.Screens.showPopup(t,[c.removeConfirmation(),b,c.email()])},Eb.prototype.onEditedAccountDelete=function(){this.onAccountDelete(this.editedAccountId())},Eb.prototype.onAccountAdd=function(){cc.Screens.showPopup(u,[])},Eb.prototype.changeAccount=function(a){var b=null,c={Action:"AccountSettings",AccountID:a};(this.isFetcherTab(this.tab())||this.isIdentityTab(this.tab()))&&this.onTabClick(_b.AccountSettingsTab.Properties),this.confirmSaving(this.tab()),b=ec.Accounts.getAccount(a),!ac.isUnd(b)&&b.isExtended()?this.populate(b):cc.Ajax.send(c,this.onAccountSettingsResponse,this),this.editedFetcherId(null),this.editedIdentityId(null)},Eb.prototype.onAccountSettingsResponse=function(a,b){if(a.Result){var c=ec.Accounts.getAccount(b.AccountID);ac.isUnd(c)||(c.updateExtended(a.Result),this.populate(c))}else cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"))},Eb.prototype.populate=function(a){this.allowAutoresponderExtension(a.extensionExists("AllowAutoresponderExtension")),this.allowForwardExtension(a.extensionExists("AllowForwardExtension")),this.allowSieveFiltersExtension(a.extensionExists("AllowSieveFiltersExtension")),ec.Accounts.changeEditedAccount(a.id()),this.viewCurrentTab()},Eb.prototype.onIdentityAdd=function(a,b){b.stopPropagation(),cc.Screens.showPopup(v,[a])},Eb.prototype.onFetcherAdd=function(){cc.Screens.showPopup(w,[])},Eb.prototype.fetcherDelete=function(a,b){var c={Action:"FetcherDelete",FetcherID:a};b&&cc.Ajax.send(c,this.onFetcherDeleteResponse,this)},Eb.prototype.onFetcherDelete=function(a){var b=ac.i18n("WARNING/FETCHER_DELETE_WARNING"),c=_.bind(this.fetcherDelete,this,a.id()),d=a.incomingMailServer();cc.Screens.showPopup(t,[b,c,d])},Eb.prototype.onFetcherDeleteResponse=function(a){a.Result?(ec.Accounts.populateFetchers(),this.editedFetcherId(null)):cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("WARNING/FETCHER_DELETING_ERROR"))},Eb.prototype.onChangeFetcher=function(a){var b=this.defaultAccount.fetchers().getFetcher(a);this.fetcher(b),this.isFetcherTab(this.tab())||this.onTabClick(_b.AccountSettingsTab.FetcherInc),this.confirmSaving(this.tab()),this.oFetcherIncoming.populate(b),this.oFetcherOutgoing.populate(b),this.oFetcherSignature.populate(b),this.editedFetcherId(b.id()),this.editedIdentityId(null)},Eb.prototype.isFetcherTab=function(a){return-1!==ac.inArray(a,[_b.AccountSettingsTab.FetcherInc,_b.AccountSettingsTab.FetcherOut,_b.AccountSettingsTab.FetcherSig])},Eb.prototype.onChangeIdentity=function(a){this.onTabClick(_b.AccountSettingsTab.IdentityProperties),this.confirmSaving(this.tab()),this.oIdentityProperties.populate(a),this.editedIdentityId(a.id()),this.editedFetcherId(null)},Eb.prototype.isIdentityTab=function(a){return-1!==ac.inArray(a,[_b.AccountSettingsTab.IdentityProperties,_b.AccountSettingsTab.IdentitySignature])},Eb.prototype.onRemoveIdentity=function(){this.editedIdentityId(null),this.viewCurrentTab()},Fb.prototype.TemplateName="Settings_CalendarSettingsViewModel",Fb.prototype.TabName=_b.SettingsTab.Calendar,Fb.prototype.TabTitle=ac.i18n("SETTINGS/TAB_CALENDAR"),Fb.prototype.init=function(){this.showWeekends(ec.User.CalendarShowWeekEnds),this.selectedWorkdayStarts(ec.User.CalendarWorkDayStarts),this.selectedWorkdayEnds(ec.User.CalendarWorkDayEnds),this.showWorkday(ec.User.CalendarShowWorkDay),this.weekStartsOn(ec.User.CalendarWeekStartsOn),this.defaultTab(ec.User.CalendarDefaultTab)},Fb.prototype.getState=function(){var a=[this.showWeekends(),this.selectedWorkdayStarts(),this.selectedWorkdayEnds(),this.showWorkday(),this.weekStartsOn(),this.defaultTab()];return a.join(":")},Fb.prototype.updateFirstState=function(){this.firstState=this.getState()},Fb.prototype.isChanged=function(){return this.firstState&&this.getState()!==this.firstState?!0:!1},Fb.prototype.onResponse=function(a,b){this.loading(!1),a.Result===!1?cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("SETTINGS/ERROR_CALENDAR_SETTINGS_SAVING_FAILED")):(cc.CalendarCache.calendarSettingsChanged(!0),ec.User.updateCalendarSettings(b.ShowWeekEnds,b.ShowWorkDay,b.WorkDayStarts,b.WorkDayEnds,b.WeekStartsOn,b.DefaultTab),cc.Api.showReport(ac.i18n("SETTINGS/COMMON_REPORT_UPDATED_SUCCESSFULLY")))},Fb.prototype.onSaveClick=function(){var a={Action:"UpdateUserSettings",ShowWeekEnds:this.showWeekends()?1:0,ShowWorkDay:this.showWorkday()?1:0,WorkDayStarts:parseInt(this.selectedWorkdayStarts(),10),WorkDayEnds:parseInt(this.selectedWorkdayEnds(),10),WeekStartsOn:parseInt(this.weekStartsOn(),10),DefaultTab:parseInt(this.defaultTab(),10)};this.loading(!0),this.updateFirstState(),cc.Ajax.send(a,this.onResponse,this)},Gb.prototype.TemplateName="Settings_MobileSyncSettingsViewModel",Gb.prototype.TabName=_b.SettingsTab.MobileSync,Gb.prototype.TabTitle=ac.i18n("SETTINGS/TAB_MOBILE_SYNC"),Gb.prototype.onRoute=function(){ec.User.requestSyncSettings()},Gb.prototype.onMobileSyncSubscribe=function(){this.enableDav(ec.User.MobileSyncEnable&&this.mobileSync()&&this.mobileSync().EnableDav),this.enableDav()&&(this.davLogin(this.mobileSync().Dav.Login),this.davServer(this.mobileSync().Dav.Server),this.davCalendars(this.mobileSync().Dav.Calendars),this.davPersonalContactsUrl(this.mobileSync().Dav.PersonalContactsUrl),this.davCollectedAddressesUrl(this.mobileSync().Dav.CollectedAddressesUrl),this.davGlobalAddressBookUrl(this.mobileSync().Dav.GlobalAddressBookUrl))},Hb.prototype.TemplateName="Settings_OutLookSyncSettingsViewModel",Hb.prototype.TabName=_b.SettingsTab.OutLookSync,Hb.prototype.TabTitle=ac.i18n("SETTINGS/TAB_OUTLOOK_SYNC"),Hb.prototype.onRoute=function(){ec.User.requestSyncSettings()},Hb.prototype.onOutlookSyncSubscribe=function(){ec.User.OutlookSyncEnable&&(this.visibleOutlookSync(!0),this.outlookSync()&&(this.login(this.outlookSync().Login),this.server(this.outlookSync().Server)))},Ib.prototype.getState=function(){var a=[this.friendlyName(),this.email(),this.incomingMailLogin(),this.incomingMailPort(),this.incomingMailServer(),this.outgoingMailLogin(),this.outgoingMailPort(),this.outgoingMailServer(),this.useSmtpAuthentication()];return a.join(":")},Ib.prototype.updateFirstState=function(){this.firstState=this.getState()},Ib.prototype.isChanged=function(){return this.firstState&&this.getState()!==this.firstState?!0:!1},Ib.prototype.populate=function(a){a?(this.allowChangePassword(a.extensionExists("AllowChangePasswordExtension")),this.isInternal(a.isInternal()),this.isLinked(a.isLinked()),this.isDefault(a.isDefault()),this.removeHint(a.removeHint()),this.useSmtpAuthentication(2===ac.pInt(a.outgoingMailAuth())?!0:!1),this.friendlyName(a.friendlyName()),this.email(a.email()),this.incomingMailLogin(a.incomingMailLogin()),this.incomingMailServer(a.incomingMailServer()),this.incomingMailPort(a.incomingMailPort()),this.outgoingMailServer(a.outgoingMailServer()),this.outgoingMailLogin(a.outgoingMailLogin()),this.outgoingMailPort(a.outgoingMailPort()),this.updateFirstState()):(this.allowChangePassword(!1),this.isLinked(!0),this.useSmtpAuthentication(!0),this.friendlyName(""),this.email(""),this.incomingMailLogin(""),this.incomingMailServer(""),this.incomingMailPort(143),this.outgoingMailServer(""),this.outgoingMailLogin(""),this.outgoingMailPort(25))},Ib.prototype.onResponse=function(a,b){if(this.loading(!1),a.Result){var c=ac.pInt(a.AccountID),d=c>0?ec.Accounts.getAccount(c):null;d&&(d.updateExtended(b),cc.Api.showReport(ac.i18n("SETTINGS/COMMON_REPORT_UPDATED_SUCCESSFULLY")))}else cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"))},Ib.prototype.prepareParameters=function(){var a={Action:"UpdateAccountSettings",AccountID:this.account().id(),FriendlyName:this.friendlyName(),Email:this.email(),IncomingMailLogin:this.incomingMailLogin(),IncomingMailServer:this.incomingMailServer(),IncomingMailPort:ac.pInt(this.incomingMailPort()),OutgoingMailServer:this.outgoingMailServer(),OutgoingMailLogin:this.outgoingMailLogin(),OutgoingMailPort:ac.pInt(this.outgoingMailPort()),OutgoingMailAuth:this.useSmtpAuthentication()?2:0,IncomingMailPassword:this.incomingMailPassword()};return a},Ib.prototype.saveData=function(a){this.updateFirstState(),cc.Ajax.send(a,this.onResponse,this)},Ib.prototype.onSaveClick=function(){this.account()&&(this.loading(!0),this.saveData(this.prepareParameters()))},Ib.prototype.onChangePasswordClick=function(){cc.Screens.showPopup(z,[!1])},Ib.prototype.onShow=function(a,b){this.account(b)},Jb.prototype.isChanged=function(){return!1},Jb.prototype.onAddNewFolderClick=function(){cc.Screens.showPopup(y)},Jb.prototype.onSystemFoldersClick=function(){cc.Screens.showPopup(x)},Kb.prototype.__name="CAccountSignatureViewModel",Kb.prototype.getState=function(){var a=[this.type(),this.useSignature(),this.oHtmlEditor.getText()];return a.join(":")},Kb.prototype.updateFirstState=function(){this.firstState=this.getState()},Kb.prototype.isChanged=function(){return this.firstState&&this.getState()!==this.firstState?!0:!1},Kb.prototype.getSignature=function(){if(this.account())if(null!==this.account().signature())this.type(this.account().signature().type()),this.useSignature(this.account().signature().options()),this.signature(this.account().signature().signature());else{var a={Action:"AccountSignature",AccountID:this.account().id()};cc.Ajax.send(a,this.onSignatureResponse,this)}},Kb.prototype.onSignatureResponse=function(a){var b=null,c=parseInt(a.AccountID,10);a.Result?this.account()&&c===this.account().id()&&(b=new hb,b.parse(c,a.Result),this.account().signature(b),this.type(this.account().signature().type()),this.useSignature(this.account().signature().options()),this.signature(this.account().signature().signature())):cc.Api.showErrorByCode(a.ErrorCode)},Kb.prototype.prepareParameters=function(){var a={Action:"UpdateAccountSignature",AccountID:this.account().id(),Type:this.type()?1:0,Options:this.useSignature(),Signature:this.signature()};return a},Kb.prototype.saveData=function(a){this.updateFirstState(),cc.Ajax.send(a,this.onResponse,this)},Kb.prototype.save=function(){this.account()&&(this.loading(!0),this.signature(this.oHtmlEditor.getText()),this.account().signature().type(this.type()),this.account().signature().options(this.useSignature()),this.account().signature().signature(this.signature()),this.saveData(this.prepareParameters()))},Kb.prototype.onResponse=function(a){this.loading(!1),a.Result?cc.Api.showReport(ac.i18n("SETTINGS/COMMON_REPORT_UPDATED_SUCCESSFULLY")):cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"))},Kb.prototype.onShow=function(a,b){this.account(b),this.oHtmlEditor.initCrea(this.signature(),""),this.oHtmlEditor.setActivitySource(this.useSignature),this.updateFirstState()},Lb.prototype.getState=function(){var a=[this.enable(),this.email()];return a.join(":")},Lb.prototype.updateFirstState=function(){this.firstState=this.getState()},Lb.prototype.isChanged=function(){return this.firstState&&this.getState()!==this.firstState?!0:!1},Lb.prototype.prepareParameters=function(){var a={Action:"UpdateForward",AccountID:this.account().id(),Enable:this.enable()?"1":"0",Email:this.email()};return a},Lb.prototype.saveData=function(a){this.updateFirstState(),cc.Ajax.send(a,this.onUpdateForwardResponse,this)},Lb.prototype.onSaveClick=function(){if(this.account()){var a=this.account().forward();a&&(a.enable=this.enable(),a.email=this.email()),this.loading(!0),this.saveData(this.prepareParameters())}},Lb.prototype.getForward=function(){if(this.account())if(null!==this.account().forward())this.enable(this.account().forward().enable),this.email(this.account().forward().email),this.firstState=this.getState();else{var a={Action:"GetForward",AccountID:this.account().id()};this.loading(!0),this.updateFirstState(),cc.Ajax.send(a,this.onGetForwardResponse,this)}},Lb.prototype.onShow=function(a,b){this.account(b)},Lb.prototype.onGetForwardResponse=function(a,b){if(this.loading(!1),b&&b.Action){if(a&&a.Result&&a.AccountID&&this.account()){var c=null,d=new lb,e=ac.pInt(a.AccountID);e&&(c=ec.Accounts.getAccount(e),c&&(d.parse(e,a.Result),c.forward(d),this.enable(c.forward().enable),this.email(c.forward().email),this.updateFirstState(),e===this.account().id()&&this.account.valueHasMutated()))}}else cc.Api.showError(ac.i18n("WARNING/UNKNOWN_ERROR"))},Lb.prototype.onUpdateForwardResponse=function(a,b){this.loading(!1),b&&b.Action?a&&a.Result?cc.Api.showReport(ac.i18n("SETTINGS/ACCOUNT_FORWARD_SUCCESS_REPORT")):cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED")):cc.Api.showError(ac.i18n("WARNING/UNKNOWN_ERROR"))},Mb.prototype.getState=function(){var a=[this.enable(),this.subject(),this.message()];return a.join(":")},Mb.prototype.updateFirstState=function(){this.firstState=this.getState()},Mb.prototype.isChanged=function(){return this.firstState&&this.getState()!==this.firstState?!0:!1},Mb.prototype.prepareParameters=function(){var a={Action:"UpdateAutoresponder",AccountID:this.account().id(),Enable:this.enable()?"1":"0",Subject:this.subject(),Message:this.message()};return a},Mb.prototype.saveData=function(a){this.updateFirstState(),cc.Ajax.send(a,this.onUpdateAutoresponder,this)},Mb.prototype.onSaveClick=function(){if(this.account()){var a=this.account().autoresponder();a&&(a.enable=this.enable(),a.subject=this.subject(),a.message=this.message()),this.loading(!0),this.saveData(this.prepareParameters())}},Mb.prototype.getAutoresponder=function(){if(this.account())if(null!==this.account().autoresponder())this.enable(this.account().autoresponder().enable),this.subject(this.account().autoresponder().subject),this.message(this.account().autoresponder().message),this.updateFirstState();else{var a={Action:"GetAutoresponder",AccountID:this.account().id()};this.loading(!0),cc.Ajax.send(a,this.onGetAutoresponderResponse,this)}},Mb.prototype.onShow=function(a,b){this.account(b)},Mb.prototype.onGetAutoresponderResponse=function(a,b){if(this.loading(!1),b&&b.Action){if(a&&a.Result&&a.AccountID&&this.account()){var c=null,d=new ib,e=ac.pInt(a.AccountID);e&&(c=ec.Accounts.getAccount(e),c&&(d.parse(e,a.Result),c.autoresponder(d),e===this.account().id()&&this.account.valueHasMutated()))}}else cc.Api.showError(ac.i18n("WARNING/UNKNOWN_ERROR"))},Mb.prototype.onUpdateAutoresponder=function(a,b){this.loading(!1),b&&b.Action?a&&a.Result?cc.Api.showReport(ac.i18n("SETTINGS/ACCOUNT_AUTORESPONDER_SUCCESS_REPORT")):cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED")):cc.Api.showError(ac.i18n("WARNING/UNKNOWN_ERROR"))},Nb.prototype.getState=function(){var a=":",b=_.map(this.collection(),function(a){return a.toString()},this);return b.length>0&&(a=b.join(":")),a},Nb.prototype.updateFirstState=function(){_.each(this.newCollection(),function(a){this.deleteFilter(a)},this),this.newCollection([]),this.firstState=this.getState()},Nb.prototype.isChanged=function(){return this.firstState&&this.getState()!==this.firstState?!0:!1},Nb.prototype.prepareParameters=function(){var a=_.map(this.collection(),function(a){return{Enable:a.enable()?"1":"0",Field:a.field(),Filter:a.filter(),Condition:a.condition(),Action:a.action(),FolderFullName:a.folder()}}),b={Action:"UpdateSieveFilters",AccountID:this.account().id(),Filters:a};return b},Nb.prototype.saveData=function(a){this.updateFirstState(),cc.Ajax.send(a,this.onUpdateFiltersResponse,this)},Nb.prototype.onSaveClick=function(){this.account()&&(this.loading(!0),this.newCollection([]),this.saveData(this.prepareParameters()))},Nb.prototype.getFilters=function(){if(this.account())if(null!==this.account().filters())this.collection(this.account().filters().collection()),this.updateFirstState();else{var a={Action:"GetSieveFilters",AccountID:this.account().id()};this.loading(!0),cc.Ajax.send(a,this.onGetFiltersResponse,this)}},Nb.prototype.onShow=function(a,b){this.account(b)},Nb.prototype.deleteFilter=function(a){this.collection.remove(a),this.newCollection.remove(a)},Nb.prototype.addFilter=function(){if(this.account()){var a=new nb(this.account().id());this.collection.push(a),this.newCollection.push(a)}},Nb.prototype.displayFilterPart=function(a,b){var c="";return c="%FIELD%"===a?"Field":"%CONDITION%"===a?"Condition":"%STRING%"===a?"String":"%ACTION%"===a?"Action":"%FOLDER%"===a?"Folder":"%DEPENDED"===a.substr(0,9)?"DependedText":"Text",b+c},Nb.prototype.getDependedText=function(a){return a=ac.pString(a),a&&(a=a.replace(/%/g,"").split("=")[1]||""),a},Nb.prototype.getDependedField=function(a,b){return a=ac.pString(a),a&&(a=a.replace(/[=](.*)/g,"").split("-")[1]||"",a=a.toLowerCase()),ac.isUnd(b[a])?!1:b[a]()},Nb.prototype.onGetFiltersResponse=function(a,b){if(this.loading(!1),b&&b.Action){if(a&&a.Result&&a.AccountID&&this.account()){var c=null,d=new mb,e=ac.pInt(a.AccountID);e&&(c=ec.Accounts.getAccount(e),c&&(d.parse(e,a.Result),c.filters(d),e===this.account().id()&&this.account.valueHasMutated()))}}else cc.Api.showError(ac.i18n("WARNING/UNKNOWN_ERROR"))},Nb.prototype.onUpdateFiltersResponse=function(a,b){this.loading(!1),b&&b.Action?a&&a.Result?cc.Api.showReport(ac.i18n("SETTINGS/ACCOUNT_FILTERS_SUCCESS_REPORT")):cc.Api.showError(ac.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED")):cc.Api.showError(ac.i18n("WARNING/UNKNOWN_ERROR"))},Ob.prototype.onSaveClick=function(){if(this.isEmptyRequiredFields())cc.Api.showErrorByCode(0,ac.i18n("WARNING/FETCHER_CREATE_ERROR"));else{var a={Action:"FetcherUpdate",AccountID:this.defaultAccountId(),FetcherID:this.idFetcher(),IsEnabled:this.isEnabled()?1:0,Folder:this.folder(),IncomingMailPassword:""===this.incomingMailPassword()?"******":this.incomingMailPassword(),LeaveMessagesOnServer:this.leaveMessagesOnServer()?1:0};this.loading(!0),cc.Ajax.send(a,this.onSaveFetcherResponse,this)}},Ob.prototype.onSaveFetcherResponse=function(a){this.loading(!1),a.Result?(ec.Accounts.populateFetchers(),cc.Api.showReport(ac.i18n("SETTINGS/ACCOUNT_FETCHER_SUCCESSFULLY_SAVED"))):cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("WARNING/UNKNOWN_ERROR"))},Ob.prototype.populate=function(a){a&&(this.fetcher(a),this.idFetcher(a.id()),this.isEnabled(a.isEnabled()),this.folder(a.folder()),this.incomingMailServer(a.incomingMailServer()),this.incomingMailPort(a.incomingMailPort()),this.incomingMailLogin(a.incomingMailLogin()),this.incomingMailPassword("******"),this.leaveMessagesOnServer(a.leaveMessagesOnServer()))},Ob.prototype.isEmptyRequiredFields=function(){switch(""){case this.incomingMailServer():return this.serverIsSelected(!0),!0;case this.incomingMailLogin():return this.loginIsSelected(!0),!0;case this.incomingMailPassword():return this.passwordIsSelected(!0),!0;default:return!1}},Pb.prototype.onSaveClick=function(){if(this.outgoingMailAuth()&&this.isEmptyRequiredFields())cc.Api.showErrorByCode(0,ac.i18n("WARNING/FETCHER_CREATE_ERROR"));else{var a={Action:"FetcherUpdate",AccountID:this.defaultAccountId(),FetcherID:this.idFetcher(),Email:this.email(),Name:this.userName(),IsOutgoingEnabled:this.isOutgoingEnabled()?1:0,OutgoingMailServer:this.outgoingMailServer(),OutgoingMailPort:parseInt(this.outgoingMailPort(),10),OutgoingMailAuth:this.outgoingMailAuth()?1:0};this.loading(!0),cc.Ajax.send(a,this.onSaveFetcherResponse,this)}},Pb.prototype.onSaveFetcherResponse=function(a){this.loading(!1),a.Result?(ec.Accounts.populateFetchers(),cc.Api.showReport(ac.i18n("SETTINGS/ACCOUNT_FETCHER_SUCCESSFULLY_SAVED"))):cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("WARNING/UNKNOWN_ERROR"))},Pb.prototype.populate=function(a){a&&(this.fetcher(a),this.idFetcher(a.id()),this.isEnabled(a.isEnabled()),this.email(a.email()),this.userName(a.userName()),this.isOutgoingEnabled(a.isOutgoingEnabled()),this.outgoingMailServer(a.outgoingMailServer()),this.outgoingMailPort(a.outgoingMailPort()),this.outgoingMailAuth(a.outgoingMailAuth()))},Pb.prototype.isEmptyRequiredFields=function(){return this.isOutgoingEnabled()&&""===this.outgoingMailServer()?(this.serverIsSelected(!0),!0):!1},Qb.prototype.__name="CFetcherSignatureViewModel",Qb.prototype.save=function(){var a={Action:"FetcherUpdate",AccountID:this.defaultAccountId(),FetcherID:this.idFetcher(),SignatureOptions:this.useSignature(),Signature:this.oHtmlEditor.getText()};this.loading(!0),cc.Ajax.send(a,this.onSaveFetcherResponse,this)},Qb.prototype.onSaveFetcherResponse=function(a){this.loading(!1),a.Result?cc.Api.showReport(ac.i18n("SETTINGS/COMMON_REPORT_UPDATED_SUCCESSFULLY")):cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"))},Qb.prototype.populate=function(a){a&&(this.fetcher(a),this.idFetcher(a.id()),this.signature(a.signature()),this.useSignature(a.signatureOptions()))},Qb.prototype.getState=function(){var a=[this.type(),this.useSignature(),this.oHtmlEditor.getText()];return a.join(":")},Qb.prototype.updateFirstState=function(){this.firstState=this.getState()},Qb.prototype.onShow=function(){this.oHtmlEditor.initCrea(this.signature(),""),this.oHtmlEditor.setActivitySource(this.useSignature),this.updateFirstState()},Rb.prototype.TemplateName="Settings_HelpdeskSettingsViewModel",Rb.prototype.TabName=_b.SettingsTab.Helpdesk,Rb.prototype.TabTitle=ac.i18n("SETTINGS/TAB_HELPDESK"),Rb.prototype.onShow=function(){this.allowNotifications(ec.User.AllowHelpdeskNotifications)},Rb.prototype.onResponse=function(a){this.loading(!1),a.Result===!1?cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED")):(ec.User.updateHelpdeskSettings(this.allowNotifications()),cc.Api.showReport(ac.i18n("SETTINGS/COMMON_REPORT_UPDATED_SUCCESSFULLY")))},Rb.prototype.onSaveClick=function(){var a={Action:"UpdateHelpdeskUserSettings",AllowHelpdeskNotifications:this.allowNotifications()?"1":"0"};this.loading(!0),cc.Ajax.send(a,this.onResponse,this)},Sb.prototype.__name="CIdentityPropertiesViewModel",Sb.prototype.onShow=function(){this.oHtmlEditor.initCrea(this.signature(),""),this.oHtmlEditor.setActivitySource(this.useSignature)},Sb.prototype.save=function(){if(""===this.email())cc.Api.showError(ac.i18n("WARNING/FETCHER_CREATE_ERROR"));else{this.signature(this.oHtmlEditor.getText());var a=this.bCreate?"CreateIdentity":"UpdateIdentity",b={Action:a,AccountID:this.identity().accountId(),Enabled:this.enabled()?1:0,Email:this.email(),Signature:this.signature(),UseSignature:this.useSignature(),FriendlyName:this.friendlyName()};this.bCreate||(b.IdIdentity=this.identity().id()),this.loading(!0),cc.Ajax.send(b,this.onUpdateIdentityResponse,this)}},Sb.prototype.onUpdateIdentityResponse=function(a){this.loading(!1),a.Result?(ec.Accounts.populateIdentities(),this.bCreate&&this.oParent.closeCommand()):cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("SETTINGS/ACCOUNTS_IDENTITY_ADDING_ERROR"))},Sb.prototype.populate=function(a){a&&(this.identity(a),this.enabled(a.enabled()),this.email(a.email()),this.friendlyName(a.friendlyName()),this.signature(a.signature()),this.useSignature(a.useSignature()?1:0))},Sb.prototype.remove=function(){var a={Action:"DeleteIdentity",AccountID:this.identity().accountId(),IdIdentity:this.identity().id()};cc.Ajax.send(a,this.onDeleteIdentityResponse,this),this.bCreate||this.oParent.onRemoveIdentity()},Sb.prototype.onDeleteIdentityResponse=function(a){a.Result||cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("SETTINGS/ACCOUNTS_IDENTITY_DELETING_ERROR")),ec.Accounts.populateIdentities()},Sb.prototype.cancel=function(){this.bCreate&&this.oParent.cancel()},Tb.prototype.initFullCalendar=function(){this.$calendarGrid.fullCalendar(this.fullcalendarOptions)},Tb.prototype.applyCalendarSettings=function(){this.timeFormatGrid=ec.User.defaultTimeFormat()===_b.TimeFormat.F24?"HH:mm":"hh:mm TT",this.timeFormatMoment=ec.User.defaultTimeFormat()===_b.TimeFormat.F24?"HH:mm":"hh:mm A",this.dateFormat=ec.User.DefaultDateFormat,this.calendarGridDom().removeClass("fc-show-weekends"),ec.User.CalendarShowWeekEnds&&this.calendarGridDom().addClass("fc-show-weekends"),this.fullcalendarOptions.timeFormat=this.timeFormatGrid+"{ - "+this.timeFormatGrid+"}",this.fullcalendarOptions.axisFormat=this.timeFormatGrid,this.fullcalendarOptions.firstDay=ec.User.CalendarWeekStartsOn,this.fullcalendarOptions.defaultView=this.defaultViewName(),this.changeView(this.defaultViewName()),this.applyFirstDay(),this.$calendarGrid.fullCalendar("destroy"),this.$calendarGrid.fullCalendar(this.fullcalendarOptions)},Tb.prototype.applyFirstDay=function(){var a=[],b="",c="";switch(_.each(this.aDayNames,function(b){a.push(b)}),ec.User.CalendarWeekStartsOn){case 1:c=a.shift(),a.push(c);break;case 6:b=a.pop(),a.unshift(b)}this.correctedDayNames(a),this.$datePicker.datepicker("option","firstDay",ec.User.CalendarWeekStartsOn)},Tb.prototype.initDatePicker=function(){this.$datePicker.datepicker({showOtherMonths:!0,selectOtherMonths:!0,monthNames:ac.getMonthNamesArray(),dayNamesMin:ac.i18n("DATETIME/DAY_NAMES_MIN").split(" "),onChangeMonthYear:_.bind(this.changeMonthYearFromDatePicker,this),onSelect:_.bind(this.selectDateFromDatePicker,this),beforeShowDay:_.bind(this.getDayDescription,this)})},Tb.prototype.onApplyBindings=function(){this.$calendarGrid=a(this.calendarGridDom()),this.$datePicker=a(this.datePickerDom()),this.initFullCalendar(),this.initDatePicker(),this.applyCalendarSettings(),this.highlightWeekInDayPicker(),_.delay(_.bind(this.initResizing,this),300)},Tb.prototype.onShow=function(){cc.CalendarCache&&cc.CalendarCache.calendarSettingsChanged()?(this.applyCalendarSettings(),this.reloadAll()):cc.CalendarCache&&cc.CalendarCache.calendarChanged()?(cc.CalendarCache.calendarChanged(!1),this.reloadAll()):this.loaded||this.getCalendars()},Tb.prototype.displayViewCallback=function(b){var c=0,d=null,e="01/01/2001 ";"month"!==b.name&&ec.User.CalendarShowWorkDay&&a(".fc-agenda-slots tr").each(function(){var b=a(this).find("td");0!==b.length&&(a(".fc-slot"+c+" th").each(function(){var c=a(this).eq(0).text(),f=""!==c?Date.parse(e+c):null,g=Date.parse(e+ec.User.CalendarWorkDayStarts+":00"),h=Date.parse(e+ec.User.CalendarWorkDayEnds+":00");f?d=f:f=d,(g>f||f>=h)&&b.addClass("fc-non-working-time")}),c++)}),this.activateCustomScrollInDayAndWeekView()},Tb.prototype.collectBusyDays=function(){var a=[],b=this.calendars.getEvents();_.each(b,function(b){for(var c=moment(b.start),d=b.end?moment(b.end):null,e=d?d.diff(c,"days"):0,f=0;e>=f;f++)a.push(c.clone().add("days",f).toDate())},this),this.busyDays(a)},Tb.prototype.refreshDatePicker=function(){_.defer(_.bind(function(){this.collectBusyDays(),this.$datePicker.datepicker("refresh"),this.highlightWeekInDayPicker()},this))},Tb.prototype.getDayDescription=function(a){var b=!0,c=_.find(this.busyDays(),function(b){return b.getDate()===a.getDate()&&b.getMonth()===a.getMonth()&&b.getYear()===a.getYear()},this),d=c?"day_with_events":"",e="";return[b,d,e]},Tb.prototype.initResizing=function(){var c=_.throttle(_.bind(this.resize,this),50);a(b).bind("resize",function(a){(a.target===this||cc.browser.ie8AndBelow)&&c()}),c()},Tb.prototype.resize=function(){var a=this.$calendarGrid.parent();a&&this.$calendarGrid.fullCalendar("option","height",a.height()),this.dayNamesResize()},Tb.prototype.dayNamesResize=function(){if("month"===this.selectedView()){var b=a("div.weekday-header-item"),c=a("tr.fc-first td.fc-day"),d=a(c[0]).width(),e=0;if(7===b.length&&7===c.length&&0!==d)for(;7>e;e++)a(b[e]).width(d)}},Tb.prototype.changeMonthYearFromDatePicker=function(a,b){var c=this.$calendarGrid.fullCalendar("getDate");this.$calendarGrid.fullCalendar("gotoDate",a,b-1,c.getDate()),this.changeDate()},Tb.prototype.selectDateFromDatePicker=function(a){var b=new Date(a);this.$calendarGrid.fullCalendar("gotoDate",b.getFullYear(),b.getMonth(),b.getDate()),this.changeDate(),_.defer(_.bind(this.highlightWeekInDayPicker,this))},Tb.prototype.highlightWeekInDayPicker=function(){var a=this.$datePicker.find("td.ui-datepicker-current-day"),b=a.parent(),c=this.$datePicker.find("table.ui-datepicker-calendar"),d=this.$calendarGrid.fullCalendar("getView");switch(d.name){case"agendaDay":c.addClass("highlight_day").removeClass("highlight_week");break;case"agendaWeek":c.removeClass("highlight_day").addClass("highlight_week");break;default:c.removeClass("highlight_day").removeClass("highlight_week")}b.addClass("current_week")},Tb.prototype.changeDateTitle=function(){var a=moment(this.$calendarGrid.fullCalendar("getDate")),b=this.$calendarGrid.fullCalendar("getView"),c=a.format("MMMM YYYY"),d=b.start?moment(b.start):null,e=b.end?moment(b.end).add("days",-1):null;switch(b.name){case"agendaDay":c=a.format("MMMM D, YYYY");break;case"agendaWeek":d&&e&&(c=d.format("MMMM D, YYYY")+" - "+e.format("MMMM D, YYYY"))}this.dateTitle(c)},Tb.prototype.changeDate=function(){this.getEvents(this.calendars.ids())},Tb.prototype.changeDateInDatePicker=function(){this.$datePicker.datepicker("setDate",this.$calendarGrid.fullCalendar("getDate")),this.highlightWeekInDayPicker()},Tb.prototype.activateCustomScrollInDayAndWeekView=function(){if(!jc){var b=a("table.fc-agenda-slots").parent().parent();b.each(function(){var b=a(this),d=a(this).parent();d.hasClass("scroll-wrap")||(d.attr("data-bind","customScrollbar: {x: false, relativeToInner: true}"),b.css({overflow:"hidden"}).addClass("scroll-inner"),c.applyBindings({},d[0]))})}},Tb.prototype.execCommand=function(a,b){b?this.$calendarGrid.fullCalendar(a,b):this.$calendarGrid.fullCalendar(a),this.changeDate(),this.changeDateInDatePicker()},Tb.prototype.displayToday=function(){this.execCommand("today")},Tb.prototype.displayPrev=function(){this.execCommand("prev")},Tb.prototype.displayNext=function(){this.execCommand("next")},Tb.prototype.changeView=function(a){this.selectedView(a),this.execCommand("changeView",a)},Tb.prototype.reloadAll=function(){this.startDateTime=0,this.endDateTime=0,this.needsToReload=!0,this.getCalendars()},Tb.prototype.getCalendars=function(){this.checkStarted(!0),cc.Ajax.abortRequestByActionName("CalendarList"),cc.Ajax.sendExt({Action:"CalendarList",IsPublic:this.isPublic?1:0,PublicCalendarId:this.publicCalendarId},this.onCalendarsResponse,this)},Tb.prototype.onCalendarsResponse=function(a){var b=[],c=null;a.Result?(this.loaded=!0,a.Result=_.sortBy(a.Result,function(a){return"Default"!==a.Id}),this.calendars.clearCollection(),_.each(a.Result,function(a){c=this.calendars.parseAndAddCalendar(a),c&&(this.isPublic&&(cc.setTitle(c.name()),this.publicCalendarName(c.name())),b.push(c.id))},this),0===b.length&&this.isPublic&&(cc.setTitle(ac.i18n("CALENDAR/NO_CALENDAR_FOUND")),cc.Api.showErrorByCode(0,ac.i18n("CALENDAR/NO_CALENDAR_FOUND"))),this.getEvents(b)):this.setCalendarGridVisibility(),this.checkStarted(!1)},Tb.prototype.getEvents=function(a){var b=!1,c=this.$calendarGrid.fullCalendar("getView"),d=c&&c.visStart&&c.visStart.getTime?c.visStart.getTime()/1e3:0,e=c&&c.visEnd&&c.visEnd.getTime?c.visEnd.getTime()/1e3:0;this.changeDateTitle(),a.length>0&&(0===this.startDateTime&&0===this.endDateTime?(this.startDateTime=d,this.endDateTime=e,b=!0):d<this.startDateTime&&e>this.endDateTime?(this.startDateTime=d,this.endDateTime=e,b=!0):d<this.startDateTime?(e=this.startDateTime,this.startDateTime=d,b=!0):e>this.endDateTime&&(d=this.endDateTime,this.endDateTime=e,b=!0),b&&(this.checkStarted(!0),a.length>1&&this.$calendarGrid.find(".fc-view div").first().css("visibility","hidden"),cc.Ajax.abortRequestByActionName("EventList"),cc.Ajax.sendExt({CalendarIds:JSON.stringify(a),Start:d,End:e,IsPublic:this.isPublic?1:0,Action:"EventList"},this.onEventsResponse,this)))
},Tb.prototype.onEventsResponse=function(a){a.Result&&(this.needsToReload&&this.$calendarGrid.fullCalendar("removeEvents"),_.each(this.calendars.collection(),function(a){a&&(this.$calendarGrid.fullCalendar("removeEventSource",{events:a.events}),this.needsToReload&&a.removeEvents())},this),this.needsToReload=!1,_.each(a.Result,function(a){var b=this.calendars.getCalendarById(a.calendarId);b&&b.addEvent(a)},this),_.each(this.calendars.collection(),function(a){a&&a.active()&&this.$calendarGrid.fullCalendar("addEventSource",{events:a.events})},this),this.refreshDatePicker()),this.setCalendarGridVisibility(),this.checkStarted(!1)},Tb.prototype.setCalendarGridVisibility=function(){this.$calendarGrid.css("visibility","").find(".fc-view div").first().css("visibility","")},Tb.prototype.getUnusedColor=function(){var a=_.difference(this.colors,this.calendars.getColors());return a.length>0?a[0]:this.colors[0]},Tb.prototype.openCreateCalendarForm=function(){if(!this.isPublic){var a=new bb;a.color(this.getUnusedColor()),cc.Screens.showPopup(D,[_.bind(this.createCalendar,this),this.colors,a])}},Tb.prototype.createCalendar=function(a,b,c){this.isPublic||cc.Ajax.send({Name:a,Description:b,Color:c,Action:"CalendarCreate"},this.onCalendarCreateResponse,this)},Tb.prototype.onCalendarCreateResponse=function(a){a.Result&&this.calendars.parseAndAddCalendar(a.Result)},Tb.prototype.openUpdateCalendarForm=function(a){this.isPublic||cc.Screens.showPopup(D,[_.bind(this.updateCalendar,this),this.colors,a])},Tb.prototype.updateCalendar=function(a,b,c,d){this.isPublic||cc.Ajax.send({Name:a,Description:b,Color:c,Id:d,Action:"CalendarUpdate"},this.onCalendarUpdateResponse,this)},Tb.prototype.onCalendarUpdateResponse=function(a,b){var c=null,d=[];a.Result&&(c=this.calendars.getCalendarById(b.Id),c&&(d=c.events,c.name(b.Name),c.description(b.Description),c.color(b.Color),this.$calendarGrid.fullCalendar("removeEventSource",{events:d}),this.$calendarGrid.fullCalendar("addEventSource",{events:c.events})))},Tb.prototype.updateCalendarColor=function(a,b){this.isPublic||cc.Ajax.send({Color:a,Id:b,Action:"CalendarUpdateColor"},this.onCalendarUpdateColorResponse,this)},Tb.prototype.onCalendarUpdateColorResponse=function(a,b){var c=null,d=[];a.Result&&(c=this.calendars.getCalendarById(b.Id),c&&(d=c.events,c.color(b.Color),this.$calendarGrid.fullCalendar("removeEventSource",{events:d}),this.$calendarGrid.fullCalendar("addEventSource",{events:c.events})))},Tb.prototype.openGetLinkCalendarForm=function(a){this.isPublic||cc.Screens.showPopup(F,[_.bind(this.publicCalendar,this),a])},Tb.prototype.openShareCalendarForm=function(a){this.isPublic||cc.Screens.showPopup(E,[_.bind(this.shareCalendar,this),a])},Tb.prototype.shareCalendar=function(a,b,c,d,e){this.isPublic||cc.Ajax.send({Action:"CalendarShareUpdate",Id:a,IsPublic:b?1:0,Shares:JSON.stringify(c),ShareToAll:d?1:0,ShareToAllAccess:e},this.onCalendarShareUpdateResponse,this)},Tb.prototype.onCalendarShareUpdateResponse=function(a,b){if(a.Result){var c=this.calendars.getCalendarById(b.Id);c&&(c.shares(JSON.parse(b.Shares)),1===b.ShareToAll?(c.isShared(!0),c.isSharedToAll(!0),c.sharedToAllAccess=b.ShareToAllAccess):(c.isShared(!1),c.isSharedToAll(!1)))}},Tb.prototype.publicCalendar=function(a,b){this.isPublic||cc.Ajax.send({Action:"CalendarPublicUpdate",Id:a,IsPublic:b?1:0},this.onCalendarPublicUpdateResponse,this)},Tb.prototype.onCalendarPublicUpdateResponse=function(a,b){if(a.Result){var c=this.calendars.getCalendarById(b.Id);c&&c.isPublic(b.IsPublic)}},Tb.prototype.deleteCalendar=function(a){var b=this.calendars.getCalendarById(a),c=b?ac.i18n("CALENDAR/CONFIRM_REMOVE_CALENDAR",{CALENDARNAME:b.name()}):"",d=_.bind(function(b){b&&cc.Ajax.send({Id:a,Action:"CalendarDelete"},this.onCalendarDeleteResponse,this)},this);!this.isPublic&&b&&cc.Screens.showPopup(t,[c,d])},Tb.prototype.onCalendarDeleteResponse=function(a,b){if(a.Result){var c=this.calendars.getCalendarById(b.Id);c&&!c.isDefault&&(this.calendars.currentCal().id===c.id&&this.calendars.currentCal(null),this.calendars.removeCalendar(c.id),this.$calendarGrid.fullCalendar("removeEventSource",{events:c.events}))}},Tb.prototype.createNewEventInCurrentCalendar=function(){this.createNewEventToday(this.calendars.currentCal())},Tb.prototype.createNewEventInCalendar=function(a){this.createNewEventToday(this.calendars.getCalendarById(a))},Tb.prototype.createNewEventToday=function(a){var b=moment();b.minutes()>30?b.add("minutes",60-b.minutes()):b.minutes(30),b.seconds(0),b.milliseconds(0),this.openCreateEventForm(a,b,b.clone().add("minutes",30),!1)},Tb.prototype.getParametersFromEventData=function(a){var b={id:a.id,uid:a.uid,calendarId:a.calendarId,newCalendarId:ac.isUnd(a.newCalendarId)?a.calendarId:a.newCalendarId,subject:a.subject,allDay:a.allDay?1:0,location:a.location,description:a.description,alarms:a.alarms?JSON.stringify(a.alarms):"[]",attendees:a.attendees?JSON.stringify(a.attendees):"[]",owner:a.owner,recurrenceId:a.recurrenceId,excluded:a.excluded,allEvents:a.allEvents,modified:a.modified?1:0};return a.rrule&&(b.rrule=JSON.stringify(a.rrule)),b.start=a.start,b.end=a.end,b.startTimestamp=b.start.getTime()/1e3,b.endTimestamp=b.end?b.end.getTime()/1e3:b.startTimestamp,b},Tb.prototype.getEventDataFromParameters=function(a){var b=a;return b.alarms=a.alarms?JSON.parse(a.alarms):[],b.attendees=a.attendees?JSON.parse(a.attendees):[],a.rrule&&(b.rrule=JSON.parse(a.rrule)),b},Tb.prototype.createEventFromGrid=function(a,b,c){this.openCreateEventForm(this.calendars.currentCal(),moment(a),moment(b),c)},Tb.prototype.openCreateEventForm=function(a,b,c,d){this.isPublic||cc.Screens.showPopup(G,[{CallbackSave:_.bind(this.createEvent,this),CallbackDelete:_.bind(this.deleteEvent,this),Calendars:this.calendars,SelectedCalendar:a.id,StartMoment:b,EndMoment:c,AllDay:d,TimeFormat:this.timeFormatMoment,DateFormat:this.dateFormat,CallbackAttendeeActionDecline:_.bind(this.attendeeActionDecline,this),Owner:a.owner()}])},Tb.prototype.createEvent=function(a){var b=this.getParametersFromEventData(a),c=this.$calendarGrid.fullCalendar("getView"),d=c&&c.visStart&&c.visStart.getTime?c.visStart.getTime()/1e3:0,e=c&&c.visEnd&&c.visEnd.getTime?c.visEnd.getTime()/1e3:0;this.isPublic||(b.calendarId=a.newCalendarId,b.selectStart=d,b.selectEnd=e,b.Action="EventCreate",cc.Ajax.send(b,this.onEventActionResponse,this))},Tb.prototype.openEditEventForm=function(a){var b=_.bind(function(b){var c={CallbackSave:_.bind(this.updateEvent,this),CallbackDelete:_.bind(this.deleteEvent,this),ID:a.id,Uid:a.uid,RecurrenceId:a.recurrenceId,Calendars:this.calendars,SelectedCalendar:a.calendarId,AllDay:a.allDay,Location:a.location,Description:a.description,Subject:a.subject,Alarms:a.alarms,Attendees:a.attendees,RRule:a.rrule?a.rrule:null,Excluded:a.excluded?a.excluded:!1,Owner:a.owner,Appointment:a.appointment,OwnerName:a.ownerName,TimeFormat:this.timeFormatMoment,DateFormat:this.dateFormat,AllEvents:b,CallbackAttendeeActionDecline:_.bind(this.attendeeActionDecline,this)};b!==_b.CalendarEditRecurrenceEvent.None&&(b===_b.CalendarEditRecurrenceEvent.AllEvents&&a.rrule?(c.StartMoment=moment(1e3*a.rrule.startBase),c.EndMoment=moment(1e3*a.rrule.endBase)):(c.StartMoment=moment(a.start),c.EndMoment=moment(a.end)),cc.Screens.showPopup(G,[c]))},this);a.rrule?a.excluded?b(_b.CalendarEditRecurrenceEvent.OnlyThisInstance):cc.Screens.showPopup(H,[b]):b(_b.CalendarEditRecurrenceEvent.AllEvents)},Tb.prototype.eventAction=function(a,b,c){var d=this.calendars.getCalendarById(b.calendarId);d.access===_b.CalendarAccess.Read?c&&c():this.isPublic||(c&&(this.revertFunction=c),b.Action=a,cc.Ajax.send(b,this.onEventActionResponse,this))},Tb.prototype.updateEvent=function(a){var b=this.getParametersFromEventData(a),c=this.$calendarGrid.fullCalendar("getView"),d=c&&c.visStart&&c.visStart.getTime?c.visStart.getTime()/1e3:0,e=c&&c.visEnd&&c.visEnd.getTime?c.visEnd.getTime()/1e3:0;b.selectStart=d,b.selectEnd=e,a.modified&&this.eventAction("EventUpdate",b)},Tb.prototype.moveEvent=function(a,b,c,d,e){a.dayDelta=b?b:0,a.minuteDelta=c?c:0;var f=this.getParametersFromEventData(a),g=this.$calendarGrid.fullCalendar("getView"),h=g&&g.visStart&&g.visStart.getTime?g.visStart.getTime()/1e3:0,i=g&&g.visEnd&&g.visEnd.getTime?g.visEnd.getTime()/1e3:0;f.selectStart=h,f.selectEnd=i,this.isPublic||(f.rrule?e(!1):(f.allEvents=_b.CalendarEditRecurrenceEvent.AllEvents,this.eventAction("EventUpdate",f,e)))},Tb.prototype.resizeEvent=function(a,b,c,d){var e=this.getParametersFromEventData(a),f=this.$calendarGrid.fullCalendar("getView"),g=f&&f.visStart&&f.visStart.getTime?f.visStart.getTime()/1e3:0,h=f&&f.visEnd&&f.visEnd.getTime?f.visEnd.getTime()/1e3:0,i=_.bind(function(a){a!==_b.CalendarEditRecurrenceEvent.None?(e.allEvents=a,this.eventAction("EventUpdate",e,d)):d()},this);e.selectStart=g,e.selectEnd=h,a.rrule?e.excluded?i(_b.CalendarEditRecurrenceEvent.OnlyThisInstance):cc.Screens.showPopup(H,[i]):i(_b.CalendarEditRecurrenceEvent.AllEvents)},Tb.prototype.deleteEvent=function(a){var b=this.getParametersFromEventData(a);this.eventAction("EventDelete",b)},Tb.prototype.onEventActionResponse=function(b,c){var d=this.calendars.getCalendarById(c.calendarId),e=null;b&&b.Result&&!ac.isUnd(d)?"EventUpdate"===c.Action||"EventCreate"===c.Action?(this.customscrollTop(parseInt(a(".calendar .scroll-inner").scrollTop(),10)),this.$calendarGrid.fullCalendar("removeEventSource",{events:d.events}),c.rrule&&c.allEvents===_b.CalendarEditRecurrenceEvent.AllEvents?d.removeEventByUid(c.uid,!0):d.removeEvent(c.id),c.newCalendarId&&c.newCalendarId!==c.calendarId&&(this.$calendarGrid.fullCalendar("addEventSource",{events:d.events}),d=this.calendars.getCalendarById(c.newCalendarId),this.$calendarGrid.fullCalendar("removeEventSource",{events:d.events})),_.each(b.Result,function(a){d.addEvent(a)},this),d.active()?this.$calendarGrid.fullCalendar("addEventSource",{events:d.events}):d.active(!0),this.refreshDatePicker(),this.customscrollTop.valueHasMutated()):"EventDelete"===c.Action?(this.$calendarGrid.fullCalendar("removeEventSource",{events:d.events}),c.allEvents===_b.CalendarEditRecurrenceEvent.OnlyThisInstance?d.removeEvent(c.id):d.removeEventByUid(c.uid),this.$calendarGrid.fullCalendar("addEventSource",{events:d.events}),this.refreshDatePicker()):"EventBase"===c.Action&&(e=b.Result,cc.Screens.showPopup(G,[{CallbackSave:_.bind(this.updateEvent,this),CallbackDelete:_.bind(this.deleteEvent,this),ID:e.id,Uid:e.uid,RecurrenceId:e.recurrenceId,Calendars:this.calendars,SelectedCalendar:e.calendarId,StartMoment:moment(1e3*e.start),EndMoment:moment(1e3*e.end),AllDay:e.allDay,Location:e.location,Description:e.description,Subject:e.subject,Alarms:e.alarms,Attendees:e.attendees,RRule:e.rrule?e.rrule:null,Excluded:e.excluded?e.excluded:!1,Owner:e.owner,Appointment:e.appointment,TimeFormat:this.timeFormatMoment,DateFormat:this.dateFormat,AllEvents:_b.CalendarEditRecurrenceEvent.AllEvents}])):this.revertFunction&&this.revertFunction(),this.revertFunction=null},Tb.prototype.attendeeActionDecline=function(a,b){this.$calendarGrid.fullCalendar("removeEventSource",{events:a.events}),a.removeEvent(b),this.$calendarGrid.fullCalendar("addEventSource",{events:a.events}),this.refreshDatePicker()},Ub.prototype.onApplyBindings=function(b){var c=this;this.selector.initOnApplyBindings(".items_sub_list .item",".items_sub_list .selected.item",".items_sub_list .item .custom_checkbox",a(".panel.files .items_list",b),a(".panel.files .items_list .scroll-inner",b)),this.initUploader(),a(document).on("keyup",function(a){a&&a.keyCode===_b.Key.s&&c.selector.useKeyboardKeys()&&!ac.isTextFieldFocused()&&c.isSearchFocused(!0)})},Ub.prototype.initUploader=function(){var a=this;this.uploaderButton()&&this.uploaderArea()&&(this.oJua=new Jua({action:"?/Upload/File/",name:"jua-uploader",queueSize:2,clickElement:this.uploaderButton(),dragAndDropElement:this.uploaderArea(),disableAjaxUpload:this.isPublic?!0:!1,disableFolderDragAndDrop:this.isPublic?!0:!1,disableDragAndDrop:this.isPublic?!0:!1,hidden:{Token:function(){return ec.Token},AccountID:function(){return ec.Accounts.currentId()},AdditionalData:function(b){return JSON.stringify({Type:a.storageType(),SubPath:b&&!ac.isUnd(b.Folder)?b.Folder:"",Path:a.dropPath()})}}}),this.oJua.on("onProgress",_.bind(this.onFileUploadProgress,this)).on("onSelect",_.bind(this.onFileUploadSelect,this)).on("onStart",_.bind(this.onFileUploadStart,this)).on("onDrop",_.bind(this.onDrop,this)).on("onComplete",_.bind(this.onFileUploadComplete,this)).on("onBodyDragEnter",_.bind(this.bDragActive,this,!0)).on("onBodyDragLeave",_.bind(this.bDragActive,this,!1)))},Ub.prototype.onFileUploadSelect=function(a,b){if(ec.App.FileSizeLimit>0&&b.Size/1048576>ec.App.FileSizeLimit)return cc.Screens.showPopup(s,[ac.i18n("FILESTORAGE/ERROR_SIZE_LIMIT",{SIZE:ec.App.FileSizeLimit})]),!1;if(""===this.searchPattern()){var c=new db,d=b.FileName,e=ac.getFileExtension(d),f=ac.getFileNameWithoutExtension(d),g=0,h=ec.Accounts.getDefault();for(""!==e&&(e="."+e);!ac.isUnd(this.getFileByName(d));)d=f+"_"+g+e,g++;c.onUploadSelectOwn(a,b,d,h.email(),this.path(),this.storageType()),this.uploadingFiles.push(c)}},Ub.prototype.onFileUploadStart=function(a){var b=this.getUploadFileByUid(a);b&&b.onUploadStart()},Ub.prototype.onFileUploadProgress=function(a,b,c){if(""===this.searchPattern()){var d=this.getUploadFileByUid(a);d&&d.onUploadProgress(b,c)}},Ub.prototype.onFileUploadComplete=function(a,b,c){if(""===this.searchPattern()){var d=this.getUploadFileByUid(a);d&&(d.onUploadComplete(a,b,c),this.deleteUploadFileByUid(a),d.uploadError()?(this.uploadError(!0),cc.Api.showError(d.statusText())):(this.files.push(d),0===this.uploadingFiles().length&&cc.Api.showReport(ac.i18n("COMPOSE/UPLOAD_COMPLETE")))),this.getFiles(this.storageType(),this.getPathByIndex(this.iPathIndex()),this.searchPattern(),!1)}},Ub.prototype.onDrop=function(a,b){if(!this.isPublic)if(b&&b.target&&""===this.searchPattern()){var d=c.dataFor(b.target);d&&d instanceof db&&d.isFolder()&&this.dropPath(this.path()+"/"+d.fileName())}else cc.Api.showReport(ac.i18n("FILESTORAGE/INFO_CANNOT_UPLOAD_SEARCH_RESULT"))},Ub.prototype.filesDrop=function(a,b,c){if(!this.isPublic&&a&&b){var d=this,e=""!==a.fileName()?a.path()+"/"+a.fileName():a.path(),f=b.ctrlKey?"FilesCopy":"FilesMove",g=[],h=[];(this.path()!==e&&this.storageType()===a.storageType()||this.storageType()!==a.storageType())&&(a.recivedAnim(!0),ac.uiDropHelperAnim(b,c),g=this.selector.listCheckedAndSelected(),h=_.map(g,function(a){return b.ctrlKey||(a.isFolder()?d.deleteFolderByName(a.fileName()):d.deleteFileByName(a.fileName())),{Name:a.fileName(),IsFolder:a.isFolder()}}),cc.Ajax.send({Action:f,FromType:this.storageType(),ToType:a.storageType(),FromPath:this.path(),ToPath:e,Files:JSON.stringify(h)},this.onFilesMoveResponse,this))}},Ub.prototype.onFilesMoveResponse=function(){this.getQuota(this.storageType())},Ub.prototype.dragAndDropHelper=function(b){b&&b.checked(!0);var c=ac.draggableMessages(),d=this.selector.listCheckedAndSelected(),e=d.length,f=0,g=0,h="";return _.each(d,function(a){a.isFolder()?g++:f++},this),0!==f&&0!==g?h=ac.i18n("FILESTORAGE/DRAG_ITEMS_TEXT_PLURAL",{COUNT:e},null,e):0===f?h=ac.i18n("FILESTORAGE/DRAG_FOLDERS_TEXT_PLURAL",{COUNT:g},null,g):0===g&&(h=ac.i18n("FILESTORAGE/DRAG_TEXT_PLURAL",{COUNT:f},null,f)),a(".count-text",c).text(h),c},Ub.prototype.onItemDelete=function(){this.executeDelete()},Ub.prototype.onEnter=function(a){this.onItemDblClick(a)},Ub.prototype.onItemDblClick=function(a){a&&(a.isFolder()?(this.isPublic||this.aPath(this.getCollectionFromPath(a.path())),this.getFiles(this.storageType(),a.fileName())):a.isViewable()?a.viewFile():a.downloadFile())},Ub.prototype.onFilesResponse=function(a,b){if(a.Result){var c=[],d=[];a.Result.Quota&&(this.quota(a.Result.Quota[0]+a.Result.Quota[1]),this.used(a.Result.Quota[0])),_.each(a.Result.Items,function(a){var b=new db;b.parse(a,this.publicHash),b.isFolder()?c.push(b):d.push(b)},this),(this.isPublic||b.Type===this.storageType())&&(this.folders(c),this.files(d)),this.loading(!1)}},Ub.prototype.onQuotaResponse=function(a){a.Result&&a.Result.Quota&&(this.quota(a.Result.Quota[0]+a.Result.Quota[1]),this.used(a.Result.Quota[0]))},Ub.prototype.onFilesDeleteResponse=function(){this.getFiles(this.storageType(),this.getPathByIndex(this.iPathIndex()),this.searchPattern())},Ub.prototype.executeRename=function(){if(!this.isPublic){var a=_.bind(this.renameItem,this),b=this.selector.listCheckedAndSelected();b[0]&&cc.Screens.showPopup(B,[b[0],a])}},Ub.prototype.executeDownload=function(){var a=this.selector.listCheckedAndSelected();a[0]&&!a[0].isFolder()&&a[0].downloadFile()},Ub.prototype.executeShare=function(){if(!this.isPublic){var a=this.selector.listCheckedAndSelected();a[0]&&cc.Screens.showPopup(C,[a[0]])}},Ub.prototype.executeSend=function(){var a=this.selector.listCheckedAndSelected(),b=_.filter(a,function(a){return!a.isFolder()},this);b.length>0&&cc.Routing.goDirectly(cc.Links.compose(),["file",b])},Ub.prototype.onShareIconClick=function(a){a&&cc.Screens.showPopup(C,[a])},Ub.prototype.renameItem=function(a){cc.Ajax.send({Action:"FilesRename",Type:this.storageType(),Path:a.path(),Name:a.fileName(),NewName:a.nameForEdit()},this.onFilesRenameResponse,this)},Ub.prototype.onFilesRenameResponse=function(){this.getFiles(this.storageType(),this.getPathByIndex(this.iPathIndex()),this.searchPattern())},Ub.prototype.executeDelete=function(){if(!this.isPublic){var a=this.selector.listCheckedAndSelected(),b=ac.i18n("FILESTORAGE/CONFIRMATION_DELETE"),c=_.bind(this.deleteItems,this,a);a&&a.length>0&&cc.Screens.showPopup(t,[b,c])}},Ub.prototype.onShow=function(){this.getGroups();var a="";this.isPublic||(a=this.getPathByIndex(this.iPathIndex())),this.getFiles(this.storageType(),a),this.selector.useKeyboardKeys(!0),this.oJua&&this.oJua.setDragAndDropEnabledStatus(!0)},Ub.prototype.onHide=function(){this.selector.useKeyboardKeys(!1),this.oJua&&this.oJua.setDragAndDropEnabledStatus(!1)},Ub.prototype.getQuota=function(a){cc.Ajax.send({Action:"FilesQuota",Type:a},this.onQuotaResponse,this)},Ub.prototype.getGroups=function(){var a=null;this.groups.removeAll(),this.isPublic||(a=new db,a.storageType(_b.FileStorageType.Private).displayName(ac.i18n("FILESTORAGE/TAB_PRIVATE_FILES")).isFolder(!0),this.groups.push(a),a=new db,a.storageType(_b.FileStorageType.Corporate).displayName(ac.i18n("FILESTORAGE/TAB_CORPORATE_FILES")).isFolder(!0),this.groups.push(a))},Ub.prototype.getFiles=function(a,b,c,d){if(this.isPublic)return this.getFilesPub(b);this.lastPath(this.path()),(ac.isUnd(d)||!ac.isUnd(d)&&d)&&this.loading(!0),c=ac.isUnd(c)?"":ac.pString(c),this.storageType(a),this.searchPattern(c);var e=new db;ac.isUnd(b)||""===b?(this.aPath.removeAll(),e.displayName(this.rootPath())):e.fileName(b),e.path(this.getFullPathByIndex(this.aPath().length)).storageType(a).isFolder(!0),this.aPath.push(e),this.iPathIndex(this.aPath().length-1),this.lastPath()!==this.path()&&(this.folders([]),this.files([])),cc.Ajax.sendExt({Action:"Files",Type:a,Path:this.path(),Pattern:this.searchPattern()},this.onFilesResponse,this)},Ub.prototype.getFilesPub=function(a){this.lastPath(this.path());var b=new db;ac.isUnd(a)||""===a?(this.aPath.removeAll(),b.displayName(this.rootPath())):b.fileName(a),b.path(this.getFullPathByIndex(this.aPath().length)).isFolder(!0),this.aPath.push(b),this.iPathIndex(this.aPath().length-1),this.lastPath()!==this.path()&&(this.folders([]),this.files([])),cc.Ajax.sendExt({Action:"FilesPub",Hash:ec.FileStoragePubHash,Path:this.path()},this.onFilesResponse,this)},Ub.prototype.deleteItems=function(a,b){if(b&&0<a.length){var c=_.map(a,function(a){return a.deleted(!0),{Path:a.path(),Name:a.fileName()}});cc.Ajax.send({Action:"FilesDelete",Type:this.storageType(),Path:this.path(),Items:JSON.stringify(c)},this.onFilesDeleteResponse,this)}},Ub.prototype.getPathByIndex=function(a){var b=this.aPath()[a],c="";return this.aPath(this.aPath().slice(0,a)),b&&(c=b.fileName()),c},Ub.prototype.getFullPathByIndex=function(a){var b=_.map(this.aPath().slice(0,a),function(a){return a.fileName()});return b.join("/")},Ub.prototype.getCollectionFromPath=function(a){var b=[],c=[],d=null,e=[],f="",g=[],h="";return""!==a?(c=a.split("/"),_.each(c,function(a){if(h=a,""===a){if(this.isPublic)return;h=this.rootPath()}e.push(a),g=e.slice(0,-1),f=g.join("/"),d=new db,d.fileName(a).displayName(h).isFolder(!0).path(f).storageType(this.storageType()),b.push(d)},this)):(d=new db,d.displayName(this.rootPath()).isFolder(!0).storageType(this.storageType()),b.push(d)),b},Ub.prototype.getFileByName=function(a){return _.find(this.files(),function(b){return b.fileName()===a})},Ub.prototype.deleteFileByName=function(a){var b=_.filter(this.files(),function(b){return b.fileName()!==a});this.files(b)},Ub.prototype.deleteFolderByName=function(a){var b=_.filter(this.folders(),function(b){return b.fileName()!==a});this.folders(b)},Ub.prototype.getUploadFileByUid=function(a){return _.find(this.uploadingFiles(),function(b){return b.uploadUid()===a})},Ub.prototype.deleteUploadFileByUid=function(a){var b=_.filter(this.uploadingFiles(),function(b){return b.uploadUid()!==a});this.uploadingFiles(b)},Ub.prototype.getUploadingFiles=function(){var a=[],b=this.uploadingFiles(),c=this;return ac.isUnd(b)||(a=_.filter(b,function(a){return a.path()===c.path()&&a.storageType()===c.storageType()})),a},Ub.prototype.onCancelUpload=function(a){this.oJua&&this.oJua.cancel(a),this.deleteUploadFileByUid(a)},Ub.prototype.onCreateFolderResponse=function(){this.getFiles(this.storageType(),this.getPathByIndex(this.iPathIndex()))},Ub.prototype.createFolder=function(a){cc.Ajax.send({Action:"FilesFolderCreate",Type:this.storageType(),Path:this.path(),FolderName:a},this.onCreateFolderResponse,this)},Ub.prototype.onCreateFolderClick=function(){var a=_.bind(this.createFolder,this);cc.Screens.showPopup(A,[a])},Ub.prototype.onSearch=function(){this.getFiles(this.storageType(),this.getPathByIndex(this.iPathIndex()),this.searchPattern())},Ub.prototype.clearSearch=function(){this.getFiles(this.storageType(),this.getPathByIndex(this.iPathIndex()))},Vb.prototype.requestFromLogin=function(){cc.Storage.getData("helpdeskQuestion")&&(this.newThreadText(cc.Storage.getData("helpdeskQuestion")),cc.Storage.setData("helpdeskQuestion"),this.executeThreadCreate())},Vb.prototype.clearQuickReply=function(){this.replyText(""),this.replyTextFocus(!1),this.internalNote(!1),this.uploadedFiles([]),this.isQuickReplyActive(!1)},Vb.prototype.onOwnerContactResponse=function(a){a?(this.ownerContact(a),this.ownerExistsInContacts(!0)):(this.ownerContact(new Z),this.ownerExistsInContacts(!1)),this.ownerContactInfoReceived(!0)},Vb.prototype.updateOpenerWindow=function(){this.singleMode&&b.opener&&b.opener.App&&b.opener.App.updateHelpdesk()},Vb.prototype.deletePost=function(a){if(a&&a.itsMe()){var b=this,c=function(c){c&&cc.Ajax[b.ajaxSendFunc]({Action:"HelpdeskPostDelete",PostId:a.Id,ThreadId:a.IdThread,IsExt:b.bExtApp?1:0},b.onHelpdeskPostDeleteResponse,b)};cc.Screens.showPopup(t,[ac.i18n("HELPDESK/CONFIRM_DELETE_THIS_POST"),c])}},Vb.prototype.onHelpdeskPostDeleteResponse=function(a){a.Result===!1?cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("HELPDESK/ERROR_COULDNT_DELETE_POST")):cc.Api.showReport(ac.i18n("HELPDESK/REPORT_POST_HAS_BEEN_DELETED")),this.requestPosts(),this.updateOpenerWindow()},Vb.prototype.addToContacts=function(){this.selectedItem()&&cc.ContactsCache.addToContacts("",this.selectedItem().sEmail,this.onAddToContactsResponse,this)},Vb.prototype.iHaveMoreToSay=function(){var a=this;this.isQuickReplyHidden(!1),_.delay(function(){a.replyTextFocus(!0)},300)},Vb.prototype.onAddToContactsResponse=function(a,b){a.Result&&this.selectedItem()&&""!==b.HomeEmail&&b.HomeEmail===this.selectedItem().sEmail&&(cc.Api.showReport(ac.i18n("CONTACTS/REPORT_CONTACT_SUCCESSFULLY_ADDED")),cc.ContactsCache.clearInfoAboutEmail(this.selectedItem().sEmail),cc.ContactsCache.getContactByEmail(this.selectedItem().sEmail,this.onOwnerContactResponse,this))},Vb.prototype.viewAllMailsWithContact=function(){var a=this.selectedItem()?this.selectedItem().sEmail:"";this.hasOwnerContact()&&(a=this.ownerContact().getEmailsString()),""!==a&&cc.MailCache.searchMessagesInCurrentFolder("email:"+a)},Vb.prototype.scrollPostsToBottom=function(){this.scrollToBottomTrigger(!this.scrollToBottomTrigger())},Vb.prototype.scrollPostsToTop=function(){this.scrollToTopTrigger(!this.scrollToTopTrigger())},Vb.prototype.showClientDetails=function(){this.clientDetailsVisible(!0)},Vb.prototype.hideClientDetails=function(){this.clientDetailsVisible(!1)},Vb.prototype.startAutochekmail=function(){var a=this,b=ec&&ec.User?ec.User.AutoCheckMailInterval:1;b>0&&(clearTimeout(this.iAutoCheckTimer),this.iAutoCheckTimer=setTimeout(function(){a.checkCommand()},60*b*1e3))},Vb.prototype.onApplyBindings=function(b){this.selector.initOnApplyBindings(".items_sub_list .item",".items_sub_list .selected.item",".items_sub_list .item .custom_checkbox",a(".items_list",b),a(".items_list .scroll-inner",b)),this.initUploader(),a(this.domQuickReply()).on("click",_.bind(function(a){this.isQuickReplyActive(!0),a.stopPropagation()},this)),a(document.body).on("click",_.bind(function(){this.isEmptyQuickReplyPane()&&this.isQuickReplyActive(!1)},this)),cc.registerHelpdeskUpdateFunction&&cc.registerHelpdeskUpdateFunction(_.bind(this.checkCommand,this)),this.startAutochekmail()},Vb.prototype.onShow=function(){this.selector.useKeyboardKeys(!0),this.oPageSwitcher.perPage(this.ThreadsPerPage),this.oPageSwitcher.currentPage(1),this.requestThreadsList()},Vb.prototype.onHide=function(){this.selector.useKeyboardKeys(!1),this.selectedItem(null)},Vb.prototype.requestThreadsList=function(){this.loadingList(!0),this.checkStarted(!0),cc.Ajax[this.ajaxSendFunc]({Action:"HelpdeskThreadsList",IsExt:this.bExtApp?1:0,Offset:(this.oPageSwitcher.currentPage()-1)*this.ThreadsPerPage,Limit:this.ThreadsPerPage,Filter:this.listFilter(),Search:this.search()},this.onHelpdeskThreadsListResponse,this)},Vb.prototype.onHelpdeskThreadsListResponse=function(a){var b=0,c=0,d=this.selectedItem(),e=d?ac.pString(d.Id):"",f=[],g=null,h=null,i=a.Result&&_.isArray(a.Result.List)?a.Result.List:[];if(a.Result===!1)cc.Api.showErrorByCode(a.ErrorCode);else{for(c=i.length;c>b;b++)i[b]&&"Object/CHelpdeskThread"===ac.pExport(i[b],"@Object","")&&(g=new fb,g.parse(i[b]),g.OwnerIsMe=ac.pString(g.IdOwner),e===ac.pString(g.Id)&&(d.postsCount(g.postsCount()),g.selected(!0),this.selector.itemSelected(g)),f.push(g));this.loadingList(!1),this.checkStarted(!1),this.threads(f),this.oPageSwitcher.setCount(ac.pInt(a.Result.ItemsCount)),ec.HelpdeskThreadId&&(h=_.find(f,function(a){return a.Id===ec.HelpdeskThreadId},this),h&&(h=h,this.onItemSelect(h)))}},Vb.prototype.requestPosts=function(a,b){var c=this.selectedItem(),d=a?a.Id:c?c.Id:0,e=b?b:0,f={};d&&(f={Action:"HelpdeskThreadPosts",IsExt:this.bExtApp?1:0,ThreadId:d,StartFromId:e,Limit:5},e&&this.loadingMoreMessages(!0),cc.Ajax[this.ajaxSendFunc](f,this.onHelpdeskThreadPostsResponse,this))},Vb.prototype.onHelpdeskThreadPostsResponse=function(a){var b=this,c=!1,d=0,e=0,f=[],g=[],h=null,i="",j=a.Result&&_.isArray(a.Result.List)?a.Result.List:[];if(a.Result===!1)cc.Api.showErrorByCode(a.ErrorCode);else{if(this.selectedItem()&&a.Result.ThreadId===this.selectedItem().Id){for(this.selectedItem().postsCount(ac.pInt(a.Result.ItemsCount)),e=j.length;e>d;d++)j[d]&&"Object/CHelpdeskPost"===ac.pExport(j[d],"@Object","")&&(h=new eb,h.parse(j[d]),f.push(h));if(a.Result.StartFromId){for(g=this.posts(),i=a.Result.StartFromId,e=g.length,d=0;e>d&&g.Id!==i;d++);f=_.union(_.first(g,d).reverse(),f),this.loadingMoreMessages(!1)}else c=!0;this.selectedItem().unseen()&&this.executeThreadSeen(this.selectedItem().Id)}this.posts(f.reverse()),c?(b.scrollPostsToBottom(),_.delay(function(){b.scrollPostsToBottom()},10),_.delay(function(){b.scrollPostsToBottom()},100)):b.scrollPostsToTop()}},Vb.prototype.onItemClick=function(a){var b=cc.Routing.setHash([_b.Screens.Helpdesk,a.ThreadHash]);b&&this.onItemSelect(a)},Vb.prototype.onRoute=function(a){var b=a[0],c=_.find(this.threads(),function(a){return a.ThreadHash===b});c?(c=c,this.onItemSelect(c)):0===this.threads().length&&this.loadingList()&&void 0===this.threadSubscription&&!ec.SingleMode?this.threadSubscription=this.threads.subscribe(function(){this.onRoute(a),this.threadSubscription.dispose(),this.threadSubscription=void 0},this):b&&cc.Ajax[this.ajaxSendFunc]({Action:"HelpdeskGetThreadByHash",IsExt:this.bExtApp?1:0,ThreadHash:b},this.onHelpdeskGetThreadByHashResponse,this)},Vb.prototype.onHelpdeskGetThreadByHashResponse=function(a){var b=new fb;a.Result&&(b.parse(a.Result),b.OwnerIsMe=ac.pString(b.IdOwner),this.onItemSelect(b))},Vb.prototype.onItemSelect=function(a){if(this.visibleNewThread(!1),this.selector.listCheckedAndSelected(!1),this.selector.itemSelected(this.selectedItem()),null===this.selectedItem()||this.selectedItem().Id!==a.Id)if(this.uploadedFiles().length>0||this.replyText().length>0){var b=this.selectedItem(),c=ac.i18n("HELPDESK/CONFIRM_CANCEL_REPLY"),d=_.bind(function(c){c?(this.clearQuickReply(),this.selector.itemSelected(a),this.selectedItem(a),this.visibleNewThread(!1),this.isQuickReplyHidden(a.ItsMe||!this.bAgent),this.requestPosts(a)):(this.replyTextFocus(!0),this.isQuickReplyHidden(!1),this.selector.itemSelected(b),this.selectedItem(b))},this);cc.Screens.showPopup(t,[c,d])}else this.clearQuickReply(),this.selector.itemSelected(a),this.selectedItem(a),this.isQuickReplyHidden(a.ItsMe||!this.bAgent),this.requestPosts(a)},Vb.prototype.onItemDelete=function(){this.executeDelete()},Vb.prototype.onEnter=function(a){this.onItemDblClick(a)},Vb.prototype.onItemDblClick=function(a){a&&(a.isViewable()?a.viewFile():a.downloadFile())},Vb.prototype.openNewThread=function(){if(this.uploadedFiles().length>0||this.replyText().length>0){var a=ac.i18n("HELPDESK/CONFIRM_CANCEL_REPLY"),b=_.bind(function(a){a?(this.clearQuickReply(),this.visibleNewThread(!0)):this.visibleNewThread(!1)},this);cc.Screens.showPopup(t,[a,b])}else this.selector.itemSelected(null),this.selectedItem(null),this.visibleNewThread(!0)},Vb.prototype.cancelNewThread=function(){if(this.uploadedFiles().length>0||this.newThreadText().length>0){var a=ac.i18n("HELPDESK/CONFIRM_CANCEL_REPLY"),b=_.bind(function(a){a&&(this.newThreadText(""),this.uploadedFiles([]),this.visibleNewThread(!1))},this);cc.Screens.showPopup(t,[a,b])}else this.newThreadText(""),this.uploadedFiles([]),this.visibleNewThread(!1),this.selector.itemSelected(null),this.selectedItem(null)},Vb.prototype.onSearch=function(){this.requestThreadsList()},Vb.prototype.clearSearch=function(){this.requestThreadsList()},Vb.prototype.isEnableListActions=function(){return!!this.selectedItem()},Vb.prototype.executeDelete=function(){var a=this,b=this.selectedItem();b&&(_.each(this.threads(),function(a){a===b&&a.deleted(!0)}),_.delay(function(){a.threads.remove(function(a){return a.deleted()})},500),this.selectedItem(null),cc.Ajax[this.ajaxSendFunc]({Action:"HelpdeskThreadDelete",IsExt:this.bExtApp?1:0,ThreadId:b.Id},this.onHelpdeskThreadDeleteResponse,this),cc.Routing.setHash([_b.Screens.Helpdesk,""]))},Vb.prototype.executeOpenNewWindow=function(){var a=cc.Routing.buildHashFromArray([_b.Screens.SingleHelpdesk,this.selectedItem().ThreadHash]);ac.WindowOpener.openTab(a)},Vb.prototype.onHelpdeskThreadDeleteResponse=function(){this.requestThreadsList(),this.updateOpenerWindow()},Vb.prototype.executeChangeState=function(a){var b=this.selectedItem();void 0!==a&&b&&(b.state(a),cc.Ajax[this.ajaxSendFunc]({Action:"HelpdeskThreadChangeState",IsExt:this.bExtApp?1:0,ThreadId:b.Id,Type:b.state()},this.onHelpdeskThreadChangeStateResponse,this))},Vb.prototype.onHelpdeskThreadChangeStateResponse=function(){this.requestThreadsList(),this.updateOpenerWindow()},Vb.prototype.executeThreadPing=function(a){void 0!==a&&cc.Ajax[this.ajaxSendFunc]({Action:"HelpdeskThreadPing",IsExt:this.bExtApp?1:0,ThreadId:a},this.onThreadPingResponse,this)},Vb.prototype.onThreadPingResponse=function(a){var b=ac.isNonEmptyArray(a.Result)?_.map(a.Result,function(a){var b=a.length>0?a[0]:"",c=a.length>0?a[1]:"",d=b;
return c.length>0&&b.length>0?d='"'+b+'" <'+c+">":c.length>0&&(d=c),d},this):[],c=_.without(b,"");this.watchers(c)},Vb.prototype.executeThreadSeen=function(a){void 0!==a&&cc.Ajax[this.ajaxSendFunc]({Action:"HelpdeskThreadSeen",IsExt:this.bExtApp?1:0,ThreadId:a},this.onHelpdeskThreadSeenResponse,this)},Vb.prototype.onHelpdeskThreadSeenResponse=function(a,b){var c=0,d=0,e=[],f=0;if(b.ThreadId&&(e=this.threads(),f=this.selectedItem()?this.selectedItem().Id:0,f>0))for(d=e.length;d>c;c++)if(f===b.ThreadId){this.selectedItem().unseen(!1);break}this.updateOpenerWindow()},Vb.prototype.executeThreadCreate=function(){var a="",b=-1;a=ac.trim(this.newThreadText().replace(/[\n\r]/," ")),b=a.indexOf(" ",40),b>=0&&(a=a.substring(0,b)),this.newThreadCreating(!0),this.sendHelpdeskPostCreate(0,a,this.newThreadText(),this.onThreadCreateResponse)},Vb.prototype.onThreadCreateResponse=function(a,b){this.newThreadCreating(!1),a.Result&&b&&(cc.Api.showReport(ac.i18n("HELPDESK/REPORT_THREAD_SUCCESSFULLY_CREATED")),this.posts([]),this.uploadedFiles([]),this.newThreadText(""),this.visibleNewThread(!1)),this.requestThreadsList(),this.updateOpenerWindow()},Vb.prototype.executePostCreate=function(){this.selectedItem()&&(this.replySendingStarted(!0),this.sendHelpdeskPostCreate(this.selectedItem().Id,"",this.replyText(),this.onPostCreateResponse))},Vb.prototype.onPostCreateResponse=function(a,b){this.replySendingStarted(!1),a.Result&&b&&(cc.Api.showReport(ac.i18n("HELPDESK/REPORT_POST_SUCCESSFULLY_ADDED")),this.clearQuickReply(),this.requestPosts()),this.requestThreadsList(),this.updateOpenerWindow()},Vb.prototype.sendHelpdeskPostCreate=function(a,b,c,d){var e={},f={};_.each(this.uploadedFiles(),function(a){e[a.tempName()]=a.hash()}),f={Action:"HelpdeskPostCreate",IsExt:this.bExtApp?1:0,ThreadId:a,IsInternal:this.internalNote()?1:0,Subject:b,Text:c,Attachments:e},cc.Ajax[this.ajaxSendFunc](f,d,this)},Vb.prototype.executeShowThreadsByOwner=function(){this.search("owner:"+this.selectedItem().aOwner[0]),this.prevListFilter(this.listFilter()),this.listFilter(_b.HelpdeskFilters.All)},Vb.prototype.onClearSearchClick=function(){this.search(""),""!==this.prevListFilter()&&(this.listFilter(this.prevListFilter()),this.prevListFilter("")),this.searchSubmitCommand()},Vb.prototype.initUploader=function(){this.oJua=this.createJuaObject(this.uploaderButton()),this.oJuaCompose=this.createJuaObject(this.uploaderButtonCompose())},Vb.prototype.createJuaObject=function(a){if(a){var b=new Jua({action:"?/Upload/HelpdeskFile/",name:"jua-uploader",queueSize:2,clickElement:a,dragAndDropElement:a,disableAjaxUpload:!1,disableFolderDragAndDrop:!1,disableDragAndDrop:!1,hidden:{IsExt:this.bExtApp?"1":"0",Token:ec.Token,TenantHash:this.bExtApp&&ec?ec.TenantHash:"",AccountID:this.bExtApp?0:ec.Accounts.currentId()}});return b.on("onProgress",_.bind(this.onFileUploadProgress,this)).on("onSelect",_.bind(this.onFileUploadSelect,this)).on("onStart",_.bind(this.onFileUploadStart,this)).on("onComplete",_.bind(this.onFileUploadComplete,this)).on("onBodyDragEnter",_.bind(this.bDragActive,this,!0)).on("onBodyDragLeave",_.bind(this.bDragActive,this,!1)),b}return null},Vb.prototype.onFileRemove=function(a){var b=this.getUploadedFileByUID(a);this.oJua&&this.oJua.cancel(a),this.uploadedFiles.remove(b)},Vb.prototype.getUploadedFileByUID=function(a){return _.find(this.uploadedFiles(),function(b){return b.uploadUid()===a})},Vb.prototype.onFileUploadSelect=function(a,b){var c,d=ac.i18n("COMPOSE/UPLOAD_ERROR_FILENAME_SIZE",{FILENAME:b.FileName}),e=ac.i18n("HELPDESK/ERROR_UPLOAD_FILES_COUNT"),f=ac.i18n("MAIN/BUTTON_CLOSE"),g=this.uploadedFiles().length;return g>=5?(cc.Screens.showPopup(s,[e,null,"",f]),!1):ec.App&&ec.App.AttachmentSizeLimit>0&&b.Size>ec.App.AttachmentSizeLimit?(cc.Screens.showPopup(s,[d]),!1):(c=new gb,c.onUploadSelect(a,b),this.uploadedFiles.push(c),!0)},Vb.prototype.onFileUploadProgress=function(a,b,c){var d=this.getUploadedFileByUID(a);d&&d.onUploadProgress(b,c)},Vb.prototype.onFileUploadStart=function(a){var b=this.getUploadedFileByUID(a);b&&b.onUploadStart()},Vb.prototype.onFileUploadComplete=function(a,b,c){var d=this.getUploadedFileByUID(a);d&&d.onUploadComplete(a,b,c)},Wb.prototype.initScreens=function(){},Wb.prototype.initLayout=function(){},Wb.prototype.init=function(){this.initScreens(),this.initLayout(),a("#pSevenContent").addClass("single_mode"),_.defer(function(){ec.SingleMode||a("#pSevenContent").removeClass("single_mode")}),this.informationScreen(this.showNormalScreen(_b.Screens.Information))},Wb.prototype.showCurrentScreen=function(a,b){this.currentScreen()!==a&&(this.hideCurrentScreen(),this.currentScreen(a)),this.showNormalScreen(a,b)},Wb.prototype.hideCurrentScreen=function(){this.currentScreen().length>0&&this.hideScreen(this.currentScreen())},Wb.prototype.hideScreen=function(a){var b=a,c=this.oScreens[b];"undefined"!=typeof c&&c.bInitialized&&c.Model.hideViewModel()},Wb.prototype.showNormalScreen=function(a,b){var c=a,d=this.oScreens[c];return d&&(d.bInitialized="boolean"!=typeof d.bInitialized?!1:d.bInitialized,d.bInitialized||(d.Model=this.initViewModel(d.Model,d.TemplateName),d.bInitialized=!0),d.Model.showViewModel(b)),d?d.Model:null},Wb.prototype.initViewModel=function(b,d){var e=null,f=null;return e=new b,f=a('div[data-view-model="'+d+'"]').attr("data-bind","template: {name: '"+d+"'}").hide(),e.$viewModel=f,e.bShown=!1,e.showViewModel=function(a){this.$viewModel.show(),"function"==typeof this.onRoute&&this.onRoute(a),this.bShown||("function"==typeof this.onShow&&this.onShow(a),dc.runPluginHook&&this.__name&&dc.runPluginHook("view-model-on-show",[this.__name,this]),this.bShown=!0)},e.hideViewModel=function(){this.$viewModel.hide(),"function"==typeof this.onHide&&this.onHide(),this.bShown=!1},c.applyBindings(e,f[0]),"function"==typeof e.onApplyBindings&&e.onApplyBindings(f),e},Wb.prototype.showPopup=function(b,d){if(b){if(!b.__builded){var e=null,f=new b,g=f.popupTemplate?f.popupTemplate():"";""!==g&&(e=a('div[data-view-model="'+g+'"]').attr("data-bind","template: {name: '"+g+"'}").removeClass("visible").hide(),e&&1===e.length&&(f.visibility=c.observable(!1),b.__builded=!0,b.__vm=f,f.$viewModel=e,b.__dom=e,f.showViewModel=ac.createCommand(f,function(){cc&&cc.Screens&&cc.Screens.showPopup(b)}),f.closeCommand=ac.createCommand(f,function(){cc&&cc.Screens&&cc.Screens.hidePopup(b)}),c.applyBindings(f,e[0]),ac.delegateRun(f,"onApplyBindings",[e])))}b.__vm&&b.__dom&&(b.__dom.show(),_.delay(function(){b.__dom.addClass("visible")},50),b.__vm.visibility(!0),ac.delegateRun(b.__vm,"onShow",d),this.popupVisibility(!0),this.popups.push(b),this.keyupPopupBinded=_.bind(this.keyupPopup,this,b.__vm),a(document).on("keyup",this.keyupPopupBinded))}},Wb.prototype.keyupPopup=function(a,c){if(c){var d=b.parseInt(c.keyCode,10);27===d&&a.closeCommand(),13!==d&&32!==d||!a.onEnterHandler||a.onEnterHandler()}},Wb.prototype.hidePopup=function(b){b&&b.__vm&&b.__dom&&(this.keyupPopupBinded&&(a(document).off("keyup",this.keyupPopupBinded),this.keyupPopupBinded=void 0),b.__dom.removeClass("visible").hide(),b.__vm.visibility(!1),ac.delegateRun(b.__vm,"onHide"),this.popupVisibility(!1),this.popups=_.without(this.popups,b))},Wb.prototype.hideAllPopup=function(){_.each(this.popups,function(a){this.hidePopup(a)},this)},Wb.prototype.showLoading=function(a){this.informationScreen()&&this.informationScreen().showLoading(a)},Wb.prototype.hideLoading=function(){this.informationScreen()&&this.informationScreen().hideLoading()},Wb.prototype.showReport=function(a,b){this.informationScreen()&&this.informationScreen().showReport(a,b)},Wb.prototype.showError=function(a,b,c){this.informationScreen()&&this.informationScreen().showError(a,b,c)},Wb.prototype.hideError=function(){this.informationScreen()&&this.informationScreen().hideError()},Wb.prototype.initScreens=function(){this.oScreens[_b.Screens.Information]={Model:ob,TemplateName:"Common_InformationViewModel"},this.oScreens[_b.Screens.Login]={Model:ub,TemplateName:"Login_LoginViewModel"},this.oScreens[_b.Screens.Header]={Model:pb,TemplateName:"Common_HeaderViewModel"},this.oScreens[_b.Screens.Mailbox]={Model:yb,TemplateName:"Mail_LayoutSidePane_MailViewModel"},this.oScreens[_b.Screens.BottomMailbox]={Model:yb,TemplateName:"Mail_LayoutBottomPane_MailViewModel"},this.oScreens[_b.Screens.SingleMessageView]={Model:xb,TemplateName:"Mail_LayoutSidePane_MessagePaneViewModel"},this.oScreens[_b.Screens.Compose]={Model:zb,TemplateName:"Mail_ComposeViewModel"},this.oScreens[_b.Screens.SingleCompose]={Model:zb,TemplateName:"Mail_ComposeViewModel"},this.oScreens[_b.Screens.Settings]={Model:Cb,TemplateName:"Settings_SettingsViewModel"},this.oScreens[_b.Screens.SingleHelpdesk]={Model:Vb,TemplateName:"Helpdesk_ViewThreadInNewWindow"}},Wb.prototype.initLayout=function(){a("#pSevenContent").append(a("#Layout").html())},Xb.prototype.init=function(){var a=null;ec.SingleMode&&b.opener&&(a=b.opener.App.MailCache,this.oFolderListItems=a.oFolderListItems,b.name&&this.currentAccountId(ac.pInt(b.name))),this.currentAccountId.valueHasMutated()},Xb.prototype.getCurrentFolder=function(){return this.folderList().currentFolder()},Xb.prototype.getFolderByFullName=function(a,b){var c=this.oFolderListItems[a];return c?c.getFolderByFullName(b):null},Xb.prototype.getFolderList=function(a){var b={Action:"FolderList"};ac.isUnd(a)||(b.AccountID=a),cc.Ajax.send(b,this.onFolderListResponse,this)},Xb.prototype.markMessageReplied=function(a,b,c,d){var e=this.oFolderListItems[a],f=null;e&&(f=e.getFolderByFullName(b),f&&f.markMessageReplied(c,d))},Xb.prototype.setFolderCounts=function(a,b,c,d,e,f){var g=this.oFolderListItems[a],h=null,i=!1,j=!1;return g&&(h=g.getFolderByFullName(b),h&&(i=h.setRelevantInformation(e,f,c,d,!0),i&&h.selected()&&(j=!0,this.startCheckMail()))),j},Xb.prototype.hideThreads=function(a){ec.User.useThreads()&&a.folder()===this.folderList().currentFolderFullName()&&!a.threadOpened()&&this.folderList().currentFolder().hideThreadMessages(a)},Xb.prototype.showOpenedThreads=function(a){this.messages(this.getMessagesWithThreads(a,this.uidList(),this.messages()))},Xb.prototype.getMessagesWithThreads=function(a,b,c){var d=[],e=[],f=this.folderList().currentFolder(),g=f&&f.withoutThreads(),h=""===b.search()&&""===b.filters();return a===f.fullName()&&ec.User.useThreads()&&!g&&h?(e=_.filter(c,function(a){return!a.threadPart()}),_.each(e,function(a){var b=[];d.push(a),a.threadCount()>0&&(a.threadOpened()&&(b=this.folderList().currentFolder().getThreadMessages(a),d=_.union(d,b)),this.folderList().currentFolder().computeUnreadThreadCount(a))},this),ac.log("Get messages with threads",c.length,"Messages without threads",e.length,"Messages with opened threads",d.length),d):c},Xb.prototype.setMessagesFromUidList=function(a,b,c,d){var e=a.getUidsForOffset(b,c),f=_.map(e,function(a){return c[a]},this),g=f.length;return d&&(this.messages(this.getMessagesWithThreads(this.folderList().currentFolderFullName(),a,f)),b+g<a.resultCount()&&g<ec.User.MailsPerPage&&this.messagesLoading(!0),this.currentMessage()&&(this.currentMessage().deleted()||this.currentMessage().folder()!==this.folderList().currentFolderFullName())&&(ac.log("setMessagesFromUidList currentMessage = null",this.currentMessage().deleted(),this.currentMessage().folder(),this.folderList().currentFolderFullName()),this.currentMessage(null))),e},Xb.prototype.startCheckMail=function(){var a=this.folderList().currentFolderFullName(),b=this.page(),c=this.uidList().search();""!==a&&this.requestCurrentMessageList(a,b,c,"",!1)},Xb.prototype.executeCheckMail=function(){var a=this.folderList(),b=a?a.getInboxAndCurrentFoldersArray():[],c={Action:"FolderCounts",Folders:b,AccountID:a?a.iAccountId:0};!this.checkMailStarted()&&b.length>0&&(this.checkMailStarted(!0),ac.log("Check mail started - executeCheckMail",this.checkMailStarted()),cc.Ajax.send(c,this.onFolderCountsResponse,this))},Xb.prototype.setAutocheckmailTimer=function(){clearTimeout(this.iAutoCheckMailTimer),!ec.SingleMode&&ec.User.AutoCheckMailInterval>0&&(this.iAutoCheckMailTimer=setTimeout(function(){cc.Ajax.isSearchMessages()||cc.MailCache.executeCheckMail()},60*ec.User.AutoCheckMailInterval*1e3))},Xb.prototype.changeCurrentMessageList=function(a,b,c,d){this.requestCurrentMessageList(a,b,c,d,!0)},Xb.prototype.requestCurrentMessageList=function(a,b,c,d,e){var f=this.requestMessageList(a,b,c,d||"",!0,e||!1);this.uidList(f.UidList),this.page(b),this.messagesLoading(f.DataExpected),this.messagesLoadingError(!1),cc.Prefetcher.start()},Xb.prototype.requestMessageList=function(a,b,c,d,e,f){var g=this.oFolderListItems[this.currentAccountId()],h=g?g.getFolderByFullName(a):null,i=h&&h.withoutThreads(),j=ec.User.useThreads()&&!i&&""===c&&""===d,k=h?h.getUidList(c,d):null,l=(b-1)*ec.User.MailsPerPage,m=k?this.setMessagesFromUidList(k,l,h.oMessages,f):[],n={Action:"MessageList",Folder:a,Offset:l,Limit:ec.User.MailsPerPage,Search:c,Filters:d,UseThreads:j?"1":"0"},o=!1,p=!1,q=e?this.onCurrentMessageListResponse:this.onMessageListResponse;return k&&(p=-1===k.resultCount()||l+m.length<k.resultCount()&&m.length<ec.User.MailsPerPage,o=h.hasChanges()||p),o&&cc.Ajax.send(n,q,this),{UidList:k,RequestStarted:o,DataExpected:p}},Xb.prototype.executeEmptyTrash=function(){var a=this.folderList().trashFolder();a&&a.emptyFolder()},Xb.prototype.executeEmptySpam=function(){var a=this.folderList().spamFolder();a&&a.emptyFolder()},Xb.prototype.onClearFolder=function(a){if(a&&a.selected()){this.messages.removeAll(),ac.log("onClearFolder currentMessage = null",a.fullName()),this.currentMessage(null);var b=a?a.getUidList(this.uidList().search(),this.uidList().filters()):null;b?this.uidList(b):this.uidList(new W),this.checkMailStarted(!1),this.setAutocheckmailTimer(),ac.log("Check mail started - onClearFolder",this.checkMailStarted())}},Xb.prototype.moveMessagesToFolder=function(a,b,c){if(b.length>0){var d=this.folderList().currentFolder(),e=d.getUidsWithThread(b),f=this.folderList().getFolderByFullName(a),g={Action:"MessageMove",Folder:d?d.fullName():"",ToFolder:a,Uids:e.join(",")},h=null;d&&f&&(h=d.markDeletedByUids(e),f.addMessagesCountsDiff(h.MinusDiff,h.UnseenMinusDiff),(ac.isUnd(c)?0:!c)||f.recivedAnim(!0),this.excludeDeletedMessages(),f.markHasChanges(),cc.Ajax.send(g,this.onMoveMessagesResponse,this),f&&f.type()===_b.FolderTypes.Trash&&dc.runPluginHook("move-messages-to-trash",[ec.Accounts.currentId(),g.Folder,e]),f&&f.type()===_b.FolderTypes.Spam&&dc.runPluginHook("move-messages-to-spam",[ec.Accounts.currentId(),g.Folder,e]))}},Xb.prototype.excludeDeletedMessages=function(){_.delay(_.bind(function(){var a=this.folderList().currentFolder(),b=(this.page()-1)*ec.User.MailsPerPage;this.setMessagesFromUidList(this.uidList(),b,a.oMessages,!0)},this),500)},Xb.prototype.removeMessagesFromCacheForFolder=function(a){var b=this.folderList().getFolderByFullName(a),c=this.folderList().currentFolderFullName();b&&(b.markHasChanges(),a===c&&this.requestCurrentMessageList(c,this.page(),this.uidList().search(),"",!0))},Xb.prototype.deleteMessages=function(a){var b=this.folderList().currentFolder();b&&this.deleteMessagesFromFolder(b,a)},Xb.prototype.deleteMessagesFromFolder=function(a,b){var c=a.getUidsWithThread(b),d={Action:"MessageDelete",Folder:a.fullName(),Uids:c.join(",")};a.markDeletedByUids(c),this.excludeDeletedMessages(),cc.Ajax.send(d,this.onMoveMessagesResponse,this),dc.runPluginHook("delete-messages",[ec.Accounts.currentId(),d.Folder,c])},Xb.prototype.showExternalPictures=function(a){var b=[],c=null;this.currentMessage()&&(b=this.currentMessage().oFrom.aCollection,c=this.folderList().getFolderByFullName(this.currentMessage().folder()),a&&b.length>0?c.alwaysShowExternalPicturesForSender(b[0].sEmail):c.showExternalPictures(this.currentMessage().uid()))},Xb.prototype.setCurrentMessage=function(a,b){var c=ec.SingleMode?this.folderList().getFolderByFullName(b):this.folderList().currentFolder(),d=c&&a?c.oMessages[a]:null;d&&!d.deleted()?(this.currentMessage(d),this.currentMessage().seen()||this.executeGroupOperation("MessageSetSeen",[this.currentMessage().uid()],"seen",!0),c.getCompletelyFilledMessage(a,this.onCurrentMessageResponse,this)):(ac.log("setCurrentMessage, currentMessage = null",a,b,d,d?d.deleted():""),this.currentMessage(null))},Xb.prototype.onCurrentMessageResponse=function(a,b){var c=this.currentMessage()?this.currentMessage().uid():"";null===a&&c===b&&(ac.log("onCurrentMessageResponse currentMessage = null",null===a,c,b),this.currentMessage(null))},Xb.prototype.getMessage=function(a,b,c,d){var e=this.folderList().getFolderByFullName(a);e&&e.getCompletelyFilledMessage(b,c,d)},Xb.prototype.executeGroupOperation=function(a,b,c,d){var e=this.folderList().currentFolder(),f={Action:a,Folder:e?e.fullName():"",Uids:b.join(","),SetAction:d?1:0},g=(this.page()-1)*ec.User.MailsPerPage,h=b.length,i=this.folderList().oStarredFolder?this.folderList().oStarredFolder.messageCount():0,j=e.getUidList("",_b.FolderFilter.Flagged);e&&(cc.Ajax.send(f),e.executeGroupOperation(c,b,d),e.type()===_b.FolderTypes.Inbox&&c===_b.FolderFilter.Flagged&&(""!==this.uidList().filters()?d||(this.uidList().deleteUids(b),this.folderList().oStarredFolder&&this.folderList().oStarredFolder.messageCount(j.resultCount())):(e.removeFlaggedMessageListsFromCache(),""===this.uidList().search()&&this.folderList().oStarredFolder&&(d?this.folderList().oStarredFolder.messageCount(i+h):this.folderList().oStarredFolder.messageCount(i-h>0?i-h:0)))),this.setMessagesFromUidList(this.uidList(),g,e.oMessages,!0))},Xb.prototype.onFolderListResponse=function(a,b){var c=new U,d=parseInt(a.AccountID,10),e=this.oFolderListItems[d],f=e?e.oNamedCollection:{};a.Result===!1?(cc.Api.showErrorByCode(a.ErrorCode),b.AccountID===this.currentAccountId()&&0===this.messages().length&&(this.messagesLoading(!1),this.messagesLoadingError(!0))):(c.parse(d,a.Result,f),this.oFolderListItems[d]=c,setTimeout(_.bind(this.getAllFolderCounts,this,d),2e3),this.currentAccountId()===d&&this.folderList(c),this.editedAccountId()===d&&this.editedFolderList(c))},Xb.prototype.setCurrentFolderList=function(a){var b=a.iAccountId;b===this.currentAccountId()&&b!==this.folderList().iAccountId&&this.folderList(a)},Xb.prototype.getAllFolderCounts=function(a){var b=this.oFolderListItems[a],c=b?b.getFoldersWithoutCountInfo():[],d={Action:"FolderCounts",Folders:c,AccountID:a};c.length>0&&cc.Ajax.send(d,this.onFolderCountsResponse,this)},Xb.prototype.onFolderCountsResponse=function(a){var b=!1;a.Result===!1?cc.Api.showErrorByCode(a.ErrorCode):(_.each(a.Result,function(c,d){if(_.isArray(c)&&c.length>3){var e=c[0],f=c[1],g=c[2],h=c[3];b=b||this.setFolderCounts(a.AccountID,d,e,f,g,h)}},this),a.AccountID!==this.currentAccountId()&&(b=!1)),this.checkMailStarted(b),this.checkMailStarted()||this.setAutocheckmailTimer(),ac.log("Check mail started - onFolderCountsResponse",this.checkMailStarted())},Xb.prototype.onCurrentMessageListResponse=function(a,b){if(a.Result){if(this.messagesLoadingError(!1),this.parseMessageList(a,b),""!==this.deletedDraftMessageUid()){var c=this.deletedDraftMessageUid(),d=_.find(a.Result["@Collection"],function(a){return a.Uid===c});d||(ac.log("onCurrentMessageListResponse"),this.setCurrentMessage("",""),this.deletedDraftMessageUid(""))}}else cc.Api.showErrorByCode(a.ErrorCode),this.messagesLoading()===!0&&a.ErrorCode!==_b.Errors.NotDisplayedError&&this.messagesLoadingError(!0),this.messagesLoading(!1),this.checkMailStarted(!1),this.setAutocheckmailTimer(),ac.log("Check mail started - onCurrentMessageListResponse",this.checkMailStarted())},Xb.prototype.onMessageListResponse=function(a,b){a&&a.Result&&this.parseMessageList(a,b)},Xb.prototype.parseMessageList=function(a,b){var c=a.Result,d=this.oFolderListItems[a.AccountID],e=null,f=null,g="1"===b.UseThreads,h=!1,i=!1,j=!1,k=!1,l=[];c!==!1&&"Collection/MessageCollection"===c["@Object"]&&(e=d.getFolderByFullName(c.FolderName),e.setRelevantInformation(c.UidNext.toString(),c.FolderHash,c.MessageCount,c.MessageUnseenCount,!1),h=e.hasChanges(),e.removeAllMessageListsFromCacheIfHasChanges(),f=e.getUidList(c.Search,c.Filters),f.setUidsAndCount(c),_.each(c["@Collection"],function(a){var b=e.parseAndCacheMessage(a,!1,g);l.push(b)},this),dc.runPluginHook("response-custom-messages",[a.AccountID,e.fullName(),l]),i=this.currentAccountId()===a.AccountID&&this.folderList().currentFolderFullName()===c.FolderName,j=i&&this.uidList().search()===f.search()&&this.uidList().filters()===f.filters(),k=this.page()===c.Offset/ec.User.MailsPerPage+1,j&&(this.uidList(f),k&&(this.setMessagesFromUidList(f,c.Offset,e.oMessages,!0),this.messagesLoading(!1),this.checkMailStarted(!1),this.setAutocheckmailTimer(),ac.log("Check mail started - parseMessageList",this.checkMailStarted()))),!h||!i||j&&k||this.requestCurrentMessageList(this.folderList().currentFolderFullName(),this.page(),this.uidList().search(),this.uidList().filters(),!1),e.type()===_b.FolderTypes.Inbox&&f.filters()===_b.FolderFilter.Flagged&&""===f.search()&&this.folderList().oStarredFolder&&this.folderList().oStarredFolder.messageCount(f.resultCount()))},Xb.prototype.onMoveMessagesResponse=function(a,b){var c=a.Result,d=this.folderList().getFolderByFullName(b.Folder),e=this.folderList().getFolderByFullName(b.ToFolder),f=e&&e.type()===_b.FolderTypes.Trash,g=e&&e.type()===_b.FolderTypes.Spam,h=null,i=f?ac.i18n("MAILBOX/CONFIRM_MESSAGES_DELETE_WITHOUT_TRASH"):ac.i18n("MAILBOX/CONFIRM_MESSAGES_MARK_SPAM_WITHOUT_SPAM"),j=_.bind(function(a){a&&d&&this.deleteMessagesFromFolder(d,b.Uids.split(","))},this),k=this.folderList().currentFolder(),l=k.fullName();c===!1?(h=d.revertDeleted(b.Uids.split(",")),e?(e.addMessagesCountsDiff(-h.PlusDiff,-h.UnseenPlusDiff),a.ErrorCode===_b.Errors.ImapQuota&&(f||g)?cc.Screens.showPopup(t,[i,j]):cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("MAILBOX/ERROR_MOVING_MESSAGES"))):cc.Api.showErrorByCode(a.ErrorCode,ac.i18n("MAILBOX/ERROR_DELETING_MESSAGES"))):d.commitDeleted(b.Uids.split(",")),l===d.fullName()||e&&l===e.fullName()?(k.markHasChanges(),this.requestCurrentMessageList(l,this.page(),this.uidList().search(),"",!1)):l!==d.fullName()?cc.Prefetcher.startFolderPrefetch(d):e&&l!==e.fullName()&&cc.Prefetcher.startFolderPrefetch(e)},Xb.prototype.searchMessagesInCurrentFolder=function(a){var b=this.folderList().currentFolderFullName()||"INBOX",c=this.currentMessage()?this.currentMessage().uid():"",d=this.uidList().filters();cc.Routing.setHash(cc.Links.mailbox(b,1,c,a,d))},Xb.prototype.searchMessagesInInbox=function(a){cc.Routing.setHash(cc.Links.mailbox(this.folderList().inboxFolderFullName()||"INBOX",1,"",a,""))},Xb.prototype.countMessages=function(a){var b=[],c=function(a){_.each(a.subfolders(),function(a){a.subscribed()&&(b.push(a.unseenMessageCount()),a.subfolders().length&&a.subscribed()&&c(a))},this)};a.expanded()?a.subfoldersMessagesCount(0):(c(a),a.subfoldersMessagesCount(_.reduce(b,function(a,b){return a+b},0)))},Yb.prototype.clearInfoAboutEmail=function(a){this.contacts[a]=void 0},Yb.prototype.getContactByEmail=function(a,b,c){if(ec.User.ShowContacts){var d=this.contacts[a],e={Action:"ContactByEmail",Email:a};void 0!==d?b.apply(c,[d]):(this.responseHandlers[a]={Handler:b,Context:c},cc.Ajax.send(e,this.onContactByEmailResponse,this))}},Yb.prototype.onContactByEmailResponse=function(a,b){var c=null,d=this.responseHandlers[b.Email];a.Result&&(c=new Z,c.parse(a.Result)),this.contacts[b.Email]=c,d&&(d.Handler.apply(d.Context,[c]),this.responseHandlers[b.Email]=void 0)},Yb.prototype.addVcard=function(a){this.vcardAttachments.push(a)},Yb.prototype.markVcardsNonexistent=function(a){_.each(this.vcardAttachments,function(b){-1!==_.indexOf(a,b.uid())&&b.isExists(!1)})},Yb.prototype.addToContacts=function(a,b,c,d){var e={Action:"ContactCreate",PrimaryEmail:"Home",UseFriendlyName:"1",FullName:a,HomeEmail:b};cc.Ajax.send(e,c,d),cc.ContactsCache.recivedAnim(!0)},Zb.prototype.addIcal=function(a){this.icalAttachments.push(a),0===this.calendars().length&&this.requestCalendarList()},Zb.prototype.onCalendarListResponse=function(a){if(a&&a.Result){var b=ec.Accounts,c=b.currentId(),d=b.getAccount(c).email();this.calendars(_.map(a.Result,function(a){return{name:a.Name+" <"+a.Owner+">",id:a.Id,canEdit:a.Owner===d||a.Access===_b.CalendarAccess.Full||a.Access===_b.CalendarAccess.Write}}))}this.calendarsLoadingStarted(!1)},Zb.prototype.requestCalendarList=function(){this.calendarsLoadingStarted()||(cc.Ajax.send({Action:"CalendarList"},this.onCalendarListResponse,this),this.calendarsLoadingStarted(!0))},Zb.prototype.markIcalNonexistent=function(a){_.each(this.icalAttachments,function(b){a===b.uid()&&b.onEventDelete()})},Zb.prototype.markIcalTentative=function(a){_.each(this.icalAttachments,function(b){a===b.uid()&&b.onEventTentative()})},Zb.prototype.markIcalAccepted=function(a){_.each(this.icalAttachments,function(b){a===b.uid()&&b.onEventAccept()})},$b.prototype.init=function(){var c=ec.User,d=new K,e=ec.Accounts,f=new M,g=ec.App,h=new J,i=ac.getAppPath()+"#"+_b.Screens.Compose+"/to/%s",j=""!==ec.App.SiteName?ec.App.SiteName:"WebMail",k=!1;d.parse(c),ec.User=d,e=e,f.parse(ac.pInt(ec.Default),e),ec.Accounts=f,h.parse(g),ec.App=h,this.MailCache=new Xb,this.useGoogleAnalytics(),this.collectScreensData(),b.navigator&&ac.isFunc(b.navigator.registerProtocolHandler)&&(this.browser.firefox&&1===this.Storage.getData("MailtoAsked")&&(k=!0),k||b.navigator.registerProtocolHandler("mailto",i,j),this.browser.firefox&&this.Storage.setData("MailtoAsked",1)),a(b).unload(function(){ac.WindowOpener.closeAll()})},$b.prototype.collectScreensData=function(){ec.User.ShowContacts&&this.addScreenToHeader("contacts",ac.i18n("HEADER/CONTACTS"),ac.i18n("TITLE/CONTACTS"),"Contacts_ContactsViewModel",Bb,this.ContactsCache.recivedAnim),ec.User.AllowCalendar&&this.addScreenToHeader("calendar",ac.i18n("HEADER/CALENDAR"),ac.i18n("TITLE/CALENDAR"),"Calendar_CalendarViewModel",Tb,this.CalendarCache.recivedAnim),ec.User.IsFilesSupported&&this.addScreenToHeader("files",ac.i18n("HEADER/FILESTORAGE"),ac.i18n("TITLE/FILESTORAGE"),"FileStorage_FileStorageViewModel",Ub),ec.User.IsHelpdeskSupported&&this.addScreenToHeader("helpdesk",ac.i18n("HEADER/HELPDESK"),ac.i18n("TITLE/HELPDESK"),"Helpdesk_HelpdeskViewModel",Vb)},$b.prototype.registerHelpdeskUpdateFunction=function(a){this.fHelpdeskUpdate=a},$b.prototype.updateHelpdesk=function(){this.fHelpdeskUpdate&&this.fHelpdeskUpdate()},$b.prototype.useGoogleAnalytics=function(){var a=null,c=null;ec.App.GoogleAnalyticsAccount&&0<ec.App.GoogleAnalyticsAccount.length&&(b._gaq=b._gaq||[],b._gaq.push(["_setAccount",ec.App.GoogleAnalyticsAccount]),b._gaq.push(["_trackPageview"]),a=document.createElement("script"),a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",c=document.getElementsByTagName("script")[0],c.parentNode.insertBefore(a,c))},$b.prototype.tokenProblem=function(){var a="window.location.reload(); return false;",b=ac.i18n("WARNING/TOKEN_PROBLEM_HTML",{RELOAD_FUNC:a});ec.Auth=!1,cc.Api.showError(b,!0,!0)},$b.prototype.logout=function(a){var b={Action:"Logout"};a&&(b.LastErrorCode=a),cc.Ajax.send(b,this.onLogout,this)},$b.prototype.authProblem=function(){this.logout(_b.Errors.AuthError)},$b.prototype.onLogout=function(){ac.WindowOpener.closeAll(),cc.Routing.finalize(),""!==ec.App.CustomLogoutUrl?b.location.href=ec.App.CustomLogoutUrl:b.location.reload()},$b.prototype.run=function(){if(this.Screens.init(),hc&&ec&&ec.Auth&&ec.App.IosDetectOnLogin?b.location.href="?ios":ec&&ec.Auth?(ec.SingleMode=this.Routing.isSingleMode(),this.MailCache.init(),ec.HelpdeskRedirect&&this.Routing.currentScreen!==_b.Screens.Helpdesk&&this.Routing.setHash([_b.Screens.Helpdesk]),this.Routing.init(_b.Screens.Mailbox),ec.SingleMode||this.doFirstRequests()):ec&&""!==ec.App.CustomLoginUrl?b.location.href=ec.App.CustomLoginUrl:(this.Screens.showCurrentScreen(_b.Screens.Login),ec&&ec.LastErrorCode===_b.Errors.AuthError&&this.Api.showError(ac.i18n("WARNING/AUTH_PROBLEM"),!1,!0)),ec.User.AllowVoice){var c=this;a(b).on("storage",function(){"false"!==b.localStorage.getItem("phoneLoad")&&b.localStorage.setItem("phoneLoad","false")}),b.localStorage.setItem("phoneLoad",Math.floor(900*Math.random()+100).toString()),b.setTimeout(function(){ec.SingleMode||"false"===b.localStorage.getItem("phoneLoad")&&!b.sessionStorage.getItem("phoneTab")||(c.Phone.init(),b.sessionStorage.setItem("phoneTab","true"))},1e3)}},$b.prototype.addScreenToHeader=function(a,b,c,d,e,f){var g=null;_b.Screens[a]=a,a===_b.Screens.Helpdesk&&(g=_.bind(this.Routing.setLastHelpdeskHash,this.Routing)),this.Screens.oScreens[_b.Screens[a]]={Model:e,TemplateName:d},this.headerTabs.push({name:_b.Screens[a],title:b,hash:this.Routing.buildHashFromArray([_b.Screens[a]]),clickHandler:g,koRecivedAnim:f}),this.screensTitle[_b.Screens[a]]=c},$b.prototype.doFirstRequests=function(){b.setTimeout(function(){ec.Accounts.doFirstRequests()},4e3),b.setTimeout(function(){cc.Ajax.send({Action:"DoServerInitializations"})},3e4)},$b.prototype.downloadByUrl=function(c){var d=navigator.userAgent.toLowerCase().indexOf("android")>-1,e=null;d?b.open(c):(e=a('<iframe style="display: none;"></iframe>').appendTo(document.body),e.attr("src",c),setTimeout(function(){e.remove()},6e4))},$b.prototype.initHeaderInfo=function(){this.browser.ie?a(document).bind("focusin",_.bind(this.onFocus,this)).bind("focusout",_.bind(this.onBlur,this)):a(b).bind("focus",_.bind(this.onFocus,this)).bind("blur",_.bind(this.onBlur,this))},$b.prototype.onFocus=function(){this.focused(!0)},$b.prototype.onBlur=function(){this.focused(!1)},$b.prototype.setTitle=function(a){var b=this.newMessagesCount(),c=ec.SingleMode&&!this.focused();a=a||"",c||(a=this.focused()||0===b?this.getTitleByScreen():ac.i18n("TITLE/HAS_UNSEEN_MESSAGES_PLURAL",{COUNT:b},null,b)+" - "+ec.Accounts.getEmail(),document.title=".",document.title=a)},$b.prototype.getTitleByScreen=function(){var a="",b="";try{this.MailCache.currentMessage()&&(b=this.MailCache.currentMessage().subject())}catch(c){}switch(this.currentScreen()){case _b.Screens.Login:a=ac.i18n("TITLE/LOGIN",null,"");break;case _b.Screens.Mailbox:case _b.Screens.BottomMailbox:a=ec.Accounts.getEmail()+" - "+ac.i18n("TITLE/MAILBOX");break;case _b.Screens.Compose:case _b.Screens.SingleCompose:a=ec.Accounts.getEmail()+" - "+ac.i18n("TITLE/COMPOSE");break;case _b.Screens.SingleMessageView:a=ec.Accounts.getEmail()+" - "+ac.i18n("TITLE/VIEW_MESSAGE"),b&&(a=b+" - "+a);break;default:this.screensTitle[this.currentScreen()]&&(a=this.screensTitle[this.currentScreen()])}return""===a?a=ec.App.SiteName:a+=ec.App.SiteName&&""!==ec.App.SiteName?" - "+ec.App.SiteName:"",a},$b.prototype.desktopNotify=function(a,b,c,d,e,f){ac.desktopNotify(a,b,c,d,e,f)},cc=new $b,b.App=cc,a(function(){cc.run()},0),b.AfterLogicApi=dc,b.Enums=_b,gc.removeClass("no-js").addClass("js"),gc.hasClass("pdf")&&(kc.push("application/pdf"),kc.push("application/x-pdf"))}(jQuery,window,ko,crossroads,hasher);