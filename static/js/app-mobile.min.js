!function(a,b,c,d,e){"use strict";function f(){this.ie=/msie/.test(navigator.userAgent.toLowerCase())&&!b.opera,this.ie8AndBelow=this.ie&&this.getIeVersion()<=8,this.ie9AndBelow=this.ie&&this.getIeVersion()<=9,this.opera=!!b.opera,this.firefox=/firefox/.test(navigator.userAgent.toLowerCase()),this.chrome=/chrome/.test(navigator.userAgent.toLowerCase()),this.chromeIos=/crios/.test(navigator.userAgent.toLowerCase()),this.safari=/safari/.test(navigator.userAgent.toLowerCase())&&!this.chromeIos}function g(){this.sUrl="?/Ajax/",this.aRequests=[]}function h(){var c=a(b);this.resizeAll=_.debounce(function(){c.resize()},100),this.defaultScreen=Lb.Screens.Mailbox,this.currentScreen=Lb.Screens.Mailbox,this.lastMailboxRouting="",this.lastHelpdeskRouting=Lb.Screens.Helpdesk,this.currentHash="",this.previousHash=""}function i(){}function j(){this.replyText=c.observable(""),this.replyDraftUid=c.observable(""),this.replyCc=c.observable(""),this.replyBcc=c.observable(""),this.postponedMailData=null}function k(){this.prefetchStarted=c.observable(!1),this.init()}function l(b,d,e,f,g,h,i,j,k,l){this.fBeforeSelectCallback=null,this.fSelectCallback=d||function(){},this.fDeleteCallback=e||function(){},this.fDblClickCallback=!Sb&&f?f:function(){},this.fEnterCallback=g||function(){},this.bResetCheckedOnClick=Mb.isUnd(i)?!1:!!i,this.bCheckOnSelect=Mb.isUnd(j)?!1:!!j,this.bUnselectOnCtrl=Mb.isUnd(k)?!1:!!k,this.bDisableMultiplySelection=Mb.isUnd(l)?!1:!!l,this.useKeyboardKeys=c.observable(!1),this.list=c.observableArray([]),b&&b.subscribe&&b.subscribe(function(a){this.list(a)},this),this.multiplyLineFactor=h,this.oLast=null,this.oListScope=null,this.oScrollScope=null,this.iTimer=0,this.iFactor=1,this.KeyUp=Lb.Key.Up,this.KeyDown=Lb.Key.Down,this.KeyLeft=Lb.Key.Up,this.KeyRight=Lb.Key.Down,this.multiplyLineFactor&&(this.multiplyLineFactor.subscribe?this.multiplyLineFactor.subscribe(function(a){this.iFactor=a>0?a:1},this):this.iFactor=Mb.pInt(this.multiplyLineFactor),this.KeyUp=Lb.Key.Up,this.KeyDown=Lb.Key.Down,this.KeyLeft=Lb.Key.Left,this.KeyRight=Lb.Key.Right,a("html").hasClass("rtl")&&(this.KeyLeft=Lb.Key.Right,this.KeyRight=Lb.Key.Left)),this.sActionSelector="",this.sSelectabelSelector="",this.sCheckboxSelector="";var m=this;this.listChecked=c.computed({read:function(){var a=_.filter(this.list(),function(a){var b=a.checked(),c=a.selected();return b||m.bCheckOnSelect&&c});return a},write:function(a){a=!!a,_.each(this.list(),function(b){b.checked(a)}),this.list.valueHasMutated()},owner:this}),this.checkAll=c.computed({read:function(){return 0<this.listChecked().length},write:function(a){this.listChecked(!!a)},owner:this}),this.selectorHook=c.observable(null),this.selectorHook.subscribe(function(){var a=this.selectorHook();a&&a.selected(!1)},this,"beforeChange"),this.selectorHook.subscribe(function(a){a&&a.selected(!0)},this),this.itemSelected=c.computed({read:this.selectorHook,write:function(a){this.selectorHook(a),a&&(this.oLast=a)},owner:this}),this.list.subscribe(function(a){if(_.isArray(a)){var b=this.itemSelected();b&&(_.find(a,function(a){return b===a})||this.itemSelected(null))}else this.itemSelected(null)},this),this.listCheckedOrSelected=c.computed({read:function(){var a=this.itemSelected(),b=this.listChecked();return 0<b.length?b:a?[a]:[]},write:function(a){a?this.listChecked(!0):(this.itemSelected(null),this.listChecked(!1))},owner:this}),this.listCheckedAndSelected=c.computed({read:function(){var a=[],b=this.itemSelected(),c=this.listChecked();return c&&(a=c.slice(0)),b&&-1===_.indexOf(c,b)&&a.push(b),a},write:function(a){a?this.listChecked(!0):(this.itemSelected(null),this.listChecked(!1))},owner:this}),this.isIncompleteChecked=c.computed(function(){var a=this.list().length,b=this.listChecked().length;return a>0&&b>0&&a>b},this),this.onKeydownBinded=_.bind(this.onKeydown,this)}function m(){}function n(){Data.init()}function o(){this.provider=null,this.phoneReport=c.observable("Not connected"),this.action=c.observable("offline"),this.timerValue=c.observable(""),this.missedCalls=c.observableArray([]),this.voiceApp=c.observable(!1),this.reconnectInterval=0,this.timerInterval=0}function p(){this.phone=Ob.Phone,this.voiceApp=Ob.Phone.voiceApp,this.phoneReport=Ob.Phone.phoneReport,this.action=Ob.Phone.action,this.stack=c.observable(null),this.registerSession=c.observable(null),this.callSession=c.observable(null),this.stackConf=c.observable(null),this.registerConf=c.observable(null),this.hangupConf=c.observable(null),this.hasFatalError=c.observable(!1),this.isStarted=c.observable(!1),this.eventSessionBinded=this.eventSession.bind(this),this.createStackErrorBinded=this.createStackError.bind(this),this.createStackBinded=this.createStack.bind(this),this.audioRemote=document.getElementById("audio_remote"),this.interval=0,this.setConfigs(),this.init()}function q(){this.flash=null,this.jqFlash=null,this.phone=Ob.Phone,this.voiceApp=Ob.Phone.voiceApp,this.phoneReport=Ob.Phone.phoneReport,this.action=Ob.Phone.action,this.voiceImpi=Qb.User.VoiceImpi,this.voicePassword=Qb.User.VoicePassword,this.sessionid=c.observable(""),this.callState=c.observable(""),this.initStatus=c.observable(!1),this.connectStatus=c.observable(!1),this.init()}function r(){this.device=null,this.connection=null,this.phone=Ob.Phone,this.voiceApp=Ob.Phone.voiceApp,this.missedCalls=Ob.Phone.missedCalls,this.phoneReport=Ob.Phone.phoneReport,this.init()}function s(){this.alertDesc=c.observable(""),this.closeCallback=null,this.title=c.observable(""),this.okButtonText=c.observable(Mb.i18n("MAIN/BUTTON_OK"))}function t(){this.fConfirmCallback=null,this.confirmDesc=c.observable(""),this.title=c.observable(""),this.okButtonText=c.observable(Mb.i18n("MAIN/BUTTON_OK")),this.cancelButtonText=c.observable(Mb.i18n("MAIN/BUTTON_CANCEL"))}function u(){this.fCallback=null,this.editedAccountId=Qb.Accounts.editedId,this.loading=c.observable(!1),this.friendlyName=c.observable(""),this.email=c.observable(""),this.incomingMailLogin=c.observable(""),this.incomingLoginFocused=c.observable(!1),this.incomingLoginFocused.subscribe(function(){this.incomingLoginFocused()&&""===this.incomingMailLogin()&&this.incomingMailLogin(this.email())},this),this.incomingMailPassword=c.observable(""),this.incomingMailPort=c.observable(143),this.incomingMailServer=c.observable(""),this.outgoingMailLogin=c.observable(""),this.outgoingMailPassword=c.observable(""),this.outgoingMailPort=c.observable(25),this.outgoingMailServer=c.observable(""),this.incomingServerFocused=c.observable(!1),this.outServerFocused=c.observable(!1),this.outServerFocused.subscribe(function(){this.outServerFocused()&&""===this.outgoingMailServer()&&this.outgoingMailServer(this.incomingMailServer())},this),this.useSmtpAuthentication=c.observable(!0),this.friendlyNameFocus=c.observable(!1),this.emailFocus=c.observable(!1),this.incomingMailFocus=c.observable(!1),this.isFirstStep=c.observable(!0)}function v(){this.oIdentityPropertiesViewModel=new Eb(this,!0)}function w(){this.defaultAccountId=Qb.Accounts.defaultId,this.loading=c.observable(!1),this.incomingMailServer=c.observable(""),this.incomingMailPort=c.observable(110),this.incomingMailLogin=c.observable(""),this.incomingMailPassword=c.observable(""),this.folderList=Ob.MailCache.folderList,this.options=c.computed(function(){return this.folderList().getOptions(void 0,!0)},this),this.addNewFolderCommand=Mb.createCommand(this,this.onAddNewFolderClick),this.folder=c.observable(""),this.outgoingMailServer=c.observable(""),this.outgoingMailPort=c.observable(25),this.leaveMessagesOnServer=c.observable(!1),this.useSmtpAuthentication=c.observable(!1),this.serverIsSelected=c.observable(!1),this.loginIsSelected=c.observable(!1),this.passwordIsSelected=c.observable(!1),this.defaultOptionsAfterRender=Mb.defaultOptionsAfterRender}function x(){this.folders=c.observable(null),this.options=c.computed(function(){return this.folders()?this.folders().getOptions(Mb.i18n("SETTINGS/ACCOUNT_FOLDERS_NO_USAGE_ASSIGNED")):[]},this),this.sSentFolderOld="",this.sDraftFolderOld="",this.sSpamFolderOld="",this.sTrashFolderOld="",this.sentFolderFullName=c.observable(""),this.draftsFolderFullName=c.observable(""),this.spamFolderFullName=c.observable(""),this.trashFolderFullName=c.observable(""),this.sentFolderFullName.subscribe(function(a){!Mb.isUnd(a)&&this.folders()&&this.folders().sentFolderFullName(a)},this),this.draftsFolderFullName.subscribe(function(a){!Mb.isUnd(a)&&this.folders()&&this.folders().draftsFolderFullName(a)},this),this.spamFolderFullName.subscribe(function(a){!Mb.isUnd(a)&&this.folders()&&this.folders().spamFolderFullName(a)},this),this.trashFolderFullName.subscribe(function(a){!Mb.isUnd(a)&&this.folders()&&this.folders().trashFolderFullName(a)},this),this.defaultOptionsAfterRender=Mb.defaultOptionsAfterRender,this.allowSpamFolderExtension=c.computed(function(){var a=Qb.Accounts.getEdited();return a.extensionExists("AllowSpamFolderExtension")},this)}function y(){this.folders=Ob.MailCache.editedFolderList,this.loading=c.observable(!1),this.options=c.computed(function(){return this.folders().getOptions(Mb.i18n("SETTINGS/ACCOUNT_FOLDERS_NO_PARENT"),!0,!1,!0)},this),this.namespace=c.computed(function(){return this.folders().sNamespaceFolder},this),this.parentFolder=c.observable(""),this.folderName=c.observable(""),this.folderNameFocus=c.observable(!1),this.defaultOptionsAfterRender=Mb.defaultOptionsAfterRender}function z(){this.currentPassword=c.observable(""),this.newPassword=c.observable(""),this.confirmPassword=c.observable(""),this.isHelpdesk=c.observable(!1)}function A(){this.phone=Ob.Phone,this.voiceApp=Ob.Phone.voiceApp,this.phoneReport=Ob.Phone.phoneReport,this.action=c.observable(""),this.phoneNumber=c.observable(""),this.callback=null}function B(){this.AllowUsersChangeInterfaceSettings=!0,this.AllowUsersChangeEmailSettings=!0,this.AllowUsersAddNewAccounts=!0,this.SiteName="",this.Languages=[{name:"English",value:"en"}],this.Themes=["Default"],this.DateFormats=[],this.DefaultLanguage="English",this.AttachmentSizeLimit=1024e4,this.ImageUploadSizeLimit=1024e4,this.FileSizeLimit=1024e4,this.AutoSave=!0,this.AutoSaveIntervalSeconds=60,this.IdleSessionTimeout=0,this.AllowInsertImage=!0,this.AllowBodySize=!1,this.MaxBodySize=600,this.MaxSubjectSize=255,this.AllowPrefetch=!0,this.MaxPrefetchBodiesSize=5e4,this.LoginFormType=Lb.LoginFormType.Email,this.LoginAtDomainValue="",this.DemoWebMail=!0,this.DemoWebMailLogin="",this.DemoWebMailPassword="",this.LoginDescription="",this.GoogleAnalyticsAccount="",this.ShowQuotaBar=!1,this.ServerUseUrlRewrite=!1,this.AllowLanguageOnLogin=!1,this.FlagsLangSelect=!1,this.CustomLoginUrl="",this.CustomLogoutUrl="",this.IosDetectOnLogin=!1,this.AllowFilesSharing=!1,this.AllowContactsSharing=!1,this.DefaultLanguageShort="en"}function C(){this.IdUser=1,this.MailsPerPage=20,this.ContactsPerPage=20,this.iInterval=-1,this.AutoCheckMailInterval=0,this.DefaultEditor=1,this.Layout=Lb.MailboxLayout.Side,this.DefaultTheme="Default",this.DefaultLanguage="English",this.DefaultDateFormat="MM/DD/YYYY",this.defaultTimeFormat=c.observable(0),this.ThreadsEnabled=!0,this.useThreads=c.observable(!0),this.saveRepliedToCurrFolder=c.observable(!0),this.AllowCompose=!0,this.AllowReply=!0,this.AllowForward=!0,this.SaveMail=Lb.SaveMail.Checked,this.AllowFetcher=!1,this.OutlookSyncEnable=!0,this.MobileSyncEnable=!0,this.ShowPersonalContacts=!0,this.ShowGlobalContacts=!1,this.IsFilesSupported=!1,this.IsHelpdeskSupported=!1,this.IsHelpdeskAgent=!1,this.HelpdeskIframeUrl="",this.ShowContacts=this.ShowPersonalContacts||this.ShowGlobalContacts,this.LastLogin=0,this.IsDemo=!1,this.AllowVoice=!1,this.VoiceRealm="",this.VoiceWebsocketProxyUrl="",this.VoiceOutboundProxyUrl="",this.VoiceCallerID="",this.VoiceImpi="",this.VoiceImpu="",this.VoicePassword="",this.VoiceProvider="",this.AllowCalendar=!0,this.CalendarSharing=!1,this.CalendarAppointments=!1,this.CalendarShowWeekEnds=!1,this.CalendarShowWorkDay=!1,this.CalendarWorkDayStarts=0,this.CalendarWorkDayEnds=0,this.CalendarWeekStartsOn=0,this.CalendarDefaultTab=Lb.CalendarDefaultTab.Month,this.needToReloadCalendar=c.observable(!1),this.mobileSync=c.observable(null),this.MobileSyncDemoPass="demo",this.outlookSync=c.observable(null),this.OutlookSyncDemoPass="demo",this.AllowHelpdeskNotifications=!1}function D(){this.id=c.observable(0),this.email=c.observable(""),this.extensions=c.observableArray([]),this.fetchers=c.observable(null),this.identities=c.observable(null),this.friendlyName=c.observable(""),this.incomingMailLogin=c.observable(""),this.incomingMailPort=c.observable(143),this.incomingMailServer=c.observable(""),this.isInternal=c.observable(!1),this.isLinked=c.observable(!1),this.isDefault=c.observable(!1),this.outgoingMailAuth=c.observable(0),this.outgoingMailLogin=c.observable(""),this.outgoingMailPort=c.observable(25),this.outgoingMailServer=c.observable(""),this.isExtended=c.observable(!1),this.signature=c.observable(null),this.autoresponder=c.observable(null),this.forward=c.observable(null),this.filters=c.observable(null),this.quota=c.observable(0),this.usedSpace=c.observable(0),this.fullEmail=c.computed(function(){return""===this.friendlyName()?this.email():this.friendlyName()+" <"+this.email()+">"},this),this.isCurrent=c.observable(!1),this.isEdited=c.observable(!1),this.extensionsRequested=c.observable(!1),this.removeHint=c.computed(function(){var a="",b="";return this.isDefault()?(Qb.User.AllowCalendar&&Qb.User.ShowContacts?a=Mb.i18n("SETTINGS/ACCOUNTS_REMOVE_CONTACTS_CALENDARS_HINT"):Qb.User.AllowCalendar?a=Mb.i18n("SETTINGS/ACCOUNTS_REMOVE_CALENDARS_HINT"):Qb.User.ShowContacts&&(a=Mb.i18n("SETTINGS/ACCOUNTS_REMOVE_CONTACTS_HINT")),b=Mb.i18n("SETTINGS/ACCOUNTS_REMOVE_DEFAULT_HINT",{AND_OTHER:a}),Qb.Accounts.collection().length>1&&(b+=Mb.i18n("SETTINGS/ACCOUNTS_REMOVE_DEFAULT_NOTSINGLE_HINT"))):b=Mb.i18n("SETTINGS/ACCOUNTS_REMOVE_HINT"),b},this),this.removeConfirmation=c.computed(function(){return this.isDefault()?this.removeHint()+Mb.i18n("SETTINGS/ACCOUNTS_REMOVE_DEFAULT_CONFIRMATION"):Mb.i18n("SETTINGS/ACCOUNTS_REMOVE_CONFIRMATION")},this)}function E(){this.defaultId=c.observable(0),this.currentId=c.observable(0),this.editedId=c.observable(0),this.currentId.subscribe(function(a){var b=this.getCurrent();b.requestExtensions(),_.defer(_.bind(function(){this.editedId(a)},this))},this),this.collection=c.observableArray([])}function F(){this.sName="",this.sEmail="",this.sDisplay="",this.sFull="",this.loaded=c.observable(!1),this.founded=c.observable(!1)}function G(){this.aCollection=[]}function H(){this.oMoment=null}function I(){this.enabled=c.observable(!0),this.email=c.observable(""),this.friendlyName=c.observable(""),this.fullEmail=c.computed(function(){return""!==this.friendlyName()?this.friendlyName()+" <"+this.email()+">":this.email()},this),this.accountId=c.observable(-1),this.id=c.observable(-1),this.signature=c.observable(""),this.useSignature=c.observable(!0)}function J(){this.isIosDevice=Ub,this.fileName=c.observable(""),this.tempName=c.observable(""),this.displayName=c.observable(""),this.extension=c.observable(""),this.fileName.subscribe(function(){var a=this.fileName(),b=a.lastIndexOf(".");this.displayName(a.substr(0,b)),this.extension(a.substr(b+1))},this),this.size=c.observable(0),this.friendlySize=c.computed(function(){return Mb.friendlySize(this.size())},this),this.downloadTitle=c.computed(function(){return Mb.i18n("MESSAGE/ATTACHMENT_CLICK_TO_DOWNLOAD",{FILENAME:this.fileName(),SIZE:this.friendlySize()})},this),this.accountId=c.observable(Qb.Accounts.defaultId()),this.hash=c.observable(""),this.thumb=c.observable(!1),this.downloadLink=c.computed(function(){return Mb.getDownloadLinkByHash(this.accountId(),this.hash())},this),this.viewLink=c.computed(function(){return Mb.getViewLinkByHash(this.accountId(),this.hash())},this),this.thumbnailSrc=c.observable(""),this.thumbnailLoaded=c.observable(!1),this.thumbnailSessionUid=c.observable(""),this.thumbnailLink=c.computed(function(){return this.thumb()?Mb.getViewThumbnailLinkByHash(this.accountId(),this.hash()):""},this),this.type=c.observable(""),this.uploadUid=c.observable(""),this.uploaded=c.observable(!1),this.uploadError=c.observable(!1),this.isViewMimeType=c.computed(function(){return-1!==a.inArray(this.type(),Xb)},this),this.isMessageType=c.observable(!1),this.visibleViewLink=c.computed(function(){return this.isVisibleViewLink()},this),this.subFiles=c.observableArray([]),this.allowExpandSubFiles=c.observable(!1),this.subFilesLoaded=c.observable(!1),this.subFilesCollapsed=c.observable(!1),this.subFilesStartedLoading=c.observable(!1),this.visibleExpandLink=c.computed(function(){return this.allowExpandSubFiles()&&!this.subFilesCollapsed()&&!this.subFilesStartedLoading()},this),this.visibleExpandingText=c.computed(function(){return this.allowExpandSubFiles()&&!this.subFilesCollapsed()&&this.subFilesStartedLoading()},this),this.visibleSpinner=c.observable(!1),this.statusText=c.observable(""),this.progressPercent=c.observable(0),this.visibleProgress=c.observable(!1),this.uploadStarted=c.observable(!1),this.uploadStarted.subscribe(function(){this.uploadStarted()?(this.uploaded(!1),this.visibleProgress(!0),this.progressPercent(20)):(this.progressPercent(100),this.visibleProgress(!1),this.uploaded(!0))},this)}function K(){this.folderName=c.observable(""),this.messageUid=c.observable(""),this.cid=c.observable(""),this.contentLocation=c.observable(""),this.inline=c.observable(!1),this.linked=c.observable(!1),this.mimePartIndex=c.observable(""),this.messagePart=c.observable(null),J.call(this),this.isMessageType=c.computed(function(){return this.type(),this.mimePartIndex(),"message/rfc822"===this.type()&&""!==this.mimePartIndex()},this)}function L(){this.iAccountId=0,this.account=c.computed(function(){return Qb.Accounts.getAccount(this.iAccountId)},this),this.parentFullName=c.observable(""),this.level=c.observable(0),this.name=c.observable(""),this.nameForEdit=c.observable(""),this.fullName=c.observable(""),this.fullNameHash=c.observable(),this.uidNext=c.observable(""),this.hash=c.observable(""),this.routingHash=c.observable(""),this.delimiter=c.observable(""),this.type=c.observable(Lb.FolderTypes.User),this.showUnseenMessages=c.computed(function(){return this.type()!==Lb.FolderTypes.Drafts},this),this.withoutThreads=c.computed(function(){return this.type()===Lb.FolderTypes.Drafts||this.type()===Lb.FolderTypes.Spam||this.type()===Lb.FolderTypes.Trash},this),this.messageCount=c.observable(0),this.unseenMessageCount=c.observable(0),this.unseenMessageCount.subscribe(function(){_.delay(_.bind(function(){Ob.MailCache.countMessages(this)},this),1e3)},this),this.realUnseenMessageCount=c.observable(0),this.enableEmptyFolder=c.computed(function(){return this.messageCount()>0&&(this.type()===Lb.FolderTypes.Spam||this.type()===Lb.FolderTypes.Trash)},this),this.virtual=c.observable(!1),this.virtualEmpty=c.computed(function(){return this.virtual()&&0===this.messageCount()},this),this.hasExtendedInfo=c.observable(!1),this.selectable=c.observable(!0),this.subscribed=c.observable(!0),this.subscribed.subscribe(function(){if(this.parentFullName()){var a=Ob.MailCache.folderList().getFolderByFullName(this.parentFullName());a&&Ob.MailCache.countMessages(a)}},this),this.existen=c.observable(!0),this.isNamespace=c.observable(!1),this.subfoldersMessagesCount=c.observable(0),this.subfolders=c.observableArray([]),this.subfolders.subscribe(function(a){var b=_.any(_.map(a,function(a){return a.subscribed()}));this.canExpand(b)},this),this.canExpand=c.observable(!0),this.expanded=c.observable(!1),this.isCollapseHandler=c.computed(function(){return 0!==this.subfolders().length&&!this.isNamespace()&&this.canExpand()},this),this.messageCountToShow=c.computed(function(){return this.canExpand()?this.showUnseenMessages()?this.unseenMessageCount()+this.subfoldersMessagesCount():this.messageCount():this.showUnseenMessages()?this.unseenMessageCount():this.messageCount()},this),this.isSubFolder=c.computed(function(){return this.level()>0},this),this.selected=c.observable(!1),this.recivedAnim=c.observable(!1).extend({autoResetToFalse:500}),this.hasSubscribedSubfolders=c.computed(function(){return!!c.utils.arrayFirst(this.subfolders(),function(a){return a.subscribed()})},this),this.isSystem=c.computed(function(){return this.type()!==Lb.FolderTypes.User?!0:!1},this),this.visible=c.computed(function(){var a=this.subscribed(),b=this.existen(),c=this.selectable(),d=this.hasSubscribedSubfolders(),e=this.isSystem();return a||e||d&&(!b||!c)},this),this.edited=c.observable(!1),this.edited.subscribe(function(a){a===!1&&this.nameForEdit(this.name())},this),this.canBeSelected=c.computed(function(){var a=this.existen(),b=this.selectable();return a&&b},this),this.canSubscribe=c.computed(function(){var a=this.account(),b=!1;return a&&(b=a.extensionExists("DisableManageSubscribe")),!this.isSystem()&&this.canBeSelected()&&!b},this),this.canDelete=c.computed(function(){return!this.isSystem()&&this.hasExtendedInfo()&&0===this.messageCount()&&0===this.subfolders().length},this),this.canRename=c.computed(function(){return!this.isSystem()&&this.canBeSelected()},this),this.usedAs=c.computed(function(){var a="";switch(this.type()){case Lb.FolderTypes.Inbox:a=Mb.i18n("SETTINGS/ACCOUNT_FOLDERS_USED_AS_INBOX");break;case Lb.FolderTypes.Sent:a=Mb.i18n("SETTINGS/ACCOUNT_FOLDERS_USED_AS_SENT");break;case Lb.FolderTypes.Drafts:a=Mb.i18n("SETTINGS/ACCOUNT_FOLDERS_USED_AS_DRAFTS");break;case Lb.FolderTypes.Trash:a=Mb.i18n("SETTINGS/ACCOUNT_FOLDERS_USED_AS_TRASH");break;case Lb.FolderTypes.Spam:a=Mb.i18n("SETTINGS/ACCOUNT_FOLDERS_USED_AS_SPAM");break;default:a=""}return a},this),this.oMessages={},this.oUids={},this.aResponseHandlers=[],this.displayName=c.computed(function(){var a=this.name();switch(this.type()){case Lb.FolderTypes.Inbox:a=Mb.i18n("MAIN/FOLDER_INBOX");break;case Lb.FolderTypes.Sent:a=Mb.i18n("MAIN/FOLDER_SENT");break;case Lb.FolderTypes.Drafts:a=Mb.i18n("MAIN/FOLDER_DRAFTS");break;case Lb.FolderTypes.Trash:a=Mb.i18n("MAIN/FOLDER_TRASH");break;case Lb.FolderTypes.Spam:a=Mb.i18n("MAIN/FOLDER_SPAM")}return a},this),this.aRequestedUids=[],this.aRequestedThreadUids=[],this.requestedLists=[],this.hasChanges=c.observable(!1),this.hasChanges.subscribe(function(){this.requestedLists=[]},this)}function M(){this.iAccountId=0,this.bInitialized=c.observable(!1),this.collection=c.observableArray([]),this.options=c.observableArray([]),this.sNamespace="",this.sNamespaceFolder="",this.oStarredFolder=null,this.oNamedCollection={};var a=this,b=function(a){return function(b){b&&b.type(a)}},d=function(b){return{read:function(){return this.collection(),b()?b().fullName():""},write:function(a){b(this.getFolderByFullName(a))},owner:a}};this.totalMessageCount=c.computed(function(){return this.getRecursivelyMessageCount(this.collection())},this),this.currentFolder=c.observable(null),this.inboxFolder=c.observable(null),this.sentFolder=c.observable(null),this.draftsFolder=c.observable(null),this.spamFolder=c.observable(null),this.trashFolder=c.observable(null),this.inboxFolder.subscribe(b(Lb.FolderTypes.User),this,"beforeChange"),this.sentFolder.subscribe(b(Lb.FolderTypes.User),this,"beforeChange"),this.draftsFolder.subscribe(b(Lb.FolderTypes.User),this,"beforeChange"),this.spamFolder.subscribe(b(Lb.FolderTypes.User),this,"beforeChange"),this.trashFolder.subscribe(b(Lb.FolderTypes.User),this,"beforeChange"),this.inboxFolder.subscribe(b(Lb.FolderTypes.Inbox)),this.sentFolder.subscribe(b(Lb.FolderTypes.Sent)),this.draftsFolder.subscribe(b(Lb.FolderTypes.Drafts)),this.spamFolder.subscribe(b(Lb.FolderTypes.Spam)),this.trashFolder.subscribe(b(Lb.FolderTypes.Trash)),this.inboxFolderFullName=c.computed(d(this.inboxFolder)),this.sentFolderFullName=c.computed(d(this.sentFolder)),this.draftsFolderFullName=c.computed(d(this.draftsFolder)),this.spamFolderFullName=c.computed(d(this.spamFolder)),this.trashFolderFullName=c.computed(d(this.trashFolder)),this.currentFolderFullName=c.computed(d(this.currentFolder)),this.currentFolderType=c.computed(function(){return this.currentFolder()?this.currentFolder().type():Lb.FolderTypes.User},this),this.delimiter=c.computed(function(){return this.inboxFolder()?this.inboxFolder().delimiter():""},this)}function N(){this.accountId=c.observable(0),this.folder=c.observable(""),this.uid=c.observable(""),this.subject=c.observable(""),this.emptySubject=c.computed(function(){return""===Mb.trim(this.subject())},this),this.subjectForDisplay=c.computed(function(){return this.emptySubject()?Mb.i18n("MAILBOX/EMPTY_SUBJECT"):this.subject()},this),this.messageId=c.observable(""),this.size=c.observable(0),this.friendlySize=c.computed(function(){return Mb.friendlySize(this.size())},this),this.textSize=c.observable(0),this.oDateModel=new H,this.fullDate=c.observable(""),this.oFrom=new G,this.fullFrom=c.observable(""),this.oTo=new G,this.to=c.observable(""),this.fromOrToText=c.observable(""),this.oCc=new G,this.cc=c.observable(""),this.oBcc=new G,this.bcc=c.observable(""),this.oSender=new G,this.oReplyTo=new G,this.seen=c.observable(!1),this.flagged=c.observable(!1),this.answered=c.observable(!1),this.forwarded=c.observable(!1),this.hasAttachments=c.observable(!1),this.hasIcalAttachment=c.observable(!1),this.hasVcardAttachment=c.observable(!1),this.threadsAllowed=c.computed(function(){var a=Ob.MailCache.getFolderByFullName(this.accountId(),this.folder()),b=a&&(a.type()===Lb.FolderTypes.Drafts||a.type()===Lb.FolderTypes.Spam||a.type()===Lb.FolderTypes.Trash);return Qb.User.useThreads()&&!b},this),this.threadPart=c.observable(!1),this.threadUids=c.observableArray([]),this.threadCount=c.computed(function(){return this.threadUids().length},this),this.threadUnreedCount=c.observable(0),this.threadOpened=c.observable(!1),this.threadLoading=c.observable(!1),this.threadLoadingVisible=c.computed(function(){return this.threadsAllowed()&&this.threadOpened()&&this.threadLoading()},this),this.threadCountVisible=c.computed(function(){return this.threadsAllowed()&&this.threadCount()>0&&!this.threadLoading()},this),this.threadCountForLoad=c.observable(5),this.threadNextLoadingVisible=c.observable(!1),this.threadNextLoadingLinkVisible=c.observable(!1),this.threadFunctionLoadNext=null,this.threadShowAnimation=c.observable(!1),this.threadHideAnimation=c.observable(!1),this.importance=c.observable(Lb.Importance.Normal),this.draftInfo=c.observableArray([]),this.sensitivity=c.observable(Lb.Sensivity.Nothing),this.hash=c.observable(""),this.downloadLink=c.computed(function(){return this.hash().length>0?Mb.getDownloadLinkByHash(this.accountId(),this.hash()):""},this),this.completelyFilled=c.observable(!1),this.checked=c.observable(!1),this.checked.subscribe(function(a){if(!this.threadOpened()){var b=Ob.MailCache.folderList().getFolderByFullName(this.folder());_.each(this.threadUids(),function(c){var d=b.oMessages[c];d&&d.checked(a)})}},this),this.selected=c.observable(!1),this.deleted=c.observable(!1),this.inReplyTo=c.observable(""),this.references=c.observable(""),this.readingConfirmation=c.observable(""),this.isPlain=c.observable(!1),this.text=c.observable(""),this.textBodyForNewWindow=c.observable(""),this.$text=null,this.rtl=c.observable(!1),this.hasExternals=c.observable(!1),this.isExternalsShown=c.observable(!1),this.isExternalsAlwaysShown=c.observable(!1),this.foundedCids=c.observableArray([]),this.attachments=c.observableArray([]),this.usesAttachmentString=!1,this.allAttachmentsHash="",this.safety=c.observable(!1),this.ical=c.observable(null),this.vcard=c.observable(null),this.domMessageForPrint=c.observable(null),this.Custom={}}function O(){this.resultCount=c.observable(-1),this.search=c.observable(""),this.filters=c.observable(""),this.collection=c.observableArray([]),this.threadUids={}}function P(){this.uid=c.observable(""),this.file=c.observable(""),this.type=c.observable(""),this.icalType=c.observable(""),this.icalConfig=c.observable(""),this.type.subscribe(function(){var a=this.type().split("-"),b=a.shift(),c=_.find(Lb.IcalType,function(a){return b===a},this),d=a.join("-"),e=_.find(Lb.IcalConfig,function(a){return d===a},this);b!==c&&(b=Lb.IcalType.Save),this.icalType(b),d!==e&&(d=Lb.IcalConfig.NeedsAction),this.icalConfig(d)},this),this.isRequestType=c.computed(function(){return this.icalType()===Lb.IcalType.Request},this),this.isCancelType=c.computed(function(){return this.icalType()===Lb.IcalType.Cancel},this),this.cancelDecision=c.observable(""),this.isReplyType=c.computed(function(){return this.icalType()===Lb.IcalType.Reply},this),this.replyDecision=c.observable(""),this.isSaveType=c.computed(function(){return this.icalType()===Lb.IcalType.Save},this),this.isJustSaved=c.observable(!1),this.fillDecisions(),this.isAccepted=c.computed(function(){return this.icalConfig()===Lb.IcalConfig.Accepted},this),this.isDeclined=c.computed(function(){return this.icalConfig()===Lb.IcalConfig.Declined},this),this.isTentative=c.computed(function(){return this.icalConfig()===Lb.IcalConfig.Tentative},this),this.location=c.observable(""),this.description=c.observable(""),this.when=c.observable(""),this.calendarId=c.observable(""),this.calendars=c.observableArray([]),Qb.SingleMode&&b.opener?(this.calendars(b.opener.App.CalendarCache.calendars()),b.opener.App.CalendarCache.calendars.subscribe(function(){this.calendars(b.opener.App.CalendarCache.calendars())},this)):(this.calendars(Ob.CalendarCache.calendars()),Ob.CalendarCache.calendars.subscribe(function(){this.calendars(Ob.CalendarCache.calendars())},this)),this.selectedCalendar=c.observable(""),this.chosenCalendarName=c.computed(function(){var a=null;return""!==this.calendarId()&&(a=_.find(this.calendars(),function(a){return a.id===this.calendarId()},this)),a?a.name:""},this),this.calendarIsChosen=c.computed(function(){return""!==this.chosenCalendarName()},this),this.visibleCalendarDropdown=c.computed(function(){return!this.calendarIsChosen()&&this.calendars().length>1&&(this.isRequestType()||this.isSaveType())},this),this.visibleCalendarName=c.computed(function(){return this.calendarIsChosen()},this),this.visibleFirstCalendarName=c.computed(function(){return 1===this.calendars().length&&!this.calendarIsChosen()},this),this.visibleCalendarRow=c.computed(function(){return this.visibleCalendarDropdown()||this.visibleCalendarName()||this.visibleFirstCalendarName()},this),this.animation=c.observable(!1)}function Q(){this.uid=c.observable(""),this.file=c.observable(""),this.name=c.observable(""),this.email=c.observable(""),this.isExists=c.observable(!1),this.isJustSaved=c.observable(!1)}function R(){this.sEmailDefaultType=Lb.ContactEmailType.Personal,this.sPhoneDefaultType=Lb.ContactPhoneType.Mobile,this.sAddressDefaultType=Lb.ContactAddressType.Personal,this.voiceApp=Ob.Phone.voiceApp,this.idContact=c.observable(""),this.idUser=c.observable(""),this.global=c.observable(!1),this.itsMe=c.observable(!1),this.isNew=c.observable(!1),this.readOnly=c.observable(!1),this.edited=c.observable(!1),this.extented=c.observable(!1),this.personalCollapsed=c.observable(!1),this.businessCollapsed=c.observable(!1),this.otherCollapsed=c.observable(!1),this.groupsCollapsed=c.observable(!1),this.displayName=c.observable(""),this.firstName=c.observable(""),this.lastName=c.observable(""),this.nickName=c.observable(""),this.skype=c.observable(""),this.facebook=c.observable(""),this.displayNameFocused=c.observable(!1),this.primaryEmail=c.observable(this.sEmailDefaultType),this.primaryPhone=c.observable(this.sPhoneDefaultType),this.primaryAddress=c.observable(this.sAddressDefaultType),this.mainPrimaryEmail=c.computed({read:this.primaryEmail,write:function(a){!Mb.isUnd(a)&&0<=Mb.inArray(a,[Lb.ContactEmailType.Personal,Lb.ContactEmailType.Business,Lb.ContactEmailType.Other])?this.primaryEmail(a):this.primaryEmail(Lb.ContactEmailType.Personal)},owner:this}),this.mainPrimaryPhone=c.computed({read:this.primaryPhone,write:function(a){!Mb.isUnd(a)&&0<=Mb.inArray(a,[Lb.ContactPhoneType.Mobile,Lb.ContactPhoneType.Personal,Lb.ContactPhoneType.Business])?this.primaryPhone(a):this.primaryPhone(Lb.ContactPhoneType.Mobile)
},owner:this}),this.mainPrimaryAddress=c.computed({read:this.primaryAddress,write:function(a){!Mb.isUnd(a)&&0<=Mb.inArray(a,[Lb.ContactAddressType.Personal,Lb.ContactAddressType.Business])?this.primaryAddress(a):this.primaryAddress(Lb.ContactAddressType.Personal)},owner:this}),this.personalEmail=c.observable(""),this.personalStreetAddress=c.observable(""),this.personalCity=c.observable(""),this.personalState=c.observable(""),this.personalZipCode=c.observable(""),this.personalCountry=c.observable(""),this.personalWeb=c.observable(""),this.personalFax=c.observable(""),this.personalPhone=c.observable(""),this.personalMobile=c.observable(""),this.businessEmail=c.observable(""),this.businessCompany=c.observable(""),this.businessDepartment=c.observable(""),this.businessJob=c.observable(""),this.businessOffice=c.observable(""),this.businessStreetAddress=c.observable(""),this.businessCity=c.observable(""),this.businessState=c.observable(""),this.businessZipCode=c.observable(""),this.businessCountry=c.observable(""),this.businessWeb=c.observable(""),this.businessFax=c.observable(""),this.businessPhone=c.observable(""),this.otherEmail=c.observable(""),this.otherBirthdayMonth=c.observable("0"),this.otherBirthdayDay=c.observable("0"),this.otherBirthdayYear=c.observable("0"),this.otherNotes=c.observable(""),this.etag=c.observable(""),this.sharedToAll=c.observable(!1),this.birthdayIsEmpty=c.computed(function(){var a="0"===this.otherBirthdayMonth(),b="0"===this.otherBirthdayDay(),c="0"===this.otherBirthdayYear();return a||b||c},this),this.otherBirthday=c.computed(function(){var a="",b=Mb.pInt(this.otherBirthdayYear()),c=Mb.pInt(this.otherBirthdayMonth()),d=Mb.pInt(this.otherBirthdayDay()),e=new H;return this.birthdayIsEmpty()||(e.setDate(b,c>0?c-1:0,d),a=e.getShortDate()),a},this),this.groups=c.observableArray([]),this.groupsIsEmpty=c.computed(function(){return 0===this.groups().length},this),this.email=c.computed({read:function(){var a="";switch(this.primaryEmail()){case Lb.ContactEmailType.Personal:a=this.personalEmail();break;case Lb.ContactEmailType.Business:a=this.businessEmail();break;case Lb.ContactEmailType.Other:a=this.otherEmail()}return a},write:function(a){switch(this.primaryEmail()){case Lb.ContactEmailType.Personal:this.personalEmail(a);break;case Lb.ContactEmailType.Business:this.businessEmail(a);break;case Lb.ContactEmailType.Other:this.otherEmail(a);break;default:this.primaryEmail(this.sEmailDefaultType),this.email(a)}},owner:this}),this.personalIsEmpty=c.computed(function(){var a=this.personalEmail()!==this.email()?this.personalEmail():"";return""==""+a+this.personalStreetAddress()+this.personalCity()+this.personalState()+this.personalZipCode()+this.personalCountry()+this.personalWeb()+this.personalFax()+this.personalPhone()+this.personalMobile()},this),this.businessIsEmpty=c.computed(function(){var a=this.businessEmail()!==this.email()?this.businessEmail():"";return""==""+a+this.businessCompany()+this.businessDepartment()+this.businessJob()+this.businessOffice()+this.businessStreetAddress()+this.businessCity()+this.businessState()+this.businessZipCode()+this.businessCountry()+this.businessWeb()+this.businessFax()+this.businessPhone()},this),this.otherIsEmpty=c.computed(function(){var a=this.otherEmail()!==this.email()?this.otherEmail():"";return""==""+a+this.otherNotes()&&this.birthdayIsEmpty()},this),this.phone=c.computed({read:function(){var a="";switch(this.primaryPhone()){case Lb.ContactPhoneType.Mobile:a=this.personalMobile();break;case Lb.ContactPhoneType.Personal:a=this.personalPhone();break;case Lb.ContactPhoneType.Business:a=this.businessPhone()}return a},write:function(a){switch(this.primaryPhone()){case Lb.ContactPhoneType.Mobile:this.personalMobile(a);break;case Lb.ContactPhoneType.Personal:this.personalPhone(a);break;case Lb.ContactPhoneType.Business:this.businessPhone(a);break;default:this.primaryPhone(this.sEmailDefaultType),this.phone(a)}},owner:this}),this.address=c.computed({read:function(){var a="";switch(this.primaryAddress()){case Lb.ContactAddressType.Personal:a=this.personalStreetAddress();break;case Lb.ContactAddressType.Business:a=this.businessStreetAddress()}return a},write:function(a){switch(this.primaryAddress()){case Lb.ContactAddressType.Personal:this.personalStreetAddress(a);break;case Lb.ContactAddressType.Business:this.businessStreetAddress(a);break;default:this.primaryAddress(this.sEmailDefaultType),this.address(a)}},owner:this}),this.emails=c.computed(function(){var a=[];return""!==this.personalEmail()&&a.push({text:Mb.i18n("CONTACTS/OPTION_PERSONAL")+": "+this.personalEmail(),value:Lb.ContactEmailType.Personal}),""!==this.businessEmail()&&a.push({text:Mb.i18n("CONTACTS/OPTION_BUSINESS")+": "+this.businessEmail(),value:Lb.ContactEmailType.Business}),""!==this.otherEmail()&&a.push({text:Mb.i18n("CONTACTS/OPTION_OTHER")+": "+this.otherEmail(),value:Lb.ContactEmailType.Other}),a},this),this.phones=c.computed(function(){var a=[];return""!==this.personalMobile()&&a.push({text:Mb.i18n("CONTACTS/LABEL_MOBILE")+": "+this.personalMobile(),value:Lb.ContactPhoneType.Mobile}),""!==this.personalPhone()&&a.push({text:Mb.i18n("CONTACTS/OPTION_PERSONAL")+": "+this.personalPhone(),value:Lb.ContactPhoneType.Personal}),""!==this.businessPhone()&&a.push({text:Mb.i18n("CONTACTS/OPTION_BUSINESS")+": "+this.businessPhone(),value:Lb.ContactPhoneType.Business}),a},this),this.addresses=c.computed(function(){var a=[];return""!==this.personalStreetAddress()&&a.push({text:Mb.i18n("CONTACTS/OPTION_PERSONAL")+": "+this.personalStreetAddress(),value:Lb.ContactAddressType.Personal}),""!==this.businessStreetAddress()&&a.push({text:Mb.i18n("CONTACTS/OPTION_BUSINESS")+": "+this.businessStreetAddress(),value:Lb.ContactAddressType.Business}),a},this),this.hasEmails=c.computed(function(){return 0<this.emails().length},this),this.extented.subscribe(function(a){a&&(this.personalCollapsed(!this.personalIsEmpty()),this.businessCollapsed(!this.businessIsEmpty()),this.otherCollapsed(!this.otherIsEmpty()),this.groupsCollapsed(!this.groupsIsEmpty()))},this),this.birthdayMonthSelect=R.birthdayMonthSelect,this.birthdayYearSelect=R.birthdayYearSelect,this.birthdayDaySelect=c.computed(function(){for(var a=1,b=Mb.pInt(Mb.daysInMonth(this.otherBirthdayMonth(),this.otherBirthdayYear())),c="",d=[{text:Mb.i18n("DATETIME/DAY"),value:"0"}];b>=a;a++)c=a.toString(),d.push({text:c,value:c});return d},this);for(var a=new Date,b="",d=a.getFullYear(),e=1932;d>=e;d--)b=d.toString(),this.birthdayYearSelect.push({text:b,value:b});this.canBeSave=c.computed(function(){return!0},this),this.sendMailLink=c.computed(function(){return this.getSendMailLink(this.email())},this),this.sendMailToPersonalLink=c.computed(function(){return this.getSendMailLink(this.personalEmail())},this),this.sendMailToBusinessLink=c.computed(function(){return this.getSendMailLink(this.businessEmail())},this),this.sendMailToOtherLink=c.computed(function(){return this.getSendMailLink(this.otherEmail())},this)}function S(){this.isNew=c.observable(!1),this.readOnly=c.observable(!1),this.idGroup=c.observable(""),this.idUser=c.observable(""),this.name=c.observable(""),this.isOrganization=c.observable(!1),this.email=c.observable(""),this.country=c.observable(""),this.city=c.observable(""),this.company=c.observable(""),this.fax=c.observable(""),this.phone=c.observable(""),this.state=c.observable(""),this.street=c.observable(""),this.web=c.observable(""),this.zip=c.observable(""),this.edited=c.observable(!1),this.nameFocused=c.observable(!1),this.canBeSave=c.computed(function(){return""!==this.name()},this),this.newContactsInGroupCount=c.observable(0),this.newContactsInGroupHint=c.computed(function(){var a=this.newContactsInGroupCount();return this.isNew()&&a>0?Mb.i18n("CONTACTS/CONTACT_ADD_TO_NEW_HINT_PLURAL",{COUNT:a},null,a):""},this)}function T(){this.bIsGroup=!1,this.bIsOrganization=!1,this.bReadOnly=!1,this.bItsMe=!1,this.bGlobal=!1,this.sId="",this.sName="",this.sEmail="",this.bSharedToAll=!1,this.deleted=c.observable(!1),this.checked=c.observable(!1),this.selected=c.observable(!1),this.recivedAnim=c.observable(!1).extend({autoResetToFalse:500})}function U(){this.iAccountId=0,this.type=c.observable(!0),this.options=c.observable(0),this.signature=c.observable("")}function V(){this.iAccountId=0,this.enable=!1,this.subject="",this.message=""}function W(){this.FETCHER=!0,this.id=c.observable(0),this.accountId=c.observable(0),this.isEnabled=c.observable(!1),this.isLocked=c.observable(!1),this.email=c.observable(""),this.userName=c.observable(""),this.folder=c.observable(""),this.signatureOptions=c.observable(0),this.signature=c.observable(""),this.incomingMailServer=c.observable(""),this.incomingMailPort=c.observable(0),this.incomingMailLogin=c.observable(""),this.leaveMessagesOnServer=c.observable(""),this.isOutgoingEnabled=c.observable(!1),this.outgoingMailServer=c.observable(""),this.outgoingMailPort=c.observable(0),this.outgoingMailAuth=c.observable(!1),this.fullEmail=c.computed(function(){return""===this.userName()?this.email():this.userName()+" <"+this.email()+">"},this)}function X(){this.accountId=0,this.collection=c.observableArray([])}function Y(){this.iAccountId=0,this.enable=!1,this.email=""}function Z(){this.iAccountId=0,this.collection=c.observableArray([])}function $(a){this.iAccountId=a,this.enable=c.observable(!0),this.field=c.observable(""),this.condition=c.observable(""),this.filter=c.observable(""),this.action=c.observable(""),this.folder=c.observable("")}function ab(){this.loadingMessage=c.observable(""),this.loadingVisible=c.observable(!1),this.reportMessage=c.observable(""),this.reportVisible=c.observable(!1),this.iReportTimeout=0/0,this.errorMessage=c.observable(""),this.errorNotHide=c.observable(!1),this.errorVisible=c.observable(!1),this.iErrorTimeout=-1,this.isHtmlError=c.observable(!1),this.gray=c.observable(!1)}function bb(){this.mobileApp=Sb,this.oPhone=new fb,this.allowVoice=Qb.User.AllowVoice,this.currentAccountId=Qb.Accounts.currentId,this.currentAccountId.subscribe(function(){this.changeCurrentAccount()},this),this.tabs=Ob.headerTabs,this.email=c.observable(""),this.accounts=Qb.Accounts.collection,this.currentTab=Ob.Screens.currentScreen,this.isMailboxTab=c.computed(function(){return this.currentTab()===Lb.Screens.Mailbox},this),this.sMailboxHash=Ob.Routing.buildHashFromArray([Lb.Screens.Mailbox]),this.sSettingsHash=Ob.Routing.buildHashFromArray([Lb.Screens.Settings]),this.contactsRecivedAnim=Ob.ContactsCache.recivedAnim,this.calendarRecivedAnim=Ob.CalendarCache.recivedAnim}function cb(a,b){this.currentPage=c.observable(1),this.count=c.observable(a),this.perPage=c.observable(b),this.pagesCount=c.computed(function(){var a=Math.ceil(this.count()/this.perPage());return a>0?a:1},this),this.firstPage=c.computed(function(){var a=this.currentPage()-2;return a>0?a:1},this),this.lastPage=c.computed(function(){var a=this.firstPage()+4;return a<=this.pagesCount()?a:this.pagesCount()},this),this.visibleFirst=c.computed(function(){return this.firstPage()>1},this),this.visibleLast=c.computed(function(){return this.lastPage()<this.pagesCount()},this),this.pages=c.computed(function(){var a=this.firstPage(),b=[];if(this.firstPage()<this.lastPage())for(;a<=this.lastPage();a++)b.push({number:a,current:a===this.currentPage(),clickFunc:_.bind(this.clickPage,this)});return b},this)}function db(a,b){this.mobileApp=Sb,this.oParent=b,this.creaId="creaId"+Math.random().toString().replace(".",""),this.textFocused=c.observable(!1),this.workareaDom=c.observable(),this.uploaderAreaDom=c.observable(),this.editorUploaderBodyDragOver=c.observable(!1),this.editorUploaderProgress=c.observable(!1),this.colorPickerDropdownDom=c.observable(),this.insertLinkDropdownDom=c.observable(),this.insertImageDropdownDom=c.observable(),this.isEnable=c.observable(!0),this.isEnable.subscribe(function(){this.oCrea&&this.oCrea.setEditable(this.isEnable())},this),this.allowInsertImage=c.observable(a&&Qb.App.AllowInsertImage),this.lockFontSubscribing=c.observable(!1),this.aFonts=["Arial","Arial Black","Courier New","Tahoma","Times New Roman","Verdana"],this.sDefaultFont="Tahoma",this.selectedFont=c.observable(this.sDefaultFont),this.selectedFont.subscribe(function(){this.lockFontSubscribing()||this.oCrea.fontName(this.selectedFont())},this),this.aSizes=[1,2,3,4,5,6,7],this.iDefaultSize=3,this.selectedSize=c.observable(this.iDefaultSize),this.selectedSize.subscribe(function(){this.lockFontSubscribing()||this.oCrea.fontSize(this.selectedSize())},this),this.visibleInsertLinkPopup=c.observable(!1),this.linkForInsert=c.observable(""),this.linkFocused=c.observable(!1),this.visibleLinkPopup=c.observable(!1),this.linkPopupTop=c.observable(0),this.linkPopupLeft=c.observable(0),this.linkHref=c.observable(""),this.visibleLinkHref=c.observable(!1),this.visibleImagePopup=c.observable(!1),this.visibleImagePopup.subscribe(function(){this.onImageOut()},this),this.imagePopupTop=c.observable(0),this.imagePopupLeft=c.observable(0),this.imageSelected=c.observable(!1),this.tooltipText=c.observable(""),this.tooltipPopupTop=c.observable(0),this.tooltipPopupLeft=c.observable(0),this.visibleInsertImagePopup=c.observable(!1),this.imageUploaderButton=c.observable(null),this.uploadedImagePathes=c.observableArray([]),this.imagePathFromWeb=c.observable(""),this.visibleFontColorPopup=c.observable(!1),this.oFontColorPicker=new eb(Mb.i18n("HTMLEDITOR/TEXT_COLOR_CAPTION"),this.setTextColorFromPopup,this),this.oBackColorPicker=new eb(Mb.i18n("HTMLEDITOR/BACKGROUND_COLOR_CAPTION"),this.setBackColorFromPopup,this),this.activitySource=c.observable(1),this.inactive=c.observable(!1),this.inactive.subscribe(function(){var a=this.removeAllTags(this.getText());this.inactive()?(""===a||"&nbsp;"===a)&&this.setText('<span style="color: #AAAAAA;">'+Mb.i18n("HTMLEDITOR/SIGNATURE_PLACEHOLDER")+"</span>"):a===Mb.i18n("HTMLEDITOR/SIGNATURE_PLACEHOLDER")&&this.setText("")},this)}function eb(a,b,d){this.aGreyColors=["rgb(0, 0, 0)","rgb(68, 68, 68)","rgb(102, 102, 102)","rgb(153, 153, 153)","rgb(204, 204, 204)","rgb(238, 238, 238)","rgb(243, 243, 243)","rgb(255, 255, 255)"],this.aBrightColors=["rgb(255, 0, 0)","rgb(255, 153, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(0, 0, 255)","rgb(153, 0, 255)","rgb(255, 0, 255)"],this.aColorLines=[["rgb(244, 204, 204)","rgb(252, 229, 205)","rgb(255, 242, 204)","rgb(217, 234, 211)","rgb(208, 224, 227)","rgb(207, 226, 243)","rgb(217, 210, 233)","rgb(234, 209, 220)"],["rgb(234, 153, 153)","rgb(249, 203, 156)","rgb(255, 229, 153)","rgb(182, 215, 168)","rgb(162, 196, 201)","rgb(159, 197, 232)","rgb(180, 167, 214)","rgb(213, 166, 189)"],["rgb(224, 102, 102)","rgb(246, 178, 107)","rgb(255, 217, 102)","rgb(147, 196, 125)","rgb(118, 165, 175)","rgb(111, 168, 220)","rgb(142, 124, 195)","rgb(194, 123, 160)"],["rgb(204, 0, 0)","rgb(230, 145, 56)","rgb(241, 194, 50)","rgb(106, 168, 79)","rgb(69, 129, 142)","rgb(61, 133, 198)","rgb(103, 78, 167)","rgb(166, 77, 121)"],["rgb(153, 0, 0)","rgb(180, 95, 6)","rgb(191, 144, 0)","rgb(56, 118, 29)","rgb(19, 79, 92)","rgb(11, 83, 148)","rgb(53, 28, 117)","rgb(116, 27, 71)"],["rgb(102, 0, 0)","rgb(120, 63, 4)","rgb(127, 96, 0)","rgb(39, 78, 19)","rgb(12, 52, 61)","rgb(7, 55, 99)","rgb(32, 18, 77)","rgb(76, 17, 48)"]],this.caption=a,this.pickHandler=b,this.pickContext=d,this.colorPickerDom=c.observable(null)}function fb(){this.phone=Ob.Phone,this.missedCalls=Ob.Phone.missedCalls,this.provider=Ob.Phone.provider,this.phoneReport=Ob.Phone.phoneReport,this.action=Ob.Phone.action,this.action.subscribe(function(a){var b=this;"connection_end"===a&&_.delay(function(){b.action("online")},500)},this),this.isNotHide=c.observable(!1).extend({autoResetToFalse:300}),this.state=c.observable("offline"),this.input=c.observable(""),this.isActive=c.observable(!1),this.inputFocus=c.observable(!1),this.inputFocus.subscribe(function(a){if(!a){var b=this;_.delay(function(){"online_active"!==b.action()||b.isNotHide()||b.action("online")},250)}},this),this.phoneAutocompleteItem=c.observable(null),this.phoneAutocompleteItem.subscribe(function(a){this.missedCalls().length&&this.phone.removeCallFromMissed(a)},this),this.indicator=c.observable(Mb.i18n("PHONE/MISSED_CALLS")),this.phoneAutocompleteTrigger=c.observable()}function gb(){this.email=c.observable(""),this.login=c.observable(""),this.password=c.observable(""),this.rtl=c.observable(Mb.isRTL()),this.loginDescription=c.observable(""),this.emailFocus=c.observable(!1),this.loginFocus=c.observable(!1),this.passwordFocus=c.observable(!1),this.loading=c.observable(!1),this.loginFocus.subscribe(function(a){a&&""===this.login()&&this.login(this.email())},this),this.loginFormType=c.observable(Qb.App.LoginFormType),this.loginAtDomainValue=c.observable(Qb.App.LoginAtDomainValue),this.loginAtDomainValueWithAt=c.computed(function(){var a=this.loginAtDomainValue();return""===a?"":"@"+a},this),this.emailVisible=c.computed(function(){return Lb.LoginFormType.Login!==this.loginFormType()},this),this.loginVisible=c.computed(function(){return Lb.LoginFormType.Email!==this.loginFormType()},this),this.signMeType=c.observable(Qb.App.LoginSignMeType),this.signMe=c.observable(Lb.LoginSignMeType.DefaultOn===this.signMeType()),this.signMeType.subscribe(function(){this.signMe(Lb.LoginSignMeType.DefaultOn===this.signMeType())},this),this.focusedField="",this.aLanguages=Qb.App.Languages,this.currentLanguage=c.observable(Qb.App.DefaultLanguage),this.allowLanguages=c.observable(Qb.App.AllowLanguageOnLogin),this.viewLanguagesAsDropdown=c.observable(!Qb.App.FlagsLangSelect),this.canBeLogin=c.computed(function(){var a=this.loginFormType(),b=this.email(),c=this.login(),d=this.password();return!this.loading()&&""!==Mb.trim(d)&&(Lb.LoginFormType.Login===a&&""!==Mb.trim(c)||Lb.LoginFormType.Email===a&&""!==Mb.trim(b)||Lb.LoginFormType.Both===a&&""!==Mb.trim(b))},this),this.signInButtonText=c.computed(function(){return this.loading()?Mb.i18n("LOGIN/BUTTON_SIGNING_IN"):Mb.i18n("LOGIN/BUTTON_SIGN_IN")},this),this.loginCommand=Mb.createCommand(this,this.signIn,this.canBeLogin),this.email(Qb.App.DemoWebMailLogin||""),this.password(Qb.App.DemoWebMailPassword||""),this.loginDescription(Qb.App.LoginDescription||"")}function hb(){this.accounts=Qb.Accounts.collection,this.mobileApp=Sb,this.foldersContainer=c.observable(null),this.folderList=Ob.MailCache.folderList,this.manageFoldersHash=Ob.Routing.buildHashFromArray([Lb.Screens.Settings,Lb.SettingsTab.EmailAccounts,Lb.AccountSettingsTab.Folders]),this.quotaProc=c.observable(-1),this.quotaDesc=c.observable(""),c.computed(function(){if(!Qb.App.ShowQuotaBar)return!0;Ob.MailCache.quotaChangeTrigger();var a=Qb.Accounts.getCurrent(),b=a?a.quota():0,c=a?a.usedSpace():0,d=b>0?Math.ceil(c/b*100):-1;return d=d>100?100:d,this.quotaProc(d),this.quotaDesc(d>-1?Mb.i18n("MAILBOX/QUOTA_TOOLTIP",{PROC:d,QUOTA:Mb.friendlySize(1024*b)}):""),!0},this)}function ib(){this.isFocused=c.observable(!1),this.messagesContainer=c.observable(null),this.searchInput=c.observable(""),this.searchInputFrom=c.observable(""),this.searchInputTo=c.observable(""),this.searchInputSubject=c.observable(""),this.searchInputText=c.observable(""),this.searchSpan=c.observable(""),this.highlightTrigger=c.observable(""),this.currentMessage=Ob.MailCache.currentMessage,this.currentMessage.subscribe(function(){this.isFocused(!1),this.selector.itemSelected(this.currentMessage())},this),this.folderList=Ob.MailCache.folderList,this.folderList.subscribe(this.onFolderListSubscribe,this),this.folderFullName=c.observable(""),this.filters=c.observable(""),this.uidList=Ob.MailCache.uidList,this.uidList.subscribe(function(){this.uidList().searchCountSubscription&&(this.uidList().searchCountSubscription.dispose(),this.uidList().searchCountSubscription=void 0),this.uidList().searchCountSubscription=this.uidList().resultCount.subscribe(function(){this.uidList().resultCount()>=0&&this.oPageSwitcher.setCount(this.uidList().resultCount())},this),this.uidList().resultCount()>=0&&this.oPageSwitcher.setCount(this.uidList().resultCount())},this),this.useThreads=c.computed(function(){var a=this.folderList().currentFolder(),b=a&&a.withoutThreads(),c=""===this.uidList().search()&&""===this.uidList().filters();return Qb.User.useThreads()&&!b&&c},this),this.collection=Ob.MailCache.messages,this._search=c.observable(""),this.search=c.computed({read:function(){return Mb.trim(this._search())},write:this._search,owner:this}),this.isEmptyList=c.computed(function(){return 0===this.collection().length},this),this.isNotEmptyList=c.computed(function(){return 0!==this.collection().length},this),this.isSearch=c.computed(function(){return this.search().length>0},this),this.isLoading=Ob.MailCache.messagesLoading,this.isError=Ob.MailCache.messagesLoadingError,this.visibleInfoLoading=c.computed(function(){return!this.isSearch()&&this.isLoading()},this),this.visibleInfoSearchLoading=c.computed(function(){return this.isSearch()&&this.isLoading()},this),this.visibleInfoSearchList=c.computed(function(){return this.isSearch()&&!this.isLoading()&&!this.isEmptyList()},this),this.visibleInfoMessageListEmpty=c.computed(function(){return!this.isLoading()&&!this.isSearch()&&this.filters()!==Lb.FolderFilter.Flagged&&this.isEmptyList()&&!this.isError()},this),this.visibleInfoStarredFolderEmpty=c.computed(function(){return!this.isLoading()&&!this.isSearch()&&this.filters()===Lb.FolderFilter.Flagged&&this.isEmptyList()&&!this.isError()},this),this.visibleInfoSearchEmpty=c.computed(function(){return this.isSearch()&&this.isEmptyList()&&!this.isError()&&!this.isLoading()},this),this.visibleInfoMessageListError=c.computed(function(){return!this.isSearch()&&this.isError()},this),this.visibleInfoSearchError=c.computed(function(){return this.isSearch()&&this.isError()},this),this.searchText=c.computed(function(){return Mb.i18n("MAILBOX/INFO_SEARCH_RESULT",{SEARCH:this.search(),FOLDER:this.folderList().currentFolder()?this.folderList().currentFolder().displayName():""})},this),this.collectionChecked=c.computed(function(){var a=_.filter(this.collection(),function(a){return!a.deleted()&&a.checked()});return 0===a.length&&Ob.MailCache.currentMessage()&&!Ob.MailCache.currentMessage().deleted()&&(a=[Ob.MailCache.currentMessage()]),a},this),this.collectionCheckedUids=c.computed(function(){return _.map(this.collectionChecked(),function(a){return a.uid()})},this),this.isEnableGroupOperations=c.observable(!1).extend({throttle:250}),this.selector=new l(this.collection,_.bind(this.routeForMessage,this),_.bind(this.onDeletePress,this),_.bind(this.onMessageDblClick,this),_.bind(this.onEnterPress,this)),c.computed(function(){this.isEnableGroupOperations(0<this.selector.listCheckedOrSelected().length)},this),this.checkAll=this.selector.koCheckAll(),this.checkAllIncomplite=this.selector.koCheckAllIncomplete(),this.pageSwitcherLocked=c.observable(!1),this.oPageSwitcher=new cb(0,Qb.User.MailsPerPage),this.oPageSwitcher.currentPage.subscribe(function(a){var b=this.folderList().currentFolderFullName(),c=!Sb&&this.currentMessage()?this.currentMessage().uid():"",d=this.search();this.pageSwitcherLocked()||this.changeRoutingForMessageList(b,a,c,d,this.filters())},this),this.currentPage=c.observable(0),this.listChangedThrottle=Ob.browser.firefox||Ob.browser.ie?c.observable(!1).extend({throttle:10}):c.observable(!1),this.firstCompleteCollection=c.observable(!0),this.collection.subscribe(function(){this.collection().length>0&&this.firstCompleteCollection(!1)},this),this.currentAccountId=Qb.Accounts.currentId,this.listChanged=c.computed(function(){return[this.firstCompleteCollection(),this.currentAccountId(),this.folderFullName(),this.filters(),this.search(),this.oPageSwitcher.currentPage()]},this),this.listChanged.subscribe(function(){this.listChangedThrottle(!this.listChangedThrottle())},this),this.bAdvancedSearch=c.observable(!1),this.searchAttachmentsCheckbox=c.observable(!1),this.searchAttachments=c.observable(""),this.searchAttachments.subscribe(function(a){this.searchAttachmentsCheckbox(!!a)},this),this.panelTopDom=c.observable(null),this.extendedDom=c.observable(null),this.searchAttachmentsFocus=c.observable(!1),this.searchFromFocus=c.observable(!1),this.searchSubjectFocus=c.observable(!1),this.searchToFocus=c.observable(!1),this.searchTextFocus=c.observable(!1),this.searchTrigger=c.observable(null),this.searchDateStartFocus=c.observable(!1),this.searchDateEndFocus=c.observable(!1),this.searchDateStartDom=c.observable(null),this.searchDateStart=c.observable(""),this.searchDateEndDom=c.observable(null),this.searchDateEnd=c.observable(""),this.dateFormatMoment="MM/DD/YYYY",this.dateFormatDatePicker="yy.mm.dd",this.attachmentsPlaceholder=c.computed(function(){return"Has attachments"},this),_.delay(_.bind(function(){this.createDatePickerObject(this.searchDateStartDom()),this.createDatePickerObject(this.searchDateEndDom())},this),1e3)}function jb(){this.singleMode=c.observable(Qb.SingleMode),this.isLoading=c.observable(!1),this.messages=Ob.MailCache.messages,this.messages.subscribe(this.onMessagesSubscribe,this),this.currentMessage=Ob.MailCache.currentMessage,this.currentMessage.subscribe(this.onCurrentMessageSubscribe,this),Qb.User.defaultTimeFormat.subscribe(this.onCurrentMessageSubscribe,this),this.isCurrentMessage=c.computed(function(){return!!this.currentMessage()},this),this.isCurrentMessageLoaded=c.computed(function(){return this.isCurrentMessage()&&!this.isLoading()},this),this.visibleNoMessageSelectedText=c.computed(function(){return this.messages().length>0&&!this.isCurrentMessage()},this),this.isEnableReply=this.isCurrentMessageLoaded,this.isEnableReplyAll=this.isCurrentMessageLoaded,this.isEnableResend=this.isCurrentMessageLoaded,this.isEnableForward=this.isCurrentMessageLoaded,this.isEnablePrint=this.isCurrentMessageLoaded,this.isEnableSave=this.isCurrentMessage,this.replyCommand=Mb.createCommand(this,this.executeReply,this.isEnableReply),this.replyAllCommand=Mb.createCommand(this,this.executeReplyAll,this.isEnableReplyAll),this.resendCommand=Mb.createCommand(this,this.executeResend,this.isEnableResend),this.forwardCommand=Mb.createCommand(this,this.executeForward,this.isEnableForward),this.printCommand=Mb.createCommand(this,this.executePrint,this.isEnablePrint),this.saveCommand=Mb.createCommand(this,this.executeSave,this.isEnableSave),this.ical=c.observable(null),this.vcard=c.observable(null),this.processed=c.observable(!1),this.visiblePicturesControl=c.observable(!1),this.visibleShowPicturesLink=c.observable(!1),this.visibleAppointmentInfo=c.computed(function(){return null!==this.ical()},this),this.visibleVcardInfo=c.computed(function(){return null!==this.vcard()},this),this.sensitivityText=c.computed(function(){var a="";if(this.currentMessage())switch(this.currentMessage().sensitivity()){case Lb.Sensivity.Confidential:a=Mb.i18n("MESSAGE/SENSIVITY_CONFIDENTIAL");break;case Lb.Sensivity.Personal:a=Mb.i18n("MESSAGE/SENSIVITY_PERSONAL");break;case Lb.Sensivity.Private:a=Mb.i18n("MESSAGE/SENSIVITY_PRIVATE")}return a},this),this.visibleConfirmationControl=c.computed(function(){return this.currentMessage()&&""!==this.currentMessage().readingConfirmation()},this),this.fakeHeader=c.computed(function(){return!(this.visiblePicturesControl()||this.visibleConfirmationControl()||""!==this.sensitivityText())},this),this.isCurrentNotDraftOrSent=c.computed(function(){var a=Ob.MailCache.folderList().currentFolder();return a&&a.fullName().length>0&&a.type()!==Lb.FolderTypes.Drafts&&a.type()!==Lb.FolderTypes.Sent},this),this.isCurrentSentFolder=c.computed(function(){var a=Ob.MailCache.folderList().currentFolder();return a&&a.fullName().length>0&&a.type()===Lb.FolderTypes.Sent},this),this.isCurrentNotDraftFolder=c.computed(function(){var a=Ob.MailCache.folderList().currentFolder();return a&&a.fullName().length>0&&a.type()!==Lb.FolderTypes.Drafts},this),this.isVisibleReplyTool=this.isCurrentNotDraftOrSent,this.isVisibleResendTool=this.isCurrentSentFolder,this.isVisibleForwardTool=this.isCurrentNotDraftFolder,this.uid=c.observable(""),this.folder=c.observable(""),this.subject=c.observable(""),this.importance=c.observable(Lb.Importance.Normal),this.oFromAddr=c.observable(null),this.from=c.observable(""),this.fullFrom=c.observable(""),this.to=c.observable(""),this.aToAddr=c.observableArray([]),this.cc=c.observable(""),this.aCcAddr=c.observableArray([]),this.bcc=c.observable(""),this.aBccAddr=c.observableArray([]),this.allRecipients=c.observable(""),this.aAllRecipients=c.observableArray([]),this.recipientsContacts=c.observableArray([]),this.currentAccountEmail=c.observable(),this.meRecipient=Mb.i18n("MESSAGE/ME_RECIPIENT"),this.fullDate=c.observable(""),this.midDate=c.observable(""),this.textBody=c.observable(""),this.textBodyForNewWindow=c.observable(""),this.domTextBody=c.observable(null),this.rtlMessage=c.observable(!1),this.contentHasFocus=c.observable(!1),this.mobileApp=Sb,this.attachments=c.observableArray([]),this.usesAttachmentString=!0,this.attachmentsInString=c.computed(function(){return _.map(this.attachments(),function(a){return a.fileName()},this).join(", ")},this),this.notInlineAttachments=c.computed(function(){return _.filter(this.attachments(),function(a){return!a.linked()})},this),this.visibleDownloadAllAttachments=c.computed(function(){return Qb.ZipAttachments&&this.notInlineAttachments().length>1},this),this.visibleSaveAttachmentsToFiles=Qb.User.IsFilesSupported,this.visibleDownloadAllAttachmentsSeparately=c.computed(function(){return this.notInlineAttachments().length>1},this),this.visibleExtendedDownload=c.computed(function(){return!this.mobileApp&&(this.visibleDownloadAllAttachments()||this.visibleDownloadAllAttachmentsSeparately()||this.visibleSaveAttachmentsToFiles)},this),this.detailsVisible=c.observable(!1),this.hasNotInlineAttachments=c.computed(function(){return this.notInlineAttachments().length>0},this),this.scrollToAttachment=c.observable(".attachments"),this.hasBodyText=c.computed(function(){return this.textBody().length>0},this),this.visibleAddMenu=c.observable(!1),this.replyText=c.observable(""),this.replyHtmlText=c.computed(function(){return Ob.MessageSender.getHtmlFromText(this.replyText())},this),this.replyTextFocus=c.observable(!1),this.replyPaneVisible=c.computed(function(){return this.currentMessage()&&this.currentMessage().completelyFilled()},this),this.replySendingStarted=c.observable(!1),this.replySavingStarted=c.observable(!1),this.replyDraftUid=c.observable(""),this.replyCc=c.observable(""),this.replyBcc=c.observable(""),this.replyLoadingText=c.computed(function(){return this.replySendingStarted()?Mb.i18n("COMPOSE/INFO_SENDING"):this.replySavingStarted()?Mb.i18n("COMPOSE/INFO_SAVING"):""},this),this.domMessageHeader=c.observable(null),this.domQuickReply=c.observable(null),this.domMessageForPrint=c.observable(null),this.replyTextFocusThrottled=c.observable(!1).extend({throttle:50}),this.replyTextFocus.subscribe(function(){this.replyTextFocusThrottled(this.replyTextFocus())},this),this.isQuickReplyActive=c.computed(function(){return this.replyText().length>0||this.replyTextFocusThrottled()},this),this.jqPanelHelper=null,this.visibleAttachments=c.observable(!1),this.showMessage=function(){this.visibleAttachments(!1)},this.showAttachments=function(){this.visibleAttachments(!0)}}function kb(){this.folderList=Ob.MailCache.folderList,this.domFolderList=c.observable(null),this.oFolderList=new hb,this.oMessageList=new ib,this.oMessagePane=new jb,this.isEnableGroupOperations=this.oMessageList.isEnableGroupOperations,this.composeLink=c.observable(Ob.Routing.buildHashFromArray(Ob.Links.compose())),this.checkMailCommand=Mb.createCommand(Ob.MailCache,Ob.MailCache.executeCheckMail),this.checkMailStarted=Ob.MailCache.checkMailStarted,this.markAsReadCommand=Mb.createCommand(this.oMessageList,this.oMessageList.executeMarkAsRead,this.isEnableGroupOperations),this.markAsUnreadCommand=Mb.createCommand(this.oMessageList,this.oMessageList.executeMarkAsUnread,this.isEnableGroupOperations),this.markAllReadCommand=Mb.createCommand(this.oMessageList,this.oMessageList.executeMarkAllRead),this.moveToFolderCommand=Mb.createCommand(this,Mb.emptyFunction,this.isEnableGroupOperations),this.deleteCommand=Mb.createCommand(this.oMessageList,this.oMessageList.executeDelete,this.isEnableGroupOperations),this.selectedUids=c.computed(function(){var a=this.oMessageList.selector.listChecked(),b=this.getThreadCheckedUidsFromList(a),c=_.map(a,function(a){return a.uid()
}),d=_.union(c,b);return d},this),this.selectedCount=c.computed(function(){var a=this.selectedUids(),b=a.length;return b},this),this.emptyTrashCommand=Mb.createCommand(Ob.MailCache,Ob.MailCache.executeEmptyTrash,this.oMessageList.isNotEmptyList),this.emptySpamCommand=Mb.createCommand(Ob.MailCache,Ob.MailCache.executeEmptySpam,this.oMessageList.isNotEmptyList),this.spamCommand=Mb.createCommand(this.oMessageList,this.oMessageList.executeSpam,this.isEnableGroupOperations),this.notSpamCommand=Mb.createCommand(this.oMessageList,this.oMessageList.executeNotSpam,this.isEnableGroupOperations),this.bVisibleComposeMessage=Qb.User.AllowCompose,this.isVisibleReplyTool=c.computed(function(){return this.folderList().currentFolder()&&this.folderList().currentFolderFullName().length>0&&this.folderList().currentFolderType()!==Lb.FolderTypes.Drafts&&this.folderList().currentFolderType()!==Lb.FolderTypes.Sent},this),this.isVisibleForwardTool=c.computed(function(){return this.folderList().currentFolder()&&this.folderList().currentFolderFullName().length>0&&this.folderList().currentFolderType()!==Lb.FolderTypes.Drafts},this),this.isSpamFolder=c.computed(function(){return this.folderList().currentFolderType()===Lb.FolderTypes.Spam},this),this.allowedSpamAction=c.computed(function(){var a=Qb.Accounts.getCurrent();return a?a.extensionExists("AllowSpamFolderExtension")&&!this.isSpamFolder():!1},this),this.allowedNotSpamAction=c.computed(function(){var a=Qb.Accounts.getCurrent();return a.extensionExists("AllowSpamFolderExtension")&&this.isSpamFolder()},this),this.isTrashFolder=c.computed(function(){return this.folderList().currentFolderType()===Lb.FolderTypes.Trash},this),this.jqPanelHelper=null,this.mobileApp=Sb,this.selectedPanel=c.observable(Lb.MobilePanel.Items),Ob.MailCache.currentMessage.subscribe(function(){this.gotoMessagePane()},this)}function lb(){this.toAddrDom=c.observable(),this.ccAddrDom=c.observable(),this.bccAddrDom=c.observable(),this.folderList=Ob.MailCache.folderList,this.folderList.subscribe(function(){this.getMessageOnRoute()},this),this.singleMode=c.observable(Qb.SingleMode),this.isDemo=c.observable(Qb.User.IsDemo),this.sending=c.observable(!1),this.sending.subscribe(this.sendingAndSavingSubscription,this),this.saving=c.observable(!1),this.saving.subscribe(this.sendingAndSavingSubscription,this),this.oHtmlEditor=new db(!0,this),this.textFocused=this.oHtmlEditor.textFocused,this.visibleBcc=c.observable(!1),this.visibleBcc.subscribe(function(){Tb.toggleClass("screen-compose-bcc",this.visibleCc()),_.defer(_.bind(function(){a(this.bccAddrDom()).inputosaurus("resizeInput")},this))},this),this.visibleCc=c.observable(!1),this.visibleCc.subscribe(function(){Tb.toggleClass("screen-compose-cc",this.visibleCc()),_.defer(_.bind(function(){a(this.ccAddrDom()).inputosaurus("resizeInput")},this))},this),this.visibleCounter=c.observable(!1),this.readingConfirmation=c.observable(!1),this.saveMailInSentItems=c.observable(!0),this.useSaveMailInSentItems=c.observable(!1),this.composeUploaderButton=c.observable(null),this.composeUploaderDropPlace=c.observable(null),this.composeUploaderBodyDragOver=c.observable(!1),this.composeUploaderDragOver=c.observable(!1),this.allowDragNDrop=c.observable(!1),this.uploaderBodyDragOver=c.computed(function(){return this.allowDragNDrop()&&this.composeUploaderBodyDragOver()},this),this.uploaderDragOver=c.computed(function(){return this.allowDragNDrop()&&this.composeUploaderDragOver()},this),this.selectedImportance=c.observable(Lb.Importance.Normal),this.selectedSensitivity=c.observable(Lb.Sensivity.Nothing),this.senderList=c.observableArray([]),this.visibleFrom=c.computed(function(){return this.senderList().length>1},this),this.selectedSender=c.observable(""),this.selectedFetcherOrIdentity=c.observable(null),this.selectedFetcherOrIdentity.subscribe(function(){this.selectedFetcherOrIdentity()?this.selectedFetcherOrIdentity().FETCHER===!0?this.selectedSender("fetcher"+this.selectedFetcherOrIdentity().id()):this.selectedSender(Mb.pString(this.selectedFetcherOrIdentity().id())):this.selectedSender(""),this.changeSignature()},this),this.selectedSender.subscribe(function(){var a=Qb.Accounts.getAccount(this.senderAccountId()),b=this.selectedSender(),c=null;0===b.indexOf("fetcher")?a.fetchers()&&(b=b.replace("fetcher",""),c=_.find(a.fetchers().collection(),function(a){return a.id()===Mb.pInt(b)})):c=_.find(a.identities(),function(a){return a.id()===Mb.pInt(b)}),this.selectedFetcherOrIdentity(c)},this),this.selectedIdentityId=c.observable(0),this.selectedIdentityId.subscribe(function(){this.changeSignature()},this),this.senderAccountId=c.observable(Qb.Accounts.currentId()),this.lockToAddr=c.observable(!1),this.toAddr=c.observable("").extend({reversible:!0}),this.toAddr.subscribe(function(){this.lockToAddr()||(a(this.toAddrDom()).val(this.toAddr()),a(this.toAddrDom()).inputosaurus("refresh"))},this),this.lockCcAddr=c.observable(!1),this.ccAddr=c.observable("").extend({reversible:!0}),this.ccAddr.subscribe(function(){this.lockCcAddr()||(a(this.ccAddrDom()).val(this.ccAddr()),a(this.ccAddrDom()).inputosaurus("refresh"))},this),this.lockBccAddr=c.observable(!1),this.bccAddr=c.observable("").extend({reversible:!0}),this.bccAddr.subscribe(function(){this.lockBccAddr()||(a(this.bccAddrDom()).val(this.bccAddr()),a(this.bccAddrDom()).inputosaurus("refresh"))},this),this.subject=c.observable("").extend({reversible:!0}),this.counter=c.observable(0),this.commitedTextBody=c.observable(""),this.textBody=c.observable(""),this.textBody.subscribe(function(){this.oHtmlEditor.setText(this.textBody()),this.commitedTextBody(this.oHtmlEditor.getText())},this),this.toAddrFocused=c.observable(!1),this.toAddrFocused.subscribe(function(){this.toAddrFocused()&&a(this.toAddrDom()).inputosaurus("focus")},this),this.ccAddrFocused=c.observable(!1),this.ccAddrFocused.subscribe(function(){this.ccAddrFocused()&&a(this.bccAddrDom()).inputosaurus("focus")},this),this.bccAddrFocused=c.observable(!1),this.bccAddrFocused.subscribe(function(){this.bccAddrFocused()&&a(this.bccAddrDom()).inputosaurus("focus")},this),this.subjectFocused=c.observable(!1),this.draftUid=c.observable(""),this.draftInfo=c.observableArray([]),this.routeType=c.observable(""),this.routeParams=c.observableArray([]),this.inReplyTo=c.observable(""),this.references=c.observable(""),this.uploadAttachmentsTimer=-1,this.messageUploadAttachmentsStarted=c.observable(!1),this.messageUploadAttachmentsStarted.subscribe(function(){clearTimeout(this.uploadAttachmentsTimer),this.messageUploadAttachmentsStarted()?this.uploadAttachmentsTimer=setTimeout(function(){Ob.Api.showLoading(Mb.i18n("COMPOSE/INFO_ATTACHMENTS_LOADING"))},4e3):Ob.Api.hideLoading()},this),this.attachments=c.observableArray([]),this.attachmentsChanged=c.observable(!1),this.notUploadedAttachments=c.computed(function(){return _.filter(this.attachments(),function(a){return!a.uploaded()})},this),this.allAttachmentsUploaded=c.computed(function(){return 0===this.notUploadedAttachments().length&&!this.messageUploadAttachmentsStarted()},this),this.notInlineAttachments=c.computed(function(){return _.filter(this.attachments(),function(a){return!a.linked()})},this),this.notInlineAttachments.subscribe(function(){Tb.toggleClass("screen-compose-attachments",this.notInlineAttachments().length>0)},this),this.allowStartSending=c.computed(function(){return!this.saving()},this),this.allowStartSending.subscribe(function(){this.allowStartSending()&&this.requiresPostponedSending()&&(Ob.MessageSender.sendPostponedMail(this.draftUid()),this.requiresPostponedSending(!1))},this),this.requiresPostponedSending=c.observable(!1),this.oJua=null,this.isDraftsCleared=c.observable(!1),this.autoSaveTimer=-1,this.backToListCommand=Mb.createCommand(this,this.executeBackToList),this.sendCommand=Mb.createCommand(this,this.executeSend,this.isEnableSending),this.saveCommand=Mb.createCommand(this,this.executeSaveCommand,this.isEnableSaving),this.messageFields=c.observable(null),this.bottomPanel=c.observable(null),this.shown=c.observable(!1),this.shown.subscribe(function(){this.shown()||this.stopAutosaveTimer()},this),this.editableArea=c.observable(null),this.mobileApp=Sb}function mb(a){this.oJua=null,this.oParent=a,this.visibility=c.observable(!1),this.importing=c.observable(!1)}function nb(){this.importingHelpLink=Ob.getHelpLink("ImportingContacts"),this.loadingList=c.observable(!1),this.loadingViewPane=c.observable(!1),this.showPersonalContacts=c.observable(!1),this.showGlobalContacts=c.observable(!1),this.showSharedToAllContacts=c.observable(!1),this.recivedAnimShare=c.observable(!1).extend({autoResetToFalse:500}),this.recivedAnimUnshare=c.observable(!1).extend({autoResetToFalse:500}),this.selectedGroupType=c.observable(Lb.ContactsGroupListType.Personal),this.selectedGroupInList=c.observable(null),this.selectedGroupInList.subscribe(function(){var a=this.selectedGroupInList();a&&a.selected(!1)},this,"beforeChange"),this.selectedGroupInList.subscribe(function(a){a&&this.showPersonalContacts()&&(a.selected(!0),this.selectedGroupType(Lb.ContactsGroupListType.SubGroup),this.requestContactList())},this),this.selectedGroup=c.observable(null),this.selectedContact=c.observable(null),this.selectedGroupContactsList=c.observable(null),this.currentGroupId=c.observable(""),this.oContactModel=new R,this.oGroupModel=new S,this.oContactImportViewModel=new mb(this),this.selectedOldItem=c.observable(null),this.selectedItem=c.computed({read:function(){return this.selectedContact()||this.selectedGroup()||null},write:function(a){a instanceof R?(this.oContactImportViewModel.visibility(!1),this.selectedGroup(null),this.selectedContact(a)):a instanceof S?(this.oContactImportViewModel.visibility(!1),this.selectedContact(null),this.selectedGroup(a),this.currentGroupId(a.idGroup())):(this.selectedGroup(null),this.selectedContact(null)),this.loadingViewPane(!1)},owner:this}),this.sortOrder=c.observable(!0),this.sortType=c.observable(Lb.ContactSortType.Name),this.collection=c.observableArray([]),this.isSearchFocused=c.observable(!1),this.searchInput=c.observable(""),this.search=c.observable(""),this.groupFullCollection=c.observableArray([]),this.selectedContact.subscribe(function(a){if(a){var b=a.groups();_.each(this.groupFullCollection(),function(a){a.checked(a&&0<=Mb.inArray(a.Id(),b))})}},this),this.selectedGroupType.subscribe(function(a){Lb.ContactsGroupListType.Personal===a&&!this.showPersonalContacts()&&this.showGlobalContacts()?this.selectedGroupType(Lb.ContactsGroupListType.Global):Lb.ContactsGroupListType.Global===a&&!this.showGlobalContacts()&&this.showPersonalContacts()?this.selectedGroupType(Lb.ContactsGroupListType.Personal):(Lb.ContactsGroupListType.Personal===a||Lb.ContactsGroupListType.Global===a||Lb.ContactsGroupListType.SharedToAll===a)&&(this.selectedGroupInList(null),this.selectedItem(null),this.selector.listCheckedOrSelected(!1),this.requestContactList())},this),this.pageSwitcherLocked=c.observable(!1),this.oPageSwitcher=new cb(0,Qb.User.ContactsPerPage),this.oPageSwitcher.currentPage.subscribe(function(){var a=this.selectedGroupType(),b=a===Lb.ContactsGroupListType.SubGroup?this.currentGroupId():"";this.pageSwitcherLocked()||Ob.Routing.setHash(Ob.Links.contacts(a,b,this.search(),this.oPageSwitcher.currentPage()))},this),this.currentPage=c.observable(0),this.search.subscribe(function(a){this.searchInput(a)},this),this.searchSubmitCommand=Mb.createCommand(this,function(){var a=this.selectedGroupType(),b=a===Lb.ContactsGroupListType.SubGroup?this.currentGroupId():"";Ob.Routing.setHash(Ob.Links.contacts(a,b,this.searchInput()))}),this.selector=new l(this.collection,_.bind(function(a){if(a){var b=this.selectedGroupType(),c=b===Lb.ContactsGroupListType.SubGroup?this.currentGroupId():"";Ob.Routing.setHash(Ob.Links.contacts(b,c,this.search(),this.oPageSwitcher.currentPage(),a.sId))}},this),_.bind(this.executeDelete,this),_.bind(this.onContactDblClick,this)),this.checkAll=this.selector.koCheckAll(),this.checkAllIncomplite=this.selector.koCheckAllIncomplete(),this.newContactCommand=Mb.createCommand(this,this.executeNewContact),this.newGroupCommand=Mb.createCommand(this,this.executeNewGroup),this.addContactsCommand=Mb.createCommand(this,Mb.emptyFunction,this.isEnableAddContacts),this.deleteCommand=Mb.createCommand(this,this.executeDelete,this.isEnableDeleting),this.shareCommand=Mb.createCommand(this,this.executeShare,this.isEnableSharing),this.removeFromGroupCommand=Mb.createCommand(this,this.executeRemoveFromGroup,this.isEnableRemoveContactsFromGroup),this.importCommand=Mb.createCommand(this,this.executeImport),this.exportCommand=Mb.createCommand(this,this.executeExport),this.saveCommand=Mb.createCommand(this,this.executeSave,function(){var a=this.selectedItem();return a?a.canBeSave():!1}),this.updateSharedToAllCommand=Mb.createCommand(this,this.executeUpdateSharedToAll,function(){return 1===this.selector.listCheckedOrSelected().length}),this.newMessageCommand=Mb.createCommand(this,function(){var a=this.selector.listCheckedOrSelected(),b=[];_.isArray(a)&&0<a.length&&(b=_.map(a,function(a){return a.EmailAndName()}),b=_.compact(b),Ob.Api.openComposeMessage(b.join(", ")))},function(){return 0<this.selector.listCheckedOrSelected().length}),this.selector.listCheckedOrSelected.subscribe(function(a){this.oGroupModel.newContactsInGroupCount(a.length)},this),this.isLoading=this.loadingList,this.isSearch=c.observable(!1),this.isEmptyList=c.computed(function(){return 0===this.collection().length},this),this.inGroup=c.computed(function(){return Lb.ContactsGroupListType.SubGroup===this.selectedGroupType()},this),this.searchText=c.computed(function(){return Mb.i18n("CONTACTS/INFO_SEARCH_RESULT",{SEARCH:this.search()})},this),this.mobileApp=Sb,this.selectedPanel=c.observable(Lb.MobilePanel.Items),this.selectedItem.subscribe(function(){var a=this.selectedItem()&&this.selectedItem()instanceof S&&!this.selectedItem().isNew();this.selectedItem()&&!a?this.gotoViewPane():this.gotoContactList()},this)}function ob(){this.aTabs=[],Qb.App.AllowUsersChangeInterfaceSettings&&this.aTabs.push(new pb),this.aTabs.push(new qb),Qb.App.AllowUsersChangeInterfaceSettings&&Qb.User.AllowCalendar&&this.aTabs.push(new rb),Qb.User.MobileSyncEnable&&this.aTabs.push(new sb),Qb.User.OutlookSyncEnable&&this.aTabs.push(new tb),Qb.User.IsHelpdeskSupported&&this.aTabs.push(new Db),Pb&&Pb.getPluginsSettingsTabs&&_.each(Pb.getPluginsSettingsTabs(),_.bind(function(a){this.aTabs.push(new a)},this)),this.tab=c.observable(Lb.SettingsTab.Common),this.allowFolderListOrder=c.computed(function(){var a=Qb.Accounts.getEdited();return a?!a.extensionExists("DisableFoldersManualSort"):!1},this),this.folderListOrderUpdateDebounce=_.debounce(_.bind(this.folderListOrderUpdate,this),5e3),this.afterSortableFolderMoveBinded=_.bind(this.afterSortableFolderMove,this),this.iUpdateFolderListTimer=-1,this.bAllowFolderListOrderNameUpdate=!1}function pb(){this.aSkins=Qb.App.Themes,this.selectedSkin=c.observable(Qb.User.DefaultTheme),this.layout=c.observable(Qb.User.Layout),this.aLanguages=Qb.App.Languages,this.selectedLanguage=c.observable(Qb.User.DefaultLanguage),this.loading=c.observable(!1),this.rangeOfNumbers=[10,20,30,50,75,100,150,200],this.messagesPerPageValues=c.observableArray(this.rangeOfNumbers),this.messagesPerPage=c.observable(this.rangeOfNumbers[0]),this.setMessagesPerPage(Qb.User.MailsPerPage),this.contactsPerPageValues=c.observableArray(this.rangeOfNumbers),this.contactsPerPage=c.observable(this.rangeOfNumbers[0]),this.setContactsPerPage(Qb.User.ContactsPerPage),this.autocheckmailInterval=c.observable(Qb.User.AutoCheckMailInterval),this.richText=c.observable(Qb.User.DefaultEditor),this.timeFormat=c.observable(Qb.User.defaultTimeFormat()),this.aDateFormats=Mb.getDateFormatsForSelector(),this.dateFormat=c.observable(Qb.User.DefaultDateFormat),this.useThreads=c.observable(Qb.User.useThreads()),this.saveRepliedToCurrFolder=c.observable(Qb.User.SaveRepliedToCurrFolder),this.bAllowContacts=Qb.User.ShowContacts,this.bAllowCalendar=Qb.User.AllowCalendar,this.bAllowThreads=Qb.User.ThreadsEnabled,this.firstState=this.getState()}function qb(){this.accounts=Qb.Accounts.collection,this.onlyOneAccount=c.computed(function(){var a=1===this.accounts().length&&!Qb.App.AllowUsersAddNewAccounts;return a&&(this.TabTitle=Mb.i18n("SETTINGS/TAB_EMAIL_ACCOUNT")),a},this),this.title=c.computed(function(){return this.onlyOneAccount()?Mb.i18n("SETTINGS/TITLE_EMAIL_ACCOUNT"):Mb.i18n("SETTINGS/TITLE_EMAIL_ACCOUNTS")},this),this.currentAccountId=Qb.Accounts.currentId,this.editedAccountId=Qb.Accounts.editedId,this.defaultAccountId=Qb.Accounts.defaultId,this.defaultAccount=Qb.Accounts.getDefault(),this.isAllowFetcher=!!Qb.User.AllowFetcher,this.isAllowIdentities=!!Qb.AllowIdentities,this.oAccountProperties=new ub(this),this.oAccountSignature=new wb(this),this.oAccountFilters=new zb(this),this.oAccountAutoresponder=new yb(this),this.oAccountForward=new xb(this),this.oAccountFolders=new vb(this),this.oFetcherIncoming=new Ab(this),this.oFetcherOutgoing=new Bb(this),this.oFetcherSignature=new Cb(this),this.oIdentityProperties=new Eb(this,!1),this.fetcher=c.observable(null),this.fetchers=c.observable(null),this.firstFetcher=c.observable(null),this.editedFetcherId=c.observable(null),this.editedIdentityId=c.observable(null),this.defaultAccount.fetchers.subscribe(function(a){if(a){var b=this.defaultAccount.fetchers(),c=b.collection()[0],d=c.id(),e=this.isFetcherTab(this.tab());this.fetchers(b),this.firstFetcher(c),this.editedFetcherId()&&e?this.onChangeFetcher(this.editedFetcherId()):e&&(this.editedFetcherId(d),this.editedIdentityId(null),this.onChangeFetcher(d))}else this.changeAccount(this.defaultAccountId())},this),this.tab=c.observable(Lb.AccountSettingsTab.Properties),this.allowUsersAddNewAccounts=Qb.App.AllowUsersAddNewAccounts,this.allowUsersChangeInterfaceSettings=Qb.App.AllowUsersChangeInterfaceSettings,this.allowAutoresponderExtension=c.observable(!1),this.allowForwardExtension=c.observable(!1),this.allowSieveFiltersExtension=c.observable(!1),this.changeAccount(this.editedAccountId())}function rb(){this.showWeekends=c.observable(Qb.User.CalendarShowWeekEnds),this.loading=c.observable(!1),this.availableTimes=c.observableArray(this.getDisplayedTimes(Qb.User.defaultTimeFormat()?"hh:mm A":"HH:mm")),Qb.User.defaultTimeFormat.subscribe(function(a){this.availableTimes(this.getDisplayedTimes(a?"hh:mm A":"HH:mm"))},this),this.selectedWorkdayStarts=c.observable(Qb.User.CalendarWorkDayStarts),this.selectedWorkdayEnds=c.observable(Qb.User.CalendarWorkDayEnds),this.showWorkday=c.observable(Qb.User.CalendarShowWorkDay),this.weekStartsOn=c.observable(Qb.User.CalendarWeekStartsOn),this.defaultTab=c.observable(Qb.User.CalendarDefaultTab),this.firstState=this.getState()}function sb(){this.mobileSync=Qb.User.mobileSync,this.mobileSync.subscribe(this.onMobileSyncSubscribe,this),this.enableDav=c.observable(!1),this.davLogin=c.observable(""),this.davServer=c.observable(""),this.davCalendars=c.observable([]),this.visibleCalendars=c.computed(function(){return this.davCalendars().length>0},this),this.davPersonalContactsUrl=c.observable(""),this.davCollectedAddressesUrl=c.observable(""),this.davGlobalAddressBookUrl=c.observable(""),this.bVisiblePersonalContacts=Qb.User.ShowPersonalContacts,this.bVisibleGlobalContacts=Qb.User.ShowGlobalContacts,this.bVisibleContacts=Qb.User.ShowContacts,this.bVisibleCalendar=Qb.User.AllowCalendar,this.bVisibleFiles=Qb.User.IsFilesSupported,this.bVisibleIosLink=Ub,this.visibleDavViaUrls=c.computed(function(){return this.visibleCalendars()||this.bVisibleContacts},this),this.password=c.observable(Qb.User.IsDemo?Qb.User.MobileSyncDemoPass:Mb.i18n("SETTINGS/MOBILE_DAVSYNC_PASSWORD_VALUE")),this.bChanged=!1}function tb(){this.outlookSync=Qb.User.outlookSync,this.outlookSync.subscribe(this.onOutlookSyncSubscribe,this),this.visibleOutlookSync=c.observable(!1),this.login=c.observable(""),this.server=c.observable(""),this.password=c.observable(Qb.User.IsDemo?Qb.User.OutlookSyncDemoPass:Mb.i18n("SETTINGS/OUTLOOKSYNC_PASSWORD_VALUE")),this.bChanged=!1}function ub(){this.allowUsersChangeInterfaceSettings=Qb.App.AllowUsersChangeInterfaceSettings,this.allowUsersChangeEmailSettings=Qb.App.AllowUsersChangeEmailSettings,this.account=c.observable(null),this.isInternal=c.observable(!0),this.isLinked=c.observable(!0),this.isDefault=c.observable(!1),this.removeHint=c.observable(""),this.friendlyName=c.observable(""),this.email=c.observable(""),this.incomingMailLogin=c.observable(""),this.incomingMailPassword=c.observable(""),this.incomingMailPort=c.observable(0),this.incomingMailServer=c.observable(""),this.outgoingMailLogin=c.observable(""),this.outgoingMailPassword=c.observable(""),this.outgoingMailPort=c.observable(0),this.outgoingMailServer=c.observable(""),this.loading=c.observable(!1),this.allowChangePassword=c.observable(!1),this.useSmtpAuthentication=c.observable(!1),this.incLoginFocused=c.observable(!1),this.incLoginFocused.subscribe(function(){this.incLoginFocused()&&""===this.incomingMailLogin()&&this.incomingMailLogin(this.email())},this),this.outServerFocused=c.observable(!1),this.outServerFocused.subscribe(function(){this.outServerFocused()&&""===this.outgoingMailServer()&&this.outgoingMailServer(this.incomingMailServer())},this),this.account.subscribe(function(a){this.populate(a)},this),this.firstState=null}function vb(a){this.parent=a,this.highlighted=c.observable(!1).extend({autoResetToFalse:500}),this.collection=c.observableArray(Ob.MailCache.editedFolderList().collection()),this.totalMessageCount=c.computed(function(){return Ob.MailCache.editedFolderList().totalMessageCount()},this),this.enableButtons=c.computed(function(){return Ob.MailCache.editedFolderList().bInitialized()},this),Ob.MailCache.editedFolderList.subscribe(function(a){this.collection(a.collection())},this),this.addNewFolderCommand=Mb.createCommand(this,this.onAddNewFolderClick,this.enableButtons),this.systemFoldersCommand=Mb.createCommand(this,this.onSystemFoldersClick,this.enableButtons),this.showMovedWithMouseItem=c.computed(function(){var a=Qb.Accounts.getEdited();return a?!Wb&&!a.extensionExists("DisableFoldersManualSort"):!1},this)}function wb(a){this.parent=a,this.account=c.observable(null),this.type=c.observable(!1),this.useSignature=c.observable(0),this.signature=c.observable(""),this.loading=c.observable(!1),this.account.subscribe(function(){this.getSignature()},this),this.oHtmlEditor=new db(!1),this.enabled=c.observable(!0),this.signature.subscribe(function(){this.oHtmlEditor.setText(this.signature())},this),Qb.Accounts.editedId.subscribe(function(){this.account(Qb.Accounts.getEdited())},this),this.getSignature(),this.firstState=null}function xb(){this.account=c.observable(null),this.available=c.observable(!1),this.loading=c.observable(!1),this.enable=c.observable(!1),this.email=c.observable(""),this.available=c.computed(function(){var a=this.account();return a&&a.forward()},this),this.account.subscribe(function(){this.getForward()},this),this.firstState=null}function yb(){this.account=c.observable(null),this.available=c.observable(!1),this.loading=c.observable(!1),this.enable=c.observable(!1),this.subject=c.observable(""),this.message=c.observable(""),this.available=c.computed(function(){var a=this.account();return a&&a.autoresponder()},this),this.account.subscribe(function(){this.getAutoresponder()},this),this.firstState=null}function zb(){this.account=c.observable(null),this.folderList=c.observable(Ob.MailCache.editedFolderList()),Ob.MailCache.editedFolderList.subscribe(function(a){this.folderList(a)},this),this.foldersOptions=c.computed(function(){return this.folderList()?this.folderList().getOptions(Mb.i18n("SETTINGS/ACCOUNT_FOLDERS_NOT_SELECTED"),!0,!0):[]},this),this.available=c.observable(!1),this.loading=c.observable(!1),this.collection=c.observableArray([]),this.newCollection=c.observableArray([]),this.available=c.computed(function(){var a=this.account();return!(!a||!a.filters())},this),this.account.subscribe(function(){this.getFilters()},this),this.fieldOptions=[{text:Mb.i18n("SETTINGS/ACCOUNT_FILTERS_FIELD_FROM"),value:0},{text:Mb.i18n("SETTINGS/ACCOUNT_FILTERS_FIELD_TO"),value:1},{text:Mb.i18n("SETTINGS/ACCOUNT_FILTERS_FIELD_SUBJECT"),value:2}],this.conditionOptions=[{text:Mb.i18n("SETTINGS/ACCOUNT_FILTERS_COND_CONTAIN_SUBSTR"),value:0},{text:Mb.i18n("SETTINGS/ACCOUNT_FILTERS_COND_EQUAL_TO"),value:1},{text:Mb.i18n("SETTINGS/ACCOUNT_FILTERS_COND_NOT_CONTAIN_SUBSTR"),value:2}],this.actionOptions=[{text:Mb.i18n("SETTINGS/ACCOUNT_FILTERS_ACTION_MOVE"),value:3},{text:Mb.i18n("SETTINGS/ACCOUNT_FILTERS_ACTION_DELETE"),value:1}],this.phaseArray=[""],_.each(Mb.i18n("SETTINGS/ACCOUNT_FILTERS_PHRASE").split(/\s/),function(a){var b=this.phaseArray.length-1;"%"===a.substr(0,1)||"%"===this.phaseArray[b].substr(-1,1)?this.phaseArray.push(a):this.phaseArray[b]+=" "+a},this),this.firstState=null}function Ab(){this.defaultAccountId=Qb.Accounts.defaultId,this.folderList=Ob.MailCache.folderList,this.loading=c.observable(!1),this.fetcher=c.observable(null),this.idFetcher=c.observable(null),this.isEnabled=c.observable(!0),this.incomingMailServer=c.observable(""),this.incomingMailPort=c.observable(110),this.incomingMailLogin=c.observable(""),this.incomingMailPassword=c.observable(""),this.folder=c.observable(""),this.options=c.computed(function(){return this.folderList().getOptions(void 0,!0)},this),this.leaveMessagesOnServer=c.observable(!1),this.folderList.subscribe(function(){this.folder(this.fetcher()?this.fetcher().folder():"")},this),this.serverIsSelected=c.observable(!1),this.loginIsSelected=c.observable(!1),this.passwordIsSelected=c.observable(!1),this.defaultOptionsAfterRender=Mb.defaultOptionsAfterRender}function Bb(){this.defaultAccountId=Qb.Accounts.defaultId,this.loading=c.observable(!1),this.fetcher=c.observable(null),this.idFetcher=c.observable(null),this.isEnabled=c.observable(!0),this.email=c.observable(""),this.userName=c.observable(""),this.isOutgoingEnabled=c.observable(!1),this.outgoingMailServer=c.observable(""),this.outgoingMailPort=c.observable(25),this.outgoingMailAuth=c.observable(!1),this.serverIsSelected=c.observable(!1)}function Cb(a){this.defaultAccountId=Qb.Accounts.defaultId,this.idFetcher=c.observable(null),this.fetcher=c.observable(null),this.signature=c.observable(""),this.loading=c.observable(!1),this.type=c.observable(!1),this.useSignature=c.observable(0),this.oHtmlEditor=new db(!1),this.enabled=a.oFetcherIncoming.isEnabled,this.enabled.subscribe(function(){this.oHtmlEditor.isEnable(this.enabled())},this),this.signature.subscribe(function(){this.oHtmlEditor.setText(this.signature())},this),this.firstState=null}function Db(){this.allowNotifications=c.observable(Qb.User.AllowHelpdeskNotifications),this.loading=c.observable(!1)}function Eb(a,b){this.defaultAccountId=Qb.Accounts.defaultId,this.oParent=a,this.bCreate=b,this.loading=c.observable(!1),this.identity=c.observable(null),this.enabled=c.observable(!0),this.email=c.observable(""),this.friendlyName=c.observable(""),this.signature=c.observable(""),this.useSignature=c.observable(0),this.oHtmlEditor=new db(!1),this.signature.subscribe(function(){this.oHtmlEditor.setText(this.signature())},this),this.enabled.subscribe(function(){this.oHtmlEditor.isEnable(this.enabled())},this)}function Fb(){this.defaultAccount=Qb.Accounts?Qb.Accounts.getDefault():null,this.todayDate=new Date,this.aDayNames=Mb.i18n("DATETIME/DAY_NAMES").split(" "),this.correctedDayNames=c.observable(this.aDayNames);var a=this;this.isPublic=Rb,this.publicCalendarId=this.isPublic?Qb.CalendarPubHash:"",this.publicCalendarName=c.observable(""),this.timeFormatGrid=Qb.User.defaultTimeFormat()===Lb.TimeFormat.F24?"HH:mm":"hh:mm TT",this.timeFormatMoment=Qb.User.defaultTimeFormat()===Lb.TimeFormat.F24?"HH:mm":"hh:mm A",this.dateFormat=Qb.User.DefaultDateFormat,this.dateTitle=c.observable(""),this.dateTitleHelper=c.observableArray(Mb.i18n("DATETIME/MONTH_NAMES").split(" ")),this.selectedView=c.observable(""),this.visibleWeekdayHeader=c.computed(function(){return"month"===this.selectedView()},this),this.selectedView.subscribe(function(){this.resize()},this),this.$calendarGrid=null,this.calendarGridDom=c.observable(null),this.$datePicker=null,this.datePickerDom=c.observable(null),this.calendars=new CCalendarListModel({onCalendarCollectionChange:function(){a.refreshView()},onCalendarActiveChange:function(){a.refreshView()}}),this.colors=["#f09650","#f68987","#6fd0ce","#8fbce2","#b9a4f5","#f68dcf","#d88adc","#4afdb4","#9da1ff","#5cc9c9","#77ca71","#aec9c9"],this.busyDays=c.observableArray([]),this.$inlineEditedEvent=null,this.inlineEditedEventText=null,this.checkStarted=c.observable(!1),this.loaded=!1,this.startDateTime=0,this.endDateTime=0,this.needsToReload=!1,this.calendarListClick=function(a){a.active(!a.active())},this.currentCalendarDropdown=c.observable(!1),this.currentCalendarDropdownOffset=c.observable(0),this.calendarDropdownToggle=function(b,c){if(c&&b){var d=c.position(),e=c.outerHeight();a.currentCalendarDropdownOffset(parseInt(d.top,10)+e)}a.currentCalendarDropdown(b)},this.dayNamesResizeBinding=_.throttle(_.bind(this.resize,this),50),this.customscrollTop=c.observable(0),this.fullcalendarOptions={header:!0,editable:!this.isPublic,selectable:!this.isPublic,allDayText:Mb.i18n("CALENDAR/TITLE_ALLDAY"),dayNames:this.aDayNames,isRTL:Mb.isRTL(),firstHour:8,columnFormat:{month:"dddd",week:"dddd d",day:"dddd d"},titleFormat:{month:"MMMM yyyy",week:"MMMM d[ yyyy]{ '-'[ MMMM] d yyyy}",day:"MMMM D, YYYY"},select:_.bind(this.createEventFromGrid,this),eventClick:_.bind(this.openEditEventForm,this),eventDragStart:_.bind(this.onEventDragStart,this),eventDragStop:_.bind(this.onEventDragStop,this),eventResizeStart:_.bind(this.onEventResizeStart,this),eventResizeStop:_.bind(this.onEventResizeStop,this),eventDrop:_.bind(this.moveEvent,this),eventResize:_.bind(this.resizeEvent,this),viewRender:_.bind(this.displayViewCallback,this),eventSources:[]},this.revertFunction=null,this.calendarSharing=Qb.User.AllowCalendar&&Qb.User.CalendarSharing,this.defaultViewName=c.computed(function(){var a="month";switch(Qb.User.CalendarDefaultTab){case Lb.CalendarDefaultTab.Day:a="agendaDay";break;case Lb.CalendarDefaultTab.Week:a="agendaWeek";break;case Lb.CalendarDefaultTab.Month:a="month"}return a},this),this.iAutoReloadTimer=-1,this.dragEventTrigger=!1,this.delayOnEventResult=!1,this.delayOnEventResultData=[],this.refreshView=_.throttle(_.bind(this.refreshViewSingle,this),100)}function Gb(){this.oScreens={},this.currentScreen=c.observable(""),this.popupVisibility=c.observable(!1),this.informationScreen=c.observable(null),this.popups=[]}function Hb(){this.currentAccountId=Qb.Accounts.currentId,this.currentAccountId.subscribe(function(a){var b=Qb.Accounts.getAccount(a),c=this.oFolderListItems[a],d={Action:"FolderList",AccountID:a};b&&(_.delay(_.bind(b.updateQuotaParams,b),5e3),this.messagesLoading(!0),c?this.folderList(c):(this.folderList(new M),this.messages([]),Mb.log("currentAccountId.subscribe currentMessage = null"),this.currentMessage(null),Ob.Ajax.send(d,this.onFolderListResponse,this)))},this),this.editedAccountId=Qb.Accounts.editedId,this.editedAccountId.subscribe(function(a){var b=this.oFolderListItems[a],c={};b?this.editedFolderList(b):this.currentAccountId()!==a&&(this.editedFolderList(new M),c={Action:"FolderList",AccountID:a},Ob.Ajax.send(c,this.onFolderListResponse,this))},this),this.oFolderListItems={},this.quotaChangeTrigger=c.observable(!1),this.checkMailStarted=c.observable(!1),this.folderList=c.observable(new M),this.editedFolderList=c.observable(new M),this.newMessagesCount=c.computed(function(){var a=this.folderList().inboxFolder();return a?a.unseenMessageCount():0},this),this.newMessagesCount.subscribe(function(){Mb.log("New messages count",this.newMessagesCount())},this),this.messages=c.observableArray([]),this.messages.subscribe(function(){Ob.Prefetcher.startThreadListPrefetch()},this),this.uidList=c.observable(new O),this.page=c.observable(1),this.messagesLoading=c.observable(!0),this.messagesLoadingError=c.observable(!1),this.currentMessage=c.observable(null),this.currentMessage.subscribe(function(){Mb.log("Current message",this.currentMessage()),this.currentMessage()&&Pb.runPluginHook("view-message",[Qb.Accounts.currentId(),this.currentMessage().folder(),this.currentMessage().uid()])
},this),this.deletedDraftMessageUid=c.observable(""),this.aResponseHandlers=[],Qb.User.useThreads.subscribe(function(){_.each(this.oFolderListItems,function(a){_.each(a.collection(),function(a){a.markHasChanges(),a.removeAllMessageListsFromCacheIfHasChanges()},this)},this),Mb.log("****************************************AppData.User.useThreads.subscribe"),Mb.log(this.messages()),Mb.log("****************************************"),this.messages([])},this),this.iAutoCheckMailTimer=-1}function Ib(){this.contacts={},this.responseHandlers={},this.vcardAttachments=[],this.recivedAnim=c.observable(!1).extend({autoResetToFalse:500})}function Jb(){this.calendars=c.observableArray([]),this.calendarsLoadingStarted=c.observable(!1),this.icalAttachments=[],this.recivedAnim=c.observable(!1).extend({autoResetToFalse:500}),this.calendarSettingsChanged=c.observable(!1),this.calendarChanged=c.observable(!1)}function Kb(){this.browser=new f,this.headerTabs=c.observableArray([]),this.screensTitle={},this.Ajax=new g,this.Routing=new h,this.Screens=new Gb,this.Links=new i,this.Api=new m,this.MessageSender=new j,this.Prefetcher=new k,this.MailCache=null,this.ContactsCache=new Ib,this.CalendarCache=new Jb,this.Storage=new n,this.Phone=new o,this.currentScreen=this.Screens.currentScreen,this.currentScreen.subscribe(this.setTitle,this),this.focused=c.observable(!0),this.focused.subscribe(function(){Qb.SingleMode||b.opener||this.setTitle()},this),this.init(),this.newMessagesCount=this.MailCache.newMessagesCount,this.newMessagesCount.subscribe(this.setTitle,this),this.currentMessage=this.MailCache.currentMessage,this.currentMessage.subscribe(this.setTitle,this),this.notification=null,this.initHeaderInfo()}var Lb={},Mb={},Nb=b.pSevenI18N||{},Ob={},Pb={},Qb=b.pSevenAppData||{},Rb=!1,Sb=!1,Tb=a("html"),Ub=-1<navigator.userAgent.indexOf("iPhone")||-1<navigator.userAgent.indexOf("iPod")||-1<navigator.userAgent.indexOf("iPad"),Vb=-1<navigator.userAgent.toLowerCase().indexOf("android"),Wb=Ub||Vb,Xb=["image/jpeg","image/png","image/gif","text/html","text/plain","text/css","text/rfc822-headers","message/delivery-status","application/x-httpd-php","application/javascript"];if(b.Modernizr&&navigator&&b.Modernizr.addTest("pdf",function(){for(var a=navigator.mimeTypes,b=0,c=a.length;c>b;b++)if("application/pdf"===a[b].type)return!0;return!1}),Sb=!0,b.Modernizr&&navigator&&b.Modernizr.addTest("native-android-browser",function(){return"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/534.24 (KHTML, like Gecko) Chrome/11.0.696.34 Safari/534.24"===navigator.userAgent}),f.prototype.getIeVersion=function(){var a=navigator.userAgent.toLowerCase(),b=Mb.pInt(a.slice(a.indexOf("msie")+4,a.indexOf(";",a.indexOf("msie")+4)));return b},g.prototype.hasOpenedRequests=function(){return this.aRequests=_.filter(this.aRequests,function(a){var b=a&&4===a.Xhr.readyState,c=!a||0===a.Xhr.readyState&&"abort"===a.Xhr.statusText;return a&&!b&&!c}),this.aRequests.length>0},g.prototype.isSearchMessages=function(){var a=!1;return _.each(this.aRequests,function(b){b&&b.Parameters&&"MessageList"===b.Parameters.Action&&""!==b.Parameters.Search&&(a=!0)},this),a},g.prototype.isAllowedActionWithoutAuth=function(a){var b=["Login","LoginLanguageUpdate","Logout","AccountCreate","SetMobile"];return-1!==_.indexOf(b,a)},g.prototype.isAllowedExtAction=function(a){return"SocialRegister"===a||"HelpdeskRegister"===a||"HelpdeskForgot"===a||"HelpdeskLogin"===a||"Logout"===a},g.prototype.doSend=function(b,c,d,e){var f=_.bind(e||null,this,b,c,d),g=_.bind(this.fail,this,b,c,d),h=_.bind(this.always,this,b),i=null;Pb.runPluginHook&&Pb.runPluginHook("ajax-default-request",[b.Action,b]),Qb.Token&&(b.Token=Qb.Token),this.abortRequests(b),Mb.log("Ajax request send",b.Action,b),i=a.ajax({url:this.sUrl,type:"POST",async:!0,dataType:"json",data:b,success:f,error:g,complete:h}),this.aRequests.push({Parameters:b,Xhr:i})},g.prototype.send=function(a,b,c){var d=void 0===a.AccountID,e=d||Qb.Accounts.hasAccountWithId(a.AccountID);a&&(Qb.Auth&&e||this.isAllowedActionWithoutAuth(a.Action))&&(d&&"Login"!==a.Action&&(a.AccountID=Qb.Accounts.currentId()),this.doSend(a,b,c,this.done))},g.prototype.sendExt=function(a,b,c){var d=["SocialRegister","HelpdeskRegister","HelpdeskForgot","HelpdeskLogin","HelpdeskForgotChangePassword","Logout","CalendarList","EventList","FilesPub"],e=-1!==_.indexOf(d,a.Action);a&&(Qb.Auth||e)&&(Qb.TenantHash&&(a.TenantHash=Qb.TenantHash),this.doSend(a,b,c,this.doneExt))},g.prototype.abortRequests=function(a){switch(a.Action){case"MessageMove":case"MessageDelete":this.abortRequestByActionName("MessageList",{Folder:a.Folder}),this.abortRequestByActionName("Message");break;case"MessageList":case"MessageSetSeen":this.abortRequestByActionName("MessageList",{Folder:a.Folder});break;case"FolderClear":this.abortRequestByActionName("MessageList",{Folder:a.Folder}),this.abortRequestByActionName("FolderCounts");break;case"ContactList":case"GlobalContactList":this.abortRequestByActionName("ContactList"),this.abortRequestByActionName("GlobalContactList");break;case"Contact":case"GlobalContact":this.abortRequestByActionName("Contact"),this.abortRequestByActionName("GlobalContact");break;case"EventUpdate":this.abortRequestByActionName("EventUpdate",{calendarId:a.calendarId,uid:a.uid})}},g.prototype.abortRequestByActionName=function(a,b){var c;_.each(this.aRequests,function(d,e){if(c=!1,d&&d.Parameters.Action===a)switch(a){case"MessageList":b.Folder===d.Parameters.Folder&&(c=!0);break;case"EventUpdate":b.calendarId===d.Parameters.calendarId&&b.uid===d.Parameters.uid&&(c=!0);break;default:c=!0}c&&(d.Xhr.abort(),this.aRequests[e]=void 0)},this),this.aRequests=_.compact(this.aRequests)},g.prototype.abortAllRequests=function(){_.each(this.aRequests,function(a){a&&a.Xhr.abort()},this),this.aRequests=[]},g.prototype.done=function(a,b,c,d,e){var f=this.isAllowedActionWithoutAuth(a.Action),g=Qb.Accounts.hasAccountWithId(a.AccountID),h=a.AccountID===Qb.Accounts.defaultId();if(Mb.log("Ajax request done",a.Action,e,Mb.getAjaxDataForLog(a.Action,d),a),f||g){if(d&&!d.Result)switch(d.ErrorCode){case Lb.Errors.InvalidToken:f||Ob.tokenProblem();break;case Lb.Errors.AuthError:h&&!f&&(this.abortAllRequests(),Ob.authProblem())}this.executeResponseHandler(b,c,d,a)}Mb.checkConnection(a.Action,d)},g.prototype.doneExt=function(a,b,c,d){this.executeResponseHandler(b,c,d,a)},g.prototype.fail=function(a,b,c,d,e,f){var g={Result:!1,ErrorCode:0};switch(Mb.log("Ajax request fail",a.Action,e,a),e){case"abort":g={Result:!1,ErrorCode:Lb.Errors.NotDisplayedError};break;default:case"error":case"parseerror":g=""===f?{Result:!1,ErrorCode:Lb.Errors.NotDisplayedError}:{Result:!1,ErrorCode:Lb.Errors.DataTransferFailed}}this.executeResponseHandler(b,c,g,a),Mb.checkConnection(a.Action,g)},g.prototype.executeResponseHandler=function(a,b,c,d){c||(c={Result:!1,ErrorCode:0}),Pb.runPluginHook&&Pb.runPluginHook("ajax-default-response",[d.Action,c]),"function"==typeof a&&a.apply(b,[c,d])},g.prototype.always=function(a){_.each(this.aRequests,function(b,c){b&&_.isEqual(b.Parameters,a)&&(this.aRequests[c]=void 0)},this),this.aRequests=_.compact(this.aRequests)},Lb.Screens={Login:"login",Information:"information",Header:"header",Mailbox:"mailbox",BottomMailbox:"bottommailbox",SingleMessageView:"single-message-view",Compose:"compose",SingleCompose:"single-compose",Settings:"settings",Contacts:"contacts",Calendar:"calendar",FileStorage:"files",Helpdesk:"helpdesk",SingleHelpdesk:"single-helpdesk"},Lb.MailboxLayout={Side:0,Bottom:1},Lb.CalendarDefaultTab={Day:1,Week:2,Month:3},Lb.TimeFormat={F24:0,F12:1},Lb.Errors={InvalidToken:101,AuthError:102,DataBaseError:104,LicenseProblem:105,DemoLimitations:106,Captcha:107,AccessDenied:108,CanNotGetMessage:202,ImapQuota:205,NotSavedInSentItems:304,CanNotChangePassword:502,AccountOldPasswordNotCorrect:503,FetcherIncServerNotAvailable:702,FetcherLoginNotCorrect:703,HelpdeskThrowInWebmail:805,HelpdeskUserNotExists:807,HelpdeskUserNotActivated:808,MailServerError:901,DataTransferFailed:1100,NotDisplayedError:1155},Lb.FolderTypes={Inbox:1,Sent:2,Drafts:3,Spam:4,Trash:5,Virus:6,Starred:7,System:9,User:10},Lb.FolderFilter={Flagged:"flagged"},Lb.LoginFormType={Email:0,Login:3,Both:4},Lb.LoginSignMeType={DefaultOff:0,DefaultOn:1,Unuse:2},Lb.ReplyType={Reply:"reply",ReplyAll:"reply-all",Resend:"resend",Forward:"forward"},Lb.Importance={Low:5,Normal:3,High:1},Lb.Sensivity={Nothing:0,Confidential:1,Private:2,Personal:3},Lb.ContactEmailType={Personal:"Personal",Business:"Business",Other:"Other"},Lb.ContactPhoneType={Mobile:"Mobile",Personal:"Personal",Business:"Business"},Lb.ContactAddressType={Personal:"Personal",Business:"Business"},Lb.ContactSortType={Email:"Email",Name:"Name",Frequency:"Frequency"},Lb.SaveMail={Hidden:0,Checked:1,Unchecked:2},Lb.SettingsTab={Common:"common",EmailAccounts:"accounts",Calendar:"calendar",MobileSync:"mobile_sync",OutLookSync:"outlook_sync",Helpdesk:"helpdesk"},Lb.AccountSettingsTab={Properties:"properties",Signature:"signature",Filters:"filters",Autoresponder:"autoresponder",Forward:"forward",Folders:"folders",FetcherInc:"fetcher-inc",FetcherOut:"fetcher-out",FetcherSig:"fetcher-sig",IdentityProperties:"identity-properties",IdentitySignature:"identity-signature"},Lb.ContactsGroupListType={Personal:0,SubGroup:1,Global:2,SharedToAll:3},Lb.IcalType={Request:"REQUEST",Reply:"REPLY",Cancel:"CANCEL",Save:"SAVE"},Lb.IcalConfig={Accepted:"ACCEPTED",Declined:"DECLINED",Tentative:"TENTATIVE",NeedsAction:"NEEDS-ACTION"},Lb.IcalConfigInt={Accepted:1,Declined:2,Tentative:3,NeedsAction:0},Lb.Key={Tab:9,Enter:13,Shift:16,Ctrl:17,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Up:38,Down:40,Left:37,Right:39,Del:46,Six:54,a:65,c:67,f:70,n:78,p:80,q:81,r:82,s:83,v:86,F5:116,Comma:188,Dot:190,Dash:192,Apostrophe:222},Lb.MouseKey={Left:0,Middle:1,Right:2},Lb.FileStorageType={Private:0,Corporate:1,Shared:2},Lb.HelpdeskThreadStates={None:0,Pending:1,Waiting:2,Answered:3,Resolved:4,Deferred:5},Lb.HelpdeskPostType={Normal:0,Internal:1,System:2},Lb.HelpdeskFilters={All:0,Pending:1,Resolved:2,InWork:3,Open:4,Archived:9},Lb.CalendarAccess={Full:0,Write:1,Read:2},Lb.CalendarEditRecurrenceEvent={None:0,OnlyThisInstance:1,AllEvents:2},Lb.CalendarRepeatPeriod={None:0,Daily:1,Weekly:2,Monthly:3,Yearly:4},Lb.DesktopNotifications={Allowed:0,NotAllowed:1,Denied:2,NotSupported:9},Lb.PhoneAction={Settings:"settings",Incoming:"incoming",Outgoing:"outgoing"},Lb.HtmlEditorImageSizes={Small:"small",Medium:"medium",Large:"large",Original:"original"},Lb.MobilePanel={Groups:1,Items:2,View:3},c.bindingHandlers.command={init:function(b,d,e,f){var g=a(b),h=d();if(!h||!h.enabled||!h.canExecute)throw new Error("You are not using command function");g.addClass("command"),c.bindingHandlers[g.is("form")?"submit":"click"].init.apply(f,arguments)},update:function(b,c){var d=!0,e=a(b),f=c();d=f.enabled(),e.toggleClass("command-not-enabled",!d),d&&(d=f.canExecute(),e.toggleClass("unavailable",!d)),e.toggleClass("command-disabled disable disabled",!d),e.toggleClass("command-disabled",!d)}},c.bindingHandlers.onEnter={init:function(d,e,f,g){c.bindingHandlers.event.init(d,function(){return{keyup:function(c,f){f&&13===b.parseInt(f.keyCode,10)&&(a(d).trigger("change"),e().call(this,c))}}},f,g)}},c.bindingHandlers.onCtrlEnter={init:Sb?null:function(d,e,f,g){c.bindingHandlers.event.init(d,function(){return{keydown:function(c,f){return f&&13===b.parseInt(f.keyCode,10)&&f.ctrlKey?(a(d).trigger("change"),e().call(this,c),!1):!0}}},f,g)}},c.bindingHandlers.onEsc={init:Sb?null:function(d,e,f,g){c.bindingHandlers.event.init(d,function(){return{keyup:function(c,f){f&&27===b.parseInt(f.keyCode,10)&&(a(d).trigger("change"),e().call(this,c))}}},f,g)}},c.bindingHandlers.onFocusSelect={init:function(a,b,d,e){c.bindingHandlers.event.init(a,function(){return{focus:function(){a.select()},mouseup:function(){return!1}}},d,e)}},c.bindingHandlers.onFocusMoveCaretToEnd={init:function(a,b,d,e){c.bindingHandlers.event.init(a,function(){return{focus:function(){Mb.moveCaretToEnd(a)}}},d,e)}},c.bindingHandlers.onEnterChange={init:function(d,e,f,g){c.bindingHandlers.event.init(d,function(){return{keyup:function(c,e){e&&13===b.parseInt(e.keyCode,10)&&a(d).trigger("change")}}},f,g)}},c.bindingHandlers.jhasfocus={init:function(b,c){a(b).on("focus",function(){c()(!0)}).on("blur",function(){c()(!1)})},update:function(b,d){c.utils.unwrapObservable(d())?a(b).is(":focus")||a(b).focus():a(b).is(":focus")&&a(b).blur()}},c.bindingHandlers.fadeIn={update:function(b,d){c.utils.unwrapObservable(d())&&a(b).hide().fadeIn("fast")}},c.bindingHandlers.fadeOut={update:function(b,d){c.utils.unwrapObservable(d())&&a(b).fadeOut()}},c.bindingHandlers.csstext={init:function(b,d){b&&b.styleSheet&&!Mb.isUnd(b.styleSheet.cssText)?b.styleSheet.cssText=c.utils.unwrapObservable(d()):a(b).text(c.utils.unwrapObservable(d()))},update:function(b,d){b&&b.styleSheet&&!Mb.isUnd(b.styleSheet.cssText)?b.styleSheet.cssText=c.utils.unwrapObservable(d()):a(b).text(c.utils.unwrapObservable(d()))}},c.bindingHandlers.i18n={init:function(b,c){var d=a(b).data("i18n"),e=d?Mb.i18n(d):d;if(""!==e)switch(c()){case"value":a(b).val(e);break;case"text":a(b).text(e);break;case"html":a(b).html(e);break;case"title":a(b).attr("title",e);break;case"placeholder":a(b).attr({placeholder:e})}}},c.bindingHandlers.link={init:function(b,d){a(b).attr("href",c.utils.unwrapObservable(d()))}},c.bindingHandlers.title={init:function(b,d){a(b).attr("title",c.utils.unwrapObservable(d()))},update:function(b,d){a(b).attr("title",c.utils.unwrapObservable(d()))}},c.bindingHandlers.initDom={init:function(b,c){if(c())if(_.isArray(c()))for(var d=c(),e=d.length-1;e>=0;e--)d[e](a(b));else c()(a(b))}},c.bindingHandlers.customScrollbar={init:Sb?null:function(b,c){if(!Wb){var d=a(b),e=c();e=e,d.addClass("scroll-wrap").customscroll(e),Mb.isUnd(e.reset)||(b._customscroll_reset=_.throttle(function(){d.data("customscroll").reset()},100)),!Mb.isUnd(e.scrollToTopTrigger)&&Mb.isFunc(e.scrollToTopTrigger.subscribe)&&e.scrollToTopTrigger.subscribe(function(){d.data("customscroll")&&d.data("customscroll").scrollToTop()}),!Mb.isUnd(e.scrollToBottomTrigger)&&Mb.isFunc(e.scrollToBottomTrigger.subscribe)&&e.scrollToBottomTrigger.subscribe(function(){d.data("customscroll")&&d.data("customscroll").scrollToBottom()}),!Mb.isUnd(e.scrollTo)&&Mb.isFunc(e.scrollTo.subscribe)&&e.scrollTo.subscribe(function(){d.data("customscroll")&&d.data("customscroll").scrollTo(e.scrollTo())})}},update:Sb?null:function(b,c){Wb||(b._customscroll_reset&&b._customscroll_reset(),Mb.isUnd(c().top)||a(b).data("customscroll").vertical.set(c().top))}},c.bindingHandlers.customOptions={init:function(){return{controlsDescendantBindings:!0}},update:function(a,b,d,e,f){for(var g=0,h=0,i=c.utils.arrayMap(c.utils.arrayFilter(a.childNodes,function(a){return a.tagName&&"OPTION"===a.tagName&&a.selected}),function(a){return c.selectExtensions.readValue(a)||a.innerText||a.textContent}),j=a.scrollTop,k=c.utils.unwrapObservable(b());a.length>0;)c.cleanNode(a.options[0]),a.remove(0);if(k){"number"!=typeof k.length&&(k=[k]);var l=d().optionsBind;for(g=0,h=k.length;h>g;g++){var m=document.createElement("OPTION"),n=c.utils.unwrapObservable(k[g]);c.selectExtensions.writeValue(m,n),m.appendChild(document.createTextNode(n)),a.appendChild(m),l&&(m.setAttribute("data-bind",l),c.applyBindings(f.createChildContext(n),m))}var o=a.getElementsByTagName("OPTION"),p=0,q=navigator.userAgent.indexOf("MSIE 6")>=0;for(g=0,h=o.length;h>g;g++)c.utils.arrayIndexOf(i,c.selectExtensions.readValue(o[g]))>=0&&(q?o[g].setAttribute("selected",!0):o[g].selected=!0,p++);a.scrollTop=j,p<i.length&&c.utils.triggerEvent(a,"change")}}},c.bindingHandlers.splitter={init:Sb?null:function(b,c){var d=a(b),e=c();setTimeout(function(){d.splitter(_.defaults(e,{}))},1)}},c.bindingHandlers.dropdown={init:function(b,c,d,e){var f=a(b),g=_.defaults(c(),{disabled:"disabled",expand:"expand",control:!0,container:".dropdown_content",passClick:!0,trueValue:!0}),h=g.control?f.find(".control"):f,i=a(document),j=function(){Mb.isUnd(g.callback)||g.callback.call(e,f.hasClass(g.expand)?g.trueValue:!1,f)},k=function(a){a.stopPropagation()};g.passClick||(f.find(g.container).click(k),h.click(k)),f.removeClass(g.expand),g.close&&g.close.subscribe&&g.close.subscribe(function(a){a||(i.unbind("click.dropdown"),f.removeClass(g.expand)),j()}),h.click(function(){f.hasClass(g.disabled)||(f.toggleClass(g.expand),_.defer(function(){j()}),f.hasClass(g.expand)&&(g.close&&g.close.subscribe&&g.close(!0),_.defer(function(){i.on("click.dropdown",function(a){(g.passClick||a.button!==Lb.MouseKey.Right)&&(i.unbind("click.dropdown"),g.close&&g.close.subscribe&&g.close(!1),f.removeClass(g.expand),j())})})))})}},c.bindingHandlers.customSelect={init:function(b,c,d,e){var f=a(b),g=_.defaults(c(),{disabled:"disabled",selected:"selected",expand:"expand",control:!0,input:!1}),h=[],i=g.control?f.find(".control"):f,j=f.find(".dropdown_content"),k=f.find(".link"),l=function(b){_.each(h,function(a){a.removeClass(g.selected)});var c=_.find(g.options,function(a){return a[g.optionsValue]===b});return Mb.isUnd(c)?c=g.options[0]:(h[_.indexOf(g.options,c)].addClass(g.selected),k.text(a.trim(c[g.optionsText]))),c[g.optionsValue]},m=function(b){j.empty(),h=[],_.each(b?b:g.options,function(b){var c=a('<span class="item"></span>').text(b[g.optionsText]).data("value",b[g.optionsValue]),d=b.isDisabled;d?c.data("isDisabled",d).addClass("disabled"):c.data("isDisabled",d).removeClass("disabled"),h.push(c),j.append(c)},this)};m(),j.on("click",".item",function(){var b=a(this);b.data("isDisabled")||g.value(b.data("value"))}),!g.input&&g.value&&g.value.subscribe&&(g.value.subscribe(function(){var a=l(g.value());g.value()!==a&&g.value(a)},e),g.value.valueHasMutated()),g.input&&g.value&&g.value.subscribe&&(g.value.subscribe(function(){l(g.value())},e),g.value.valueHasMutated()),g.alarmOptions&&g.alarmOptions.subscribe(function(){m()},e),g.timeOptions&&g.timeOptions.subscribe(function(a){m(a)},e),f.removeClass(g.expand),i.click(function(){if(!f.hasClass(g.disabled)&&(f.toggleClass(g.expand),f.hasClass(g.expand))){var b=f.find(".dropdown_content"),c=b.find(".selected");c.position()&&(b.scrollTop(0),b.scrollTop(c.position().top-100)),_.defer(function(){a(document).one("click",function(){f.removeClass(g.expand)})})}})}},c.bindingHandlers.moveToFolderFilter={init:function(b,c){var d=a(b),e=_.defaults(c(),{disabled:"disabled",selected:"selected",expand:"expand",control:!0,container:".content"}),f=e.control?d.find(".control"):d,g=d.find(e.container),h=d.find(".link");d.removeClass(e.expand),e.options.subscribe(function(a){var b=e.value(),c=_.find(a,function(a){return a.id===b});c||e.value("")}),e.value&&e.value.subscribe&&(e.value.subscribe(function(b){var c=_.isArray(e.options)?e.options:e.options(),d=_.find(c,function(a){return a[e.optionsValue]===b});d||(d=_.find(c,function(a){return""===a[e.optionsValue]}),d&&""!==b&&e.value("")),d&&h.text(a.trim(d[e.optionsText]))}),e.value.valueHasMutated()),g.on("click",".item",function(){var b=a(this).data("value");e.value(b)}),f.click(function(){d.hasClass(e.disabled)||(d.toggleClass(e.expand),d.hasClass(e.expand)&&_.defer(function(){a(document).one("click",function(){d.removeClass(e.expand)})}))})},update:function(b,c){var d=_.defaults(c(),{disabled:"disabled",selected:"selected",expand:"expand",control:!0,container:".content"}),e=a(b).find(d.container),f=_.isArray(d.options)?d.options:d.options(),g=d.value?d.value():"";e.empty(),_.each(f,function(b){var c=a('<span class="item"></span>').text(b[d.optionsText]).data("value",b[d.optionsValue]);g===b[d.optionsValue]&&c.addClass("selected"),e.append(c)})}},c.bindingHandlers.contactcard={init:Sb?null:function(b,c){var d=a(b),e=!1,f=_.defaults(c(),{disabled:"disabled",expand:"expand",control:!0}),g=f.control?d.find(".control"):d;void 0!==f.trigger&&void 0!==f.trigger.subscribe&&(d.removeClass(f.expand),g.bind({mouseover:function(){!d.hasClass(f.disabled)&&f.trigger()&&(e=!0,_.delay(function(){e&&(void 0!==f.controlWidth&&void 0!==f.controlWidth.subscribe&&f.controlWidth(g.width()),d.addClass(f.expand))},200))},mouseout:function(){f.trigger()&&(e=!1,_.delay(function(){e||d.removeClass(f.expand)},200))}}))}},c.bindingHandlers.checkmail={update:function(b,c){var d=b.oOptions||null,e=b.jqElement||null,f=b.oIconIE||null,g=c(),h=g.state;void 0!==g.state&&(e||(b.jqElement=e=a(b)),d||(b.oOptions=d=_.defaults(g,{activeClass:"process",duration:800})),Mb.deferredUpdate(e,h,d.duration,function(a,c){if(Ob.browser.ie9AndBelow)if(f||(b.oIconIE=f=e.find(".icon")),!f.__intervalIE&&c){var g=0,h="";f.__intervalIE=setInterval(function(){h="0px -"+20*g+"px",g=7>g?g+1:0,f.css({"background-position":h})},1e3/12)}else f.css({"background-position":"0px 0px"}),clearInterval(f.__intervalIE),f.__intervalIE=null;else a.toggleClass(d.activeClass,c)}))}},c.bindingHandlers.heightAdjust={update:function(b,c){var d=b.jqElement||null,e=0,f=c().location,g=c().delay||400;d||(b.jqElement=d=a(b)),_.delay(function(){_.each(c().elements,function(a){var b=a();b&&(e+=b.is(":visible")?b.outerHeight():0)}),"top"===f||void 0===f?d.css({"padding-top":e,"margin-top":-e}):"bottom"===f&&d.css({"padding-bottom":e,"margin-bottom":-e})},g)}},c.bindingHandlers.triggerInview={update:function(b,c){c().trigger().length<=0||_.defer(function(){var d=a(b),e=d.height(),f=c(),g=null,h=null;f=f,g=d.find(f.selector),g.each(function(){this.$el=a(this),this.inviewHeight=this.$el.height(),this.inview=!1}),h=_.debounce(function(){g.each(function(){var a=this.inview||!1,b=this.$el.position().top+parseInt(this.$el.css("margin-top"),10);b>0&&e>b?a||(this.inview=!0,this.$el.trigger("inview")):this.inview=!1})},2e3),d.scroll(h),h()})}},c.bindingHandlers.watchWidth={init:function(c,d){a(b).bind("resize",function(){d()(a(c).outerWidth())})}},c.bindingHandlers.columnCalc={init:function(c,d){var e=a(c),f=d().prop,g=null,h=0;g=e.find(d().itemSelector),void 0!==g[0]&&(h=g.outerWidth(!0),h=1>=h?1:h,f&&a(b).bind("resize",function(){var a=e.width();f(a>0?Math.floor(a/h):1)}))}},c.bindingHandlers.quickReplyAnim={update:Sb?null:function(b,c){var d=b.jqTextarea||null,e=b.jqStatus||null,f=b.jqButtons||null,g=b.jqElement||null,h=b.oPrevActions||null,i=c(),j=null;j=_.defaults(i,{saveAction:!1,sendAction:!1,activeAction:!1}),g||(b.jqElement=g=a(b),b.jqTextarea=d=g.find("textarea"),b.jqStatus=e=g.find(".status"),b.jqButtons=f=g.find(".buttons"),b.oPrevActions=h={saveAction:null,sendAction:null,activeAction:null}),g.is(":visible")&&(Ob.browser.ie9AndBelow?(!d||g.defualtHeight||d.defualtHeight||(g.defualtHeight=g.outerHeight(),d.defualtHeight=d.outerHeight(),e.defualtHeight=f.outerHeight(),f.defualtHeight=f.outerHeight()),_.defer(function(){var a=h.activeAction!==j.activeAction,b=h.sendAction!==j.sendAction,c=h.saveAction!==j.saveAction;a&&(j.activeAction?(d.animate({height:d.defualtHeight+50},300),g.animate({"max-height":g.defualtHeight+f.defualtHeight+50},300)):(d.animate({height:d.defualtHeight},300),g.animate({"max-height":g.defualtHeight},300))),(b||c)&&(j.sendAction?(g.animate({"max-height":"30px"},300),e.animate({"max-height":"30px",opacity:1},300)):j.saveAction?g.animate({"max-height":0},300):(g.animate({"max-height":g.defualtHeight+f.defualtHeight+50},300),e.animate({"max-height":0,opacity:0},300)))})):(g.toggleClass("saving",j.saveAction),g.toggleClass("sending",j.sendAction),g.toggleClass("active",j.activeAction))),_.defer(function(){h=j})}},c.extenders.reversible=function(a){var b=a();return a.commit=function(){b=a()},a.revert=function(){a(b)},a.commitedValue=function(){return b},a.changed=function(){return b!==a()},a},c.extenders.autoResetToFalse=function(a,c){return a.iTimeout=0,a.subscribe(function(d){d&&(b.clearTimeout(a.iTimeout),a.iTimeout=b.setTimeout(function(){a.iTimeout=0,a(!1)},Mb.pInt(c)))}),a},Mb.createCommand=function(a,b,d){var e=b?function(){return e.canExecute&&e.canExecute()?b.apply(a,Array.prototype.slice.call(arguments)):!1}:function(){};return e.enabled=c.observable(!0),d=Mb.isUnd(d)?!0:d,e.canExecute=Mb.isFunc(d)?c.computed(function(){return e.enabled()&&d.call(a)}):c.computed(function(){return e.enabled()&&!!d}),e},c.bindingHandlers.autocomplete={init:function(b,c){function d(a){return a.split(/,\s*/)}function e(a){return d(a).pop()}var f=c(),g=a(b);f&&g&&g[0]&&g.autocomplete({minLength:1,source:function(a,b){f(e(a.term),b)},search:function(){var a=e(this.value);return a.length<1?!1:!0},focus:function(){return!1},select:function(a,b){var c=d(this.value),e=null;return c.pop(),c.push(b.item.value),c.push(""),this.value=c.join(", ").slice(0,-2),g.trigger("change"),e=function(a){var b=a.value.length;a.blur(),a.focus(),a.setSelectionRange&&a.setSelectionRange(b,b)},e(g[0]),!1}})}},c.bindingHandlers.autocompleteSimple={init:function(b,c){var d=a(b),e=c(),f=e.callback,g=e.dataAccessor,h=e.autocompleteTrigger;f&&d&&d[0]&&(a.widget("custom.autocomplete",a.ui.autocomplete,{_renderMenu:function(b,c){var d=this,e="";a.each(c,function(a,c){c.category&&c.category!==e&&(b.append("<li class='ui-autocomplete-category'>"+c.category+"</li>"),e=c.category),d._renderItemData(b,c)})}}),d.autocomplete({minLength:1,source:function(a,b){f(a.term,b)},focus:function(){return!1},select:function(a,b){return _.delay(function(){d.trigger("change")},5),g&&g(b.item),!0}}),h&&h.subscribe(function(){d.autocomplete("option","minLength",0),d.autocomplete("search"),d.autocomplete("option","minLength",1)},this))}},c.bindingHandlers.draggablePlace={init:Sb?null:function(b,d,e,f){if(null===d())return null;var g=e?e():null;a(b).draggable({distance:20,handle:".dragHandle",cursorAt:{top:0,left:0},helper:function(a){return d().call(f,a&&a.target?c.dataFor(a.target):null)},start:g&&g.draggableDragStartCallback?g.draggableDragStartCallback:Mb.emptyFunction,stop:g&&g.draggableDragStopCallback?g.draggableDragStopCallback:Mb.emptyFunction}).on("mousedown",function(){Mb.removeActiveFocus()})}},c.bindingHandlers.droppable={init:Sb?null:function(b,c){var d=c(),e=d.valueFunc,f=d.switchObserv;!1!==e&&a(b).droppable({hoverClass:"droppableHover",drop:function(a,b){e(a,b)}}),f&&e!==!1&&(f.subscribe(function(c){a(b).data().droppable&&(c?a(b).droppable("disable"):a(b).droppable("enable"))},this),f.valueHasMutated())}},c.bindingHandlers.draggable={init:Sb?null:function(b,d){a(b).attr("draggable",c.utils.unwrapObservable(d()))}},c.bindingHandlers.autosize={init:function(b,c){var d=a(b),e=c(),f=d.height(),g=d.outerHeight(),h=d.innerHeight(),i=g-h,j=h-f,k=e.minHeight?e.minHeight:0,l=e.maxHeight?e.maxHeight:0,m=e.scrollableHeight?e.scrollableHeight:1e3,n=e.autosizeTrigger?e.autosizeTrigger:null,o=function(a){var b=0;Ob.browser.firefox&&(b=2*parseInt(d.css("padding-top"),10)),l?setTimeout(function(){d.prop("scrollHeight")<l?(d.height(k-j-i),d.height(d.prop("scrollHeight")+b-j)):d.height(l-j-i)},100):(a||d.prop("scrollHeight")<m)&&setTimeout(function(){d.height(k-j-i),d.height(d.prop("scrollHeight")+b-j)},100)};d.on("keydown",function(){o()}),d.on("paste",function(){o()}),n&&n.subscribe(function(a){o(a)},this),o()}},c.bindingHandlers.customBind={init:function(a,b,d,e){var f=b(),g=f.onKeydown?f.onKeydown:null,h=f.onKeyup?f.onKeyup:null,i=f.onPaste?f.onPaste:null,j=f.onInput?f.onInput:null,k=f.valueObserver?f.valueObserver:null;c.bindingHandlers.event.init(a,function(){return{keydown:function(b,c){return g&&g.call(this,a,c,k),!0},keyup:function(b,c){return h&&h.call(this,a,c,k),!0},paste:function(b,c){return i&&i.call(this,a,c,k),!0},input:function(b,c){return j&&j.call(this,a,c,k),!0}}},d,e)}},c.bindingHandlers.fade={init:function(b,c){var d=a(b),e=a('<span class="faded"></span>'),f=_.defaults(c(),{color:null,css:"fadeout"}),g=f.color,h=f.css,i=function(a){if(""!==a){var b=j(a),c="rgba("+b.r+","+b.g+","+b.b;k(a,c)}},j=function(a){var b=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return a=a.replace(b,function(a,b,c,d){return b+b+c+c+d+d}),c?{r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16)}:null},k=function(a,b){Mb.isRTL()?e.css("filter","progid:DXImageTransform.Microsoft.gradient(startColorstr='"+a+"', endColorstr='"+a+"',GradientType=1 )").css("background-image","-webkit-gradient(linear, left top, right top, color-stop(0%,"+b+",1)), color-stop(100%,"+b+",0)))").css("background-image","-moz-linear-gradient(left, "+b+",1)0%, "+b+",0)100%)").css("background-image","-webkit-linear-gradient(left, "+b+"1)0%,"+b+",0)100%)").css("background-image","-o-linear-gradient(left, "+b+",1)0%,"+b+",0)100%)").css("background-image","-ms-linear-gradient(left, "+b+",1)0%,"+b+",0)100%)").css("background-image","linear-gradient(left, "+b+",1)0%,"+b+",0)100%)"):e.css("filter","progid:DXImageTransform.Microsoft.gradient(startColorstr='"+a+"', endColorstr='"+a+"',GradientType=1 )").css("background-image","-webkit-gradient(linear, left top, right top, color-stop(0%,"+b+",0)), color-stop(100%,"+b+",1)))").css("background-image","-moz-linear-gradient(left, "+b+",0)0%, "+b+",1)100%)").css("background-image","-webkit-linear-gradient(left, "+b+",0)0%,"+b+",1)100%)").css("background-image","-o-linear-gradient(left, "+b+",0)0%,"+b+",1)100%)").css("background-image","-ms-linear-gradient(left, "+b+",0)0%,"+b+",1)100%)").css("background-image","linear-gradient(left, "+b+",0)0%,"+b+",1)100%)")};d.parent().addClass(h),d.after(e),void 0!==f.color.subscribe&&(i(g()),g.subscribe(function(a){i(a)},this))}},c.bindingHandlers.highlighter={init:function(d,e,f,g){function h(b){if(v){var c=0,d=k.text(),e=d.split(q),f=[],g='<span class="search_highlight">$&</span>';a.each(e,function(b,c){_.any(p,function(a){return a===c})?a.each(c,function(b,c){f.push(a(c.replace(/(.)/,g)))}):a.each(c,function(a,b){" "===b?f.push(document.createTextNode("")):f.push(document.createTextNode(b))})}),b?k.empty().append(f):(c=i(),k.empty().append(f),j(c))}}function i(){var a,c,e,f,g=0;return"undefined"!=typeof b.getSelection?(a=b.getSelection().getRangeAt(0),c=a.cloneRange(),c.selectNodeContents(d),c.setEnd(a.endContainer,a.endOffset),g=c.toString().length):"undefined"!=typeof document.selection&&"Control"!==document.selection.type&&(e=document.selection.createRange(),f=document.body.createTextRange(),f.moveToElementText(d),f.setEndPoint("EndToEnd",e),g=f.text.length),g}function j(a){var c,e,f;if(!d)return!1;if(document.createRange)c=document.createRange(),c.selectNodeContents(d),c.setStart(d,a),c.setEnd(d,a),e=b.getSelection(),e.removeAllRanges(),e.addRange(c);else{if(d.createTextRange)return f=d.createTextRange(),f.collapse(!0),f.moveEnd(a),f.moveStart(a),f.select(),!0;if(d.setSelectionRange)return d.setSelectionRange(a,a),!0}return!1}var k=a(d),l=e(),m=l.valueObserver?l.valueObserver:null,n=l.highlighterValueObserver?l.highlighterValueObserver:null,o=l.highlightTrigger?l.highlightTrigger:null,p=["from:","to:","subject:","text:","email:","has:","date:","text:","body:"],q=function(){var b="";return a.each(p,function(a,c){b=a?b+"|\\b"+c:b+"\\b"+c}),new RegExp("("+b+")","g")}(),r=function(a){return a.replace(/[\s]+/," ")},s=-1,t=b.navigator.language||b.navigator.userLanguage,u=["zh","zh-TW","zh-CN","zh-HK","zh-SG","zh-MO","ja","ja-JP","ko","ko-KR","vi","vi-VN","th","th-TH"],v=!_.include(u,t);c.bindingHandlers.event.init(d,function(){return{keydown:function(a,b){return b.keyCode!==Lb.Key.Enter},keyup:function(a,b){var c=[Lb.Key.Left,Lb.Key.Right,Lb.Key.Home,Lb.Key.End],d=-1!==Mb.inArray(b.keyCode,c);return b.keyCode===Lb.Key.Enter||b.keyCode===Lb.Key.Shift||b.keyCode===Lb.Key.Ctrl||b.keyCode===Lb.Key.Dash||b.keyCode===Lb.Key.Apostrophe||b.keyCode===Lb.Key.Six&&b.shiftKey||d||(b.ctrlKey||s===Lb.Key.Ctrl)&&b.keyCode===Lb.Key.a||(m(r(k.text())),h(!1)),s=b.keyCode,!0},paste:function(){return setTimeout(function(){m(r(k.text())),h(!1)},0),!0}}},f,g),setTimeout(function(){h(!0)},0),o.notifySubscribers(),o.subscribe(function(a){setTimeout(function(){h(!!a)},0)},this),n.subscribe(function(){k.text(m())},this)}},h.prototype.init=function(a){this.defaultScreen=a,e.initialized.removeAll(),e.changed.removeAll(),e.initialized.add(this.parseRouting,this),e.changed.add(this.parseRouting,this),e.init(),e.initialized.removeAll()
},h.prototype.finalize=function(){e.dispose(),this.setHashFromString("")},h.prototype.setHashFromString=function(a){var b=location.hash===decodeURIComponent(a);return b||(Mb.log("Set hash from string",a),location.hash=a),b},h.prototype.replaceHashFromString=function(a){location.hash!==a&&(Mb.log("Replace hash from string",a),location.replace(a))},h.prototype.setHash=function(a){return this.setHashFromString(this.buildHashFromArray(a))},h.prototype.replaceHash=function(a){this.replaceHashFromString(this.buildHashFromArray(a))},h.prototype.setLastMailboxHash=function(){this.setHashFromString(this.lastMailboxRouting)},h.prototype.setLastHelpdeskHash=function(){this.setHashFromString(this.lastHelpdeskRouting)},h.prototype.setPreviousHash=function(){location.hash=this.previousHash},h.prototype.buildHashFromArray=function(a){var b=0,c=0,d="";if(_.isArray(a))for(c=a.length;c>b;b++)a[b]=encodeURIComponent(a[b]);else a=[encodeURIComponent(a.toString())];return d=a.join("/"),""!==d&&(d="#"+d),d},h.prototype.getHashFromHref=function(){var a=location.href.indexOf("#"),b="";return-1!==a&&(b=location.href.substr(a+1)),b},h.prototype.isSingleMode=function(){var a=this.getHashFromHref(),b=a.split("/"),c=decodeURIComponent(b.shift())||Lb.Screens.Mailbox,d=c===Lb.Screens.SingleMessageView||c===Lb.Screens.SingleCompose||c===Lb.Screens.SingleHelpdesk;return this.currentScreen=c,d},h.prototype.goDirectly=function(a,b){e.stop(),this.setHash(a),this.parseRouting(b),e.init()},h.prototype.parseRouting=function(b){var c=this.getHashFromHref(),d=c.split("/"),e=decodeURIComponent(d.shift())||this.defaultScreen,f=_.find(Lb.Screens,function(a){return a===e},this),g=0,h=d.length;for(e===Lb.Screens.Mailbox&&(this.lastMailboxRouting=c),e===Lb.Screens.Helpdesk&&(this.lastHelpdeskRouting=c),this.previousHash=this.currentHash,this.currentHash=c;h>g;g++)d[g]=decodeURIComponent(d[g]);switch(a.isArray(b)&&(d=_.union(d,b)),this.currentScreen=e,e){case Lb.Screens.SingleMessageView:case Lb.Screens.SingleCompose:case Lb.Screens.SingleHelpdesk:Qb.SingleMode=!0,Ob.Screens.showCurrentScreen(e,d);break;default:f||(e=this.defaultScreen),Qb.SingleMode=!1,Ob.Screens.showNormalScreen(Lb.Screens.Header),Ob.Screens.showCurrentScreen(e,d);break;case Lb.Screens.Mailbox:Qb.SingleMode=!1,Ob.Screens.showNormalScreen(Lb.Screens.Header),Qb.User.Layout===Lb.MailboxLayout.Side?Ob.Screens.showCurrentScreen(Lb.Screens.Mailbox,d):Ob.Screens.showCurrentScreen(Lb.Screens.BottomMailbox,d)}this.resizeAll()},i.prototype.mailbox=function(a,b,c,d,e){var f=[Lb.Screens.Mailbox];return b=Mb.isNormal(b)?Mb.pInt(b):1,c=Mb.isNormal(c)?Mb.pString(c):"",d=Mb.isNormal(d)?Mb.pString(d):"",e=Mb.isNormal(e)?Mb.pString(e):"",a&&""!==a&&(e&&""!==e?f.push("filter:"+e):f.push(a)),b>1&&f.push("p"+b),c&&""!==c&&f.push("msg"+c),d&&""!==d&&f.push(d),f},i.prototype.inbox=function(){return this.mailbox()},i.prototype.parseMailbox=function(a){var b="INBOX",c=1,d="",e="",f="",g="";return a.length>0&&(Mb.isNormal(a[0])&&(b=Mb.pString(a[0]),b==="filter:"+Lb.FolderFilter.Flagged&&(b="INBOX",f=Lb.FolderFilter.Flagged)),a[1]&&(g=Mb.pString(a[1]),this.isPageParam(g)?(c=Mb.pInt(g.substr(1)),0>=c&&(c=1)):this.isMsgParam(g)?d=g.substr(3):e=g),""===e&&(a[2]&&(g=Mb.pString(a[2]),this.isMsgParam(g)?d=g.substr(3):e=g),a[3]&&(e=Mb.pString(a[3])))),{Folder:b,Page:c,Uid:d,Search:e,Filters:f}},i.prototype.contacts=function(a,b,c,d,e){var f=[Lb.Screens.Contacts];return"number"==typeof a&&f.push(a),b&&""!==b&&f.push(b),c&&""!==c&&f.push(c),Mb.isNumeric(d)&&f.push("p"+d),e&&""!==e&&f.push("cnt"+e),f},i.prototype.parseContacts=function(a){var b=0,c=[Lb.ContactsGroupListType.Personal,Lb.ContactsGroupListType.SharedToAll,Lb.ContactsGroupListType.Global],d=Lb.ContactsGroupListType.Personal,e="",f="",g=1,h="";return Mb.isNonEmptyArray(a)&&(d=Mb.pInt(a[b]),b++,-1===Mb.inArray(d,c)&&(d=Lb.ContactsGroupListType.SubGroup),d===Lb.ContactsGroupListType.SubGroup&&(a.length>b?(e=Mb.pString(a[b]),b++):d=Lb.ContactsGroupListType.Personal),a.length>b&&!this.isPageParam(a[b])&&!this.isContactParam(a[b])&&(f=Mb.pString(a[b]),b++),a.length>b&&this.isPageParam(a[b])&&(g=Mb.pInt(a[b].substr(1)),b++,0>=g&&(g=1)),a.length>b&&this.isContactParam(a[b])&&(h=Mb.pString(a[b].substr(3)),b++)),{Type:d,GroupId:e,Search:f,Page:g,Uid:h}},i.prototype.isPageParam=function(a){return"p"===a.substr(0,1)&&/^[1-9][\d]*$/.test(a.substr(1))},i.prototype.isContactParam=function(a){return"cnt"===a.substr(0,3)&&/^[1-9][\d]*$/.test(a.substr(3))},i.prototype.isMsgParam=function(a){return"msg"===a.substr(0,3)&&/^[1-9][\d]*$/.test(a.substr(3))},i.prototype.compose=function(){var a=Qb.SingleMode?Lb.Screens.SingleCompose:Lb.Screens.Compose;return[a]},i.prototype.composeFromMessage=function(a,b,c){var d=Qb.SingleMode?Lb.Screens.SingleCompose:Lb.Screens.Compose;return[d,a,b,c]},i.prototype.composeWithToField=function(a){var b=Qb.SingleMode?Lb.Screens.SingleCompose:Lb.Screens.Compose;return[b,"to",a]},i.prototype.parseToAddr=function(a){var b=decodeURI(Mb.pString(a)),c=-1!==b.indexOf("mailto:"),d=[],e=[],f="",g="",h="",i="";return c&&(d=b.replace(/^mailto:/,"").split("?"),b=d[0],2===d.length&&(e=d[1].split("&"),_.each(e,function(a){var b=a.split("=");if(2===b.length)switch(b[0]){case"subject":f=b[1];break;case"cc":g=b[1];break;case"bcc":h=b[1];break;case"body":i=b[1]}}))),{to:b,hasMailto:c,subject:f,cc:g,bcc:h,body:i}},j.prototype.setReplyData=function(a,b,c,d){this.replyText(a),this.replyDraftUid(b),this.replyCc(c||""),this.replyBcc(d||"")},j.prototype.send=function(a,b,c,d,e,f,g){var h="",i=Ob.MailCache.folderList().sentFolderFullName(),j=Ob.MailCache.folderList().draftsFolderFullName(),k=Qb.Accounts.getCurrent().email(),l=b.To.indexOf(k)>-1||b.Cc.indexOf(k)>-1||b.Bcc.indexOf(k)>-1;switch(Qb.User.SaveRepliedToCurrFolder&&!l&&Mb.isNonEmptyArray(b.DraftInfo,3)&&(i=b.DraftInfo[2]),b.Action=a,b.IsHtml="1",b.ShowReport=d,a){case"MessageSend":h=Mb.i18n("COMPOSE/INFO_SENDING"),c&&(b.SentFolder=i),""!==b.DraftUid&&(b.DraftFolder=j);break;case"MessageSave":h=Mb.i18n("COMPOSE/INFO_SAVING"),b.DraftFolder=j}d&&Ob.Api.showLoading(h),g?this.postponedMailData={Parameters:b,MessageSendResponseHandler:e,MessageSendResponseContext:f}:Ob.Ajax.send(b,e,f)},j.prototype.sendPostponedMail=function(a){var b=this.postponedMailData,c=Ob.MailCache.folderList().draftsFolderFullName();""!==a&&(b.Parameters.DraftUid=a,b.Parameters.DraftFolder=c),this.postponedMailData&&(Ob.Ajax.send(b.Parameters,b.MessageSendResponseHandler,b.MessageSendResponseContext),this.postponedMailData=null)},j.prototype.sendReplyMessage=function(a,b,c,d,e){var f=null;Ob.MailCache.currentMessage()&&(f=this.getReplyDataFromMessage(Ob.MailCache.currentMessage(),Lb.ReplyType.ReplyAll,Qb.Accounts.currentId(),null,b,c),f.Bcc="",f.Importance=Lb.Importance.Normal,f.Sensivity=Lb.Sensivity.Nothing,f.ReadingConfirmation="0",f.IsQuickReply=!0,f.Attachments=this.convertAttachmentsForSending(f.Attachments),this.send(a,f,Qb.User.getSaveMailInSentItems(),!1,d,e))},j.prototype.convertAttachmentsForSending=function(a){var b={};return _.each(a,function(a){b[a.tempName()]=[a.fileName(),a.cid(),a.inline()?"1":"0",a.linked()?"1":"0",a.contentLocation()]}),b},j.prototype.onMessageSendOrSaveResponse=function(a,c){var d,e,f,g=Qb.SingleMode?b.opener.App:Ob,h=!!a.Result;switch(Ob.Api.hideLoading(),c.Action){case"MessageSave":h?(c.ShowReport&&Ob.Api.showReport(Mb.i18n("COMPOSE/REPORT_MESSAGE_SAVED")),a.Result.NewUid||(Qb.App.AutoSave=!1)):c.ShowReport&&Ob.Api.showErrorByCode(a,Mb.i18n("COMPOSE/ERROR_MESSAGE_SAVING"));break;case"MessageSend":h||a.ErrorCode===Lb.Errors.NotSavedInSentItems?(h||a.ErrorCode!==Lb.Errors.NotSavedInSentItems?c.IsQuickReply?Ob.Api.showReport(Mb.i18n("COMPOSE/REPORT_MESSAGE_SENT")):g.Api.showReport(Mb.i18n("COMPOSE/REPORT_MESSAGE_SENT")):Ob.Api.showError(Mb.i18n("WARNING/SENT_EMAIL_NOT_SAVED")),_.isArray(c.DraftInfo)&&3===c.DraftInfo.length&&(f=c.DraftInfo[0],e=c.DraftInfo[1],d=c.DraftInfo[2],Ob.MailCache.markMessageReplied(c.AccountID,d,e,f))):Ob.Api.showErrorByCode(a,Mb.i18n("COMPOSE/ERROR_MESSAGE_SENDING")),c.SentFolder&&g.MailCache.removeMessagesFromCacheForFolder(c.SentFolder)}return c.DraftFolder&&g.MailCache.removeMessagesFromCacheForFolder(c.DraftFolder),{Action:c.Action,Result:h,NewUid:a.Result?a.Result.NewUid:""}},j.prototype.getReplyDataFromMessage=function(a,b,c,d,e,f){var g=null,h={DraftInfo:[],DraftUid:"",To:"",Cc:"",Bcc:"",Subject:"",Attachments:[],InReplyTo:a.messageId(),References:this.getReplyReferences(a)},i=[],j=a.oReplyTo.getFull(),k=a.oTo.getFull();switch(""===j&&(j=a.oFrom.getFull()),e&&""!==e||(e=this.replyText(),this.replyText("")),"forward"===b?h.Text=e+this.getForwardMessageBody(a):"resend"===b?(g=a.getDomText(),h.Text=g.length>0?g.html():"",h.Cc=a.cc(),h.Bcc=a.bcc()):h.Text=e+this._getReplyMessageBody(a,c,d),f?h.DraftUid=f:(h.DraftUid=this.replyDraftUid(),this.replyDraftUid("")),b){case Lb.ReplyType.Reply:h.DraftInfo=[Lb.ReplyType.Reply,a.uid(),a.folder()],h.To=j,h.Subject=this.replySubjectAdd(Mb.i18n("COMPOSE/REPLY_PREFIX"),a.subject()),i=_.filter(a.attachments(),function(a){return a.linked()});break;case Lb.ReplyType.ReplyAll:h.DraftInfo=[Lb.ReplyType.ReplyAll,a.uid(),a.folder()],h.To=j,h.Cc=this._getReplyAllCcAddr(a,c,d),h.Subject=this.replySubjectAdd(Mb.i18n("COMPOSE/REPLY_PREFIX"),a.subject()),i=_.filter(a.attachments(),function(a){return a.linked()});break;case Lb.ReplyType.Resend:h.DraftInfo=[Lb.ReplyType.Resend,a.uid(),a.folder(),a.cc(),a.bcc()],h.To=k,h.Subject=a.subject(),i=a.attachments();break;case Lb.ReplyType.Forward:h.DraftInfo=[Lb.ReplyType.Forward,a.uid(),a.folder()],h.Subject=this.replySubjectAdd(Mb.i18n("COMPOSE/FORWARD_PREFIX"),a.subject()),i=a.attachments()}return _.each(i,function(a){a.getCopy&&h.Attachments.push(a.getCopy())}),h},j.prototype.getReplyReferences=function(a){var b=a.references(),c=a.messageId(),d=b.indexOf(c);return-1===d&&(b+=" "+c),b},j.prototype._getReplyMessageBody=function(a,b,c){var d=a.getDomText(),e=d.length>0?d.html():"",f=Mb.i18n("COMPOSE/REPLY_MESSAGE_TITLE",{DATE:a.oDateModel.getDate(),TIME:a.oDateModel.getTime(),SENDER:Mb.encodeHtml(a.oFrom.getFull())}),g="<br /><br />"+this.getSignatureText(b,c)+"<br /><br />"+f+"<blockquote>"+e+"</blockquote>";return g},j.prototype.getSignatureText=function(a,b){var c=Qb.Accounts.getAccount(a),d=c.signature(),e='<div data-anchor="signature"></div>';return d&&parseInt(d.options())&&(e='<div data-anchor="signature">'+d.signature()+"</div>"),b&&b.accountId()===a&&(b.useSignature?b.useSignature():b.signatureOptions())&&null!==b.signature()&&(e='<div data-anchor="signature">'+b.signature()+"</div>"),e},j.prototype.getFetcherOrIdentityByRecipients=function(a,b){var c=Qb.Accounts.getAccount(b),d=null;return c&&(c.fetchers()&&(d=_.find(c.fetchers().collection(),function(b){var c=_.find(a,function(a){return a.sEmail===b.email()}),d=!!c;return d})),d||(d=_.find(c.identities()||[],function(b){var c=_.find(a,function(a){return a.sEmail===b.email()}),d=!!c;return d}))),d},j.prototype.getForwardMessageBody=function(a){var b=a.getDomText(),c=b.length>0?b.html():"",d=Mb.encodeHtml(a.oCc.getFull()),e=""!==d?Mb.i18n("COMPOSE/FORWARD_MESSAGE_BODY_CC",{CCADDR:d}):"",f=Mb.i18n("COMPOSE/FORWARD_MESSAGE_TITLE",{FROMADDR:Mb.encodeHtml(a.oFrom.getFull()),TOADDR:Mb.encodeHtml(a.oTo.getFull()),CCPART:e,FULLDATE:a.oDateModel.getFullDate(),SUBJECT:a.subject()}),g="<br /><br />"+f+"<br /><br />"+c;return g},j.prototype._getReplyAllCcAddr=function(a,b,c){var d=new G,e=_.union(a.oTo.aCollection,a.oCc.aCollection,a.oBcc.aCollection),f=_.find(Qb.Accounts.collection(),function(a){return a.id()===b},this),g=new F,h=new F;return g.sEmail=f.email(),h.sEmail=c?c.email():"",d.addCollection(e),d.excludeCollection(_.union(a.oFrom.aCollection,[g,h])),d.getFull()},j.prototype.replySubjectAdd=function(a,c){var d=null,e=Mb.trim(c);return null===(d=new b.RegExp("^"+a+"[\\s]?\\:(.*)$","gi").exec(c))||Mb.isUnd(d[1])?null===(d=new b.RegExp("^("+a+"[\\s]?[\\[\\(]?)([\\d]+)([\\]\\)]?[\\s]?\\:.*)$","gi").exec(c))||Mb.isUnd(d[1])||Mb.isUnd(d[2])||Mb.isUnd(d[3])?e=a+": "+c:(e=d[1]+(Mb.pInt(d[2])+1)+d[3],e=d[1]+(Mb.pInt(d[2])+1)+d[3]):e=a+"[2]: "+d[1],e},j.prototype.getHtmlFromText=function(a){return a.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/\r/g,"").replace(/\n/g,"<br />")},k.prototype.init=function(){setInterval(_.bind(function(){this.prefetchStarted(!1),this.start()},this),2e3)},k.prototype.start=function(){var a=Ob.MailCache.folderList();Qb.SingleMode||Ob.Ajax.hasOpenedRequests()||this.prefetchStarted()||(a&&a.inboxFolder()&&Ob.MailCache.requestMessageList(a.inboxFolder().fullName(),1,"",Lb.FolderFilter.Flagged,!1,!1),Qb.App.AllowPrefetch&&!Ob.Ajax.hasOpenedRequests()&&(this.startThreadListPrefetch(),this.startMessagesPrefetch(),this.startOtherPagesPrefetch(),this.startOtherFoldersPrefetch()))},k.prototype.startOtherPagesPrefetch=function(){var a=Ob.MailCache.folderList().currentFolder();this.startPagePrefetch(a,Ob.MailCache.page()+1),this.startPagePrefetch(a,Ob.MailCache.page()-1)},k.prototype.startPagePrefetch=function(a,b){if(!this.prefetchStarted()&&a){var c=Ob.MailCache.uidList(),d=(b-1)*Qb.User.MailsPerPage,e=b>0&&d<c.resultCount(),f={folder:a.fullName(),page:b,search:c.search()},g=null;e&&!a.hasListBeenRequested(f)&&(g=Ob.MailCache.requestMessageList(f.folder,f.page,f.search,"",!1,!1),g&&g.RequestStarted&&this.prefetchStarted(!0))}},k.prototype.startOtherFoldersPrefetch=function(){if(!this.prefetchStarted()){var a=Ob.MailCache.folderList().sentFolder(),b=Ob.MailCache.folderList().draftsFolder(),c=Ob.MailCache.folderList().inboxFolder(),d=c?c.subfolders():[],e=_.filter(Ob.MailCache.folderList().collection(),function(a){return!a.isSystem()},this),f=_.union(d,e),g=f.length>0?f[0]:null,h=f.length>1?f[1]:null,i=f.length>2?f[2]:null;this.startFolderPrefetch(c),this.startFolderPrefetch(a),this.startFolderPrefetch(b),this.startFolderPrefetch(g),this.startFolderPrefetch(h),this.startFolderPrefetch(i)}},k.prototype.startFolderPrefetch=function(a){if(!this.prefetchStarted()&&a){var b=1,c="",d={folder:a.fullName(),page:b,search:c},e=null;a.hasListBeenRequested(d)||(e=Ob.MailCache.requestMessageList(d.folder,d.page,d.search,"",!1,!1),e&&e.RequestStarted&&this.prefetchStarted(!0))}},k.prototype.startThreadListPrefetch=function(){var a=[],b=Ob.MailCache.getCurrentFolder();this.prefetchStarted()||(_.each(Ob.MailCache.messages(),function(c){!this.prefetchStarted()&&c.threadCount()>0&&_.each(c.threadUids(),function(c){var d=b.oMessages[c];d&&b.hasThreadUidBeenRequested(c)||a.push(c)})},this),a.length>0&&(a=a.slice(0,Qb.User.MailsPerPage),b.addRequestedThreadUids(a),b.loadThreadMessages(a),this.prefetchStarted(!0)))},k.prototype.startMessagesPrefetch=function(){var a=Ob.MailCache.currentAccountId(),b=Ob.MailCache.getCurrentFolder(),c=0,d=Qb.App.MaxPrefetchBodiesSize,e=[],f=null,g=2048,h=function(a){var f=!a.deleted()&&!a.completelyFilled(),h=!_.find(e,function(b){return b===a.uid()},this),i=!b.hasUidBeenRequested(a.uid());c+a.textSize()+g<d&&f&&h&&i&&(e.push(a.uid()),c+=a.textSize()+g)};b&&b.selected()&&!this.prefetchStarted()&&(_.each(Ob.MailCache.messages(),h),_.each(b.oMessages,h),e.length>0&&(b.addRequestedUids(e),f={AccountID:a,Action:"Messages",Folder:b.fullName(),Uids:e},Ob.Ajax.send(f,this.onPrefetchResponse,this),this.prefetchStarted(!0)))},k.prototype.onPrefetchResponse=function(a,b){var c=Ob.MailCache.getFolderByFullName(b.AccountID,b.Folder);_.isArray(a.Result)&&_.each(a.Result,function(a){c.parseAndCacheMessage(a,!1,!1)})},Mb.inArray=a.inArray,Mb.isFunc=a.isFunction,Mb.trim=a.trim,Mb.emptyFunction=function(){},Mb.isUnd=function(a){return void 0===a},Mb.isNull=function(a){return null===a},Mb.isNormal=function(a){return!Mb.isUnd(a)&&!Mb.isNull(a)},Mb.isNumeric=function(a){return Mb.isNormal(a)?/^[1-9]+[0-9]*$/.test(a.toString()):!1},Mb.pInt=function(a){return Mb.isNormal(a)&&""!==a?b.parseInt(a,10):0},Mb.pString=function(a){return Mb.isNormal(a)?a.toString():""},Mb.isNonEmptyArray=function(a,b){return b=b||1,_.isArray(a)&&b<=a.length},Mb.pImport=function(a,b,c){a[b]=c},Mb.pExport=function(a,b,c){return Mb.isUnd(a[b])?c:a[b]},Mb.encodeHtml=function(a){return a?a.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""},Mb.i18n=function(a,b,c,d){var e="",f=Mb.isUnd(Nb[a])?Mb.isNormal(c)?c:a:Nb[a];if(Mb.isUnd(d)||(f=function(a,b){var c=Mb.getPlural(Qb.User.DefaultLanguage,a),d=b.split("|");return d&&d[c]?d[c]:d&&d[0]?d[0]:b}(d,f)),Mb.isNormal(b))for(e in b)b.hasOwnProperty(e)&&(f=f.replace("%"+e+"%",b[e]));return f},Mb.roundNumber=function(a,b){return Math.round(a*Math.pow(10,b))/Math.pow(10,b)},Mb.friendlySize=function(a){var b=1024,c=b*b,d=b*b*b;return a=Mb.pInt(a),a>=d?Mb.roundNumber(a/d,1)+Mb.i18n("MAIN/GIGABYTES"):a>=c?Mb.roundNumber(a/c,1)+Mb.i18n("MAIN/MEGABYTES"):a>=b?Mb.roundNumber(a/b,0)+Mb.i18n("MAIN/KILOBYTES"):a+Mb.i18n("MAIN/BYTES")},Mb.timeOutAction=function(){var a={};return function(c,d,e){Mb.isUnd(a[c])&&(a[c]=0),b.clearTimeout(a[c]),a[c]=b.setTimeout(d,e)}}(),Mb.$log=null,Mb.log=function(){function b(a,b){return"string"==typeof b&&b.length>50?b.substring(0,50):b}if(Qb&&Qb.ClientDebug&&Ob.browser&&!Ob.browser.ie9AndBelow){var c=Mb.$log||a('<div style="display: none;"></div>').appendTo("body"),d=c.html(),e=d.split(/<br {0,1}\/{0,1}><br {0,1}\/{0,1}>/),f=[];_.each(arguments,function(a){var c="string"==typeof a?a:JSON.stringify(a,b);0===f.length&&(c="<b>"+c+"</b>"),f.push(c)}),Mb.$log=c,e.length>200&&e.shift(),e.push(Mb.encodeHtml(f.join(", "))),c.html(e.join("<br /><br />"))}},Mb.getAjaxDataForLog=function(a,b){var c=b;if(b&&b.Result)switch(a){case"MessageList":case"MessageListByUids":c={Result:{Uids:b.Result.Uids,UidNext:b.Result.UidNext,FolderHash:b.Result.FolderHash,MessageCount:b.Result.MessageCount,MessageUnseenCount:b.Result.MessageUnseenCount,MessageResultCount:b.Result.MessageResultCount}};break;case"Message":c={Result:{Folder:b.Result.Folder,Uid:b.Result.Uid,Subject:b.Result.Subject,Size:b.Result.Size,TextSize:b.Result.TextSize,From:b.Result.From,To:b.Result.To}};break;case"Messages":c={Result:_.map(b.Result,function(a){return{Uid:a.Uid,Subject:a.Subject}})}}else b&&(c={Result:b.Result,ErrorCode:b.ErrorCode});return c},Mb.getEmailParts=function(a){for(var b=a.indexOf('"'),c=a.indexOf('"',b+1),d=a.indexOf("<",c),e=-1,f=-1,g="",h="";-1!==d;)e=d,d=a.indexOf("<",d+1);return d=e,f=a.indexOf(">",d+1),-1===d?h=Mb.trim(a):(g=-1===b?Mb.trim(a.substring(0,d)):Mb.trim(a.substring(b+1,c)),h=Mb.trim(a.substring(d+1,f))),{name:g,email:h,FullEmail:a}},Mb.isCorrectEmail=function(a){return!!a.match(/^[A-Z0-9\"!#\$%\^\{\}`~&'\+\-=_\.]+@[A-Z0-9\.\-]+$/i)},Mb.getIncorrectEmailsFromAddressString=function(a){for(var b=a.replace(/"[^"]*"/g,"").replace(/;/g,",").split(","),c=[],d=0,e=b.length,f="",g=null;e>d;d++)f=Mb.trim(b[d]),f.length>0&&(g=Mb.getEmailParts(Mb.trim(b[d])),Mb.isCorrectEmail(g.email)||c.push(g.email));return c},Mb.getArrayRecipients=function(a){if(!a)return[];for(var b=[],c=Mb.trim(a)+" ",d=0,e=0,f=!1,g='"',h=!1,i=!1,j=0,k=c.length,l="",m="",n=null,o=!1,p=0,q=0;k>j;){switch(l=c.substring(j,j+1)){case"'":case'"':f?g===l&&(f=!1):h||i||(g=l,f=!0);break;case"<":f||h||i||(h=!0);break;case">":h&&(h=!1);break;case"(":f||h||i||(i=!0);break;case")":i&&(i=!1);break;default:if(","!==l&&";"!==l&&j!==k-1)break;if(!h&&!i&&!f){if(e=j!==k-1?j:k,m=c.substring(d,e),Mb.trim(m).length>0){for(n=Mb.getEmailParts(m),o=!1,p=b.length,q=0;p>q;q++)b[q].email===n.email&&(o=!0);!o&&Mb.isCorrectEmail(n.email)&&b.push(n)}d=j+1}}j++}return b},Mb.getImportContactsLink=function(){return"?/ImportContacts/"},Mb.getExportContactsLink=function(){return"?/Raw/Contacts/"},Mb.getExportCalendarLinkByHash=function(a,b){return"?/Raw/Calendar/"+a+"/"+b},Mb.getDownloadLinkByHash=function(a,b,c,d){return c=Mb.isUnd(c)?!1:!!c,d=Mb.isUnd(d)?"":d,"?/Raw/Download/"+a+"/"+b+"/"+(c?"1":"0")+(""===d?"":"/"+d)},Mb.getViewLinkByHash=function(a,b,c,d){return c=Mb.isUnd(c)?!1:!!c,d=Mb.isUnd(d)?"":d,"?/Raw/View/"+a+"/"+b+"/"+(c?"1":"0")+(""===d?"":"/"+d)},Mb.getViewThumbnailLinkByHash=function(a,b,c,d){return c=Mb.isUnd(c)?!1:!!c,d=Mb.isUnd(d)?"":d,"?/Raw/Thumbnail/"+a+"/"+b+"/"+(c?"1":"0")+(""===d?"":"/"+d)},Mb.getFilestorageDownloadLinkByHash=function(a,b,c){var d="?/Raw/FilesDownload/"+a+"/"+b;return Mb.isUnd(c)||(d=d+"/0/"+c),d},Mb.getFilestorageViewLinkByHash=function(a,b,c){var d="?/Raw/FilesView/"+a+"/"+b;return Mb.isUnd(c)||(d=d+"/0/"+c),d},Mb.getFilestorageViewThumbnailLinkByHash=function(a,b,c){var d="?/Raw/FilesThumbnail/"+a+"/"+b;return Mb.isUnd(c)||(d=d+"/0/"+c),d},Mb.getFilestoragePublicViewLinkByHash=function(a){return"?/Window/Files/0/"+a},Mb.getFilestoragePublicDownloadLinkByHash=function(a){return"?/Raw/FilesPub/0/"+a},Mb.daysInMonth=function(a,b){return a>0&&13>a&&b>0?new Date(b,a,0).getDate():31},Mb.getAppPath=function(){return b.location.protocol+"//"+b.location.host+b.location.pathname},Mb.WindowOpener={_iDefaultRatio:.8,_aOpenedWins:[],openMessage:function(a,b){if(a){var c=a.folder(),d=a.uid(),e="",f=null;e=b?Ob.Routing.buildHashFromArray([Lb.Screens.SingleCompose,"drafts",c,d]):Ob.Routing.buildHashFromArray([Lb.Screens.SingleMessageView,c,"msg"+d]),f=this.openTab(e)}},openTab:function(a){var c=null;return c=b.open(a,"_blank"),c.focus(),c.name=Qb.Accounts.currentId(),this._aOpenedWins.push(c),c},open:function(a,c,d){var e=d?",menubar=yes":",menubar=no",f="location=no,toolbar=no,status=no,scrollbars=yes,resizable=yes"+e,g=null;return c=c.replace(/\W/g,""),f+=this._getSizeParameters(),g=b.open(a,c,f),g.focus(),g.name=Qb.Accounts.currentId(),this._aOpenedWins.push(g),g},closeAll:function(){for(var a=this._aOpenedWins.length,b=0,c=null;a>b;b++)c=this._aOpenedWins[b],c.closed||c.close();this._aOpenedWins=[]},_getSizeParameters:function(){var a=b.screen.width,c=Math.ceil(a*this._iDefaultRatio),d=Math.ceil((a-c)/2),e=b.screen.height,f=Math.ceil(e*this._iDefaultRatio),g=Math.ceil((e-f)/2);return",width="+c+",height="+f+",top="+g+",left="+d}},Mb.moveCaretToEnd=function(a){var b,c;a.createTextRange?(b=a.createTextRange(),b.collapse(!1),b.select()):a.setSelectionRange&&(c=2*a.value.length,a.setSelectionRange(c,c))},Mb.delegateRun=function(a,b,c){a&&a[b]&&a[b].apply(a,_.isArray(c)?c:[])},Mb.strRepeat=function(a,b){return new Array(b+1).join(a)},Mb.deferredUpdate=function(a,c,d,e){!a.__interval&&c?(a.__state=!0,e(a,!0),a.__interval=b.setInterval(function(){a.__state||(e(a,!1),b.clearInterval(a.__interval),a.__interval=null)},d)):c||(a.__state=!1)},Mb.draggableMessages=function(){return a('<div class="draggable draggableMessages"><div class="content"><span class="count-text"></span></div></div>').appendTo("#pSevenHidden")},Mb.draggableContacts=function(){return a('<div class="draggable draggableContacts"><div class="content"><span class="count-text"></span></div></div>').appendTo("#pSevenHidden")},Mb.removeActiveFocus=function(){if(document&&document.activeElement&&document.activeElement.blur){var b=a(document.activeElement);(b.is("input")||b.is("textarea"))&&document.activeElement.blur()}},Mb.uiDropHelperAnim=function(b,c){var d=c.helper.clone().appendTo("#pSevenHidden"),e=a(b.target).find(".animGoal"),f=e[0]?e.offset():a(b.target).offset();d.animate({left:f.left+"px",top:f.top+"px","font-size":"0px",opacity:0},800,"easeOutQuint",function(){a(this).remove()})},Mb.isTextFieldFocused=function(){var a=document&&document.activeElement?document.activeElement:null,b=a?a.tagName:null,c=a&&a.type?a.type.toLowerCase():null,d=a?a.contentEditable:null;return"INPUT"===b&&("text"===c||"password"===c||"email"===c)||"TEXTAREA"===b||"IFRAME"===b||"true"===d},Mb.removeSelection=function(){b.getSelection?b.getSelection().removeAllRanges():document.selection&&document.selection.empty()},Mb.getMonthNamesArray=function(){for(var a=Mb.i18n("DATETIME/MONTH_NAMES").split(" "),b=12,c=a.length;b>c;c++)a[c]="";return a},Mb.getPlural=function(a,b){var c=0;switch(b=Mb.pInt(b),a){case"Arabic":c=0===b?0:1===b?1:2===b?2:b%100>=3&&10>=b%100?3:b%100>=11?4:5;break;case"Bulgarian":c=1===b?0:1;break;case"Chinese-Simplified":c=0;break;case"Chinese-Traditional":c=1===b?0:1;break;case"Czech":c=1===b?0:b>=2&&4>=b?1:2;break;case"Danish":c=1===b?0:1;break;case"Dutch":c=1===b?0:1;break;case"English":c=1===b?0:1;break;case"Estonian":c=1===b?0:1;break;case"Finish":c=1===b?0:1;break;case"French":c=1===b?0:1;break;case"German":c=1===b?0:1;break;case"Greek":c=1===b?0:1;break;case"Hebrew":c=1===b?0:1;break;case"Hungarian":c=1===b?0:1;break;case"Italian":c=1===b?0:1;break;case"Japanese":c=0;break;case"Korean":c=0;break;case"Latvian":c=b%10===1&&b%100!==11?0:0!==b?1:2;break;case"Lithuanian":c=b%10===1&&b%100!==11?0:b%10>=2&&(10>b%100||b%100>=20)?1:2;break;case"Norwegian":c=1===b?0:1;break;case"Persian":c=0;break;case"Polish":c=1===b?0:b%10>=2&&4>=b%10&&(10>b%100||b%100>=20)?1:2;break;case"Portuguese-Portuguese":c=1===b?0:1;break;case"Portuguese-Brazil":c=1===b?0:1;break;case"Romanian":c=1===b?0:0===b||b%100>0&&20>b%100?1:2;break;case"Russian":c=b%10===1&&b%100!==11?0:b%10>=2&&4>=b%10&&(10>b%100||b%100>=20)?1:2;break;case"Serbian":c=b%10===1&&b%100!==11?0:b%10>=2&&4>=b%10&&(10>b%100||b%100>=20)?1:2;break;case"Spanish":c=1===b?0:1;break;case"Swedish":c=1===b?0:1;break;case"Thai":c=0;break;case"Turkish":c=1===b?0:1;break;case"Ukrainian":c=b%10===1&&b%100!==11?0:b%10>=2&&4>=b%10&&(10>b%100||b%100>=20)?1:2;break;default:c=0}return c},Mb.getFileExtension=function(a){var b="",c=a.lastIndexOf(".");return c>-1&&(b=a.substr(c+1)),b},Mb.getFileNameWithoutExtension=function(a){var b=a,c=a.lastIndexOf(".");return c>-1&&(b=a.substr(0,c)),b},Mb.defaultOptionsAfterRender=function(a,b){b&&(Mb.isUnd(b.disable)||c.applyBindingsToNode(a,{disable:b.disable},b))},Mb.getDateFormatForMoment=function(a){var b="MM/DD/YYYY";switch(a){case"MM/DD/YYYY":b="MM/DD/YYYY";break;case"DD/MM/YYYY":b="DD/MM/YYYY";break;case"DD Month YYYY":b="DD MMMM YYYY"}return b},Mb.getDateFormatForDatePicker=function(a){var b="mm/dd/yy";switch(a){case"MM/DD/YYYY":b="mm/dd/yy";break;case"DD/MM/YYYY":b="dd/mm/yy";break;case"DD Month YYYY":b="dd MM yy"}return b},Mb.getDateFormatsForSelector=function(){return _.map(Qb.App.DateFormats,function(a){switch(a){case"MM/DD/YYYY":return{name:Mb.i18n("DATETIME/DATEFORMAT_MMDDYYYY"),value:a};case"DD/MM/YYYY":return{name:Mb.i18n("DATETIME/DATEFORMAT_DDMMYYYY"),value:a};case"DD Month YYYY":return{name:Mb.i18n("DATETIME/DATEFORMAT_DDMONTHYYYY"),value:a};default:return{name:a,value:a}}})},Mb.getTitleForEvent=function(a){var b=Mb.trim(a.replace(/[\n\r]/," ")),c=b.indexOf(" ",180);return c>=0&&(b=b.substring(0,c)+"..."),b.length>200&&(b=b.substring(0,200)+"..."),b},Mb.getFormattedPhone=function(a){var b,c={"+7":"8"},d=/#/g.test(a)?a.split("#")[1]:a.replace(/[()\s_\-]/g,""),e=(a+"").slice(0,2);return b=_.any(c,function(a,b){return b===e},this),b?d.replace(e,c[e]):d.replace(/[+]/g,"")},Mb.desktopNotify=function(){var a,c=0;return function(d,e,f,g,h,i){if("show"===d){var j,k=null,l={phone:"skins/Default/images/logo.png"},m={body:f,icon:l[g]||!1};if(b.Notification&&b.Notification.permission)switch(k=b.Notification,b.Notification.permission.toLowerCase()){case"granted":j=Lb.DesktopNotifications.Allowed;break;case"denied":j=Lb.DesktopNotifications.Denied;break;case"default":j=Lb.DesktopNotifications.NotAllowed}else b.webkitNotifications&&b.webkitNotifications.checkPermission&&(k=b.webkitNotifications,j=b.webkitNotifications.checkPermission());k&&j===Lb.DesktopNotifications.Allowed&&(a&&a.close(),a=new b.Notification(e,m),clearTimeout(c),i&&(c=setTimeout(function(){a.close()},i)),a.onclick=function(){h&&h(),a.close()})}else"hide"===d&&a&&a.close()}}(),Mb.isRTL=function(){return Tb.hasClass("rtl")},Mb.shadeColor=function(a,c){var d=!1,e=0,f=0,g=0,h=0;return"#"===a[0]&&(a=a.slice(1),d=!0),e=b.parseInt(a,16),f=(e>>16)+c,f>255?f=255:0>f&&(f=0),g=(e>>8&255)+c,g>255?g=255:0>g&&(g=0),h=(255&e)+c,h>255?h=255:0>h&&(h=0),(d?"#":"")+(h|g<<8|f<<16).toString(16)},Mb.extend=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a},Mb.thumbQueue=function(){var a={},b={},c=2;return function(d,e,f){e&&f?!(d in b)||b[d]>0?(f(e),d in b||(b[d]=c,a[d]=[]),b[d]--):a[d].push({imageSrc:e,imageSrcObserver:f,messageUid:d}):a[d].length&&(a[d][0].imageSrcObserver(a[d][0].imageSrc),a[d].shift())}}(),Mb.checkConnection=function(){var a=-1;return function(b,c){clearTimeout(a),c.Result?Ob.Api.hideError(!0):"Ping"===b?(Ob.Api.showError(Mb.i18n("WARNING/NO_INTERNET_CONNECTION"),!1,!0,!0),a=setTimeout(function(){Ob.Ajax.send({Action:"Ping"})},6e4)):Ob.Ajax.send({Action:"Ping"})}}(),l.prototype.iTimer=0,l.prototype.bResetCheckedOnClick=!1,l.prototype.bCheckOnSelect=!1,l.prototype.bUnselectOnCtrl=!1,l.prototype.bDisableMultiplySelection=!1,l.prototype.setBeforeSelectCallback=function(a){this.fBeforeSelectCallback=a||null},l.prototype.initOnApplyBindings=function(b,d,e,f,g){a(document).on("keydown",this.onKeydownBinded),this.oListScope=f,this.oScrollScope=g,this.sActionSelector=b,this.sSelectabelSelector=d,this.sCheckboxSelector=e;var h=this,i=function(a,b){var c=0,d=0,e=null,f=!1,g=!1,i=[],j=!1;if(a=a?a:null,b&&b.shiftKey&&null!==a&&null!==h.oLast&&a!==h.oLast)for(i=h.list(),j=a.checked(),c=0,d=i.length;d>c;c++)e=i[c],f=!1,(e===h.oLast||e===a)&&(f=!0),f&&(g=!g),(g||f)&&e.checked(j);a&&(h.oLast=a)};a(this.oListScope).on("dblclick",b,function(a){var b=c.dataFor(this);!b||!a||a.ctrlKey||a.altKey||a.shiftKey||h.onDblClick(b)}),Wb&&a(this.oListScope).on("touchstart",b,function(b){if(b){var c=b.timeStamp,d=a(this).data("lastTouch")||c,e=c-d,f=b.originalEvent&&b.originalEvent.touches?b.originalEvent.touches.length:0;a(this).data("lastTouch",c),!e||e>250||f>1||(b.preventDefault(),a(this).trigger("dblclick"))}}),a(this.oListScope).on("click",b,function(a){var b=!0,d=null,e=c.dataFor(this);e&&a&&(a.shiftKey?(b=!1,h.bDisableMultiplySelection||(null===h.oLast&&(h.oLast=e),e.checked(!e.checked()),i(e,a))):a.ctrlKey&&(b=!1,h.bDisableMultiplySelection||(h.oLast=e,d=h.itemSelected(),!d||d.checked()||e.checked()||d.checked(!0),h.bUnselectOnCtrl&&e===h.itemSelected()?(e.checked(!e.selected()),h.itemSelected(null)):e.checked(!e.checked()))),b&&h.onSelect(e))}),a(this.oListScope).on("click",e,function(a){var b=c.dataFor(this);b&&a&&!h.bDisableMultiplySelection&&(a.shiftKey?(null===h.oLast&&(h.oLast=b),i(b,a)):h.oLast=b),a&&a.stopPropagation&&a.stopPropagation()}),a(this.oListScope).on("dblclick",e,function(a){a&&a.stopPropagation&&a.stopPropagation()})},l.prototype.getResultSelection=function(a,b){var c=this,d=!1,e=!1,f=null,g=this.iFactor,h=!!this.multiplyLineFactor,i=0,j=0,k=[];if(!a&&-1<Mb.inArray(b,[this.KeyUp,this.KeyDown,this.KeyLeft,this.KeyRight,Lb.Key.PageUp,Lb.Key.PageDown,Lb.Key.Home,Lb.Key.End]))k=this.list(),k&&0<k.length&&(-1<Mb.inArray(b,[this.KeyDown,this.KeyRight,Lb.Key.PageUp,Lb.Key.Home])?f=k[0]:-1<Mb.inArray(b,[this.KeyUp,this.KeyLeft,Lb.Key.PageDown,Lb.Key.End])&&(f=k[k.length-1]));else if(a&&(k=this.list(),j=k?k.length:0,j>0))if(Lb.Key.Home===b||Lb.Key.PageUp===b||Lb.Key.End===b||Lb.Key.PageDown===b||h&&(Lb.Key.Left===b||Lb.Key.Right===b)||!h&&(Lb.Key.Up===b||Lb.Key.Down===b))_.each(k,function(g){if(!d)switch(b){case c.KeyUp:case c.KeyLeft:a===g?d=!0:f=g;break;case Lb.Key.Home:case Lb.Key.PageUp:f=g,d=!0;break;case c.KeyDown:case c.KeyRight:e?(f=g,d=!0):a===g&&(e=!0);break;case Lb.Key.End:case Lb.Key.PageDown:f=g}});else if(h&&this.KeyDown===b){for(;j>i;i++)if(a===k[i]){i+=g,i>j-1&&(i-=g),f=k[i];break}}else if(h&&this.KeyUp===b)for(i=j;i>=0;i--)if(a===k[i]){i-=g,0>i&&(i+=g),f=k[i];break}return f},l.prototype.shiftClickResult=function(a,b,c){if(b){var d=!!this.multiplyLineFactor,e=!1,f=!1;-1<Mb.inArray(c,d?[Lb.Key.Left,Lb.Key.Right]:[Lb.Key.Up,Lb.Key.Down])?b.checked(!b.checked()):-1<Mb.inArray(c,d?[Lb.Key.Up,Lb.Key.Down,Lb.Key.PageUp,Lb.Key.PageDown,Lb.Key.Home,Lb.Key.End]:[Lb.Key.Left,Lb.Key.Right,Lb.Key.PageUp,Lb.Key.PageDown,Lb.Key.Home,Lb.Key.End])&&(f=!b.checked(),_.each(this.list(),function(c){var d=!1;(c===a||b===c)&&(e=!e,d=!0),(e||d)&&(c.checked(f),d=!1)
}),d&&a&&(c===Lb.Key.Up||c===Lb.Key.Down)&&a.checked(!a.checked()))}},l.prototype.clickNewSelectPosition=function(a,c){var d=this,e=0,f=null,g=this.itemSelected();f=this.getResultSelection(g,a),f?(c&&this.shiftClickResult(f,g,a),f&&this.fBeforeSelectCallback?(this.fBeforeSelectCallback(f,function(a){a&&(d.itemSelected(f),e=0===d.iTimer?50:150,0!==d.iTimer&&b.clearTimeout(d.iTimer),d.iTimer=b.setTimeout(function(){d.iTimer=0,d.onSelect(f,!1)},e))}),this.scrollToSelected()):(this.itemSelected(f),e=0===this.iTimer?50:150,0!==this.iTimer&&b.clearTimeout(this.iTimer),this.iTimer=b.setTimeout(function(){d.iTimer=0,d.onSelect(f)},e),this.scrollToSelected())):g&&c&&-1<Mb.inArray(a,[this.KeyUp,this.KeyDown,this.KeyLeft,this.KeyRight,Lb.Key.PageUp,Lb.Key.PageDown,Lb.Key.Home,Lb.Key.End])&&g.checked(!g.checked())},l.prototype.onKeydown=function(a){var b=!0,c=0;return this.useKeyboardKeys()&&a&&!Mb.isTextFieldFocused()&&(c=a.keyCode,a.ctrlKey||this.KeyUp!==c&&this.KeyDown!==c&&this.KeyLeft!==c&&this.KeyRight!==c&&Lb.Key.PageUp!==c&&Lb.Key.PageDown!==c&&Lb.Key.Home!==c&&Lb.Key.End!==c?Lb.Key.Del!==c||a.ctrlKey||a.shiftKey?Lb.Key.Enter===c?0<this.list().length&&!a.ctrlKey&&(this.onEnter(this.itemSelected()),b=!1):!a.ctrlKey||a.altKey||a.shiftKey||Lb.Key.a!==c||(this.checkAll(!(this.checkAll()&&!this.isIncompleteChecked())),b=!1):0<this.list().length&&(this.onDelete(),b=!1):(this.clickNewSelectPosition(c,a.shiftKey),b=!1)),b},l.prototype.onDelete=function(){this.fDeleteCallback.call(this,this.listCheckedOrSelected()),this.itemSelected(null),this.listChecked(!1)},l.prototype.onEnter=function(a){var b=this;a&&this.fBeforeSelectCallback?this.fBeforeSelectCallback(a,function(c){c&&(b.itemSelected(a),b.fEnterCallback.call(this,a))}):(this.itemSelected(a),this.fEnterCallback.call(this,a))},l.prototype.selectionFunc=function(a){this.itemSelected(null),this.bResetCheckedOnClick&&this.listChecked(!1),this.itemSelected(a),this.fSelectCallback.call(this,a)},l.prototype.onSelect=function(a,b){if(b=Mb.isUnd(b)?!0:!!b,this.fBeforeSelectCallback&&b){var c=this;this.fBeforeSelectCallback(a,function(b){b&&c.selectionFunc(a)})}else this.selectionFunc(a)},l.prototype.onDblClick=function(a){this.fDblClickCallback.call(this,a)},l.prototype.koCheckAll=function(){return c.computed({read:this.checkAll,write:this.checkAll,owner:this})},l.prototype.koCheckAllIncomplete=function(){return c.computed({read:this.isIncompleteChecked,write:this.isIncompleteChecked,owner:this})},l.prototype.scrollToSelected=function(){if(!this.oListScope||!this.oScrollScope)return!1;var b=20,c=a(this.sSelectabelSelector,this.oScrollScope),d=c.position(),e=this.oListScope.height(),f=c.outerHeight();return d&&(d.top<0||d.top+f>e)?(d.top<0?this.oScrollScope.scrollTop(this.oScrollScope.scrollTop()+d.top-b):this.oScrollScope.scrollTop(this.oScrollScope.scrollTop()+d.top-e+f+b),!0):!1},m.prototype.openComposeMessage=function(a){Ob.Routing.setHash(Ob.Links.composeWithToField(a))},m.prototype.downloadByUrl=function(c){var d=null;Wb?b.open(c):(d=a('<iframe style="display: none;"></iframe>').appendTo(document.body),d.attr("src",c),setTimeout(function(){d.remove()},6e4))},m.prototype.showLoading=function(a){Ob.Screens.showLoading(a)},m.prototype.hideLoading=function(){Ob.Screens.hideLoading()},m.prototype.showReport=function(a,b){Ob.Screens.showReport(a,b)},m.prototype.showError=function(a,b,c,d){Ob.Screens.showError(a,b,c,d)},m.prototype.hideError=function(a){Ob.Screens.hideError(a)},m.prototype.showErrorByCode=function(a,b){var c=a.ErrorCode,d=a.ErrorMessage||"";switch(""!==d&&(d=" ("+d+")"),c){case Lb.Errors.AuthError:this.showError(Mb.i18n("WARNING/LOGIN_PASS_INCORRECT")+d);break;case Lb.Errors.DemoLimitations:this.showError(Mb.i18n("DEMO/WARNING_THIS_FEATURE_IS_DISABLED")+d);break;case Lb.Errors.Captcha:this.showError(Mb.i18n("WARNING/CAPTCHA_IS_INCORRECT")+d);break;case Lb.Errors.CanNotGetMessage:this.showError(Mb.i18n("MESSAGE/ERROR_MESSAGE_DELETED")+d);break;case Lb.Errors.CanNotChangePassword:this.showError(Mb.i18n("WARNING/UNABLE_CHANGE_PASSWORD")+d);break;case Lb.Errors.AccountOldPasswordNotCorrect:this.showError(Mb.i18n("WARNING/CURRENT_PASSWORD_NOT_CORRECT")+d);break;case Lb.Errors.FetcherIncServerNotAvailable:this.showError(Mb.i18n("WARNING/FETCHER_SAVE_ERROR")+d);break;case Lb.Errors.FetcherLoginNotCorrect:this.showError(Mb.i18n("WARNING/FETCHER_SAVE_ERROR")+d);break;case Lb.Errors.HelpdeskUserNotExists:this.showError(Mb.i18n("HELPDESK/ERROR_FORGOT_NO_ACCOUNT")+d);break;case Lb.Errors.MailServerError:this.showError(Mb.i18n("WARNING/CANT_CONNECT_TO_SERVER")+d);break;case Lb.Errors.DataTransferFailed:this.showError(Mb.i18n("WARNING/DATA_TRANSFER_FAILED")+d);break;case Lb.Errors.NotDisplayedError:a.ErrorMessage&&""!==a.ErrorMessage&&this.showError(a.ErrorMessage);break;default:b&&b.length>0?this.showError(b+d):a.ErrorMessage&&""!==a.ErrorMessage&&this.showError(a.ErrorMessage)}},Pb.addScreenToHeader=function(a,b,c,d,e){Ob.addScreenToHeader(a,b,c,d,e)},Pb.aSettingsTabs=[],Pb.addSettingsTab=function(a){a.prototype.TabName&&(Lb.SettingsTab[a.prototype.TabName]=a.prototype.TabName,Pb.aSettingsTabs.push(a))},Pb.getPluginsSettingsTabs=function(){return Pb.aSettingsTabs},Pb.getSetting=function(a){return Qb.App[a]},Pb.getPluginSettings=function(a){return Qb&&Qb.Plugins?Qb.Plugins[a]:null},Pb.oPluginHooks={},Pb.addPluginHook=function(b,c){Mb.isFunc(c)&&(a.isArray(this.oPluginHooks[b])||(this.oPluginHooks[b]=[]),this.oPluginHooks[b].push(c))},Pb.runPluginHook=function(b,c){a.isArray(this.oPluginHooks[b])&&(c=c||[],_.each(this.oPluginHooks[b],function(a){a.apply(null,c)}))},Pb.sendAjaxRequest=function(a,b,c){Ob.Ajax.send(a,b,c)},Pb.i18n=Mb.i18n,Pb.getArrayRecipients=Mb.getArrayRecipients,Pb.getEmailParts=Mb.getEmailParts,Pb.showAlertPopup=function(a){Ob.Screens.showPopup(s,[a])},Pb.showConfirmPopup=function(a,b){Ob.Screens.showPopup(t,[a,b])},Pb.showReport=function(a,b){Ob.Screens.showReport(a,b)},Pb.showError=function(a){Ob.Screens.showError(a)},n.prototype.setData=function(a,b){Data.setVar(a,b)},n.prototype.removeData=function(a){Data.setVar(a,"")},n.prototype.getData=function(a){return Data.getVar(a)},n.prototype.hasData=function(a){return Data.hasVar(a)},o.prototype.init=function(){a.ajaxSettings.cache=!0,this.provider=new r},o.prototype.log=function(){},o.prototype.call=function(a){this.provider.call(a),this.action("outgoing")},o.prototype.answer=function(){this.action("incoming_connect"),this.provider.answer(),this.removeCallFromMissed(),this.hideAll()},o.prototype.hangup=function(){this.action("online"),this.provider.hangup(),this.removeCallFromMissed(),this.hideAll()},o.prototype.hideAll=function(){var a=this;Ob.Screens.hidePopup(A),Ob.desktopNotify("hide"),this.timer("stop"),setTimeout(function(){a.phoneReport("")},2e3)},o.prototype.reconnect=function(a,b){var c,d=this;clearInterval(this.reconnectInterval),arguments.length&&(c=a,this.reconnectInterval=setInterval(function(){c>0?d.phoneReport(Mb.i18n("Reconnect in "+c+" seconds")):0>=c&&(d.phoneReport(Mb.i18n("Connecting...")),clearInterval(d.reconnectInterval),c=a,b()),c--},1e3))},o.prototype.timer=function(a){var b=this,c=0,d=0,e=function(a){var b=a.toString();return 1===b.length?b="0"+b:b};"start"===a?this.timerInterval=setInterval(function(){60===c&&(c=0,d++),b.phoneReport(Mb.i18n("PHONE/PASSED_TIME")+" "+e(d)+":"+e(c)),c++},1e3):"stop"===a&&clearInterval(this.timerInterval)},o.prototype.showError=function(a){1===Mb.pInt(a)&&Ob.Api.showError(Mb.i18n("PHONE/ERROR_SERVER_UNAVAILABLE"),!1,!0)},o.prototype.hideError=function(){Ob.Api.hideError()},o.prototype.showPopup=function(a){Ob.Screens.showPopup(A,[a])},o.prototype.hidePopup=function(){Ob.Screens.hidePopup(A)},o.prototype.phoneSupport=function(a,b){var c=function(){try{try{var a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");try{a.AllowScriptAccess="always"}catch(b){return"6,0,0"}}catch(b){}return new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version").replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(b){try{if(navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin)return(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]).description.replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(c){}}return"0,0,0"};!a||Ob.browser.chrome||b||Ub?Ub?this.phoneReport("Device not supported"):b&&"0,0,0"===c()?this.phoneReport("Please install flash player"):b&&c()<b&&this.phoneReport("Please reinstall flash player"):this.phoneReport("Browser not supported")},o.prototype.incomingCall=function(b){var c=this,d={Action:"ContactSuggestions",Search:b,PhoneOnly:"1"},e=function(a){c.phoneReport(Mb.i18n("PHONE/INCOMING_CALL_FROM")+" "+a),c.showPopup({Action:Lb.PhoneAction.Incoming,PhoneNumber:a}),Ob.desktopNotify("show",a+" calling...","Click here to answer.\r\n To drop the call, click End in the web interface.","",c.answer.bind(c))};this.action("incoming"),b&&Ob.Ajax.send(d,function(c){if(c&&c.Result&&c.Result.List&&c.Result.List[0]){var d="";a.each(c.Result.List[0].Phones,function(a,f){var g=c.Result.List[0],h=/[()\s_\-]/g,i=b.replace(h,""),j=f.replace(h,"");return i===j?(d=""===g.Name?g.Email+" "+f:g.Name+" "+f,e(d),!1):void 0},this),""===d&&e(b)}else e(b)},this),this.missedCalls.push({time:moment().hour()+":"+moment().minute(),label:b,value:b,direction:"incoming"}),this.contactFind(b)},o.prototype.removeCallFromMissed=function(a){a?this.missedCalls(_.reject(this.missedCalls(),function(b){return b===a.label})):this.missedCalls.pop()},o.prototype.contactFind=function(a){var b={Action:"ContactSuggestions",Search:a,PhoneOnly:"1"},c={};a=Mb.trim(a),a&&""!==a&&Ob.Ajax.send(b,function(b){var d=!1;b&&b.Result&&b.Result.List&&(_.each(b.Result.List,function(b){d||_.each(b.Phones,function(e){e===a&&(c={label:""===b.Name?b.Email:b.Name,value:e},d=!0)},this)},this),d&&!_.isEmpty(c)&&this.contactFound(c))},this)},o.prototype.contactFound=function(a){var b=_.last(this.missedCalls());b.label=a.label,b.value=a.value},p.prototype.init=function(){var b=this;a.getScript("static/js/sipml.js",function(a,c){"success"===c&&(b.voiceApp(!0),SIPml.setDebugLevel("fatal"),SIPml.init(b.createStackBinded,b.createStackErrorBinded))})},p.prototype.setConfigs=function(){this.stackConf({realm:Qb.User.VoiceRealm,impi:Qb.User.VoiceImpi,impu:"sip:"+Qb.User.VoiceImpi+"@"+Qb.User.VoiceRealm,password:Qb.User.VoicePassword,enable_rtcweb_breaker:!0,websocket_proxy_url:Qb.User.VoiceWebsocketProxyUrl,events_listener:{events:"*",listener:this.eventSessionBinded}}),this.registerConf({audio_remote:this.audioRemote,expires:3600,events_listener:{events:"*",listener:this.eventSessionBinded},sip_caps:[{name:"+g.oma.sip-im",value:null},{name:"+audio",value:null},{name:"language",value:'"en,fr"'}]}),this.hangupConf({events_listener:{events:"*",listener:this.eventSessionBinded}})},p.prototype.createStackError=function(){this.log("Failed to initialize the engine")},p.prototype.log=function(){},p.prototype.createStack=function(){this.stack(new SIPml.Stack(this.stackConf())),this.stack().start()},p.prototype.register=function(){this.registerSession(this.stack().newSession("register",this.registerConf())),this.registerSession().register()},p.prototype.call=function(a){this.isStarted()?(this.action("outgoing"),this.callSession(this.stack().newSession("call-audio",this.registerConf())),this.callSession().call(a),this.log(this.callSession().getRemoteFriendlyName())):(this.hasFatalError(!1),this.createStack())},p.prototype.answer=function(){this.callSession()&&this.callSession().accept(this.registerConf())},p.prototype.hangup=function(){this.callSession()&&this.callSession().hangup(this.hangupConf())},p.prototype.eventSession=function(a){this.log(a.type+" ("+a.description+")");var b=a.type;switch(b){case"starting":break;case"started":this.phone.hideError(),this.isStarted(!0),this.register();break;case"stopping":case"stopped":this.isStarted(!1),this.createStack();break;case"failed_to_stop":break;case"failed_to_start":this.isStarted(!1),this.phone.reconnect(30,this.createStack.bind(this));break;case"connecting":break;case"connected":this.phoneReport(Mb.i18n("PHONE/CONNECTED")),"In call"===a.description&&Ob.desktopNotify("hide");break;case"terminating":this.phoneReport(Mb.i18n("PHONE/CALL_TERMINATING")),_.delay(_.bind(function(){this.action("")},this),1500);break;case"terminated":this.phoneReport(Mb.i18n("PHONE/TERMINATED")),"Disconnected"===a.description&&this.createStack();break;case"i_ao_request":this.phoneReport(Mb.i18n("PHONE/RINGING"));break;case"media_added":break;case"media_removed":break;case"i_request":break;case"o_request":break;case"sent_request":break;case"cancelled_request":break;case"i_new_call":this.callSession(a.newSession),this.action("incoming"),this.phone.showPopup({Action:Lb.PhoneAction.Incoming,PhoneNumber:this.callSession().getRemoteFriendlyName()});break;case"i_new_message":break;case"m_permission_requested":break;case"m_permission_accepted":"incoming"===this.action()?this.phoneReport(Mb.i18n("PHONE/INCOMING_CALL_FROM")+" "+this.callSession().getRemoteFriendlyName()):this.phoneReport(Mb.i18n("PHONE/CALL_IN_PROGRESS"));break;case"m_permission_refused":break;case"transport_error":break;case"global_error":break;case"message_error":break;case"webrtc_error":}},q.prototype.init=function(){var b=this;a.getScript("static/js/swfobject.js",function(a,c){"success"===c&&(b.voiceApp(!0),swfobject.embedSWF("static/freeswitch.swf","flash","214","137","9.0.0","expressInstall.swf",{rtmp_url:"rtmp://217.199.220.26/phone"},{allowScriptAccess:"always",bgcolor:"#ece9e0"},[],!1),b.callbacks())})},q.prototype.log=function(){},q.prototype.showPrivacy=function(){this.phone.showPopup({Action:Lb.PhoneAction.Settings,Callback:this.launchFlash.bind(this)});var b=a("#fake_flash"),c=b.offset(),d=b.width();this.jqFlash.css("left",c.left+d/2-107),this.jqFlash.css("top",c.top),this.jqFlash.css("visibility","visible"),this.flash.showPrivacy()},q.prototype.checkMic=function(){return this.flash.isMuted()},q.prototype.login=function(a,b){this.flash.login(a,b)},q.prototype.newCall=function(){},q.prototype.call=function(){this.flash.makeCall("sip:7002@217.199.220.24","7003@217.199.220.26",[])},q.prototype.answer=function(a){this.flash.answer(a)},q.prototype.hangup=function(a){this.flash.hangup(a)},q.prototype.addCall=function(){},q.prototype.launchFlash=function(){this.jqFlash.css("top","-200px")},q.prototype.callbacks=function(){var c=this;b.onInit=function(){c.log("**************** onInit"),c.initStatus(!0)},b.onConnected=function(b){c.log("**************** onConnected ("+b+")"),c.connectStatus(!0),c.sessionid(b),c.jqFlash=a("#flash"),c.flash=c.jqFlash[0],c.checkMic()&&c.showPrivacy(),c.login("7003@217.199.220.26","7003voippassword")},b.onDisconnected=function(){c.log("**************** onDisconnected")},b.onEvent=function(a){c.log("**************** onEvent ("+a+")")},b.onLogin=function(a,b,d){c.log("**************** onLogin ("+a+", "+b+", "+d+")")},b.onLogout=function(a,b){c.log("**************** onLogout ("+a+", "+b+")")},b.onMakeCall=function(a,b,d){c.log("**************** onMakeCall ("+a+", "+b+", "+d+")")},b.onHangup=function(a,b){c.log("**************** onHangup ("+a+", "+b+")")},b.onIncomingCall=function(a,b,d,e,f){c.log("**************** onIncomingCall ("+a+", "+b+", "+d+", "+e+", "+f+")"),c.addCall(a,b,d)},b.onDisplayUpdate=function(a,b,d){c.log("**************** onDisplayUpdate ("+a+", "+b+", "+d+")")},b.onCallState=function(a,b){c.log("**************** onCallState ("+a+", "+b+")"),c.callState(b)},b.onDebug=function(a){c.log("**************** onDebug ("+a+")")},b.onAttach=function(a){c.log("**************** onAttach ("+a+")")}},r.prototype.init=function(){Ob.Ajax.send({Action:"GetTwilioToken"},this.onTokenResponse,this)},r.prototype.onTokenResponse=function(b){var c=0,d=this;b&&b.Result&&(a.ajaxSettings.cache=!0,a.getScript("//static.twilio.com/libs/twiliojs/1.1/twilio.min.js",function(a,e){"success"===e?d.setupDevice(b.Result):d.phoneReport("Unknown error"),clearTimeout(c)}),c=setTimeout(function(){d.init()},1e4))},r.prototype.setupDevice=function(a){var b=this;this.phone.phoneSupport(!1,"10,1,000"),this.device=Twilio.Device,this.device.setup(a,{}),this.device.ready(function(a){b.phone.log("**************** ready ",a),b.voiceApp(!0),b.phone.action("online"),b.phoneReport("")}),this.device.offline(function(a){b.phone.log("**************** offline ",a),b.phone.action("offline")}),this.device.error(function(a){b.phone.log("**************** error ",a),b.phone.action("offline")}),this.device.connect(function(a){b.phone.log("**************** connect ",a),b.phone.timer("start")}),this.device.disconnect(function(a){b.phone.log("**************** disconnect ",a),b.phone.hideAll(),b.phone.action("online")}),this.device.incoming(function(a){b.phone.log("**************** incoming ",a),b.connection=a,b.phone.incomingCall(a.parameters.From)}),this.device.cancel(function(a){b.phone.log("**************** cancel ",a),b.phone.hideAll(),b.phone.action("online")}),this.device.presence(function(a){b.phone.log("**************** presence ",a)})},r.prototype.call=function(a){var b={PhoneNumber:a,Direction:"outbound"};this.connection=this.device.connect(b)},r.prototype.answer=function(){this.phoneReport("Incoming: "+this.connection.parameters.From),this.connection.accept()},r.prototype.hangup=function(){"pending"===this.connection.status()?this.connection.reject():this.connection.disconnect(),"closed"!==this.connection.status()&&_.delay(_.bind(function(){this.hangup()},this),1e3)},s.prototype.onShow=function(a,b,c,d){this.alertDesc(a),this.closeCallback=b||null,this.title(c||""),this.okButtonText(d||Mb.i18n("MAIN/BUTTON_OK"))},s.prototype.popupTemplate=function(){return"Popups_AlertPopupViewModel"},s.prototype.onEnterHandler=function(){this.close()},s.prototype.close=function(){Mb.isFunc(this.closeCallback)&&this.closeCallback(),this.closeCommand()},t.prototype.onShow=function(a,b,c,d,e){this.title(c||""),this.okButtonText(d||Mb.i18n("MAIN/BUTTON_OK")),this.cancelButtonText(e||Mb.i18n("MAIN/BUTTON_CANCEL")),Mb.isFunc(b)&&(this.fConfirmCallback=b,this.confirmDesc(a))},t.prototype.popupTemplate=function(){return"Popups_ConfirmPopupViewModel"},t.prototype.onEnterHandler=function(){this.yesClick()},t.prototype.yesClick=function(){this.fConfirmCallback&&this.fConfirmCallback(!0),this.closeCommand()},t.prototype.noClick=function(){this.fConfirmCallback&&this.fConfirmCallback(!1),this.closeCommand()},u.prototype.popupTemplate=function(){return"Popups_AccountCreatePopupViewModel"},u.prototype.onShow=function(){this.friendlyNameFocus(!0),this.init()},u.prototype.init=function(){this.isFirstStep(!0),this.friendlyName(""),this.email(""),this.incomingMailLogin(""),this.incomingLoginFocused(!1),this.incomingMailPassword(""),this.incomingMailPort(143),this.incomingMailServer(""),this.outgoingMailLogin(""),this.outgoingMailPassword(""),this.outgoingMailPort(25),this.outgoingMailServer(""),this.outServerFocused(!1),this.useSmtpAuthentication(!0)},u.prototype.onFirstSaveClick=function(){if(!this.isEmptyFirstFields()){var a={Action:"EmailDomainData",Email:this.email()};this.loading(!0),Ob.Ajax.send(a,this.onEmailDomainDataResponse,this)}},u.prototype.onSecondSaveClick=function(){if(!this.isEmptySecondFields()){var a={Action:"AccountCreate",AccountID:this.editedAccountId(),FriendlyName:this.friendlyName(),Email:this.email(),IncomingMailLogin:this.incomingMailLogin(),IncomingMailPassword:this.incomingMailPassword(),IncomingMailServer:this.incomingMailServer(),IncomingMailPort:parseInt(this.incomingMailPort(),10),OutgoingMailServer:this.outgoingMailServer(),OutgoingMailLogin:this.outgoingMailLogin(),OutgoingMailPassword:this.outgoingMailPassword(),OutgoingMailPort:parseInt(this.outgoingMailPort(),10),OutgoingMailAuth:this.useSmtpAuthentication()?2:0};this.loading(!0),Ob.Ajax.send(a,this.onAccountCreateResponse,this)}},u.prototype.onCancelClick=function(){this.closeCommand(),this.init()},u.prototype.onEmailDomainDataResponse=function(a){this.loading(!1),this.incomingMailLogin(this.email()),this.isFirstStep(!1),a.Result&&(this.incomingMailPort(a.Result.IncomingMailPort),this.incomingMailServer(a.Result.IncomingMailServer),this.outgoingMailPort(a.Result.OutgoingMailPort),this.outgoingMailServer(a.Result.OutgoingMailServer))},u.prototype.onAccountCreateResponse=function(a,b){if(this.loading(!1),a.Result){var c=new D,d=parseInt(a.Result,10);c.init(d,b.Email,b.FriendlyName),c.updateExtended(b),Qb.Accounts.addAccount(c),Qb.Accounts.changeEditedAccount(d),this.closeCommand(),this.init()}else Ob.Api.showErrorByCode(a,Mb.i18n("WARNING/CREATING_ACCOUNT_ERROR")),this.isFirstStep(!0)},u.prototype.isEmptyFirstFields=function(){switch(""){case this.friendlyName():return this.friendlyNameFocus(!0),!0;case this.email():return this.emailFocus(!0),!0;case this.incomingMailPassword():return this.incomingMailFocus(!0),!0;default:return!1}},u.prototype.isEmptySecondFields=function(){switch(""){case this.incomingMailLogin():return this.incomingLoginFocused(!0),!0;case this.incomingMailServer():return this.incomingServerFocused(!0),!0;case this.outgoingMailServer():return this.outServerFocused(!0),!0;default:return!1}},v.prototype.popupTemplate=function(){return"Popups_AccountCreateIdentityPopupViewModel"},v.prototype.onShow=function(a){var b=new I;b.accountId(a),this.oIdentityPropertiesViewModel.populate(b)},v.prototype.cancel=function(){this.closeCommand()},w.prototype.popupTemplate=function(){return"Popups_FetcherAddPopupViewModel"},w.prototype.onShow=function(){this.incomingMailServer(""),this.incomingMailPort(110),this.incomingMailLogin(""),this.incomingMailPassword(""),this.folder(""),this.outgoingMailServer(""),this.outgoingMailPort(25),this.leaveMessagesOnServer(!0)},w.prototype.onSaveClick=function(){if(this.isEmptyRequiredFields())Ob.Api.showError(Mb.i18n("WARNING/FETCHER_CREATE_ERROR"));else{var a={Action:"FetcherCreate",AccountID:this.defaultAccountId(),Folder:this.folder(),IncomingMailServer:this.incomingMailServer(),IncomingMailPort:parseInt(this.incomingMailPort(),10),IncomingMailLogin:this.incomingMailLogin(),IncomingMailPassword:""===this.incomingMailPassword()?"******":this.incomingMailPassword(),LeaveMessagesOnServer:this.leaveMessagesOnServer()?1:0};this.loading(!0),Ob.Ajax.send(a,this.onAddFetcherResponse,this)}},w.prototype.onAddFetcherResponse=function(a){this.loading(!1),a.Result?(Qb.Accounts.populateFetchers(),this.closeCommand()):Ob.Api.showErrorByCode(a)},w.prototype.onCancelClick=function(){this.closeCommand()},w.prototype.isEmptyRequiredFields=function(){switch(""){case this.incomingMailServer():return this.serverIsSelected(!0),!0;case this.incomingMailLogin():return this.loginIsSelected(!0),!0;case this.incomingMailPassword():return this.passwordIsSelected(!0),!0;default:return!1}},w.prototype.onAddNewFolderClick=function(){Ob.Screens.showPopup(y)},x.prototype.onShow=function(){var a=Ob.MailCache.editedFolderList();this.sSentFolderOld=a.sentFolderFullName(),this.sDraftFolderOld=a.draftsFolderFullName(),this.sSpamFolderOld=a.spamFolderFullName(),this.sTrashFolderOld=a.trashFolderFullName(),this.folders(a),this.sentFolderFullName(this.sSentFolderOld),this.draftsFolderFullName(this.sDraftFolderOld),this.spamFolderFullName(this.sSpamFolderOld),this.trashFolderFullName(this.sTrashFolderOld)},x.prototype.popupTemplate=function(){return"Popups_FolderSystemPopupViewModel"},x.prototype.onResponseSetupSystemFolders=function(a){a&&a.Result!==!1&&Ob.MailCache.getFolderList(Qb.Accounts.editedId())},x.prototype.onOKClick=function(){var a=this.folders(),b={Action:"SetupSystemFolders",AccountID:Qb.Accounts.editedId(),Sent:a.sentFolderFullName(),Drafts:a.draftsFolderFullName(),Trash:a.trashFolderFullName(),Spam:a.spamFolderFullName()};Ob.Ajax.send(b,this.onResponseSetupSystemFolders,this),this.closeCommand()},x.prototype.onCancelClick=function(){var a=this.folders();a.sentFolderFullName(this.sSentFolderOld),a.draftsFolderFullName(this.sDraftFolderOld),a.spamFolderFullName(this.sSpamFolderOld),a.trashFolderFullName(this.sTrashFolderOld),this.closeCommand()},y.prototype.popupTemplate=function(){return"Popups_FolderCreatePopupViewModel"},y.prototype.onShow=function(){this.folderNameFocus(!0)},y.prototype.onHide=function(){this.parentFolder=c.observable(""),this.folderName=c.observable("")},y.prototype.onResponseFolderCreate=function(a){this.loading(!1),a.Result?(this.folderName(""),this.parentFolder(""),Ob.MailCache.getFolderList(Qb.Accounts.editedId()),this.closeCommand()):Ob.Api.showErrorByCode(a,Mb.i18n("SETTINGS/ACCOUNT_FOLDERS_CANT_CREATE_FOLDER"))},y.prototype.onOKClick=function(){var a=""===this.parentFolder()?this.namespace():this.parentFolder(),b={Action:"FolderCreate",AccountID:Qb.Accounts.editedId(),FolderNameInUtf8:this.folderName(),FolderParentFullNameRaw:a,Delimiter:this.folders().delimiter()};this.loading(!0),Ob.Ajax.send(b,this.onResponseFolderCreate,this)},y.prototype.onCancelClick=function(){this.closeCommand()},z.prototype.onShow=function(a){this.isHelpdesk(a),this.init()},z.prototype.popupTemplate=function(){return"Popups_ChangePasswordPopupViewModel"},z.prototype.init=function(){this.currentPassword(""),this.newPassword(""),this.confirmPassword("")},z.prototype.onResponse=function(a){a.Result===!1?Ob.Api.showErrorByCode(a,Mb.i18n("SETTINGS/ACCOUNT_PROPERTIES_NEW_PASSWORD_UPDATE_ERROR")):(Ob.Api.showReport(Mb.i18n("SETTINGS/ACCOUNT_PROPERTIES_CHANGE_PASSWORD_SUCCESS")),this.closeCommand(),this.init())},z.prototype.onOKClick=function(){var a=null;this.confirmPassword()!==this.newPassword()?Ob.Api.showError(Mb.i18n("WARNING/PASSWORDS_DO_NOT_MATCH")):this.isHelpdesk()?(a={Action:"HelpdeskUpdateUserPassword",CurrentPassword:this.currentPassword(),NewPassword:this.newPassword()},Ob.Ajax.sendExt(a,this.onResponse,this)):(a={Action:"UpdateAccountPassword",AccountID:Qb.Accounts.editedId(),CurrentIncomingMailPassword:this.currentPassword(),NewIncomingMailPassword:this.newPassword()},Ob.Ajax.send(a,this.onResponse,this))},z.prototype.onCancelClick=function(){this.closeCommand()},A.prototype.popupTemplate=function(){return"Popups_PhonePopupViewModel"},A.prototype.onShow=function(a){this.action(a.Action||""),this.phoneNumber(a.PhoneNumber||""),this.callback=a.Callback||null},A.prototype.onCancelClick=function(){this.phone.hidePopup()},A.prototype.onOKClick=function(){this.phone.hidePopup(),this.callback&&this.callback()},A.prototype.answer=function(){this.phone.answer()},A.prototype.hangup=function(){this.phone.hangup()},B.prototype.parse=function(a){this.AllowUsersChangeInterfaceSettings=!!a.AllowUsersChangeInterfaceSettings,this.AllowUsersChangeEmailSettings=!!a.AllowUsersChangeEmailSettings,this.AllowUsersAddNewAccounts=Mb.isUnd(a.AllowUsersAddNewAccounts)?this.AllowUsersChangeEmailSettings:!!a.AllowUsersAddNewAccounts,this.SiteName=Mb.pString(a.SiteName),this.Languages=a.Languages,this.Themes=a.Themes,this.DateFormats=a.DateFormats,this.AttachmentSizeLimit=Mb.pInt(a.AttachmentSizeLimit),this.ImageUploadSizeLimit=Mb.pInt(a.ImageUploadSizeLimit),this.FileSizeLimit=Mb.pInt(a.FileSizeLimit),this.AutoSave=!!a.AutoSave,this.IdleSessionTimeout=Mb.pInt(a.IdleSessionTimeout),this.AllowInsertImage=!!a.AllowInsertImage,this.AllowBodySize=!!a.AllowBodySize,this.MaxBodySize=Mb.pInt(a.MaxBodySize),this.MaxSubjectSize=Mb.pInt(a.MaxSubjectSize),this.AllowPrefetch=!!a.AllowPrefetch,this.LoginFormType=Mb.pInt(a.LoginFormType),this.LoginSignMeType=Mb.pInt(a.LoginSignMeType),this.LoginAtDomainValue=Mb.pString(a.LoginAtDomainValue),this.DemoWebMail=!!a.DemoWebMail,this.DemoWebMailLogin=Mb.pString(a.DemoWebMailLogin),this.DemoWebMailPassword=Mb.pString(a.DemoWebMailPassword),this.GoogleAnalyticsAccount=a.GoogleAnalyticsAccount,this.ShowQuotaBar=!!a.ShowQuotaBar,this.ServerUseUrlRewrite=!!a.ServerUseUrlRewrite,this.AllowLanguageOnLogin=!Sb&&!!a.AllowLanguageOnLogin,this.FlagsLangSelect=!!a.FlagsLangSelect,this.DefaultLanguage=Mb.pString(a.DefaultLanguage),this.LoginDescription=Mb.pString(a.LoginDescription),this.CustomLoginUrl=Mb.pString(a.CustomLoginUrl),this.CustomLogoutUrl=Mb.pString(a.CustomLogoutUrl),this.IosDetectOnLogin=!!a.IosDetectOnLogin,this.AllowFilesSharing=!!a.AllowFilesSharing,this.AllowContactsSharing=!!a.AllowContactsSharing,""!==a.DefaultLanguageShort&&(this.DefaultLanguageShort=a.DefaultLanguageShort)},C.prototype.getSaveMailInSentItems=function(){var a=!0;switch(this.SaveMail){case Lb.SaveMail.Unchecked:a=!1;break;case Lb.SaveMail.Checked:case Lb.SaveMail.Hidden:a=!0}return a},C.prototype.getUseSaveMailInSentItems=function(){var a=!1;switch(this.SaveMail){case Lb.SaveMail.Unchecked:case Lb.SaveMail.Checked:a=!0;break;case Lb.SaveMail.Hidden:a=!1}return a},C.prototype.parse=function(a){var b=null;null!==a&&(this.IdUser=Mb.pInt(a.IdUser),this.MailsPerPage=Mb.pInt(a.MailsPerPage),this.ContactsPerPage=Mb.pInt(a.ContactsPerPage),this.AutoCheckMailInterval=Mb.pInt(a.AutoCheckMailInterval),this.DefaultEditor=Mb.pInt(a.DefaultEditor),this.Layout=Mb.pInt(a.Layout),this.DefaultTheme=Mb.pString(a.DefaultTheme),this.DefaultLanguage=Mb.pString(a.DefaultLanguage),this.DefaultDateFormat=Mb.pString(a.DefaultDateFormat),this.defaultTimeFormat(Mb.pInt(a.DefaultTimeFormat)),this.ThreadsEnabled=!!a.ThreadsEnabled,this.useThreads(!!a.UseThreads),this.SaveRepliedToCurrFolder=!!a.SaveRepliedMessagesToCurrentFolder,this.AllowCompose=!!a.AllowCompose,this.AllowReply=!!a.AllowReply,this.AllowForward=!!a.AllowForward,this.SaveMail=Mb.pInt(a.SaveMail),this.AllowFetcher=!!a.AllowFetcher,this.OutlookSyncEnable=!!a.OutlookSyncEnable,this.MobileSyncEnable=!!a.MobileSyncEnable,this.ShowPersonalContacts=!!a.ShowPersonalContacts,this.ShowGlobalContacts=!!a.ShowGlobalContacts,this.ShowContacts=this.ShowPersonalContacts||this.ShowGlobalContacts,this.IsFilesSupported=!!a.IsFilesSupported&&!Sb,this.IsHelpdeskSupported=!!a.IsHelpdeskSupported&&!Sb,this.IsHelpdeskAgent=!!a.IsHelpdeskAgent,this.LastLogin=Mb.pInt(a.LastLogin),this.AllowCalendar=!!a.AllowCalendar&&!Sb,this.CalendarSharing=!!a.CalendarSharing,this.CalendarAppointments=!!a.CalendarAppointments,this.IsDemo=!!a.IsDemo,this.AllowVoice=!!a.AllowVoice,this.VoiceRealm=a.VoiceRealm,this.VoiceWebsocketProxyUrl=a.VoiceWebsocketProxyUrl,this.VoiceOutboundProxyUrl=a.VoiceOutboundProxyUrl,this.VoiceCallerID=a.VoiceCallerID,this.VoiceImpi=a.VoiceImpi,this.VoiceImpu=a.VoiceImpu,this.VoicePassword=a.VoicePassword,this.VoiceProvider=a.VoiceRealm,this.AllowHelpdeskNotifications=a.AllowHelpdeskNotifications,b=a.Calendar,b&&(this.CalendarShowWeekEnds=!!b.ShowWeekEnds,this.CalendarShowWorkDay=!!b.ShowWorkDay,this.CalendarWorkDayStarts=Mb.pInt(b.WorkDayStarts),this.CalendarWorkDayEnds=Mb.pInt(b.WorkDayEnds),this.CalendarWeekStartsOn=Mb.pInt(b.WeekStartsOn),this.CalendarDefaultTab=Mb.pInt(b.DefaultTab)))},C.prototype.updateCommonSettings=function(a,b,c,d,e,f,g,h,i,j,k){(this.DefaultTheme!==f||this.DefaultLanguage!==g||this.DefaultDateFormat!==h||this.defaultTimeFormat()!==i)&&this.needToReloadCalendar(!0),this.MailsPerPage=a,this.ContactsPerPage=b,this.AutoCheckMailInterval=c,Ob.MailCache.setAutocheckmailTimer(),this.DefaultEditor=d,this.Layout=e,this.DefaultTheme=f,this.DefaultLanguage=g,this.DefaultDateFormat=h,this.defaultTimeFormat(i),this.useThreads("1"===j),this.SaveRepliedToCurrFolder="1"===k},C.prototype.updateCalendarSettings=function(a,b,c,d,e,f){(this.CalendarShowWeekEnds!==a||this.CalendarShowWorkDay!==b||this.CalendarWorkDayStarts!==c||this.CalendarWorkDayEnds!==d||this.CalendarWeekStartsOn!==e||this.CalendarDefaultTab!==f)&&this.needToReloadCalendar(!0),this.CalendarShowWeekEnds=a,this.CalendarShowWorkDay=b,this.CalendarWorkDayStarts=c,this.CalendarWorkDayEnds=d,this.CalendarWeekStartsOn=e,this.CalendarDefaultTab=f},C.prototype.updateHelpdeskSettings=function(a){this.AllowHelpdeskNotifications=a},C.prototype.isNeedToReloadCalendar=function(){var a=this.needToReloadCalendar();return this.needToReloadCalendar(!1),a},C.prototype.onSyncSettingsResponse=function(a){a.Result?(this.mobileSync(a.Result.Mobile),this.outlookSync(a.Result.Outlook)):Ob.Api.showErrorByCode(a)
},C.prototype.requestSyncSettings=function(){(null===this.mobileSync()||null===this.outlookSync())&&Ob.Ajax.send({Action:"SyncSettings"},this.onSyncSettingsResponse,this)},D.prototype.init=function(a,b,c){this.id(a),this.email(b),this.friendlyName(c)},D.prototype.onQuotaParamsResponse=function(a){a&&a.Result&&_.isArray(a.Result)&&1<a.Result.length&&(this.quota(Mb.pInt(a.Result[1])),this.usedSpace(Mb.pInt(a.Result[0])),Ob.MailCache.quotaChangeTrigger(!Ob.MailCache.quotaChangeTrigger()))},D.prototype.updateQuotaParams=function(){var a={Action:"Quota",AccountID:this.id()};Qb.App&&Qb.App.ShowQuotaBar&&Ob.Ajax.send(a,this.onQuotaParamsResponse,this)},D.prototype.parse=function(a,b){var c=new U;this.init(parseInt(a.AccountID,10),Mb.pString(a.Email),Mb.pString(a.FriendlyName)),c.parse(this.id(),a.Signature),this.signature(c),this.isCurrent(b===this.id()),this.isEdited(b===this.id())},D.prototype.requestExtensions=function(){if(!this.extensionsRequested()&&Ob.Ajax){var a=b.jstz?b.jstz.determine():null;Ob.Ajax.send({AccountID:this.id(),Action:"IsAuth",ClientTimeZone:a?a.name():""},this.onIsAuthResponse,this)}},D.prototype.onIsAuthResponse=function(a){var b=!!a.Result,c=b?a.Result.Extensions:[];b&&(this.setExtensions(c),this.extensionsRequested(!0))},D.prototype.setExtensions=function(a){_.isArray(a)&&this.extensions(a)},D.prototype.extensionExists=function(a){return-1===_.indexOf(this.extensions(),a)?!1:!0},D.prototype.updateExtended=function(a){a&&(this.isExtended(!0),a.FriendlyName&&this.friendlyName(a.FriendlyName),a.IncomingMailLogin&&this.incomingMailLogin(a.IncomingMailLogin),a.IncomingMailPort&&this.incomingMailPort(a.IncomingMailPort),a.IncomingMailServer&&this.incomingMailServer(a.IncomingMailServer),a.IsInternal&&this.isInternal(a.IsInternal),a.IsLinked&&this.isLinked(a.IsLinked),a.IsDefault&&this.isDefault(a.IsDefault),a.OutgoingMailAuth&&this.outgoingMailAuth(a.OutgoingMailAuth),a.OutgoingMailLogin&&this.outgoingMailLogin(a.OutgoingMailLogin),a.OutgoingMailPort&&this.outgoingMailPort(a.OutgoingMailPort),a.OutgoingMailServer&&this.outgoingMailServer(a.OutgoingMailServer),this.setExtensions(a.Extensions))},D.prototype.changeAccount=function(){Qb.Accounts.changeCurrentAccount(this.id())},D.prototype.getFetcherOrIdentityByEmail=function(a){var b=this.fetchers()?this.fetchers().collection():[],c=null;return c=_.find(b,function(b){return b.email()===a}),c||(c=_.find(this.identities()||[],function(b){return b.email()===a})),c},E.prototype.changeCurrentAccount=function(a){var b=this.getCurrent(),c=this.getAccount(a);c&&this.currentId()!==a&&(b.isCurrent(!1),this.currentId(a),c.isCurrent(!0),Ob.Routing.setHash(Ob.Links.inbox()))},E.prototype.changeEditedAccount=function(a){var b=this.getEdited(),c=this.getAccount(a);c&&this.editedId()!==a&&(b.isEdited(!1),this.editedId(a),c.isEdited(!0))},E.prototype.parse=function(a,b){var c=null,d=!1,e=null;_.isArray(b)&&this.collection(_.map(b,function(b){var c=new D;return c.parse(b,a),c.id()===a&&(d=!0),c})),!d&&this.collection.length>0&&(c=this.collection()[0],a=c.id(),d=!0),d&&(this.defaultId(a),this.currentId(a),this.editedId(a)),e=this.getDefault(),e&&_.defer(function(){e.isDefault(!0)})},E.prototype.getAccount=function(a){var b=_.find(this.collection(),function(b){return b.id()===a},this);return b},E.prototype.getCurrent=function(){var a=_.find(this.collection(),function(a){return a.id()===this.currentId()},this);return a},E.prototype.getDefault=function(){var a=_.find(this.collection(),function(a){return a.id()===this.defaultId()},this);return a},E.prototype.getEmail=function(){var a="",b=Qb.Accounts.getCurrent();return b&&(a=b.email()),a},E.prototype.getEdited=function(){var a=_.find(this.collection(),function(a){return a.id()===this.editedId()},this);return a},E.prototype.addAccount=function(a){this.collection.push(a)},E.prototype.deleteAccount=function(a){this.currentId()===a&&this.changeCurrentAccount(this.defaultId()),this.editedId()===a&&this.changeEditedAccount(this.defaultId()),this.collection.remove(function(b){return b.id()===a})},E.prototype.hasAccountWithId=function(a){var b=_.find(this.collection(),function(b){return b.id()===a},this);return!!b},E.prototype.doFirstRequests=function(){this.populateFetchers(),this.populateIdentities()},E.prototype.populateFetchers=function(){Qb.User.AllowFetcher&&Ob.Ajax.send({Action:"FetcherList",AccountID:Qb.Accounts.defaultId()},this.onFetcherListResponse,this)},E.prototype.onFetcherListResponse=function(a){var b=null,c=this.getDefault();Mb.isNonEmptyArray(a.Result)&&(b=new X,b.parse(Qb.Accounts.defaultId(),a.Result)),c.fetchers(b)},E.prototype.populateIdentities=function(){Qb.AllowIdentities&&Ob.Ajax.send({Action:"GetIdentities"},this.onIdentitiesResponse,this)},E.prototype.onIdentitiesResponse=function(a){var b={};Mb.isNonEmptyArray(a.Result)&&_.each(a.Result,function(a){var c=new I,d=-1;c.parse(a),d=c.accountId(),b[d]||(b[d]=[]),b[d].push(c)}),_.each(this.collection(),function(a){var c=b[a.id()];Mb.isNonEmptyArray(c)||(c=[]),a.identities(c)})},F.prototype.parse=function(a){null!==a&&(this.sName=Mb.pString(a.DisplayName),"string"!=typeof this.sName&&(this.sName=""),this.sEmail=Mb.pString(a.Email),"string"!=typeof this.sEmail&&(this.sEmail=""),this.sDisplay=this.sName.length>0?this.sName:this.sEmail,this.setFull())},F.prototype.getEmail=function(){return this.sEmail},F.prototype.getName=function(){return this.sName},F.prototype.getDisplay=function(){return this.sDisplay},F.prototype.setFull=function(){var a="";a=this.sEmail.length>0?this.sName.length>0?'"'+this.sName+'" <'+this.sEmail+">":this.sEmail:this.sName,this.sFull=a},F.prototype.getFull=function(){return this.sFull},F.prototype.oPopup=null,F.prototype.oTitle=null,F.prototype.bPopupOpened=!1,F.prototype.mouseoverEvent=function(b,c){this.oPopup&&0!==this.oPopup.length||(this.oPopup=a("div.item_viewer[data-email='"+this.sEmail+"']"),this.oPopup.length>0&&this.oPopup.on("mouseover",_.bind(this.openPopup,this)).on("mouseout",_.bind(this.mouseoutEvent,this))),this.oTitle=a(c.currentTarget),this.oPopup.length>0&&this.openPopup(c)},F.prototype.openPopup=function(){this.bPopupOpened=!0,_.delay(_.bind(function(){if(this.bPopupOpened){var a=this.oTitle.offset(),b=a.left+10,c=a.top+this.oTitle.height()+6;this.oPopup.addClass("expand").css("top",c+"px").css("left",b+"px").appendTo("body")}},this),180)},F.prototype.mouseoutEvent=function(){this.oPopup&&this.oTitle&&(this.bPopupOpened=!1,_.delay(_.bind(function(){this.bPopupOpened||this.oPopup.removeClass("expand")},this),200))},G.prototype.parse=function(a){this.aCollection=_.map(a,function(a){var b=new F;return b.parse(a),b})},G.prototype.addCollection=function(a){_.each(a,function(a){var b=_.find(this.aCollection,function(b){return a.sEmail===b.sEmail});b||this.aCollection.push(a)},this)},G.prototype.excludeCollection=function(a){_.each(a,function(a){this.aCollection=_.filter(this.aCollection,function(b){return a.sEmail!==b.sEmail})},this)},G.prototype.getFirstEmail=function(){return this.aCollection.length>0?this.aCollection[0].getEmail():""},G.prototype.getFirstName=function(){return this.aCollection.length>0?this.aCollection[0].getName():""},G.prototype.getDisplay=function(a,b){var c=_.map(this.aCollection,function(c){return a&&b===c.sEmail?a:c.getDisplay(a)});return c.join(", ")},G.prototype.getFull=function(){var a=_.map(this.aCollection,function(a){return a.getFull()});return a.join(", ")},H.prototype.parse=function(a){this.oMoment=moment.unix(a)},H.prototype.setDate=function(a,b,c){this.oMoment=moment([a,b,c])},H.prototype.getTimeFormat=function(){return Qb.User.defaultTimeFormat()===Lb.TimeFormat.F24?"HH:mm":"hh:mm A"},H.prototype.getFullDate=function(){return this.oMoment?this.oMoment.format("ddd, MMM D, YYYY, "+this.getTimeFormat()):""},H.prototype.getMidDate=function(){return this.getShortDate(!0)},H.prototype.getShortDate=function(a){var b="",c=null;return this.oMoment&&(c=moment(),c.format("L")===this.oMoment.format("L")?b=this.oMoment.format(this.getTimeFormat()):(b=c.clone().subtract("days",1).format("L")===this.oMoment.format("L")?Mb.i18n("DATETIME/YESTERDAY"):c.year()===this.oMoment.year()?this.oMoment.format("MMM D"):this.oMoment.format("MMM D, YYYY"),(Mb.isUnd(a)?1:!a)||(b+=", "+this.oMoment.format(this.getTimeFormat())))),b},H.prototype.getDate=function(){return this.oMoment?this.oMoment.format("ddd, MMM D, YYYY"):""},H.prototype.getTime=function(){return this.oMoment?this.oMoment.format(this.getTimeFormat()):""},H.prototype.convertDate=function(a){var b=Mb.getDateFormatForMoment(Qb.User.DefaultDateFormat)+" "+this.getTimeFormat();return moment(1e3*a).format(b)},I.prototype.parse=function(a){"Object/CIdentity"===a["@Object"]&&(this.enabled(!!a.Enabled),this.email(Mb.pString(a.Email)),this.friendlyName(Mb.pString(a.FriendlyName)),this.accountId(Mb.pInt(a.IdAccount)),this.id(Mb.pInt(a.IdIdentity)),this.signature(Mb.pString(a.Signature)),this.useSignature(!!a.UseSignature))},J.prototype.dataObjectName="",J.prototype.isVisibleViewLink=function(){return this.uploaded()&&!this.uploadError()&&this.isViewMimeType()},J.prototype.parse=function(a,b){a["@Object"]===this.dataObjectName&&(this.fileName(Mb.pString(a.FileName)),this.tempName(Mb.pString(a.TempName)),""===this.tempName()&&this.tempName(this.fileName()),this.type(Mb.pString(a.MimeType)),this.size(a.EstimatedSize?parseInt(a.EstimatedSize,10):parseInt(a.SizeInBytes,10)),this.thumb(!!a.Thumb),this.hash(Mb.pString(a.Hash)),this.accountId(b),this.allowExpandSubFiles(!!a.Expand),this.uploadUid(this.hash()),this.uploaded(!0),Mb.isFunc(this.additionalParse)&&this.additionalParse(a))},J.prototype.getInThumbQueue=function(a){this.thumbnailSessionUid(a),this.thumb()&&(!this.linked||this.linked&&!this.linked())&&Mb.thumbQueue(this.thumbnailSessionUid(),this.thumbnailLink(),this.thumbnailSrc)},J.prototype.downloadFile=function(a){a&&a.Api&&a.Api.downloadByUrl||(a=Ob),a&&this.downloadLink().length>0&&"#"!==this.downloadLink()&&a.Api.downloadByUrl(this.downloadLink())},J.prototype.onExpandAttachmentResponse=function(a){this.subFiles([]),Mb.isNonEmptyArray(a.Result)&&(_.each(a.Result,_.bind(function(a){var b=this.getInstance();a["@Object"]=this.dataObjectName,b.parse(a,this.accountId()),this.subFiles.push(b)},this)),this.subFilesLoaded(!0),this.subFilesCollapsed(!0)),this.subFilesStartedLoading(!1)},J.prototype.expandFile=function(){this.subFilesLoaded()?this.subFilesCollapsed(!0):(this.subFilesStartedLoading(!0),Ob.Ajax.send({Action:"ExpandAttachment",RawKey:this.hash()},this.onExpandAttachmentResponse,this))},J.prototype.collapseFile=function(){this.subFilesCollapsed(!1)},J.prototype.getInstance=function(){return new J},J.prototype.viewFile=function(){this.viewCommonFile()},J.prototype.viewCommonFile=function(){var a=null,b=Mb.getAppPath()+this.viewLink();this.visibleViewLink()&&this.viewLink().length>0&&"#"!==this.viewLink()&&(b=Mb.getAppPath()+this.viewLink(),a=Mb.WindowOpener.open(b,b,!1),a&&a.focus())},J.prototype.eventDragStart=function(a,b){var c=b.originalEvent||b;return a&&c&&c.dataTransfer&&c.dataTransfer.setData&&c.dataTransfer.setData("DownloadURL",this.generateTransferDownloadUrl()),!0},J.prototype.generateTransferDownloadUrl=function(){var a=this.downloadLink();return"http"!==a.substr(0,4)&&(a=b.location.protocol+"//"+b.location.host+b.location.pathname+a),this.type()+":"+this.fileName()+":"+a},J.prototype.onUploadSelect=function(a,b){this.fileName(b.FileName),this.type(b.Type),this.size(Mb.pInt(b.Size)),this.uploadUid(a),this.uploaded(!1),this.visibleSpinner(!1),this.statusText(""),this.progressPercent(0),this.visibleProgress(!1)},J.prototype.onUploadStart=function(){this.visibleSpinner(!0),this.visibleProgress(!0)},J.prototype.onUploadProgress=function(a,b){b>0&&(this.progressPercent(Math.ceil(a/b*100)),this.visibleProgress(!0))},J.prototype.onUploadComplete=function(a,b,c){var d=!b||!c||c.Error||!1,e=c&&"size"===c.Error?Mb.i18n("COMPOSE/UPLOAD_ERROR_SIZE"):Mb.i18n("COMPOSE/UPLOAD_ERROR_UNKNOWN");this.visibleSpinner(!1),this.progressPercent(0),this.visibleProgress(!1),this.uploaded(!0),this.uploadError(d),this.statusText(d?e:Mb.i18n("COMPOSE/UPLOAD_COMPLETE")),d||(this.fillDataAfterUploadComplete(c,a),setTimeout(function(a){return function(){a.statusText("")}}(this),3e3))},J.prototype.fillDataAfterUploadComplete=function(){},J.prototype.onImageLoad=function(){this.thumb()&&!this.thumbnailLoaded()&&(this.thumbnailLoaded(!0),Mb.thumbQueue(this.thumbnailSessionUid()))},Mb.extend(K,J),K.prototype.dataObjectName="Object/CApiMailAttachment",K.prototype.getInstance=function(){return new K},K.prototype.getCopy=function(){var a=new K;return a.copyProperties(this),a},K.prototype.copyProperties=function(a){this.fileName(a.fileName()),this.tempName(a.tempName()),this.size(a.size()),this.accountId(a.accountId()),this.hash(a.hash()),this.type(a.type()),this.cid(a.cid()),this.contentLocation(a.contentLocation()),this.inline(a.inline()),this.linked(a.linked()),this.thumb(a.thumb()),this.thumbnailSrc(a.thumbnailSrc()),this.thumbnailLoaded(a.thumbnailLoaded()),this.statusText(a.statusText()),this.uploaded(a.uploaded())},K.prototype.isVisibleViewLink=function(){return this.uploaded()&&!this.uploadError()&&(this.isViewMimeType()||this.isMessageType())},K.prototype.additionalParse=function(a){this.mimePartIndex(Mb.pString(a.MimePartIndex)),this.cid(Mb.pString(a.CID)),this.contentLocation(Mb.pString(a.ContentLocation)),this.inline(!!a.IsInline),this.linked(!!a.IsLinked)},K.prototype.setMessageData=function(a,b){this.folderName(a),this.messageUid(b)},K.prototype.onMessageResponse=function(a){var b=a.Result,c=new N;b&&this.oNewWindow&&(c.parse(b,a.AccountID,!1,!0),this.messagePart(c),this.messagePart().viewMessage(this.oNewWindow),this.oNewWindow=void 0)},K.prototype.viewFile=function(){this.isMessageType()?this.viewMessageFile():this.viewCommonFile()},K.prototype.viewMessageFile=function(){var b=null,c='<div style="margin: 30px; text-align: center; font: normal 14px Tahoma;">'+Mb.i18n("MAIN/LOADING")+"</div>";b=Mb.WindowOpener.open("",this.fileName()),b&&(this.messagePart()?this.messagePart().viewMessage(b):(a(b.document.body).html(c),this.oNewWindow=b,Ob.Ajax.send({Action:"Message",Folder:this.folderName(),Uid:this.messageUid(),Rfc822MimeIndex:this.mimePartIndex()},this.onMessageResponse,this)),b.focus())},K.prototype.viewCommonFile=function(){var a=null,b=Mb.getAppPath()+this.viewLink();this.visibleViewLink()&&this.viewLink().length>0&&"#"!==this.viewLink()&&(b=Mb.getAppPath()+this.viewLink(),a=Mb.WindowOpener.open(b,b,!1),a&&a.focus())},K.prototype.fillDataAfterUploadComplete=function(a,b){this.cid(b),this.tempName(a.Result.Attachment.TempName),this.type(a.Result.Attachment.MimeType),this.size(a.Result.Attachment.Size),this.hash(a.Result.Attachment.Hash),this.accountId(a.AccountID)},K.prototype.parseFromContact=function(a,b){this.fileName(a.Name.toString()),this.tempName(a.TempName?a.TempName.toString():this.fileName()),this.type(a.MimeType.toString()),this.size(parseInt(a.Size,10)),this.hash(a.Hash),this.accountId(b),this.uploadUid(this.hash()),this.uploaded(!0),this.uploadStarted(!1)},K.prototype.errorFromContact=function(){this.uploaded(!0),this.uploadError(!0),this.uploadStarted(!1),this.statusText(Mb.i18n("COMPOSE/UPLOAD_ERROR_UNKNOWN"))},L.prototype.hideThreadMessages=function(a){_.each(a.threadUids(),function(a){var b=this.oMessages[a];b&&(b.deleted()||(b.threadShowAnimation(!1),b.threadHideAnimation(!0),setTimeout(function(){b.threadHideAnimation(!1)},1e3)))},this)},L.prototype.getThreadMessages=function(a){var b=[],c=[],d=[],e=0,f=null,g=50;return _.each(a.threadUids(),function(h){if(e<a.threadCountForLoad()){var i=this.oMessages[h];i?i.deleted()||(i.markAsThreadPart(g),b.push(i),d.push(i.uid()),e++,f=i):(c.push(h),d.push(h),e++)}else d.push(h)},this),a.threadLoading()||this.loadThreadMessages(c),a.changeThreadUids(d,b.length),f&&b.length<a.threadUids().length&&f.showNextLoadingLink(_.bind(a.increaseThreadCountForLoad,a)),this.addThreadUidsToUidLists(a.uid(),a.threadUids()),b},L.prototype.computeUnreadThreadCount=function(a){var b=0;_.each(a.threadUids(),function(a){var c=this.oMessages[a];!c||c.deleted()||c.seen()||b++},this),a.threadUnreedCount(b)},L.prototype.addThreadUidsToUidLists=function(a,b){_.each(this.oUids,function(c){_.each(c,function(c){c.addThreadUids(a,b)})})},L.prototype.loadThreadMessages=function(a){if(a.length>0){var b={Action:"MessageListByUids",Folder:this.fullName(),Uids:a};Ob.Ajax.send(b,this.onMessageListByUidsResponse,this)}},L.prototype.getUidsWithThread=function(a){var b=[];return _.each(a,function(a){var c=this.oMessages[a];c&&!c.threadOpened()&&(b=_.union(b,c.threadUids()))},this),_.union(a,b)},L.prototype.parseAndCacheMessage=function(a,b,c){var d=a.Uid.toString(),e=this.oMessages[d]?this.oMessages[d]:new N;return e.parse(a,this.iAccountId,b,c),this.oMessages[e.uid()]=e,e},L.prototype.onMessageListByUidsResponse=function(a){var b=a.Result;b&&"Collection/MessageCollection"===b["@Object"]&&(_.each(b["@Collection"],function(a){this.parseAndCacheMessage(a,!0,!0)},this),Ob.MailCache.showOpenedThreads(this.fullName()))},L.prototype.addRequestedUids=function(a){this.aRequestedUids=_.union(this.aRequestedUids,a)},L.prototype.hasUidBeenRequested=function(a){return-1!==_.indexOf(this.aRequestedUids,a)},L.prototype.addRequestedThreadUids=function(a){this.aRequestedThreadUids=_.union(this.aRequestedThreadUids,a)},L.prototype.hasThreadUidBeenRequested=function(a){return-1!==_.indexOf(this.aRequestedThreadUids,a)},L.prototype.hasListBeenRequested=function(a){var b=_.where(this.requestedLists,a),c=b.length>0;return c||this.requestedLists.push(a),c},L.prototype.markMessageReplied=function(a,b){var c=this.oMessages[a];if(c)switch(b){case Lb.ReplyType.Reply:case Lb.ReplyType.ReplyAll:c.answered(!0);break;case Lb.ReplyType.Forward:c.forwarded(!0)}},L.prototype.removeAllMessages=function(){var a=null;this.oMessages={},this.oUids={},this.messageCount(0),this.unseenMessageCount(0),this.realUnseenMessageCount(0),a=this.getUidList("",""),a.resultCount(0)},L.prototype.removeAllMessageListsFromCacheIfHasChanges=function(){this.hasChanges()&&(this.oUids={},this.requestedLists=[],this.aRequestedThreadUids=[],this.hasChanges(!1))},L.prototype.removeFlaggedMessageListsFromCache=function(){_.each(this.oUids,function(a,b){delete this.oUids[b][Lb.FolderFilter.Flagged]},this)},L.prototype.setRelevantInformation=function(a,b,c,d,e){var f=this.hasExtendedInfo()&&(this.hash()!==b||this.realUnseenMessageCount()!==d);return this.uidNext(a),this.hash(b),this.hasExtendedInfo()&&e||(this.messageCount(c),this.unseenMessageCount(d),0===d&&this.unseenMessageCount.valueHasMutated()),this.realUnseenMessageCount(d),this.hasExtendedInfo(!0),f&&this.markHasChanges(),f},L.prototype.markHasChanges=function(){this.hasChanges(!0)},L.prototype.addMessagesCountsDiff=function(a,b){var c=this.messageCount()+a,d=this.unseenMessageCount()+b;0>c&&(c=0),this.messageCount(c),0>d&&(d=0),d>c&&(d=c),this.unseenMessageCount(d)},L.prototype.markDeletedByUids=function(a){var b=0,c=0;return _.each(a,function(a){var d=this.oMessages[a];d&&(b++,d.seen()||c++,d.deleted(!0))},this),this.addMessagesCountsDiff(-b,-c),{MinusDiff:b,UnseenMinusDiff:c}},L.prototype.revertDeleted=function(a){var b=0,c=0;return _.each(a,function(a){var d=this.oMessages[a];d&&d.deleted()&&(b++,d.seen()||c++,d.deleted(!1))},this),this.addMessagesCountsDiff(b,c),{PlusDiff:b,UnseenPlusDiff:c}},L.prototype.commitDeleted=function(a){_.each(this.oUids,function(b){_.each(b,function(b){b.deleteUids(a)})})},L.prototype.getUidList=function(a,b){var c=null;return void 0===this.oUids[a]&&(this.oUids[a]={}),void 0===this.oUids[a][b]&&(c=new O,c.search(a),c.filters(b),this.oUids[a][b]=c),this.oUids[a][b]},L.prototype.parse=function(a,b){var c="",d=Ob.Storage.getData("folderAccordion")||[];return"Object/Folder"===a["@Object"]?(this.parentFullName(b),c=Mb.pString(a.Name),this.name(c),this.nameForEdit(c),this.fullName(Mb.pString(a.FullNameRaw)),this.fullNameHash(Mb.pString(a.FullNameHash)),this.routingHash(Ob.Routing.buildHashFromArray([Lb.Screens.Mailbox,this.fullName()])),this.delimiter(a.Delimiter),this.type(a.Type),this.subscribed(a.IsSubscribed),this.selectable(a.IsSelectable),this.existen(a.IsExisten),a.Extended&&this.setRelevantInformation(a.Extended.UidNext.toString(),a.Extended.Hash,a.Extended.MessageCount,a.Extended.MessageUnseenCount,!1),_.find(d,function(a){return a===this.name()},this)&&this.expanded(!0),a.SubFolders):null},L.prototype.onMessageResponse=function(a,b){var c=a.Result,d=null,e=c?c.Uid.toString():b.Uid.toString(),f=this.oMessages[e],g=f?f.selected():!1;c?(f=this.parseAndCacheMessage(c,!1,!1),f&&f.ical()&&f.ical().isReplyType()&&Ob.CalendarCache&&Ob.CalendarCache.calendarChanged(!0)):(g&&Ob.Api.showErrorByCode(a,Mb.i18n("WARNING/UNKNOWN_ERROR")),f=null),d=this.aResponseHandlers[e],d&&(d.handler.call(d.context,f,e),delete this.aResponseHandlers[e])},L.prototype.getCompletelyFilledMessage=function(a,b,c){var d=this.oMessages[a],e={Action:"Message",Folder:this.fullName(),Uid:a};a.length>0&&(d&&d.completelyFilled()?b&&c&&b.call(c,d,a):(b&&c&&(this.aResponseHandlers[a]={handler:b,context:c}),Ob.Ajax.send(e,this.onMessageResponse,this)))},L.prototype.showExternalPictures=function(a){var b=this.oMessages[a];void 0!==b&&b.showExternalPictures()},L.prototype.alwaysShowExternalPicturesForSender=function(a){_.each(this.oMessages,function(b){var c=b.oFrom.aCollection;c.length>0&&c[0].sEmail===a&&b.alwaysShowExternalPicturesForSender()},this)},L.prototype.executeGroupOperation=function(a,b,c){var d=0;_.each(this.oMessages,function(e){b.length>0?_.each(b,function(b){e&&e.uid()===b&&e[a]()!==c&&(e[a](c),d++)}):e[a](c)}),0===b.length&&(d=c?this.unseenMessageCount():this.messageCount()-this.unseenMessageCount()),"seen"===a&&d>0&&(c?this.addMessagesCountsDiff(0,-d):this.addMessagesCountsDiff(0,d))},L.prototype.emptyFolder=function(){var a=Mb.i18n("MAILBOX/CONFIRM_EMPTY_FOLDER"),b=_.bind(this.clearFolder,this);this.enableEmptyFolder()&&Ob.Screens.showPopup(t,[a,b])},L.prototype.clearFolder=function(a){var b={Action:"FolderClear",Folder:this.fullName()};this.enableEmptyFolder()&&a&&(Ob.Ajax.send(b),this.removeAllMessages(),Ob.MailCache.onClearFolder(this))},L.prototype.getNameWhithLevel=function(){var a=this.level();return!this.isNamespace()&&a>0&&a--,Mb.strRepeat("",3*a)+this.name()},L.prototype.onAccordion=function(a,b){var c=!this.expanded(),d=Ob.Storage.getData("folderAccordion")||[];c?d.push(this.name()):d=_.reject(d,function(a){return a===this.name()},this),Ob.Storage.setData("folderAccordion",d),this.expanded(c),Ob.MailCache.countMessages(this),b.stopPropagation()},M.prototype.getFoldersWithoutCountInfo=function(){var a=_.compact(_.map(this.oNamedCollection,function(a,b){return a.canBeSelected()&&!a.hasExtendedInfo()?b:null}));return a},M.prototype.getInboxSpamFiltersFetcherAndCurrentFolders=function(){var a=Qb.Accounts.getAccount(this.iAccountId),b=[this.inboxFolderFullName(),this.spamFolderFullName(),this.currentFolderFullName()];return a.filters()&&_.each(a.filters().collection(),function(a){b.push(a.folder())},this),a.fetchers()&&_.each(a.fetchers().collection(),function(a){b.push(a.folder())},this),_.uniq(_.compact(b))},M.prototype.setCurrentFolder=function(a,b){var c=this.getFolderByFullName(a);null===c&&(c=this.inboxFolder()),null!==c&&(this.currentFolder()&&(this.currentFolder().selected(!1),this.oStarredFolder&&this.oStarredFolder.selected(!1)),this.currentFolder(c),b===Lb.FolderFilter.Flagged?this.oStarredFolder&&this.oStarredFolder.selected(!0):this.currentFolder().selected(!0))},M.prototype.getFolderByType=function(a){switch(a){case Lb.FolderTypes.Inbox:return this.inboxFolder();case Lb.FolderTypes.Sent:return this.sentFolder();case Lb.FolderTypes.Drafts:return this.draftsFolder();case Lb.FolderTypes.Trash:return this.trashFolder();case Lb.FolderTypes.Spam:return this.spamFolder()}return null},M.prototype.getFolderByFullName=function(a){var b=this.oNamedCollection[a];return b?b:null},M.prototype.parse=function(a,b,c){this.iAccountId=a,this.sNamespace=Mb.pString(b.Namespace),this.bInitialized(!0),this.sNamespaceFolder=this.sNamespace.length>0?this.sNamespace.substring(0,this.sNamespace.length-1):this.sNamespace,this.collection(this.parseRecursively(b["@Collection"],c))},M.prototype.parseRecursively=function(a,b,c,d){var e=this,f=[],g=0,h=0,i=null,j="",k=null,l=[],m=!1,n=Qb.Accounts.getAccount(this.iAccountId),o=function(){var a=e.getFolderByType(Lb.FolderTypes.Spam);n&&n.extensionExists("AllowSpamFolderExtension")||(a.type(Lb.FolderTypes.User),e.spamFolder(null))},p=function(){n&&n.extensionsRequested()&&(o(),n.extensionsRequestedSubscription.dispose(),n.extensionsRequestedSubscription=void 0)},q=function(){e.createStarredFolder(c),e.oStarredFolder&&f.push(e.oStarredFolder)};if(d=d||"",Mb.isUnd(c)&&(c=-1),c++,_.isArray(a))for(h=a.length;h>g;g++){switch(j=Mb.pString(a[g].FullNameRaw),i=b[j],i||(i=new L),i.iAccountId=this.iAccountId,k=i.parse(a[g],d),m=this.sNamespace===i.fullName()+i.delimiter(),i.isNamespace(m),i.level(c),this.oNamedCollection[i.fullName()]=i,i.type()){case Lb.FolderTypes.Inbox:this.inboxFolder(i);break;case Lb.FolderTypes.Sent:this.sentFolder(i);break;case Lb.FolderTypes.Drafts:this.draftsFolder(i);break;case Lb.FolderTypes.Trash:this.trashFolder(i);break;case Lb.FolderTypes.Spam:this.spamFolder(i),n.extensionsRequested()?o():n.extensionsRequestedSubscription=n.extensionsRequested.subscribe(p)}f.push(i),null===k&&i.type()===Lb.FolderTypes.Inbox?q():null!==k&&(l=this.parseRecursively(k["@Collection"],b,c,i.fullName()),i.type()===Lb.FolderTypes.Inbox&&(i.isNamespace()?(this.createStarredFolder(c+1),this.oStarredFolder&&l.unshift(this.oStarredFolder)):q()),i.subfolders(l))}return f},M.prototype.createStarredFolder=function(a){var b=new L;b.iAccountId=this.iAccountId,b.virtual(!0),b.level(a),b.fullName("filter:"+Lb.FolderFilter.Flagged),b.name(Mb.i18n("MAIN/FOLDER_STARRED")),b.type(Lb.FolderTypes.Starred),b.routingHash(Ob.Routing.buildHashFromArray([Lb.Screens.Mailbox,b.fullName()])),this.oStarredFolder=b},M.prototype.getOptions=function(a,b,c,d){var e="",f=function(a){var g=0,h=0,i=null,j=[];for(Mb.isUnd(b)&&(b=!1),Mb.isUnd(c)&&(c=!1),Mb.isUnd(d)&&(d=!1),g=0,h=a.length;h>g;g++)i=a[g],i.virtual()||(i.type()===Lb.FolderTypes.Inbox||!c)&&c||j.push({id:i.fullName(),name:new Array(i.level()+1).join(e)+i.name(),displayName:new Array(i.level()+1).join(e)+i.displayName(),disable:i.isSystem()&&!b||!d&&!i.canBeSelected()}),j=j.concat(f(i.subfolders()));return j},g=f(this.collection());return Mb.isUnd(a)||g.unshift({id:"",name:a,displayName:a,disable:!1}),g},M.prototype.getRecursivelyMessageCount=function(a){var b=0,c=0,d=null,e=0;for(b=0,c=a.length;c>b;b++)d=a[b],d.virtual()||(e+=d.messageCount()+this.getRecursivelyMessageCount(d.subfolders()));return e},M.prototype.deleteFolder=function(a){var b=function(c){return a&&a.fullName()===c.fullName()?!0:(c.subfolders.remove(b),!1)};this.collection.remove(b)},N.prototype.viewMessage=function(b){var c=this.getDomText(Mb.getAppPath()),d="";this.textBodyForNewWindow(c.html()),d=a(this.domMessageForPrint()).html(),b&&(a(b.document.body).html(d),b.focus(),_.each(this.attachments(),function(c){var d=a(b.document.body).find("[data-hash='download-"+c.hash()+"']");d.on("click",_.bind(c.downloadFile,c,Ob)),d=a(b.document.body).find("[data-hash='view-"+c.hash()+"']"),d.on("click",_.bind(c.viewFile,c))},this))},N.prototype.fillFromOrToText=function(){var a=Ob.MailCache.getFolderByFullName(this.accountId(),this.folder()),b=Qb.Accounts.getAccount(this.accountId());a.type()===Lb.FolderTypes.Drafts||a.type()===Lb.FolderTypes.Sent?this.fromOrToText(this.oTo.getDisplay(Mb.i18n("MESSAGE/ME_RECIPIENT"),b.email())):this.fromOrToText(this.oFrom.getDisplay(Mb.i18n("MESSAGE/ME_SENDER"),b.email()))},N.prototype.changeThreadUids=function(a,b){this.threadUids(a),this.threadLoading(b<Math.min(this.threadUids().length,this.threadCountForLoad()))},N.prototype.showNextLoadingLink=function(a){this.threadNextLoadingLinkVisible()&&(this.threadNextLoadingVisible(!0),this.threadFunctionLoadNext=a)},N.prototype.increaseThreadCountForLoad=function(){this.threadCountForLoad(this.threadCountForLoad()+5),Ob.MailCache.showOpenedThreads(this.folder())},N.prototype.loadNextMessages=function(){this.threadFunctionLoadNext&&(this.threadFunctionLoadNext(),this.threadNextLoadingLinkVisible(!1),this.threadFunctionLoadNext=null)},N.prototype.markAsThreadPart=function(a){var b=this;Mb.log("Mark as thread part",this.threadPart(),this.uid()),this.threadPart(!0),this.threadUids([]),this.threadNextLoadingVisible(!1),this.threadNextLoadingLinkVisible(!0),this.threadFunctionLoadNext=null,this.threadHideAnimation(!1),setTimeout(function(){b.threadShowAnimation(!0)},a)},N.prototype.parse=function(a,b,c,d){var e=null,f=null,g="",h="";d&&this.threadPart(c),"Object/MessageListItem"===a["@Object"]&&(this.seen(!!a.IsSeen),this.flagged(!!a.IsFlagged),this.answered(!!a.IsAnswered),this.forwarded(!!a.IsForwarded),a.Custom&&(this.Custom=a.Custom)),("Object/Message"===a["@Object"]||"Object/MessageListItem"===a["@Object"])&&(this.accountId(b),this.folder(a.Folder),this.uid(Mb.pString(a.Uid)),this.subject(Mb.pString(a.Subject)),this.messageId(Mb.pString(a.MessageId)),this.size(a.Size),this.textSize(a.TextSize),this.oDateModel.parse(a.TimeStampInUTC),this.oFrom.parse(a.From),this.oTo.parse(a.To),this.fillFromOrToText(),this.oCc.parse(a.Cc),this.oBcc.parse(a.Bcc),this.oSender.parse(a.Sender),this.oReplyTo.parse(a.ReplyTo),this.fullDate(this.oDateModel.getFullDate()),this.fullFrom(this.oFrom.getFull()),this.to(this.oTo.getFull()),this.cc(this.oCc.getFull()),this.bcc(this.oBcc.getFull()),this.hasAttachments(!!a.HasAttachments),this.hasIcalAttachment(!!a.HasIcalAttachment),this.hasVcardAttachment(!!a.HasVcardAttachment),"Object/MessageListItem"===a["@Object"]&&d&&this.threadUids(_.map(a.Threads,function(a){return a.toString()},this)),this.importance(a.Priority),_.isArray(a.DraftInfo)&&this.draftInfo(a.DraftInfo),this.sensitivity(a.Sensitivity),this.hash(Mb.pString(a.Hash)),"Object/Message"===a["@Object"]&&(this.inReplyTo(a.InReplyTo),this.references(a.References),this.readingConfirmation(a.ReadingConfirmation),g=Mb.pString(a.Html),h=Mb.pString(a.Plain),""!==g?(this.text(g),this.isPlain(!1)):(this.text(""!==h?"<div>"+h+"</div>":""),this.isPlain(!0)),this.rtl(a.Rtl),this.hasExternals(!!a.HasExternals),this.foundedCids(a.FoundedCIDs),this.parseAttachments(a.Attachments,b),this.safety(a.Safety),null!==a.ICAL&&(e=new P,e.parse(a.ICAL),this.ical(e)),null!==a.VCARD&&(f=new Q,f.parse(a.VCARD),this.vcard(f)),this.completelyFilled(!0)))},N.prototype.getDomText=function(b){var c=this.$text;return b=b||"",(null===this.$text||""!==b)&&(this.completelyFilled()?(this.$text=a(this.text()),this.showInlinePictures(b),this.safety()===!0&&this.alwaysShowExternalPicturesForSender(),c=this.$text):c=a("")),c.clone()},N.prototype.parseAttachments=function(a,b){if(_.isArray(a)){var c=Date.now().toString();this.attachments(_.map(a,function(a){var d=new K;return d.parse(a,b),d.getInThumbQueue(c),d.setMessageData(this.folder(),this.uid()),d},this))}},N.prototype.parseAddressArray=function(a){var b=[];return _.isArray(a)&&(b=_.map(a,function(a){var b=new F;return b.parse(a),b})),b},N.prototype.findAttachmentByCid=function(a){return a="<"+a+">",_.find(this.attachments(),function(b){return b.cid()===a})},N.prototype.findAttachmentByContentLocation=function(a){return _.find(this.attachments(),function(b){return b.contentLocation()===a})},N.prototype.showInlinePictures=function(b){var c=this;this.foundedCids().length>0&&(a("[data-x-src-cid]",this.$text).each(function(){var d=a(this).attr("data-x-src-cid"),e=c.findAttachmentByCid(d);e&&e.viewLink().length>0&&a(this).attr("src",b+e.viewLink())}),a("[data-x-style-cid]",this.$text).each(function(){var b="",d=a(this).attr("data-x-style-cid-name"),e=a(this).attr("data-x-style-cid"),f=c.findAttachmentByCid(e);f&&f.viewLink().length>0&&""!==d&&(b=Mb.trim(a(this).attr("style")),b=""===b?"":";"===b.substr(-1)?b+" ":b+"; ",a(this).attr("style",b+d+": url('"+f.viewLink()+"')"))
})),a("[data-x-src-location]",this.$text).each(function(){var d=a(this).attr("data-x-src-location"),e=c.findAttachmentByContentLocation(d);e||(e=c.findAttachmentByCid(d)),e&&e.viewLink().length>0&&a(this).attr("src",b+e.viewLink())})},N.prototype.showExternalPictures=function(){a("[data-x-src]",this.$text).each(function(){a(this).attr("src",a(this).attr("data-x-src")).removeAttr("data-x-src")}),a("[data-x-style-url]",this.$text).each(function(){var b=Mb.trim(a(this).attr("style"));b=""===b?"":";"===b.substr(-1)?b+" ":b+"; ",a(this).attr("style",b+a(this).attr("data-x-style-url")).removeAttr("data-x-style-url")}),this.isExternalsShown(!0)},N.prototype.alwaysShowExternalPicturesForSender=function(){this.completelyFilled()&&(this.isExternalsAlwaysShown(!0),this.isExternalsShown()||this.showExternalPictures())},N.prototype.openThread=function(){if(this.threadCountVisible()){var a=this.folder();this.threadOpened(!this.threadOpened()),this.threadOpened()?Ob.MailCache.showOpenedThreads(a):(Ob.MailCache.hideThreads(this),setTimeout(function(){Ob.MailCache.showOpenedThreads(a)},500))}},N.prototype.downloadAllAttachments=function(){if(""!==this.allAttachmentsHash)Ob.Api.downloadByUrl(Mb.getDownloadLinkByHash(this.accountId(),this.allAttachmentsHash));else{var a=_.filter(this.attachments(),function(a){return!a.linked()}),b=_.map(a,function(a){return a.hash()});Ob.Ajax.send({Action:"MessageZipAttachments",Hashes:b},this.onMessageZipAttachments,this)}},N.prototype.onMessageZipAttachments=function(a){a.Result&&(this.allAttachmentsHash=a.Result,Ob.Api.downloadByUrl(Mb.getDownloadLinkByHash(this.accountId(),this.allAttachmentsHash)))},N.prototype.saveAttachmentsToFiles=function(){var a=_.filter(this.attachments(),function(a){return!a.linked()}),b=_.map(a,function(a){return a.hash()});Ob.Ajax.send({Action:"MessageAttachmentsSaveToFiles",Attachments:b},this.onMessageAttachmentsSaveToFilesResponse,this)},N.prototype.onMessageAttachmentsSaveToFilesResponse=function(a){a.Result&&Ob.Api.showReport(Mb.i18n("MESSAGE/REPORT_ATTACHMENTS_SAVED_TO_FILES"))},N.prototype.downloadAllAttachmentsSeparately=function(){_.each(this.attachments(),function(a){a.linked()||a.downloadFile(Ob)})},N.prototype.toJSON=function(){return{uid:this.uid(),accountId:this.accountId(),to:this.to(),subject:this.subject(),threadPart:this.threadPart(),threadUids:this.threadUids(),threadOpened:this.threadOpened()}},O.prototype.addThreadUids=function(a,b){-1!==_.indexOf(this.collection(),a)&&(this.threadUids[a]=b)},O.prototype.setUidsAndCount=function(a){"Collection/MessageCollection"===a["@Object"]&&(_.each(a.Uids,function(b,c){this.collection()[c+a.Offset]=b.toString()},this),this.resultCount(a.MessageResultCount))},O.prototype.getUidsForOffset=function(a,b){for(var c=0,d=this.collection().length,e="",f=0,g=[],h=null;d>c;c++)c>=a&&f<Qb.User.MailsPerPage&&(e=this.collection()[c],h=b[e],(h&&!h.deleted()||void 0===e)&&(f++,void 0!==e&&g.push(e)));return g},O.prototype.deleteUids=function(a){for(var b=0,c=this.collection().length,d="",e=[],f=0;c>b;b++)d=this.collection()[b],-1===_.indexOf(a,d)?e.push(d):f++;this.collection(e),this.resultCount(this.resultCount()-f)},P.prototype.fillDecisions=function(){var a=Qb.Accounts.getCurrent(),b=a?a.email():"";switch(this.cancelDecision(Mb.i18n("MESSAGE/APPOINTMENT_CANCELED",{SENDER:b})),this.icalConfig()){case Lb.IcalConfig.Accepted:this.replyDecision(Mb.i18n("MESSAGE/APPOINTMENT_ACCEPTED",{SENDER:b}));break;case Lb.IcalConfig.Declined:this.replyDecision(Mb.i18n("MESSAGE/APPOINTMENT_DECLINED",{SENDER:b}));break;case Lb.IcalConfig.Tentative:this.replyDecision(Mb.i18n("MESSAGE/APPOINTMENT_TENTATIVELY_ACCEPTED",{SENDER:b}))}},P.prototype.parse=function(a){var b="";a&&"Object/CApiMailIcs"===a["@Object"]&&(b=Mb.pString(a.Description),this.uid(Mb.pString(a.Uid)),this.file(Mb.pString(a.File)),this.type(a.Type),this.location(Mb.pString(a.Location)),this.description(b.replace(/\r/g,"").replace(/\n/g,"<br />")),this.when(Mb.pString(a.When)),this.calendarId(Mb.pString(a.CalendarId)),this.selectedCalendar(Mb.pString(a.CalendarId)),Ob.CalendarCache.addIcal(this))},P.prototype.acceptAppointment=function(){this.calendarId(this.selectedCalendar()),this.changeAndSaveConfig(Lb.IcalConfig.Accepted)},P.prototype.tentativeAppointment=function(){this.calendarId(this.selectedCalendar()),this.changeAndSaveConfig(Lb.IcalConfig.Tentative)},P.prototype.declineAppointment=function(){this.calendarId(""),this.selectedCalendar(""),this.changeAndSaveConfig(Lb.IcalConfig.Declined)},P.prototype.changeAndSaveConfig=function(a){this.icalConfig()===a||a===Lb.IcalConfig.Declined&&this.icalConfig()===Lb.IcalConfig.NeedsAction||Ob.CalendarCache.recivedAnim(!0),this.changeConfig(a),this.doProcessAppointment()},P.prototype.changeConfig=function(a){this.type(this.icalType()+"-"+a),Qb.SingleMode&&b.opener?b.opener.App.CalendarCache.markIcalTypeByFile(this.file(),this.type(),this.cancelDecision(),this.replyDecision(),this.calendarId(),this.selectedCalendar()):Ob.CalendarCache.markIcalTypeByFile(this.file(),this.type(),this.cancelDecision(),this.replyDecision(),this.calendarId(),this.selectedCalendar())},P.prototype.onProcessAppointmentResponse=function(a){a.Result?Ob.CalendarCache&&Ob.CalendarCache.calendarChanged(!0):Ob.Api.showErrorByCode(a,Mb.i18n("WARNING/UNKNOWN_ERROR"))},P.prototype.doProcessAppointment=function(){var a={Action:"ProcessAppointment",AppointmentAction:this.icalConfig(),CalendarId:this.selectedCalendar(),File:this.file()};Ob.Ajax.send(a,this.onProcessAppointmentResponse,this)},P.prototype.onAddEventResponse=function(a){a.Result?a.Result.Uid&&this.uid(a.Result.Uid):Ob.Api.showErrorByCode(a)},P.prototype.addEvent=function(){var a={Action:"SaveIcs",CalendarId:this.selectedCalendar(),File:this.file()};Ob.Ajax.send(a,this.onAddEventResponse,this),this.isJustSaved(!0),this.calendarId(this.selectedCalendar()),setTimeout(_.bind(function(){this.isJustSaved(!1)},this),2e4),Ob.CalendarCache.recivedAnim(!0)},P.prototype.onEventDelete=function(){this.calendarId(""),this.selectedCalendar(""),this.changeConfig(Lb.IcalConfig.NeedsAction)},P.prototype.onEventTentative=function(){this.changeConfig(Lb.IcalConfig.Tentative)},P.prototype.onEventAccept=function(){this.changeConfig(Lb.IcalConfig.Accepted)},P.prototype.firstCalendarName=function(){return this.calendars()[0]?this.calendars()[0].name:""},Q.prototype.parse=function(a){a&&"Object/CApiMailVcard"===a["@Object"]&&(this.uid(Mb.pString(a.Uid)),this.file(Mb.pString(a.File)),this.name(Mb.pString(a.Name)),this.email(Mb.pString(a.Email)),this.isExists(!!a.Exists),Ob.ContactsCache.addVcard(this))},Q.prototype.onAddContactResponse=function(a){a&&a.Result&&a.Result.Uid&&this.uid(a.Result.Uid)},Q.prototype.addContact=function(){var a={Action:"SaveVcf",File:this.file()};Ob.Ajax.send(a,this.onAddContactResponse,this),this.isJustSaved(!0),this.isExists(!0),setTimeout(_.bind(function(){this.isJustSaved(!1)},this),2e4),Ob.ContactsCache.recivedAnim(!0),Qb.SingleMode&&b.opener?b.opener.App.ContactsCache.markVcardExistentByFile(this.file()):Ob.ContactsCache.markVcardExistentByFile(this.file())},R.birthdayMonths=Mb.getMonthNamesArray(),R.birthdayMonthSelect=[{text:Mb.i18n("DATETIME/MONTH"),value:"0"},{text:R.birthdayMonths[0],value:"1"},{text:R.birthdayMonths[1],value:"2"},{text:R.birthdayMonths[2],value:"3"},{text:R.birthdayMonths[3],value:"4"},{text:R.birthdayMonths[4],value:"5"},{text:R.birthdayMonths[5],value:"6"},{text:R.birthdayMonths[6],value:"7"},{text:R.birthdayMonths[7],value:"8"},{text:R.birthdayMonths[8],value:"9"},{text:R.birthdayMonths[9],value:"10"},{text:R.birthdayMonths[10],value:"11"},{text:R.birthdayMonths[11],value:"12"}],R.birthdayYearSelect=[{text:Mb.i18n("DATETIME/YEAR"),value:"0"}],R.prototype.getSendMailLink=function(a){var b=this.getFullEmail(a),c=Ob.Links.composeWithToField(b),d=Ob.Routing.buildHashFromArray(c);return d},R.prototype.clear=function(){this.isNew(!1),this.readOnly(!1),this.idContact(""),this.idUser(""),this.global(!1),this.itsMe(!1),this.edited(!1),this.extented(!1),this.personalCollapsed(!1),this.businessCollapsed(!1),this.otherCollapsed(!1),this.groupsCollapsed(!1),this.displayName(""),this.firstName(""),this.lastName(""),this.nickName(""),this.skype(""),this.facebook(""),this.primaryEmail(this.sEmailDefaultType),this.primaryPhone(this.sPhoneDefaultType),this.primaryAddress(this.sAddressDefaultType),this.personalEmail(""),this.personalStreetAddress(""),this.personalCity(""),this.personalState(""),this.personalZipCode(""),this.personalCountry(""),this.personalWeb(""),this.personalFax(""),this.personalPhone(""),this.personalMobile(""),this.businessEmail(""),this.businessCompany(""),this.businessDepartment(""),this.businessJob(""),this.businessOffice(""),this.businessStreetAddress(""),this.businessCity(""),this.businessState(""),this.businessZipCode(""),this.businessCountry(""),this.businessWeb(""),this.businessFax(""),this.businessPhone(""),this.otherEmail(""),this.otherBirthdayMonth("0"),this.otherBirthdayDay("0"),this.otherBirthdayYear("0"),this.otherNotes(""),this.etag(""),this.sharedToAll(!1),this.groups([])},R.prototype.switchToNew=function(){this.clear(),this.edited(!0),this.extented(!1),this.isNew(!0),Sb||this.displayNameFocused(!0)},R.prototype.switchToView=function(){this.edited(!1),this.extented(!1)},R.prototype.toObject=function(){var a={ContactId:this.idContact(),PrimaryEmail:this.primaryEmail(),PrimaryPhone:this.primaryPhone(),PrimaryAddress:this.primaryAddress(),UseFriendlyName:"1",Title:"",FullName:this.displayName(),FirstName:this.firstName(),LastName:this.lastName(),NickName:this.nickName(),Global:this.global()?"1":"0",ItsMe:this.itsMe()?"1":"0",Skype:this.skype(),Facebook:this.facebook(),HomeEmail:this.personalEmail(),HomeStreet:this.personalStreetAddress(),HomeCity:this.personalCity(),HomeState:this.personalState(),HomeZip:this.personalZipCode(),HomeCountry:this.personalCountry(),HomeFax:this.personalFax(),HomePhone:this.personalPhone(),HomeMobile:this.personalMobile(),HomeWeb:this.personalWeb(),BusinessEmail:this.businessEmail(),BusinessCompany:this.businessCompany(),BusinessJobTitle:this.businessJob(),BusinessDepartment:this.businessDepartment(),BusinessOffice:this.businessOffice(),BusinessStreet:this.businessStreetAddress(),BusinessCity:this.businessCity(),BusinessState:this.businessState(),BusinessZip:this.businessZipCode(),BusinessCountry:this.businessCountry(),BusinessFax:this.businessFax(),BusinessPhone:this.businessPhone(),BusinessWeb:this.businessWeb(),OtherEmail:this.otherEmail(),Notes:this.otherNotes(),ETag:this.etag(),BirthdayDay:this.otherBirthdayDay(),BirthdayMonth:this.otherBirthdayMonth(),BirthdayYear:this.otherBirthdayYear(),SharedToAll:this.sharedToAll()?"1":"0",GroupsIds:this.groups()};return a},R.prototype.parse=function(a){if(a&&"Object/CContact"===a["@Object"]){var b=0,c=0,d=0,e=[];switch(this.idContact(Mb.pExport(a,"IdContact","").toString()),this.idUser(Mb.pExport(a,"IdUser","").toString()),this.global(!!Mb.pExport(a,"Global",!1)),this.itsMe(!!Mb.pExport(a,"ItsMe",!1)),this.readOnly(!!Mb.pExport(a,"ReadOnly",!1)),this.displayName(Mb.pExport(a,"FullName","")),this.firstName(Mb.pExport(a,"FirstName","")),this.lastName(Mb.pExport(a,"LastName","")),this.nickName(Mb.pExport(a,"NickName","")),this.skype(Mb.pExport(a,"Skype","")),this.facebook(Mb.pExport(a,"Facebook","")),b=Mb.pInt(Mb.pExport(a,"PrimaryEmail",0))){case 1:b=Lb.ContactEmailType.Business;break;case 2:b=Lb.ContactEmailType.Other;break;default:case 0:b=Lb.ContactEmailType.Personal}switch(this.primaryEmail(b),c=Mb.pInt(Mb.pExport(a,"PrimaryPhone",0))){case 2:c=Lb.ContactPhoneType.Business;break;case 1:c=Lb.ContactPhoneType.Personal;break;default:case 0:c=Lb.ContactPhoneType.Mobile}switch(this.primaryPhone(c),d=Mb.pInt(Mb.pExport(a,"PrimaryAddress",0))){case 1:d=Lb.ContactAddressType.Business;break;default:case 0:d=Lb.ContactAddressType.Personal}this.primaryAddress(d),this.personalEmail(Mb.pExport(a,"HomeEmail","")),this.personalStreetAddress(Mb.pExport(a,"HomeStreet","")),this.personalCity(Mb.pExport(a,"HomeCity","")),this.personalState(Mb.pExport(a,"HomeState","")),this.personalZipCode(Mb.pExport(a,"HomeZip","")),this.personalCountry(Mb.pExport(a,"HomeCountry","")),this.personalWeb(Mb.pExport(a,"HomeWeb","")),this.personalFax(Mb.pExport(a,"HomeFax","")),this.personalPhone(Mb.pExport(a,"HomePhone","")),this.personalMobile(Mb.pExport(a,"HomeMobile","")),this.businessEmail(Mb.pExport(a,"BusinessEmail","")),this.businessCompany(Mb.pExport(a,"BusinessCompany","")),this.businessDepartment(Mb.pExport(a,"BusinessDepartment","")),this.businessJob(Mb.pExport(a,"BusinessJobTitle","")),this.businessOffice(Mb.pExport(a,"BusinessOffice","")),this.businessStreetAddress(Mb.pExport(a,"BusinessStreet","")),this.businessCity(Mb.pExport(a,"BusinessCity","")),this.businessState(Mb.pExport(a,"BusinessState","")),this.businessZipCode(Mb.pExport(a,"BusinessZip","")),this.businessCountry(Mb.pExport(a,"BusinessCountry","")),this.businessWeb(Mb.pExport(a,"BusinessWeb","")),this.businessFax(Mb.pExport(a,"BusinessFax","")),this.businessPhone(Mb.pExport(a,"BusinessPhone","")),this.otherEmail(Mb.pExport(a,"OtherEmail","")),this.otherBirthdayMonth(Mb.pExport(a,"BirthdayMonth","0").toString()),this.otherBirthdayDay(Mb.pExport(a,"BirthdayDay","0").toString()),this.otherBirthdayYear(Mb.pExport(a,"BirthdayYear","0").toString()),this.otherNotes(Mb.pExport(a,"Notes","")),this.etag(Mb.pExport(a,"ETag","")),this.sharedToAll(!!Mb.pExport(a,"SharedToAll",!1)),e=Mb.pExport(a,"GroupsIds",[]),_.isArray(e)&&this.groups(e)}},R.prototype.getFullEmail=function(a){var b=a;return""!==this.displayName()&&(b=""!==a?'"'+this.displayName()+'" <'+a+">":this.displayName()),b},R.prototype.getEmailsString=function(){return _.uniq(_.without([this.email(),this.personalEmail(),this.businessEmail(),this.otherEmail()],"")).join(",")},R.prototype.viewAllMails=function(){Ob.MailCache.searchMessagesInInbox("email:"+this.getEmailsString())},R.prototype.sendThisContact=function(){Ob.Routing.goDirectly(Ob.Links.compose(),["vcard",this])},R.prototype.isStrLink=function(a){return/^http/.test(a)},R.prototype.onCallClick=function(a){Ob.Phone.call(Mb.getFormattedPhone(a))},R.prototype.viewAllMailsWithContact=function(){var a=this.getEmailsString();Qb.SingleMode&&b.opener&&b.opener.App?(b.opener.App.MailCache.searchMessagesInCurrentFolder("email:"+a),b.opener.focus(),b.close()):Ob.MailCache.searchMessagesInCurrentFolder("email:"+a)},S.prototype.clear=function(){this.isNew(!1),this.idGroup(""),this.idUser(""),this.name(""),this.nameFocused(!1),this.edited(!1),this.isOrganization(!1),this.email(""),this.country(""),this.city(""),this.company(""),this.fax(""),this.phone(""),this.state(""),this.street(""),this.web(""),this.zip("")},S.prototype.populate=function(a){this.isNew(a.isNew()),this.idGroup(a.idGroup()),this.idUser(a.idUser()),this.name(a.name()),this.nameFocused(a.nameFocused()),this.edited(a.edited()),this.isOrganization(a.isOrganization()),this.email(a.email()),this.country(a.country()),this.city(a.city()),this.company(a.company()),this.fax(a.fax()),this.phone(a.phone()),this.state(a.state()),this.street(a.street()),this.web(a.web()),this.zip(a.zip())},S.prototype.switchToNew=function(){this.clear(),this.edited(!0),this.isNew(!0),Sb||this.nameFocused(!0)},S.prototype.switchToView=function(){this.edited(!1)},S.prototype.toObject=function(){return{GroupId:this.idGroup(),Name:this.name(),IsOrganization:this.isOrganization()?"1":"0",Email:this.email(),Country:this.country(),City:this.city(),Company:this.company(),Fax:this.fax(),Phone:this.phone(),State:this.state(),Street:this.street(),Web:this.web(),Zip:this.zip()}},T.prototype.parse=function(a,b){a&&"Object/CContactListItem"===Mb.pExport(a,"@Object","")&&(this.sId=Mb.pString(a.Id),this.sName=Mb.pString(a.Name),this.sEmail=Mb.pString(a.Email),this.bIsGroup=!!a.IsGroup,this.bIsOrganization=!!a.IsOrganization,this.bReadOnly=!!a.ReadOnly,this.bItsMe=!!a.ItsMe,this.bGlobal=Mb.isUnd(b)?!1:!!b,this.bSharedToAll=!!a.SharedToAll)},T.prototype.IsGroup=function(){return this.bIsGroup},T.prototype.Global=function(){return this.bGlobal},T.prototype.ReadOnly=function(){return this.bReadOnly},T.prototype.ItsMe=function(){return this.bItsMe},T.prototype.Id=function(){return this.sId},T.prototype.Name=function(){return this.sName},T.prototype.Email=function(){return this.sEmail},T.prototype.EmailAndName=function(){return this.sName&&this.sEmail&&0<this.sName.length&&0<this.sEmail.length?'"'+this.sName+'" <'+this.sEmail+">":this.sEmail},T.prototype.IsSharedToAll=function(){return this.bSharedToAll},T.prototype.IsOrganization=function(){return this.bIsOrganization},U.prototype.parse=function(a,b){this.iAccountId=a,this.options(parseInt(b.Options,10)),this.signature(b.Signature)},V.prototype.parse=function(a,b){this.iAccountId=a,this.enable=!!b.Enable,this.subject=Mb.pString(b.Subject),this.message=Mb.pString(b.Message)},X.prototype.parse=function(a,b){this.accountId=a;var c=[],d=0,e=0,f=null,g=null;if(_.isArray(b))for(e=b.length;e>d;d++)g=b[d],f=new W,f.id(g.IdFetcher),f.accountId(g.IdAccount),f.isEnabled(g.IsEnabled),f.isLocked(g.IsLocked),f.email(g.Email),f.userName(g.Name),f.folder(g.Folder),f.signatureOptions(g.SignatureOptions||0),f.signature(g.Signature),f.incomingMailServer(g.IncomingMailServer),f.incomingMailPort(g.IncomingMailPort),f.incomingMailLogin(g.IncomingMailLogin),f.leaveMessagesOnServer(g.LeaveMessagesOnServer),f.isOutgoingEnabled(g.IsOutgoingEnabled),f.outgoingMailServer(g.OutgoingMailServer),f.outgoingMailPort(g.OutgoingMailPort),f.outgoingMailAuth(g.OutgoingMailAuth),c.push(f);this.collection(c)},X.prototype.getFetcher=function(a){var b=null,c=0,d=0,e=this.collection();for(d=e.length;d>c;c++)e[c].id()===a&&(b=e[c]);return b},Y.prototype.parse=function(a,b){this.iAccountId=a,this.enable=!!b.Enable,this.email=Mb.pString(b.Email)},Z.prototype.parse=function(a,b){var c=0,d=b.length,e=null;if(this.iAccountId=a,_.isArray(b))for(d=b.length;d>c;c++)e=new $(a),e.parse(b[c]),this.collection.push(e)},$.prototype.parse=function(a){this.enable(!!a.Enable),this.field(Mb.pInt(a.Field)),this.condition(Mb.pInt(a.Condition)),this.filter(Mb.pString(a.Filter)),this.action(Mb.pInt(a.Action)),this.folder(Mb.pString(a.FolderFullName))},$.prototype.toString=function(){var a=[this.enable(),this.field(),this.condition(),this.filter(),this.action(),this.folder()];return a.join(":")},ab.prototype.showLoading=function(a){a&&""!==a?this.loadingMessage(a):this.loadingMessage(Mb.i18n("MAIN/LOADING")),this.loadingVisible(!0)},ab.prototype.hideLoading=function(){this.loadingVisible(!1)},ab.prototype.showReport=function(a,b){var c=this;b=b||5e3,a&&""!==a?(this.reportMessage(a),this.reportVisible(!0),isNaN(this.iReportTimeout)||clearTimeout(this.iReportTimeout),this.iReportTimeout=setTimeout(function(){c.reportVisible(!1)},b)):this.reportVisible(!1)},ab.prototype.showError=function(a,b,c,d){var e=this;c=!0,a&&""!==a?(this.gray(!!d),this.errorNotHide(!!c),this.errorMessage(a),this.errorVisible(!0),this.isHtmlError(b),clearTimeout(this.iErrorTimeout),c||(this.iErrorTimeout=setTimeout(function(){e.errorVisible(!1)},5e3))):this.errorVisible(!1)},ab.prototype.selfHideError=function(){this.errorVisible(!1)},ab.prototype.hideError=function(a){a=!!a,this.gray()===a&&this.errorVisible(!1)},bb.prototype.gotoMailbox=function(){return this.mobileApp?Ob.Routing.setHash(this.sMailboxHash):Ob.Routing.setLastMailboxHash(),!1},bb.prototype.onRoute=function(){this.changeCurrentAccount()},bb.prototype.changeCurrentAccount=function(){this.email(Qb.Accounts.getEmail())},bb.prototype.logout=function(){Ob.logout()},bb.prototype.swithToFullVersion=function(){Ob.Ajax.send({Action:"SetMobile",Mobile:0},function(){b.location.reload()},this)},cb.prototype.clear=function(){this.currentPage(1),this.count(0)},cb.prototype.setCount=function(a){this.count(a),this.currentPage()>this.pagesCount()&&this.currentPage(this.pagesCount())},cb.prototype.setPage=function(a,b){this.perPage(b),a>this.pagesCount()?this.currentPage(this.pagesCount()):this.currentPage(a)},cb.prototype.clickPage=function(a){var b=a.number;1>b&&(b=1),b>this.pagesCount()&&(b=this.pagesCount()),this.currentPage(b)},cb.prototype.clickFirstPage=function(){this.currentPage(1)},cb.prototype.clickPreviousPage=function(){var a=this.firstPage()-1;1>a&&(a=1),this.currentPage(a)},cb.prototype.clickNextPage=function(){var a=this.lastPage()+1;a>this.pagesCount()&&(a=this.pagesCount()),this.currentPage(a)},cb.prototype.clickLastPage=function(){this.currentPage(this.pagesCount())},db.prototype.init=function(){a(document.body).on("click",_.bind(function(){this.closeAllPopups()},this)),a(this.colorPickerDropdownDom()).on("click",function(a){a.stopPropagation()}),a(this.insertLinkDropdownDom()).on("click",function(a){a.stopPropagation()}),a(this.insertImageDropdownDom()).on("click",function(a){a.stopPropagation()}),this.initEditorUploader()},db.prototype.showLinkPopup=function(b){var c=a(this.workareaDom()),d=c.position(),e=b.position(),f=b.height();this.linkHref(b.attr("href")||b.text()),this.linkPopupLeft(Math.round(e.left+d.left)),this.linkPopupTop(Math.round(e.top+f+d.top)),this.visibleLinkPopup(!0)},db.prototype.hideLinkPopup=function(){this.visibleLinkPopup(!1)},db.prototype.showChangeLink=function(){this.visibleLinkHref(!0),this.hideLinkPopup()},db.prototype.changeLink=function(){this.oCrea.changeLink(this.linkHref()),this.hideChangeLink()},db.prototype.hideChangeLink=function(){this.visibleLinkHref(!1)},db.prototype.showImagePopup=function(b,c){var d=a(this.workareaDom()),e=d.position(),f=d.offset();this.imagePopupLeft(Math.round(c.pageX+e.left-f.left)),this.imagePopupTop(Math.round(c.pageY+e.top-f.top)),this.visibleImagePopup(!0)},db.prototype.hideImagePopup=function(){this.visibleImagePopup(!1)},db.prototype.resizeImage=function(a){var b={width:"auto"};switch(a){case Lb.HtmlEditorImageSizes.Small:b.width="300px";break;case Lb.HtmlEditorImageSizes.Medium:b.width="600px";break;case Lb.HtmlEditorImageSizes.Large:b.width="1200px";break;case Lb.HtmlEditorImageSizes.Original:b.width="auto"}this.oCrea.changeCurrentImage(b),this.visibleImagePopup(!1)},db.prototype.onImageOver=function(b){if("IMG"===b.target.nodeName&&!this.visibleImagePopup()){this.imageSelected(!0),this.tooltipText(Mb.i18n("HTMLEDITOR/CLICK_TO_EDIT_IMAGE"));var c=this,d=a(this.workareaDom()),e=d.position(),f=d.offset();d.bind("mousemove.image",function(a){c.tooltipPopupTop(Math.round(a.pageY+e.top-f.top)),c.tooltipPopupLeft(Math.round(a.pageX+e.left-f.left))})}return!0},db.prototype.onImageOut=function(){if(this.imageSelected()){this.imageSelected(!1);var b=a(this.workareaDom());b.unbind("mousemove.image")}return!0},db.prototype.initCrea=function(a,b){this.oCrea?(this.setText(a),this.oCrea.setTabIndex(b)):(this.init(),this.oCrea=new Crea({creaId:this.creaId,tabindex:b,text:a,fontNameArray:this.aFonts,defaultFontName:this.sDefaultFont,defaultFontSize:this.iDefaultSize,enableDrop:!1,onCursorMove:_.bind(this.setFontValuesFromText,this),onFocus:_.bind(this.onCreaFocus,this),onBlur:_.bind(this.onCreaBlur,this),onUrlIn:_.bind(this.showLinkPopup,this),onUrlOut:_.bind(this.hideLinkPopup,this),onImageSelect:_.bind(this.showImagePopup,this),onImageBlur:_.bind(this.hideImagePopup,this),onItemOver:_.bind(this.onImageOver,this),onItemOut:_.bind(this.onImageOut,this)},this.isEnable()))},db.prototype.setFocus=function(){this.oCrea&&this.oCrea.setFocus(!1)},db.prototype.changeSignatureContent=function(a){this.oCrea&&this.oCrea.changeSignatureContent(a)},db.prototype.setFontValuesFromText=function(){this.lockFontSubscribing(!0),this.selectedFont(this.oCrea.getFontName()),this.selectedSize(this.oCrea.getFontSize()),this.lockFontSubscribing(!1)},db.prototype.getText=function(a){return this.oCrea?this.oCrea.getText(a):""},db.prototype.setText=function(a){this.oCrea&&(this.oCrea.setText(a),this.inactive.valueHasMutated())},db.prototype.getNotDefaultText=function(){var a=this.getText();return this.removeAllTags(a)!==Mb.i18n("HTMLEDITOR/SIGNATURE_PLACEHOLDER")?a:""},db.prototype.removeAllTags=function(a){return a.replace(/<style>.*<\/style>/g,"").replace(/<[^>]*>/g,"")},db.prototype.setActivitySource=function(a){this.activitySource=a,this.activitySource.subscribe(function(){this.inactive(0===Mb.pInt(this.activitySource()))},this),this.inactive(0===Mb.pInt(this.activitySource()))},db.prototype.onCreaFocus=function(){this.oCrea&&(this.closeAllPopups(),this.activitySource(1),this.textFocused(!0))},db.prototype.onCreaBlur=function(){this.oCrea&&this.textFocused(!1)},db.prototype.closeAllPopups=function(){this.visibleInsertLinkPopup(!1),this.visibleInsertImagePopup(!1),this.visibleFontColorPopup(!1)},db.prototype.insertLink=function(){this.visibleInsertLinkPopup()||(this.linkForInsert(this.oCrea.getSelectedText()),this.closeAllPopups(),this.visibleInsertLinkPopup(!0),this.linkFocused(!0))},db.prototype.insertLinkFromPopup=function(a,b){this.linkForInsert().length>0&&this.oCrea.insertLink(this.linkForInsert()),this.closeInsertLinkPopup(a,b)},db.prototype.closeInsertLinkPopup=function(a,b){this.visibleInsertLinkPopup(!1),b&&b.stopPropagation()},db.prototype.textColor=function(){this.closeAllPopups(),this.visibleFontColorPopup(!0),this.oFontColorPicker.onShow(),this.oBackColorPicker.onShow()},db.prototype.colorToHex=function(a){if("#"===a.substr(0,1))return a;for(var b=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(a),c=parseInt(b[2],10),d=parseInt(b[3],10),e=parseInt(b[4],10),f=e|d<<8|c<<16,g=f.toString(16);g.length<6;)g="0"+g;return b[1]+"#"+g},db.prototype.setTextColorFromPopup=function(a){this.oCrea.textColor(this.colorToHex(a)),this.visibleFontColorPopup(!1)},db.prototype.setBackColorFromPopup=function(a){this.oCrea.backgroundColor(this.colorToHex(a)),this.visibleFontColorPopup(!1)},db.prototype.insertImage=function(){return this.allowInsertImage()&&!this.visibleInsertImagePopup()&&(this.imagePathFromWeb(""),this.closeAllPopups(),this.visibleInsertImagePopup(!0),this.initUploader()),!0},db.prototype.insertWebImageFromPopup=function(a,b){this.allowInsertImage()&&this.imagePathFromWeb().length>0&&this.oCrea.insertImage(this.imagePathFromWeb()),this.closeInsertImagePopup(a,b)},db.prototype.clearImages=function(){this.uploadedImagePathes([])},db.prototype.insertComputerImageFromPopup=function(b,c){var d=Mb.getViewLinkByHash(Qb.Accounts.currentId(),c.Hash),e=!1;this.allowInsertImage()&&d.length>0&&(e=this.oCrea.insertImage(d),e&&(a(this.oCrea.$editableArea).find('img[src="'+d+'"]').attr("data-x-src-cid",b),c.CID=b,this.uploadedImagePathes.push(c))),this.closeInsertImagePopup()},db.prototype.closeInsertImagePopup=function(a,b){this.visibleInsertImagePopup(!1),b&&b.stopPropagation()},db.prototype.initUploader=function(){this.imageUploaderButton()&&!this.oJua&&(this.oJua=new Jua({action:"?/Upload/Attachment/",name:"jua-uploader",queueSize:2,clickElement:this.imageUploaderButton(),disableMultiple:!0,disableAjaxUpload:!1,disableDragAndDrop:!0,hidden:{Token:function(){return Qb.Token},AccountID:function(){return Qb.Accounts.currentId()}}}),this.oJua.on("onSelect",_.bind(this.onFileUploadSelect,this)).on("onComplete",_.bind(this.onFileUploadComplete,this)))},db.prototype.initEditorUploader=function(){if(Qb.App.AllowInsertImage&&this.uploaderAreaDom()&&!this.editorUploader){var a=null,b=null;this.oParent&&this.oParent.composeUploaderDragOver&&this.oParent.onFileUploadProgress&&this.oParent.onFileUploadStart&&this.oParent.onFileUploadComplete?(a=_.bind(function(){this.editorUploaderBodyDragOver(!0),this.oParent.composeUploaderDragOver(!0)},this),b=_.bind(function(){this.editorUploaderBodyDragOver(!1),this.oParent.composeUploaderDragOver(!1)},this),this.editorUploader=new Jua({action:"?/Upload/Attachment/",name:"jua-uploader",queueSize:1,dragAndDropElement:this.uploaderAreaDom(),disableMultiple:!0,disableAjaxUpload:!1,disableDragAndDrop:!1,hidden:{Token:function(){return Qb.Token},AccountID:function(){return Qb.Accounts.currentId()}}}),this.editorUploader.on("onDragEnter",_.bind(this.oParent.composeUploaderDragOver,this.oParent,!0)).on("onDragLeave",_.bind(this.oParent.composeUploaderDragOver,this.oParent,!1)).on("onBodyDragEnter",a).on("onBodyDragLeave",b).on("onProgress",_.bind(this.oParent.onFileUploadProgress,this.oParent)).on("onSelect",_.bind(this.onEditorDrop,this)).on("onStart",_.bind(this.oParent.onFileUploadStart,this.oParent)).on("onComplete",_.bind(this.oParent.onFileUploadComplete,this.oParent))):(a=_.bind(this.editorUploaderBodyDragOver,this,!0),b=_.bind(this.editorUploaderBodyDragOver,this,!1),this.editorUploader=new Jua({queueSize:1,dragAndDropElement:this.uploaderAreaDom(),disableMultiple:!0,disableAjaxUpload:!1,disableDragAndDrop:!1}),this.editorUploader.on("onBodyDragEnter",a).on("onBodyDragLeave",b).on("onSelect",_.bind(this.onEditorDrop,this)))}},db.prototype.onEditorDrop=function(a,c){var d=null,e=null,f=this,g=!1,h=Math.random().toString();if(c&&c.File)if(Qb.App.AllowInsertImage&&0===c.File.type.indexOf("image/"))e=c.File,Qb.App.ImageUploadSizeLimit>0&&e.size>Qb.App.ImageUploadSizeLimit?Ob.Screens.showPopup(s,[Mb.i18n("COMPOSE/UPLOAD_ERROR_SIZE")]):(d=new b.FileReader,g=this.oCrea.bFocused,g||this.oCrea.setFocus(!0),this.oCrea.insertHtml('<img id="'+e.name+"_"+h+'" src="skins/Default/images/wait.gif" />'),g||this.oCrea.fixFirefoxCursorBug(),d.onload=function(){return function(a){f.oCrea.$editableArea.find('img[id="'+e.name+"_"+h+'"]').attr("src",a.target.result)}}(),d.readAsDataURL(e));else{if(this.oParent&&this.oParent.onFileUploadSelect)return this.oParent.onFileUploadSelect(a,c),!0;Ob.Screens.showPopup(s,[Mb.i18n("HTMLEDITOR/UPLOAD_ERROR_NOT_IMAGE")])}return!1},db.prototype.isFileImage=function(b){if("string"==typeof b.Type)return-1!==b.Type.indexOf("image");var c=b.FileName.lastIndexOf("."),d=b.FileName.substr(c+1),e=["jpg","jpeg","gif","tif","tiff","png"];return-1!==a.inArray(d,e)},db.prototype.onFileUploadSelect=function(a,b){return this.isFileImage(b)?(this.closeInsertImagePopup(),!0):(Ob.Screens.showPopup(s,[Mb.i18n("HTMLEDITOR/UPLOAD_ERROR_NOT_IMAGE")]),!1)},db.prototype.onFileUploadComplete=function(a,b,c){var d="";c&&c.Result?c.Result.Error?(d="size"===c.Result.Error?Mb.i18n("COMPOSE/UPLOAD_ERROR_SIZE"):Mb.i18n("COMPOSE/UPLOAD_ERROR_UNKNOWN"),Ob.Screens.showPopup(s,[d])):(this.oCrea.setFocus(!0),this.insertComputerImageFromPopup(a,c.Result.Attachment)):Ob.Screens.showPopup(s,[Mb.i18n("COMPOSE/UPLOAD_ERROR_UNKNOWN")])},eb.prototype.onShow=function(){a(this.colorPickerDom()).find("span.color-item").on("click",function(b){return function(){b.setColorFromPopup(a(this).data("color"))}}(this))},eb.prototype.setColorFromPopup=function(a){this.pickHandler.call(this.pickContext,a)},fb.prototype.hangup=function(){this.phone.hangup()},fb.prototype.call=function(){Ob.Phone.call(Mb.getFormattedPhone(this.input()))},fb.prototype.answer=function(){this.phone.answer()},fb.prototype.end=function(){this.action("online"),this.phone.reconnect()},fb.prototype.multiAction=function(){"offline_active"===this.action()?this.action("offline"):"online"===this.action()?(this.action("online_active"),this.focusInput()):"online_active"===this.action()&&this.input().length>0?(this.action("outgoing"),this.call()):"online"===this.action()&&0===this.input().length?this.focusInput():("outgoing"===this.action()||"incoming"===this.action()||"outgoing_connect"===this.action()||"incoming_connect"===this.action())&&(this.hangup(),this.input(""))},fb.prototype.phoneClick=function(){},fb.prototype.indicatorClick=function(){"online"===this.action()&&(this.action("online_active"),_.delay(_.bind(function(){this.phoneAutocompleteTrigger.valueHasMutated()},this),500)),this.focusInput()},fb.prototype.autocompleteCallback=function(a,b){var c={Action:"ContactSuggestions",Search:a,PhoneOnly:"1"};this.phoneAutocompleteItem(null),a=Mb.trim(a),""!==a?Ob.Ajax.send(c,function(a){var c=[],d="";a&&a.Result&&a.Result.List&&(_.each(a.Result.List,function(a){d=a.Name+" "+a.Email,_.each(a.Phones,function(a){c.push({label:a,category:d})
},this)},this),c=_.compact(c)),b(c)},this):this.missedCalls().length?b(_.map(this.missedCalls(),function(a){return{label:a.label,value:a.value,category:""}})):b([])},fb.prototype.focusInput=function(){_.delay(_.bind(function(){this.inputFocus(!0)},this),500)},gb.prototype.__name="CLoginViewModel",gb.prototype.onShow=function(){this.emailVisible()?this.emailFocus(!0):this.loginFocus(!0),Tb.toggleClass("screen-login-langblock",!this.viewLanguagesAsDropdown()),Tb.toggleClass("screen-login-description",""!==this.loginDescription())},gb.prototype.signIn=function(){this.sendRequest()},gb.prototype.onResponse=function(a){!1===a.Result?(this.loading(!1),Ob.Api.showErrorByCode(a,Mb.i18n("WARNING/LOGIN_PASS_INCORRECT"))):b.location.reload()},gb.prototype.sendRequest=function(){var a={Action:"Login",Email:this.emailVisible()?this.email():"",IncLogin:this.loginVisible()?this.login():"",IncPassword:this.password(),SignMe:this.signMe()?"1":"0"};this.loading(!0),Ob.Ajax.send(a,this.onResponse,this)},gb.prototype.changeLanguage=function(a){a&&this.allowLanguages()&&(this.currentLanguage(a),Ob.Ajax.send({Action:"LoginLanguageUpdate",Language:a},function(){b.location.reload()},this))},ib.prototype.createDatePickerObject=function(b){a(b).datepicker({showOtherMonths:!0,selectOtherMonths:!0,monthNames:Mb.getMonthNamesArray(),dayNamesMin:Mb.i18n("DATETIME/DAY_NAMES_MIN").split(" "),firstDay:Qb.User.CalendarWeekStartsOn,showOn:"both",buttonText:"",buttonImageOnly:!0,dateFormat:this.dateFormatDatePicker}),a(b).mousedown(function(){a("#ui-datepicker-div").toggle()})},ib.prototype.changeRoutingForMessageList=function(a,b,c,d,e){var f=Ob.Routing.setHash(Ob.Links.mailbox(a,b,c,d,e));f&&d.length>0&&this.search()===d&&this.listChangedThrottle(!this.listChangedThrottle())},ib.prototype.onEnterPress=function(a){a.openThread()},ib.prototype.onMessageDblClick=function(a){var b=this.folderList().getFolderByFullName(a.folder());b.type()===Lb.FolderTypes.Drafts?Ob.Routing.setHash(Ob.Links.composeFromMessage("drafts",a.folder(),a.uid())):Mb.WindowOpener.openMessage(a)},ib.prototype.onFolderListSubscribe=function(){this.setCurrentFolder(),this.requestMessageList()},ib.prototype.onRoute=function(a){var b=Ob.Links.parseMailbox(a),c=this.currentPage()!==b.Page||this.folderFullName()!==b.Folder||this.filters()!==b.Filters||this.search()!==b.Search;this.pageSwitcherLocked(!0),this.folderFullName()!==b.Folder||this.search()!==b.Search||this.filters()!==b.Filters?this.oPageSwitcher.clear():this.oPageSwitcher.setPage(b.Page,Qb.User.MailsPerPage),this.pageSwitcherLocked(!1),b.Page!==this.oPageSwitcher.currentPage()&&Ob.Routing.replaceHash(Ob.Links.mailbox(b.Folder,this.oPageSwitcher.currentPage(),b.Uid,b.Search,b.Filters)),this.currentPage(this.oPageSwitcher.currentPage()),this.folderFullName(b.Folder),this.filters(b.Filters),this.search(b.Search),this.searchInput(this.search()),this.searchSpan.notifySubscribers(),this.setCurrentFolder(),c&&this.requestMessageList(),this.highlightTrigger.notifySubscribers(!0)},ib.prototype.setCurrentFolder=function(){this.folderList().setCurrentFolder(this.folderFullName(),this.filters())},ib.prototype.requestMessageList=function(){var a=this.folderList().currentFolderFullName(),b=this.oPageSwitcher.currentPage();a.length>0?Ob.MailCache.changeCurrentMessageList(a,b,this.search(),this.filters()):(this.isLoading(!0),this.isError(!1),Ob.MailCache.getFolderList(Qb.Accounts.currentId()))},ib.prototype.calculateSearchStringFromAdvancedForm=function(){var b=this.searchInputFrom(),c=this.searchInputTo(),d=this.searchInputSubject(),e=this.searchInputText(),f=this.searchAttachmentsCheckbox(),g=(this.searchAttachments(),this.searchDateStart()),h=this.searchDateEnd(),i=[],j=function(b){return b=a.trim(b).replace(/"/g,'\\"'),(-1<b.indexOf(" ")||-1<b.indexOf('"'))&&(b='"'+b+'"'),b};return""!==b&&i.push("from:"+j(b)),""!==c&&i.push("to:"+j(c)),""!==d&&i.push("subject:"+j(d)),""!==e&&i.push("text:"+j(e)),f&&i.push("has:attachments"),(""!==g||""!==h)&&i.push("date:"+j(g)+"/"+j(h)),i.join(" ")},ib.prototype.onSearchClick=function(){var a=this.folderList().currentFolderFullName(),b=1,c=this.searchInput();this.bAdvancedSearch()&&(c=this.calculateSearchStringFromAdvancedForm(),this.searchInput(c),this.bAdvancedSearch(!1)),this.changeRoutingForMessageList(a,b,"",c,this.filters())},ib.prototype.onRetryClick=function(){this.requestMessageList()},ib.prototype.onClearSearchClick=function(){var a=this.folderList().currentFolderFullName(),b=this.currentMessage()?this.currentMessage().uid():"",c="",d=1;this.clearAdvancedSearch(),this.changeRoutingForMessageList(a,d,b,c,this.filters())},ib.prototype.onStopSearchClick=function(){this.onClearSearchClick()},ib.prototype.routeForMessage=function(a){if(Mb.log("Route for message",a),null!==a){var b=this.folderList().currentFolderFullName(),c=this.oPageSwitcher.currentPage(),d=a.uid(),e=this.search();""!==d&&(this.changeRoutingForMessageList(b,c,d,e,this.filters()),Ob.MailCache.currentMessage()&&d===Ob.MailCache.currentMessage().uid()&&Ob.MailCache.currentMessage.valueHasMutated())}},ib.prototype.onApplyBindings=function(b){var d=this,e=_.bind(function(a){a&&a.stopPropagation&&a.stopPropagation()},this);a(".message_list",b).on("click",function(){d.isFocused(!1)}).on("click",".message_sub_list .item .flag",function(a){d.onFlagClick(c.dataFor(this)),a&&a.stopPropagation&&a.stopPropagation()}).on("dblclick",".message_sub_list .item .flag",e).on("click",".message_sub_list .item .thread",e).on("dblclick",".message_sub_list .item .thread",e),this.selector.initOnApplyBindings(".message_sub_list .item",".message_sub_list .selected.item",".message_sub_list .item .custom_checkbox",a(".message_list",b),a(".message_list .scroll-inner",b))},ib.prototype.onFlagClick=function(a){Ob.MailCache.executeGroupOperation("MessageSetFlagged",[a.uid()],"flagged",!a.flagged())},ib.prototype.executeMarkAsRead=function(){Ob.MailCache.executeGroupOperation("MessageSetSeen",this.collectionCheckedUids(),"seen",!0)},ib.prototype.executeMarkAsUnread=function(){Ob.MailCache.executeGroupOperation("MessageSetSeen",this.collectionCheckedUids(),"seen",!1)},ib.prototype.executeFlag=function(){Ob.MailCache.executeGroupOperation("MessageSetFlagged",this.collectionCheckedUids(),"flagged",!0)},ib.prototype.executeUnflag=function(){Ob.MailCache.executeGroupOperation("MessageSetFlagged",this.collectionCheckedUids(),"flagged",!1)},ib.prototype.executeMarkAllRead=function(){Ob.MailCache.executeGroupOperation("MessageSetAllSeen",[],"seen",!0)},ib.prototype.executeMoveToFolder=function(a){Ob.MailCache.moveMessagesToFolder(a,this.collectionCheckedUids())},ib.prototype.onDeletePress=function(a){var b=_.map(a,function(a){return a.uid()});b.length>0&&this.deleteMessages(b)},ib.prototype.executeDelete=function(){this.deleteMessages(this.collectionCheckedUids())},ib.prototype.deleteMessages=function(a){var b=this.folderList().currentFolderFullName(),c=this.folderList().trashFolder(),d=c&&b===c.fullName(),e=this.folderList().spamFolder(),f=e&&b===e.fullName(),g=function(b){b&&Ob.MailCache.deleteMessages(a)};f?Ob.MailCache.deleteMessages(a):d?Ob.Screens.showPopup(t,[Mb.i18n("MAILBOX/CONFIRM_MESSAGES_DELETE"),g]):c?Ob.MailCache.moveMessagesToFolder(c.fullName(),this.collectionCheckedUids()):c||Ob.Screens.showPopup(t,[Mb.i18n("MAILBOX/CONFIRM_MESSAGES_DELETE_NO_TRASH_FOLDER"),g])},ib.prototype.executeSpam=function(){var a=this.folderList().spamFolderFullName();this.folderList().currentFolderFullName()!==a&&Ob.MailCache.moveMessagesToFolder(a,this.collectionCheckedUids())},ib.prototype.executeNotSpam=function(){var a=this.folderList().inboxFolder();a&&this.folderList().currentFolderFullName()!==a.fullName()&&Ob.MailCache.moveMessagesToFolder(a.fullName(),this.collectionCheckedUids())},ib.prototype.clearAdvancedSearch=function(){this.searchInputFrom(""),this.searchInputTo(""),this.searchInputSubject(""),this.searchInputText(""),this.bAdvancedSearch(!1),this.searchAttachmentsCheckbox(!1),this.searchAttachments(""),this.searchDateStart(""),this.searchDateEnd("")},ib.prototype.onAdvancedSearchClick=function(){this.bAdvancedSearch(!this.bAdvancedSearch())},jb.prototype.resizeDblClick=function(b,c){c.preventDefault(),c.stopPropagation?c.stopPropagation():c.cancelBubble=!0,Mb.removeSelection(),this.jqPanelHelper||(this.jqPanelHelper=a(".MailLayout .panel_helper")),this.jqPanelHelper.trigger("resize",[295,"min"])},jb.prototype.notifySender=function(){this.currentMessage()&&""!==this.currentMessage().readingConfirmation()&&(Ob.Ajax.send({Action:"MessageSendConfirmation",Confirmation:this.currentMessage().readingConfirmation(),Subject:Mb.i18n("MESSAGE/RETURN_RECEIPT_MAIL_SUBJECT"),Text:Mb.i18n("MESSAGE/RETURN_RECEIPT_MAIL_TEXT",{EMAIL:Qb.Accounts.getEmail(),SUBJECT:this.subject()}),ConfirmFolder:this.currentMessage().folder(),ConfirmUid:this.currentMessage().uid()}),this.currentMessage().readingConfirmation(""))},jb.prototype.onMessagesSubscribe=function(){!this.currentMessage()&&this.uid().length>0&&(Mb.log("onMessagesSubscribe"),Ob.MailCache.setCurrentMessage(this.uid(),this.folder()))},jb.prototype.onCurrentMessageSubscribe=function(){var b=null,c=null,d=this.currentMessage(),e=d?Qb.Accounts.getAccount(d.accountId()):null;if(this.replyText(""),this.replyDraftUid(""),this.replyCc(""),this.replyBcc(""),d&&this.uid()===d.uid()){if(this.subject(d.subject()),this.importance(d.importance()),this.from(d.oFrom.getDisplay()),this.fullFrom(d.oFrom.getFull()),d.oFrom.aCollection.length>0?this.oFromAddr(d.oFrom.aCollection[0]):this.oFromAddr(null),this.to(d.oTo.getFull()),this.aToAddr(d.oTo.aCollection),this.cc(d.oCc.getFull()),this.aCcAddr(d.oCc.aCollection),this.bcc(d.oBcc.getFull()),this.aBccAddr(d.oBcc.aCollection),this.currentAccountEmail(e.email()),this.aAllRecipients(_.uniq(_.union(this.aToAddr(),this.aCcAddr(),this.aBccAddr()))),this.mobileApp||this.requestContactsByEmail(_.union(d.oFrom.aCollection,this.aAllRecipients())),this.midDate(d.oDateModel.getMidDate()),this.fullDate(d.oDateModel.getFullDate()),this.isLoading(""!==d.uid()&&!d.completelyFilled()),this.setMessageBody(),this.rtlMessage(d.rtl()),this.singleMode()){var f=[],g=Date.now().toString();_.each(d.attachments(),_.bind(function(a){var b=new K;b.copyProperties(a),b.getInThumbQueue(g),f.push(b)},this)),this.attachments(f)}else this.attachments(d.attachments());null!==this.ical()&&this.ical().animation(!1),b=d.ical(),b&&this.singleMode()&&(b=this.getIcalCopy(b)),this.ical(b),null!==this.ical()&&_.defer(_.bind(function(){this.ical().animation(!0)},this)),c=d.vcard(),c&&this.singleMode()&&(c=this.getVcardCopy(c)),this.vcard(c),d.completelyFilled()?d.completelyFilledSubscription?(d.completelyFilledSubscription.dispose(),d.completelyFilledSubscription=void 0):d.completelyFilledSingleModeSubscription&&(d.completelyFilledSingleModeSubscription.dispose(),d.completelyFilledSingleModeSubscription=void 0):this.singleMode()?d.completelyFilledSingleModeSubscription=d.completelyFilled.subscribe(this.onCurrentMessageSubscribe,this):d.completelyFilledSubscription=d.completelyFilled.subscribe(this.onCurrentMessageSubscribe,this)}else this.isLoading(!1),a(this.domTextBody()).empty(),this.rtlMessage(!1),this.attachments([]),this.visiblePicturesControl(!1),this.visibleShowPicturesLink(!1),this.ical(null),this.vcard(null)},jb.prototype.fromMouseoverEvent=function(a,b){this.oFromAddr()&&this.oFromAddr().mouseoverEvent(a,b)},jb.prototype.fromMouseoutEvent=function(a,b){this.oFromAddr()&&this.oFromAddr().mouseoutEvent(a,b)},jb.prototype.requestContactsByEmail=function(a){_.each(a,_.bind(function(a){Ob.ContactsCache.getContactByEmail(a.sEmail,this.onContactResponse,this)},this))},jb.prototype.onContactResponse=function(a,b){a&&(this.recipientsContacts.push(a),this.recipientsContacts(_.uniq(this.recipientsContacts()))),_.each(_.union([this.oFromAddr()],this.aAllRecipients()),function(c){c&&c.sEmail===b&&(c.loaded(!0),a&&c.founded(!0))})},jb.prototype.getVcardCopy=function(a){var b=new Q;return b.uid(a.uid()),b.file(a.file()),b.name(a.name()),b.email(a.email()),b.isExists(a.isExists()),b.isJustSaved(a.isJustSaved()),b},jb.prototype.getIcalCopy=function(a){var b=new P;return b.uid(a.uid()),b.file(a.file()),b.type(a.type()),b.cancelDecision(a.cancelDecision()),b.replyDecision(a.replyDecision()),b.isJustSaved(a.isJustSaved()),b.location(a.location()),b.description(a.description()),b.when(a.when()),b.calendarId(a.calendarId()),b.selectedCalendar(a.selectedCalendar()),b.calendars(a.calendars()),b.animation(a.animation()),b},jb.prototype.setMessageBody=function(){if(this.currentMessage()){var b=this.currentMessage(),c=b.text(),d=c.length,e=5e6,f=a(this.domTextBody());this.textBody(c),_.defer(_.bind(function(){if(this.currentMessage()){var a=this.currentMessage();f.empty(),a.isPlain()||d>e?f.html(c):(f.append(a.getDomText().html()),this.visiblePicturesControl(a.hasExternals()&&!a.isExternalsAlwaysShown()),this.visibleShowPicturesLink(!a.isExternalsShown()),this.doHidingBlockquotes())}},this))}},jb.prototype.doHidingBlockquotes=function(){var b=120,c=80;a(a("blockquote",a(this.domTextBody())).get().reverse()).each(function(){var d=a(this),e=d.parents("blockquote"),f=a('<span class="blockquote_toggle"></span>').html(Mb.i18n("MESSAGE/SHOW_QUOTED_TEXT")),g=!0;0===e.length&&d.height()>b&&(d.addClass("blockquote_before_toggle").after(f).wrapInner('<div class="blockquote_content"></div>'),f.bind("click",function(){g?(d.height("auto"),f.html(Mb.i18n("MESSAGE/HIDE_QUOTED_TEXT")),g=!1):(d.height(c),f.html(Mb.i18n("MESSAGE/SHOW_QUOTED_TEXT")),g=!0),d.toggleClass("collapsed",g)}),d.height(c).toggleClass("collapsed",g))})},jb.prototype.onRoute=function(a){var b=Ob.Links.parseMailbox(a);""!==this.replyText()&&this.saveReplyMessage(),this.uid(b.Uid),this.folder(b.Folder),Mb.log("onRoute"),Ob.MailCache.setCurrentMessage(this.uid(),this.folder()),this.contentHasFocus(!0)},jb.prototype.showPictures=function(){Ob.MailCache.showExternalPictures(!1),this.visibleShowPicturesLink(!1),this.setMessageBody()},jb.prototype.alwaysShowPictures=function(){var a=this.currentMessage()?this.currentMessage().oFrom.getFirstEmail():"";a.length>0&&Ob.Ajax.send({Action:"EmailSafety",Email:a}),Ob.MailCache.showExternalPictures(!0),this.visiblePicturesControl(!1),this.setMessageBody()},jb.prototype.showDetails=function(){this.detailsVisible(!0)},jb.prototype.hideDetails=function(){this.detailsVisible(!1)},jb.prototype.openInNewWindow=function(){var a=Ob.MailCache.folderList().currentFolder(),b=a.type()===Lb.FolderTypes.Drafts;Mb.WindowOpener.openMessage(this.currentMessage(),b)},jb.prototype.addToContacts=function(a,b){this.processed()||(this.processed(!0),Ob.ContactsCache.addToContacts(b,a,this.onAddToContactsResponse,this))},jb.prototype.onAddToContactsResponse=function(a,b){a.Result&&""!==b.HomeEmail&&(Ob.Api.showReport(Mb.i18n("CONTACTS/REPORT_CONTACT_SUCCESSFULLY_ADDED")),Ob.ContactsCache.clearInfoAboutEmail(b.HomeEmail),Ob.ContactsCache.getContactByEmail(b.HomeEmail,this.onContactResponse,this)),this.processed(!1)},jb.prototype.executeReplyOrResend=function(a){this.currentMessage()&&(Ob.MessageSender.setReplyData(this.replyHtmlText(),this.replyDraftUid(),this.replyCc(),this.replyBcc()),this.replyText(""),this.replyDraftUid(""),this.replyCc(""),this.replyBcc(""),Ob.Routing.setHash(Ob.Links.composeFromMessage(a,this.currentMessage().folder(),this.currentMessage().uid())))},jb.prototype.executeReplyOrForward=function(a){this.currentMessage()&&(Ob.MessageSender.setReplyData(this.replyHtmlText(),this.replyDraftUid()),this.replyText(""),this.replyDraftUid(""),Ob.Routing.setHash(Ob.Links.composeFromMessage(a,this.currentMessage().folder(),this.currentMessage().uid())))},jb.prototype.executeReply=function(){this.executeReplyOrForward(Lb.ReplyType.Reply)},jb.prototype.executeReplyAll=function(){this.executeReplyOrForward(Lb.ReplyType.ReplyAll)},jb.prototype.executeResend=function(){this.executeReplyOrResend(Lb.ReplyType.Resend)},jb.prototype.executeForward=function(){this.executeReplyOrForward(Lb.ReplyType.Forward)},jb.prototype.executePrint=function(){var b=Mb.WindowOpener.open("",this.subject()+"-print"),c=this.currentMessage().getDomText(Mb.getAppPath()),d="";this.textBodyForNewWindow(c.html()),d=a(this.domMessageForPrint()).html(),a(b.document.body).html(d),b.print()},jb.prototype.executeSave=function(){this.currentMessage()&&Ob.Api.downloadByUrl(this.currentMessage().downloadLink())},jb.prototype.changeAddMenuVisibility=function(){var a=!this.visibleAddMenu();this.visibleAddMenu(a)},jb.prototype.onMessageSendOrSaveResponse=function(a,b){var c=Ob.MessageSender.onMessageSendOrSaveResponse(a,b);switch(c.Action){case"MessageSend":this.replySendingStarted(!1),c.Result&&this.replyText("");break;case"MessageSave":this.replySavingStarted(!1),c.Result&&this.replyDraftUid(c.NewUid)}},jb.prototype.sendReplyMessage=function(){""!==this.replyText()&&(this.replySendingStarted(!0),Ob.MessageSender.sendReplyMessage("MessageSend",this.replyHtmlText(),this.replyDraftUid(),this.onMessageSendOrSaveResponse,this),this.replyTextFocus(!1))},jb.prototype.saveReplyMessage=function(){""!==this.replyText()&&(this.replySavingStarted(!0),Ob.MessageSender.sendReplyMessage("MessageSave",this.replyHtmlText(),this.replyDraftUid(),this.onMessageSendOrSaveResponse,this))},jb.prototype.downloadAllAttachments=function(){this.currentMessage()&&this.currentMessage().downloadAllAttachments()},jb.prototype.saveAttachmentsToFiles=function(){this.currentMessage()&&this.currentMessage().saveAttachmentsToFiles()},jb.prototype.downloadAllAttachmentsSeparately=function(){this.currentMessage()&&this.currentMessage().downloadAllAttachmentsSeparately()},jb.prototype.onApplyBindings=function(b){a(b).on("mousedown","a",function(b){if(b&&3!==b.which){var c=a(this).attr("href");if(c&&"mailto:"===c.toString().toLowerCase().substr(0,7))return Ob.Api.openComposeMessage(c.toString().substr(7)),!1}return!0}),this.hotKeysBind()},jb.prototype.hotKeysBind=function(){a(document).on("keydown",a.proxy(function(a){var b=Ob.Screens.currentScreen()===Lb.Screens.Mailbox&&a&&!a.ctrlKey&&!a.shiftKey&&!Mb.isTextFieldFocused()&&this.isEnableReply();b&&a.keyCode===Lb.Key.q?(a.preventDefault(),this.replyTextFocus(!0)):b&&a.keyCode===Lb.Key.r&&this.executeReply()},this))},kb.prototype.gotoFolderList=function(){this.changeSelectedPanel(Lb.MobilePanel.Groups)},kb.prototype.gotoMessageList=function(){return this.changeSelectedPanel(Lb.MobilePanel.Items),!0},kb.prototype.gotoMessagePane=function(){Ob.MailCache.currentMessage()?this.changeSelectedPanel(Lb.MobilePanel.View):this.gotoMessageList()},kb.prototype.changeSelectedPanel=function(a){this.mobileApp&&this.selectedPanel(a)},kb.prototype.resizeDblClick=function(b,c){c.preventDefault(),c.stopPropagation?c.stopPropagation():c.cancelBubble=!0,Mb.removeSelection(),this.jqPanelHelper||(this.jqPanelHelper=a(".MailLayout .panel_helper")),this.jqPanelHelper.trigger("resize",[600,"max"])},kb.prototype.onRoute=function(a){this.oMessageList.onRoute(a),this.oMessagePane.onRoute(a)},kb.prototype.onShow=function(){this.oMessageList.selector.useKeyboardKeys(!0)},kb.prototype.onHide=function(){this.oMessageList.selector.useKeyboardKeys(!1)},kb.prototype.onApplyBindings=function(){var b=this;this.oMessageList.onApplyBindings(this.$viewModel),this.oMessagePane.onApplyBindings(this.$viewModel),a(this.domFolderList()).on("click","span.folder",function(){b.oMessageList.executeMoveToFolder(a(this).data("folder"))}),this.hotKeysBind()},kb.prototype.hotKeysBind=function(){a(document).on("keydown",a.proxy(function(a){{var c=a.keyCode,d=a&&!a.ctrlKey&&!a.altKey&&!a.shiftKey&&!Mb.isTextFieldFocused()&&Ob.Screens.currentScreen()===Lb.Screens.Mailbox,e=this.oMessageList,f=e.collection()[0],g=f&&Ob.MailCache.currentMessage()&&f.uid()===Ob.MailCache.currentMessage().uid();Ob.Screens.currentScreen()===Lb.Screens.Mailbox}d&&c===Lb.Key.s||d&&g&&c===Lb.Key.Up?(a.preventDefault(),this.searchFocus()):e.isFocused()&&a&&c===Lb.Key.Down&&f?(e.isFocused(!1),e.routeForMessage(f)):d&&c===Lb.Key.n&&(b.location.href="#compose")},this))},kb.prototype.getThreadCheckedUidsFromList=function(a){var b=Ob.MailCache.folderList().currentFolder(),c=[];return _.each(a,function(a){a.threadCount()>0&&!a.threadOpened()&&_.each(a.threadUids(),function(a){var d=b.oMessages[a];d&&d.checked()&&c.push(a)})}),c},kb.prototype.dragAndDropHelper=function(b){b&&b.checked(!0);var c=this.oMessageList.selector.itemSelected(),d=Mb.draggableMessages(),e=this.selectedUids(),f=e.length;return 0===e.length&&c&&(e=[c.uid()],f=1),d.data("p7-message-list-folder",this.folderList().currentFolderFullName()),d.data("p7-message-list-uids",e),a(".count-text",d).text(Mb.i18n("MAILBOX/DRAG_TEXT_PLURAL",{COUNT:f},null,f)),d},kb.prototype.messagesDrop=function(a,b,c){if(a){var d=c&&c.helper?c.helper:null,e=d?d.data("p7-message-list-folder"):"",f=d?d.data("p7-message-list-uids"):null;""!==e&&null!==f&&(Mb.uiDropHelperAnim(b,c),this.oMessageList.executeMoveToFolder(a.fullName()))}},kb.prototype.searchFocus=function(){this.oMessageList.selector.useKeyboardKeys()&&!Mb.isTextFieldFocused()&&this.oMessageList.isFocused(!0)},kb.prototype.backToList=function(){Ob.Routing.setPreviousHash()},lb.prototype.__name="CComposeViewModel",lb.prototype.isEnableSending=function(){var a=0===this.toAddr().length&&0===this.ccAddr().length&&0===this.bccAddr().length,b=0!==this.folderList().iAccountId;return b&&!this.sending()&&!a&&this.allAttachmentsUploaded()},lb.prototype.isEnableSaving=function(){var a=0!==this.folderList().iAccountId;return a&&!this.sending()&&!this.saving()},lb.prototype.onApplyBindings=function(){var b=_.bind(function(a,b){this.autocompleteCallback(a.term,b)},this);this.initUploader(),a(this.toAddrDom()).inputosaurus({width:"auto",parseOnBlur:!0,autoCompleteSource:b,change:_.bind(function(a){this.lockToAddr(!0),this.toAddr(a.target.value),this.lockToAddr(!1)},this),copy:_.bind(function(a){this.inputosaurusBuffer=a},this),paste:_.bind(function(){var a=this.inputosaurusBuffer||"";return this.inputosaurusBuffer="",a},this),mobileDevice:Wb}),a(this.ccAddrDom()).inputosaurus({width:"auto",parseOnBlur:!0,autoCompleteSource:b,change:_.bind(function(a){this.lockCcAddr(!0),this.ccAddr(a.target.value),this.lockCcAddr(!1)},this),copy:_.bind(function(a){this.inputosaurusBuffer=a},this),paste:_.bind(function(){var a=this.inputosaurusBuffer||"";return this.inputosaurusBuffer="",a},this),mobileDevice:Wb}),a(this.bccAddrDom()).inputosaurus({width:"auto",parseOnBlur:!0,autoCompleteSource:b,change:_.bind(function(a){this.lockBccAddr(!0),this.bccAddr(a.target.value),this.lockBccAddr(!1)},this),copy:_.bind(function(a){this.inputosaurusBuffer=a},this),paste:_.bind(function(){var a=this.inputosaurusBuffer||"";return this.inputosaurusBuffer="",a},this),mobileDevice:Wb}),this.hotKeysBind()},lb.prototype.hotKeysBind=function(){a(document).on("keydown",a.proxy(function(a){if(a&&a.ctrlKey&&!a.altKey&&!a.shiftKey){var b=a.keyCode,c=Ob.Screens.currentScreen()===Lb.Screens.Compose,d=c&&a&&a.ctrlKey,e=this.editableArea(),f=Lb.Key;!e&&this.oHtmlEditor.oCrea&&this.editableArea(this.oHtmlEditor.oCrea.$editableArea[0]),d&&b===f.s?(a.preventDefault(),a.returnValue=!1,this.isEnableSaving()&&this.saveCommand()):d&&b===f.Enter&&""!==this.toAddr()&&this.sendCommand()}},this))},lb.prototype.getMessageOnRoute=function(){var a=this.routeParams(),b="",c="";""!==this.routeType()&&3===a.length&&(b=a[1],c=a[2],Ob.MailCache.getMessage(b,c,this.onMessageResponse,this)),this.routeParams([])},lb.prototype.onShow=function(){this.useSaveMailInSentItems(Qb.User.getUseSaveMailInSentItems()),this.saveMailInSentItems(Qb.User.getSaveMailInSentItems()),this.oHtmlEditor.initCrea(this.textBody(),"7"),this.oHtmlEditor.clearImages(),this.commitedTextBody(this.oHtmlEditor.getText()),this.shown(!0),this.startAutosaveTimer(),this.focusAfterFilling(),Tb.addClass("screen-compose"),this.oJua&&this.oJua.setDragAndDropEnabledStatus(!0)},lb.prototype.onRoute=function(a){var c="",d={};switch(this.changeSenderAccountId(Qb.Accounts.currentId()),this.messageUploadAttachmentsStarted(!1),this.draftUid(""),this.draftInfo.removeAll(),this.setDataFromMessage(new N),this.isDraftsCleared(!1),this.routeType(a.length>0?a[0]:""),this.routeType()){case Lb.ReplyType.Reply:case Lb.ReplyType.ReplyAll:case Lb.ReplyType.Resend:case Lb.ReplyType.Forward:case"drafts":this.routeParams(a),0!==this.folderList().iAccountId&&this.getMessageOnRoute();break;default:c=Ob.MessageSender.getSignatureText(this.senderAccountId(),null),Qb.SingleMode&&b.opener&&b.opener.oMessageParametersFromCompose?(this.setMessageDataInSingleMode(b.opener.oMessageParametersFromCompose),b.opener.oMessageParametersFromCompose=void 0):""!==c&&this.textBody("<br /><br />"+c),"to"===this.routeType()&&2===a.length&&(d=Ob.Links.parseToAddr(a[1]),this.toAddr(d.to),d.hasMailto&&(this.subject(d.subject),this.ccAddr(d.cc),this.bccAddr(d.bcc),this.textBody(d.body))),"vcard"===this.routeType()&&2===a.length&&this.addContactAsAttachment(a[1]),"file"===this.routeType()&&2===a.length&&this.addFilesAsAttachment(a[1])}this.visibleCc(""!==this.ccAddr()),this.visibleBcc(""!==this.bccAddr()),this.commit(this.oHtmlEditor.getText()),this.focusAfterFilling()},lb.prototype.focusAfterFilling=function(){0===this.toAddr().length?this.toAddrFocused(!0):0===this.subject().length?this.subjectFocused(!0):this.oHtmlEditor.setFocus()},lb.prototype.onHide=function(){this.shown(!1),this.stopAutosaveTimer(),this.toAddrFocused(!1),this.ccAddrFocused(!1),this.bccAddrFocused(!1),this.subjectFocused(!1),this.oHtmlEditor.closeAllPopups(),Tb.removeClass("screen-compose").removeClass("screen-compose-cc").removeClass("screen-compose-bcc").removeClass("screen-compose-attachments"),this.oJua&&this.oJua.setDragAndDropEnabledStatus(!1)},lb.prototype.sendingAndSavingSubscription=function(){(this.sending()||this.saving())&&this.stopAutosaveTimer(),this.sending()||this.saving()||this.startAutosaveTimer()},lb.prototype.stopAutosaveTimer=function(){b.clearTimeout(this.autoSaveTimer)},lb.prototype.startAutosaveTimer=function(){if(this.shown()){var a=_.bind(this.executeSave,this,!0);this.stopAutosaveTimer(),Qb.App.AutoSave&&(this.autoSaveTimer=b.setTimeout(a,1e3*Qb.App.AutoSaveIntervalSeconds))}},lb.prototype.onMessageResponse=function(a){var b=null,c=null;if(null===a)this.setDataFromMessage(new N);else{switch(this.routeType()){case Lb.ReplyType.Reply:case Lb.ReplyType.ReplyAll:case Lb.ReplyType.Resend:c=Ob.MessageSender.getFetcherOrIdentityByRecipients(a.oTo.aCollection,a.accountId()),c&&this.selectedFetcherOrIdentity(c),b=Ob.MessageSender.getReplyDataFromMessage(a,this.routeType(),this.senderAccountId(),c),this.draftInfo(b.DraftInfo),this.draftUid(b.DraftUid),this.toAddr(b.To),this.ccAddr(b.Cc),this.bccAddr(b.Bcc),this.subject(b.Subject),this.textBody(b.Text),this.attachments(b.Attachments),this.inReplyTo(b.InReplyTo),this.references(b.References);break;case Lb.ReplyType.Forward:c=Ob.MessageSender.getFetcherOrIdentityByRecipients(a.oTo.aCollection,a.accountId()),c&&this.selectedFetcherOrIdentity(c),b=Ob.MessageSender.getReplyDataFromMessage(a,this.routeType(),this.senderAccountId(),c),this.draftInfo(b.DraftInfo),this.draftUid(b.DraftUid),this.toAddr(b.To),this.ccAddr(b.Cc),this.subject(b.Subject),this.textBody(b.Text),this.attachments(b.Attachments),this.inReplyTo(b.InReplyTo),this.references(b.References);break;case"drafts":this.draftUid(a.uid()),this.setDataFromMessage(a)}this.routeType("")}this.attachments().length>0&&this.requestAttachmentsTempName(),this.visibleCc(""!==this.ccAddr()),this.visibleBcc(""!==this.bccAddr()),this.commit(this.oHtmlEditor.getText()),this.focusAfterFilling()},lb.prototype.changeSenderAccountId=function(a,b,c){Qb.Accounts.hasAccountWithId(a)?this.senderAccountId(a):Qb.Accounts.hasAccountWithId(this.senderAccountId())||this.senderAccountId(Qb.Accounts.currentId()),this.fillSenderList(b,c)},lb.prototype.fillSenderList=function(a,b){var c=[],d=Qb.Accounts.getAccount(this.senderAccountId());d&&(c.push({fullEmail:d.fullEmail(),id:""}),d.fetchers()?_.each(d.fetchers().collection(),function(a){var b=a.fullEmail();a.isOutgoingEnabled()&&b.length>0&&c.push({fullEmail:b,id:"fetcher"+a.id()})},this):d.fetchersSubscribtion||(d.fetchersSubscribtion=d.fetchers.subscribe(function(){this.fillSenderList(a,b)},this)),_.isArray(d.identities())?_.each(d.identities(),function(a){a.enabled()&&c.push({fullEmail:a.fullEmail(),id:Mb.pString(a.id())})},this):d.identitiesSubscribtion||(d.identitiesSubscribtion=d.identities.subscribe(function(){this.fillSenderList(a,b)},this))),this.senderList(c.length>0?c:[]),a&&""!==a?this.changeSelectedSenderByEmail(a):this.selectedFetcherOrIdentity(b||null)},lb.prototype.changeSelectedSenderByEmail=function(a){var b=Qb.Accounts.getAccount(this.senderAccountId()),c=b?b.getFetcherOrIdentityByEmail(a):null;c&&c.id()&&this.selectedFetcherOrIdentity(c)},lb.prototype.changeSignature=function(){var a="",b=Qb.Accounts.getAccount(this.senderAccountId()),c=this.selectedFetcherOrIdentity(),d=!!(c?c.useSignature?c.useSignature():c.signatureOptions():!0);b&&(d&&(a=c&&c.accountId()===b.id()?c.signature():b.signature()&&parseInt(b.signature().options())?b.signature().signature():""),this.oHtmlEditor.changeSignatureContent(a))},lb.prototype.setDataFromMessage=function(a){var b=a.getDomText().html();this.draftInfo(a.draftInfo()),this.inReplyTo(a.inReplyTo()),this.references(a.references()),this.toAddr(a.oTo.getFull()),this.ccAddr(a.oCc.getFull()),this.bccAddr(a.oBcc.getFull()),this.subject(a.subject()),this.attachments(a.attachments()),this.textBody(b?b:a.text()),this.selectedImportance(a.importance()),this.selectedSensitivity(a.sensitivity()),this.readingConfirmation(a.readingConfirmation()),this.changeSenderAccountId(a.accountId(),a.oFrom.getFirstEmail())},lb.prototype.addFilesAsAttachment=function(a){var b=null,c=[],d=null;_.each(a,function(a){b=new K,b.fileName(a.fileName()),b.hash(a.hash()),b.uploadStarted(!0),this.attachments.push(b),c.push(a.hash())},this),c.length>0&&(d={Action:"FilesUpload",Hashes:c},this.messageUploadAttachmentsStarted(!0),Ob.Ajax.send(d,this.onFilesUpload,this))},lb.prototype.onFilesUpload=function(b,c){var d=b.Result,e=c.Hashes;this.messageUploadAttachmentsStarted(!1),a.isArray(d)?_.each(d,function(a){var c=_.find(this.attachments(),function(b){return b.hash()===a.Hash});c&&(c.parseFromContact(a,b.AccountID),c.hash(a.NewHash))},this):_.each(e,function(a){var b=_.find(this.attachments(),function(b){return b.hash()===a});b&&b.errorFromContact()},this)},lb.prototype.addContactAsAttachment=function(a){var b=new K,c=null;a&&(b.fileName("contact-"+a.idContact()+".vcf"),b.uploadStarted(!0),this.attachments.push(b),c={Action:"ContactVCardUpload",ContactId:a.idContact(),Global:a.global()?"1":"0",Name:b.fileName()},this.messageUploadAttachmentsStarted(!0),Ob.Ajax.send(c,this.onContactVCardUpload,this))},lb.prototype.onContactVCardUpload=function(a,b){var c=a.Result,d=null;this.messageUploadAttachmentsStarted(!1),c?(d=_.find(this.attachments(),function(a){return a.fileName()===c.Name&&a.uploadStarted()}),d&&d.parseFromContact(c,a.AccountID)):(d=_.find(this.attachments(),function(a){return a.fileName()===b.Name&&a.uploadStarted()}),d&&d.errorFromContact())},lb.prototype.requestAttachmentsTempName=function(){var a=_.map(this.attachments(),function(a){return a.uploadStarted(!0),a.hash()}),b={Action:"MessageUploadAttachments",Attachments:a};a.length>0&&(this.messageUploadAttachmentsStarted(!0),Ob.Ajax.send(b,this.onMessageUploadAttachmentsResponse,this))},lb.prototype.onMessageUploadAttachmentsResponse=function(a){this.messageUploadAttachmentsStarted(!1),a.Result&&_.each(a.Result,_.bind(this.setAttachTepmNameByHash,this))},lb.prototype.setAttachTepmNameByHash=function(a,b){_.each(this.attachments(),function(c){c.hash()===a&&(c.tempName(b),c.uploadStarted(!1))})},lb.prototype.setMessageDataInSingleMode=function(a){this.draftInfo(a.draftInfo),this.draftUid(a.draftUid),this.inReplyTo(a.inReplyTo),this.references(a.references),this.toAddr(a.toAddr),this.ccAddr(a.ccAddr),this.bccAddr(a.bccAddr),this.subject(a.subject),this.attachments(_.map(a.attachments,function(a){var b=new K;
return b.parse(a,this.senderAccountId()),b},this)),this.textBody(a.textBody),this.selectedImportance(a.selectedImportance),this.selectedSensitivity(a.selectedSensitivity),this.readingConfirmation(a.readingConfirmation),this.changeSenderAccountId(a.senderAccountId,"",a.selectedFetcherOrIdentity)},lb.prototype.isEmpty=function(){var a=Mb.trim(this.toAddr()),b=Mb.trim(this.ccAddr()),c=Mb.trim(this.bccAddr()),d=Mb.trim(this.subject()),e=this.oHtmlEditor.getText(),f=Mb.trim(e.replace(/<br *\/{0,1}>/gi,"\n").replace(/<[^>]*>/g,"").replace(/&nbsp;/g," "));return""===a&&""===b&&""===c&&""===d&&0===this.attachments().length&&""===f},lb.prototype.commit=function(a){this.toAddr.commit(),this.ccAddr.commit(),this.bccAddr.commit(),this.subject.commit(),this.commitedTextBody(a),this.attachmentsChanged(!1)},lb.prototype.isChanged=function(){return this.toAddr.changed()||this.ccAddr.changed()||this.bccAddr.changed()||this.subject.changed()||this.commitedTextBody()!==this.oHtmlEditor.getText()||this.attachmentsChanged()},lb.prototype.executeBackToList=function(){this.isChanged()&&!this.isEmpty()&&this.executeSave(!0),Qb.SingleMode?b.close():this.shown()&&Ob.Routing.setPreviousHash()},lb.prototype.onFileUploadSelect=function(a,b){var c,d=Mb.i18n("COMPOSE/UPLOAD_ERROR_FILENAME_SIZE",{FILENAME:b.FileName});return Qb.App.AttachmentSizeLimit>0&&b.Size>Qb.App.AttachmentSizeLimit?(Ob.Screens.showPopup(s,[d]),!1):(c=new K,c.onUploadSelect(a,b),this.attachments.push(c),this.attachmentsChanged(!0),!0)},lb.prototype.getAttachmentByUid=function(a){return _.find(this.attachments(),function(b){return b.uploadUid()===a})},lb.prototype.onFileUploadStart=function(a){var b=this.getAttachmentByUid(a);b&&b.onUploadStart()},lb.prototype.onFileUploadProgress=function(a,b,c){var d=this.getAttachmentByUid(a);d&&d.onUploadProgress(b,c)},lb.prototype.onFileUploadComplete=function(a,b,c){var d=this.getAttachmentByUid(a);d&&d.onUploadComplete(a,b,c)},lb.prototype.onFileRemove=function(a){var b=this.getAttachmentByUid(a);this.oJua&&this.oJua.cancel(a),this.attachments.remove(b),this.attachmentsChanged(!0)},lb.prototype.initUploader=function(){this.composeUploaderButton()&&(this.oJua=new Jua({action:"?/Upload/Attachment/",name:"jua-uploader",queueSize:2,clickElement:this.composeUploaderButton(),dragAndDropElement:this.composeUploaderDropPlace(),disableAjaxUpload:!1,disableFolderDragAndDrop:!1,disableDragAndDrop:!1,hidden:{Token:function(){return Qb.Token},AccountID:function(){return Qb.Accounts.currentId()}}}),this.oJua.on("onDragEnter",_.bind(this.composeUploaderDragOver,this,!0)).on("onDragLeave",_.bind(this.composeUploaderDragOver,this,!1)).on("onBodyDragEnter",_.bind(this.composeUploaderBodyDragOver,this,!0)).on("onBodyDragLeave",_.bind(this.composeUploaderBodyDragOver,this,!1)).on("onProgress",_.bind(this.onFileUploadProgress,this)).on("onSelect",_.bind(this.onFileUploadSelect,this)).on("onStart",_.bind(this.onFileUploadStart,this)).on("onComplete",_.bind(this.onFileUploadComplete,this)),this.allowDragNDrop(this.oJua.isDragAndDropSupported()))},lb.prototype.getSendSaveParameters=function(a){var b=Ob.MessageSender.convertAttachmentsForSending(this.attachments());return _.each(this.oHtmlEditor.uploadedImagePathes(),function(a){b[a.TempName]=[a.Name,a.CID,"1","1"]}),{AccountID:this.senderAccountId(),FetcherID:this.selectedFetcherOrIdentity()&&this.selectedFetcherOrIdentity().FETCHER?this.selectedFetcherOrIdentity().id():"",IdentityID:this.selectedFetcherOrIdentity()&&!this.selectedFetcherOrIdentity().FETCHER?this.selectedFetcherOrIdentity().id():"",DraftInfo:this.draftInfo(),DraftUid:this.draftUid(),To:this.toAddr(),Cc:this.ccAddr(),Bcc:this.bccAddr(),Subject:this.subject(),Text:this.oHtmlEditor.getText(a),Importance:this.selectedImportance(),Sensivity:this.selectedSensitivity(),ReadingConfirmation:this.readingConfirmation()?"1":"0",Attachments:b,InReplyTo:this.inReplyTo(),References:this.references()}},lb.prototype.onMessageSendOrSaveResponse=function(a,b){var c=Ob.MessageSender.onMessageSendOrSaveResponse(a,b);switch(this.commit(b.Text),c.Action){case"MessageSave":c.Result&&c.NewUid&&this.draftUid(c.NewUid),this.saving(!1);break;case"MessageSend":c.Result&&(Ob.MailCache.deletedDraftMessageUid(this.draftUid()),this.executeBackToList()),this.sending(!1)}},lb.prototype.verifyDataForSending=function(){var a=Mb.getIncorrectEmailsFromAddressString(this.toAddr()),b=Mb.getIncorrectEmailsFromAddressString(this.ccAddr()),c=Mb.getIncorrectEmailsFromAddressString(this.bccAddr()),d=_.union(a,b,c),e=Mb.i18n("COMPOSE/WARNING_INPUT_CORRECT_EMAILS")+d.join(", ");return d.length>0?(Ob.Screens.showPopup(s,[e]),!1):!0},lb.prototype.executeSend=function(){this.isEnableSending()&&this.verifyDataForSending()&&(this.sending(!0),this.requiresPostponedSending(!this.allowStartSending()),Ob.MessageSender.send("MessageSend",this.getSendSaveParameters(!0),this.saveMailInSentItems(),!0,this.onMessageSendOrSaveResponse,this,this.requiresPostponedSending()))},lb.prototype.executeSaveCommand=function(){this.executeSave(!1)},lb.prototype.executeSave=function(a){this.isEnableSaving()&&(!a||this.isChanged()?(this.saving(!0),Ob.MessageSender.send("MessageSave",this.getSendSaveParameters(!1),this.saveMailInSentItems(),!a,this.onMessageSendOrSaveResponse,this)):a&&this.startAutosaveTimer())},lb.prototype.changeBccVisibility=function(){this.visibleBcc(!this.visibleBcc()),this.visibleBcc()?this.bccAddrFocused(!0):this.toAddrFocused(!0)},lb.prototype.changeCcVisibility=function(){this.visibleCc(!this.visibleCc()),this.visibleCc()?this.ccAddrFocused(!0):this.toAddrFocused(!0)},lb.prototype.getMessageDataForSingleMode=function(){var a=_.map(this.attachments(),function(a){return{"@Object":"Object/CApiMailAttachment",FileName:a.fileName(),TempName:a.tempName(),MimeType:a.type(),MimePartIndex:a.mimePartIndex(),EstimatedSize:a.size(),CID:a.cid(),ContentLocation:a.contentLocation(),IsInline:a.inline(),IsLinked:a.linked(),Hash:a.hash()}});return{draftInfo:this.draftInfo(),draftUid:this.draftUid(),inReplyTo:this.inReplyTo(),references:this.references(),senderAccountId:this.senderAccountId(),selectedFetcherOrIdentity:this.selectedFetcherOrIdentity(),toAddr:this.toAddr(),ccAddr:this.ccAddr(),bccAddr:this.bccAddr(),subject:this.subject(),attachments:a,textBody:this.oHtmlEditor.getText(),selectedImportance:this.selectedImportance(),selectedSensitivity:this.selectedSensitivity(),readingConfirmation:this.readingConfirmation()}},lb.prototype.openInNewWindow=function(){b.oMessageParametersFromCompose=this.getMessageDataForSingleMode(),Mb.WindowOpener.openTab("#"+Lb.Screens.SingleCompose),this.commit(this.oHtmlEditor.getText()),this.executeBackToList()},lb.prototype.autocompleteCallback=function(a,b){var c={Action:"ContactSuggestions",Search:a};a=Mb.trim(a),""!==a?Ob.Ajax.send(c,function(a){var c=[];a&&a.Result&&a.Result&&a.Result.List&&(c=_.map(a.Result.List,function(a){var b="",c=a.Email;return a.IsGroup?b=a.Name&&0<Mb.trim(a.Name).length?'"'+a.Name+'" ('+a.Email+")":"("+a.Email+")":a.Name&&0<Mb.trim(a.Name).length?(b='"'+a.Name+'" <'+a.Email+">",c=b):b=a.Email,{label:b,value:c}}),c=_.compact(c)),b(c)},this):b([])},mb.prototype.onFileImportStart=function(){this.importing(!0)},mb.prototype.onFileImportComplete=function(a,b,c){if(this.importing(!1),this.oParent.requestContactList(),b&&c&&c.Result){var d=Mb.pInt(c.Result.ImportedCount);d>0?Ob.Api.showReport(Mb.i18n("CONTACTS/CONTACT_IMPORT_HINT_PLURAL",{NUM:d},null,d)):Ob.Api.showError(Mb.i18n("WARNING/CONTACTS_IMPORT_NO_CONTACTS"))}else Ob.Api.showError(Mb.i18n("WARNING/CONTACTS_IMPORT_ERROR"))},mb.prototype.onApplyBindings=function(b){this.oJua=new Jua({action:"?/Upload/Contacts/",name:"jua-uploader",queueSize:1,clickElement:a("#jue_import_button",b),disableAjaxUpload:!1,disableDragAndDrop:!0,disableMultiple:!0,hidden:{Token:function(){return Qb.Token},AccountID:function(){return Qb.Accounts.currentId()}}}),this.oJua.on("onStart",_.bind(this.onFileImportStart,this)).on("onComplete",_.bind(this.onFileImportComplete,this))},nb.prototype.groupDropdownToggle=function(a){this.currentGroupDropdown(a)},nb.prototype.gotoGroupList=function(){this.changeSelectedPanel(Lb.MobilePanel.Groups)},nb.prototype.gotoContactList=function(){return this.changeSelectedPanel(Lb.MobilePanel.Items),!0},nb.prototype.gotoViewPane=function(){this.changeSelectedPanel(Lb.MobilePanel.View)},nb.prototype.backToContactList=function(){var a=this.selectedGroupType(),b=a===Lb.ContactsGroupListType.SubGroup?this.currentGroupId():"";Ob.Routing.setHash(Ob.Links.contacts(a,b,this.search(),this.oPageSwitcher.currentPage()))},nb.prototype.changeSelectedPanel=function(a){this.mobileApp&&this.selectedPanel(a)},nb.prototype.executeSave=function(a){var b={},c=[];a===this.selectedItem()&&(a instanceof R&&!a.readOnly()?(_.each(this.groupFullCollection(),function(a){a&&a.checked()&&c.push(a.Id())}),a.groups(c),b=a.toObject(),b.Action=a.isNew()?"ContactCreate":"ContactUpdate",b.SharedToAll=a.isNew()?Lb.ContactsGroupListType.SharedToAll===this.selectedGroupType()?"1":"0":a.sharedToAll()?"1":"0",a.edited()&&a.edited(!1),a.isNew()&&this.selectedItem(null),Ob.Ajax.send(b,this.onContactCreateResponse,this)):a instanceof S&&!a.readOnly()&&(b=a.toObject(),b.Action=a.isNew()?"GroupCreate":"GroupUpdate",this.gotoGroupList(),a.edited()&&a.edited(!1),a.isNew()&&!this.mobileApp&&this.selectedItem(null),Ob.Ajax.send(b,this.onGroupCreateResponse,this)))},nb.prototype.executeBackToList=function(){Ob.Routing.setLastMailboxHash()},nb.prototype.executeNewContact=function(){var a=this.selectedGroupInList();this.oContactModel.switchToNew(),this.oContactModel.groups(a?[a.Id()]:[]),this.selectedItem(this.oContactModel),this.selector.itemSelected(null),this.gotoViewPane()},nb.prototype.executeNewGroup=function(){this.oGroupModel.switchToNew(),this.selectedItem(this.oGroupModel),this.selector.itemSelected(null),this.gotoViewPane()},nb.prototype.executeDelete=function(){var a=this,b=this.selectedContact(),c=this.selector.listCheckedOrSelected(),d=_.map(c,function(a){return a.ReadOnly()?"":a.Id()});d=_.compact(d),0<d.length&&(_.each(c,function(a){a&&(Ob.ContactsCache.clearInfoAboutEmail(a.Email()),!b||a.IsGroup()||a.ReadOnly()||b.readOnly()||b.idContact()!==a.Id()||(b=null,this.selectedContact(null)))},this),_.each(this.collection(),function(a){-1<Mb.inArray(a,c)&&a.deleted(!0)}),_.delay(function(){a.collection.remove(function(a){return a.deleted()})},500),Ob.Ajax.send({Action:"ContactDelete",ContactsId:d.join(","),SharedToAll:Lb.ContactsGroupListType.SharedToAll===this.selectedGroupType()?"1":"0"},this.requestContactList,this),Ob.ContactsCache.markVcardsNonexistentByUid(d))},nb.prototype.executeRemoveFromGroup=function(){var a=this,b=this.selectedGroupInList(),c=this.selector.listCheckedOrSelected(),d=_.map(c,function(a){return a.ReadOnly()?"":a.Id()});d=_.compact(d),b&&0<d.length&&(_.each(this.collection(),function(a){-1<Mb.inArray(a,c)&&a.deleted(!0)}),_.delay(function(){a.collection.remove(function(a){return a.deleted()})},500),Ob.Ajax.send({Action:"RemoveContactsFromGroup",GroupId:b.Id(),ContactsId:d.join(",")},this.requestContactList,this))},nb.prototype.executeImport=function(){this.selectedItem(null),this.oContactImportViewModel.visibility(!0),this.selector.itemSelected(null),this.selectedGroupType(Lb.ContactsGroupListType.Personal),this.gotoViewPane()},nb.prototype.executeExport=function(){Ob.Api.downloadByUrl(Mb.getExportContactsLink())},nb.prototype.executeCancel=function(){var a=this.selectedItem();a&&(a instanceof R&&!a.readOnly()?a.isNew()?this.selectedItem(null):a.edited()&&a.edited(!1):a instanceof S&&!a.readOnly()&&(a.isNew()?this.selectedItem(null):a.edited()&&(this.selectedItem(this.selectedOldItem()),a.edited(!1)),this.gotoGroupList())),this.oContactImportViewModel.visibility(!1)},nb.prototype.executeAddContactsToGroup=function(a,b,c){a&&_.isArray(b)&&0<b.length&&(a.recivedAnim(!0),Ob.Ajax.send({Action:"AddContactsToGroup",Global:c?"1":"0",GroupId:a.Id(),ContactsId:b.join(",")},this.onAddContactsToGroupResponse,this))},nb.prototype.executeAddContactsToGroupId=function(a,b,c){a&&_.isArray(b)&&0<b.length&&Ob.Ajax.send({Action:"AddContactsToGroup",Global:c?"1":"0",GroupId:a,ContactsId:b.join(",")},this.onAddContactsToGroupResponse,this)},nb.prototype.onAddContactsToGroupResponse=function(){this.requestContactList(),this.selector.itemSelected()&&this.requestContact(this.selector.itemSelected().sId)},nb.prototype.executeAddSelectedContactsToGroup=function(a){var b=!1,c=this.selector.listCheckedOrSelected(),d=[];a&&_.isArray(c)&&0<c.length&&_.each(c,function(a){a&&!a.IsGroup()&&(b=a.Global(),d.push(a.Id()))},this),this.executeAddContactsToGroup(a,d,b)},nb.prototype.groupsInContactView=function(a){var b=[],c=[];return a&&!a.groupsIsEmpty()&&(c=a.groups(),b=_.filter(this.groupFullCollection(),function(a){return 0<=Mb.inArray(a.Id(),c)})),b},nb.prototype.isEnableAddContacts=function(){return 0<this.selector.listCheckedOrSelected().length},nb.prototype.isEnableRemoveContactsFromGroup=function(){return 0<this.selector.listCheckedOrSelected().length},nb.prototype.isEnableDeleting=function(){return 0<this.selector.listCheckedOrSelected().length},nb.prototype.isEnableSharing=function(){return 0<this.selector.listCheckedOrSelected().length},nb.prototype.onShow=function(){this.selector.useKeyboardKeys(!0),this.oPageSwitcher.perPage(Qb.User.ContactsPerPage),this.oPageSwitcher.currentPage(1),this.requestContactList()},nb.prototype.onHide=function(){this.selector.listCheckedOrSelected(!1),this.selector.useKeyboardKeys(!1),this.selectedItem(null)},nb.prototype.onApplyBindings=function(){this.selector.initOnApplyBindings(".contact_sub_list .item",".contact_sub_list .selected.item",".contact_sub_list .item .custom_checkbox",a(".contact_list",this.$viewModel),a(".contact_list .scroll-inner",this.$viewModel));var b=this;this.$viewModel.on("click",".content .item.add_to .dropdown_helper .item",function(){a(this).hasClass("new-group")?b.executeNewGroup():b.executeAddSelectedContactsToGroup(c.dataFor(this))}),this.showPersonalContacts(!!Qb.User.ShowPersonalContacts),this.showGlobalContacts(!!Qb.User.ShowGlobalContacts),this.showSharedToAllContacts(!!Qb.App.AllowContactsSharing),this.selectedGroupType.valueHasMutated(),this.oContactImportViewModel.onApplyBindings(this.$viewModel),this.requestGroupFullList(),this.hotKeysBind()},nb.prototype.hotKeysBind=function(){var b=!1;a(document).on("keydown",_.bind(function(a){var c=a.keyCode,d=this.collection()[0],e=this.isSearchFocused(),f=!1,g=Ob.Screens.currentScreen()===Lb.Screens.Contacts;g&&!Mb.isTextFieldFocused()&&!e&&a&&c===Lb.Key.s?(a.preventDefault(),this.searchFocus()):d&&(f=d.selected(),d&&e&&a&&c===Lb.Key.Down?(this.isSearchFocused(!1),this.selector.itemSelected(d),b=!0):!e&&b&&f&&a&&c===Lb.Key.Up?(this.isSearchFocused(!0),this.selector.itemSelected(!1),b=!1):f?b=!0:f||(b=!1))},this))},nb.prototype.requestContactList=function(){this.loadingList(!0),Ob.Ajax.send({Action:Lb.ContactsGroupListType.Global===this.selectedGroupType()?"GlobalContactList":"ContactList",Offset:(this.oPageSwitcher.currentPage()-1)*Qb.User.ContactsPerPage,Limit:Qb.User.ContactsPerPage,SortField:this.sortType(),SortOrder:this.sortOrder()?"1":"0",Search:this.search(),GroupId:this.selectedGroupInList()?this.selectedGroupInList().Id():"",SharedToAll:Lb.ContactsGroupListType.SharedToAll===this.selectedGroupType()?"1":"0"},this.onContactListResponse,this)},nb.prototype.requestGroupFullList=function(){Ob.Ajax.send({Action:"GroupFullList"},this.onGroupListResponse,this)},nb.prototype.requestContact=function(a){this.loadingViewPane(!0);var b=_.find(this.collection(),function(b){return b.sId===a});b&&(this.selector.itemSelected(b),Ob.Ajax.send({Action:b.Global()?"GlobalContact":"Contact",ContactId:b.Id(),SharedToAll:b.IsSharedToAll()?"1":"0"},this.onContactResponse,this))},nb.prototype.requestContactById=function(a,b){this.loadingViewPane(!0),a&&Ob.Ajax.send({Action:b?"GlobalContact":"Contact",ContactId:a},this.onContactResponse,this)},nb.prototype.editGroup=function(a){var b=new S;b.populate(a),this.selectedOldItem(b),a.edited(!0)},nb.prototype.changeGroupType=function(a){Ob.Routing.setHash(Ob.Links.contacts(a))},nb.prototype.onViewGroupClick=function(a){Ob.Routing.setHash(Ob.Links.contacts(Lb.ContactsGroupListType.SubGroup,a.Id()))},nb.prototype.onRoute=function(a){var b=Ob.Links.parseContacts(a),c=[Lb.ContactsGroupListType.Personal,Lb.ContactsGroupListType.SharedToAll,Lb.ContactsGroupListType.Global],d=this.selectedGroupType()===Lb.ContactsGroupListType.SubGroup?this.currentGroupId():"",e=this.selectedGroupType()!==b.Type||d!==b.GroupId||this.search()!==b.Search,f=!0,g=!1;this.pageSwitcherLocked(!0),e?this.oPageSwitcher.clear():this.oPageSwitcher.setPage(b.Page,Qb.User.ContactsPerPage),this.pageSwitcherLocked(!1),b.Page!==this.oPageSwitcher.currentPage()&&Ob.Routing.replaceHash(Ob.Links.contacts(b.Type,b.GroupId,b.Search,this.oPageSwitcher.currentPage())),this.currentPage()!==b.Page&&(this.currentPage(b.Page),g=!0),-1!==Mb.inArray(b.Type,c)?this.selectedGroupType(b.Type):d!==b.GroupId&&(f=this.viewGroup(b.GroupId),f?g=!1:Ob.Routing.replaceHash(Ob.Links.contacts())),this.search()!==b.Search&&(this.search(b.Search),g=!0),""!==this.search()?this.isSearch(!0):(this.isSearch(!1),g=!0),b.Uid?this.requestContact(b.Uid):(this.selector.itemSelected(null),this.gotoContactList()),g&&this.requestContactList()},nb.prototype.viewGroup=function(a){var b=_.find(this.groupFullCollection(),function(b){return b&&b.Id()===a});return b&&(this.oGroupModel.clear(),b.IsOrganization()?this.requestGroup(b):this.oGroupModel.idGroup(b.Id()).name(b.Name()),this.selectedGroupInList(b),this.selectedItem(this.oGroupModel),this.selector.itemSelected(null),this.selector.listCheckedOrSelected(!1)),!!b},nb.prototype.deleteGroup=function(a){a&&(Ob.Ajax.send({Action:"GroupDelete",GroupId:a},this.requestGroupFullList,this),this.selectedGroupType(Lb.ContactsGroupListType.Personal),this.groupFullCollection.remove(function(b){return b&&b.Id()===a}))},nb.prototype.mailGroup=function(a){a&&Ob.Ajax.send({Action:"ContactList",Offset:0,Limit:99,SortField:Lb.ContactSortType.Email,SortOrder:"1",GroupId:a.idGroup()},function(a){if(a&&a.Result&&a.Result.List){var b=0,c=0,d=[],e=null,f=[],g=a.Result.List;for(c=g.length;c>b;b++)g[b]&&"Object/CContactListItem"===Mb.pExport(g[b],"@Object","")&&(e=new T,e.parse(g[b]),f.push(e));d=_.map(f,function(a){return a.EmailAndName()}),d=_.compact(d),Ob.Api.openComposeMessage(d.join(", "))}},this)},nb.prototype.dragAndDropHelper=function(b){b&&b.checked(!0);var c=this.selector.itemSelected(),d=Mb.draggableMessages(),e=this.selector.listCheckedOrSelected().length,f=e>0?_.map(this.selector.listCheckedOrSelected(),function(a){return a.Id()}):[];return c&&!c.checked()&&c.checked(!0),d.data("p7-contatcs-type",this.selectedGroupType()),d.data("p7-contatcs-uids",f),a(".count-text",d).text(Mb.i18n("CONTACTS/DRAG_TEXT_PLURAL",{COUNT:e},null,e)),d},nb.prototype.contactsDrop=function(a,b,c){if(a){var d=c&&c.helper?c.helper:null,e=d?d.data("p7-contatcs-type"):null,f=d?d.data("p7-contatcs-uids"):null;null!==e&&null!==f&&(Mb.uiDropHelperAnim(b,c),this.executeAddContactsToGroup(a,f,Lb.ContactsGroupListType.Global===e))}},nb.prototype.contactsDropToGroupType=function(a,b,c){var d=c&&c.helper?c.helper:null,e=d?d.data("p7-contatcs-type"):null,f=d?d.data("p7-contatcs-uids"):null;a!==e&&null!==e&&null!==f&&(Mb.uiDropHelperAnim(b,c),this.executeShare())},nb.prototype.searchFocus=function(){this.selector.useKeyboardKeys()&&!Mb.isTextFieldFocused()&&this.isSearchFocused(!0)},nb.prototype.onContactDblClick=function(){var a=this.selectedContact();a&&Ob.Api.openComposeMessage(a.email())},nb.prototype.onClearSearchClick=function(){this.search(""),this.isSearch(!1),this.searchSubmitCommand()},nb.prototype.onContactResponse=function(a){if(a&&a.Action&&a.Result){var b=new R,c=this.selector.itemSelected();b.parse(a.Result),c&&c.Id()===b.idContact()&&this.selectedItem(b)}},nb.prototype.onContactCreateResponse=function(a){a&&a.Action&&a.Result&&(Ob.Api.showReport("ContactCreate"===a.Action?Mb.i18n("CONTACTS/REPORT_CONTACT_SUCCESSFULLY_ADDED"):Mb.i18n("CONTACTS/REPORT_CONTACT_SUCCESSFULLY_UPDATED")),this.requestContactList())},nb.prototype.onContactListResponse=function(a){if(a&&a.Action&&a.Result){var b=0,c=0,d=[],e="GlobalContactList"===a.Action,f=this.selector.itemSelected(),g=null,h=this.selector.listChecked(),i=h&&0<h.length?_.map(h,function(a){return a.Id()}):[],j=null;for(c=a.Result.List.length;c>b;b++)a.Result.List[b]&&"Object/CContactListItem"===Mb.pExport(a.Result.List[b],"@Object","")&&(j=new T,j.parse(a.Result.List[b],e),d.push(j));f&&(g=_.find(d,function(a){return f.Id()===a.Id()})),i&&0<i.length&&_.each(d,function(a){a.checked(-1<Mb.inArray(a.Id(),i))}),this.collection(d),this.loadingList(!1),this.oPageSwitcher.setCount(Mb.pInt(a.Result.ContactCount)),g&&this.selector.itemSelected(g),this.selectedGroupContactsList(a.Result.List)}},nb.prototype.viewAllMails=function(){var a=this.selectedGroupContactsList(),b="email:";a&&(_.each(a,function(a){_.each(a.Emails,function(a){b=b+a+","})}),Ob.MailCache.searchMessagesInInbox(b))},nb.prototype.onGroupListResponse=function(a){if(a&&a.Action&&a.Result){var b=0,c=0,d=[],e=_.find(this.groupFullCollection(),function(a){return a.selected()}),f=null;for(this.groupFullCollection(d),c=a.Result.length;c>b;b++)a.Result[b]&&"Object/CContactListItem"===Mb.pExport(a.Result[b],"@Object","")&&(f=new T,f.parse(a.Result[b]),f.IsGroup()&&(e&&e.Id()===f.Id()&&this.selectedGroupInList(f),d.push(f)));this.groupFullCollection(d)}},nb.prototype.onGroupCreateResponse=function(a){if(a&&a.Action&&a.Result){var b=_.map(this.selector.listChecked(),function(a){return a.Id()});this.executeAddContactsToGroupId(a.Result.IdGroup,b,Lb.ContactsGroupListType.Global===this.selectedGroupType()),this.mobileApp||(this.selectedItem(null),this.selector.itemSelected(null)),Ob.Api.showReport(Mb.i18n("CONTACTS/REPORT_GROUP_SUCCESSFULLY_ADDED")),this.requestContactList(),this.requestGroupFullList()}},nb.prototype.executeShare=function(){var a=this,b=this.selector.listCheckedOrSelected(),c=this.selectedContact(),d=_.map(b,function(a){return a.ReadOnly()?"":a.Id()});d=_.compact(d),0<d.length&&(_.each(b,function(a){a&&(Ob.ContactsCache.clearInfoAboutEmail(a.Email()),!c||a.IsGroup()||a.ReadOnly()||c.readOnly()||c.idContact()!==a.Id()||(c=null,this.selectedContact(null)))},this),_.each(this.collection(),function(a){-1<Mb.inArray(a,b)&&a.deleted(!0)}),_.delay(function(){a.collection.remove(function(a){return a.deleted()})},500),Lb.ContactsGroupListType.SharedToAll===this.selectedGroupType()?this.recivedAnimUnshare(!0):this.recivedAnimShare(!0),Ob.Ajax.send({Action:"ContactUpdateSharedToAll",ContactsId:d.join(","),SharedToAll:Lb.ContactsGroupListType.SharedToAll===this.selectedGroupType()?"1":"0"},this.onContactUpdateSharedToAllResponse,this))},nb.prototype.onContactUpdateSharedToAllResponse=function(){},nb.prototype.requestGroup=function(a){this.loadingViewPane(!0),a&&Ob.Ajax.send({Action:"Group",GroupId:a.Id()},this.onGroupResponse,this)},nb.prototype.onGroupResponse=function(a){if(a&&a.Action&&a.Result){var b=a.Result;this.oGroupModel.idGroup(b.IdGroup).name(b.Name).isOrganization(b.IsOrganization).company(b.Company).country(b.Country).state(b.State).city(b.City).street(b.Street).zip(b.Zip).phone(b.Phone).fax(b.Fax).email(b.Email).web(b.Web)}},ob.prototype.onHide=function(a){var b=null,c=this.tab();this.confirmSaving(c),b=this.getCurrentViewModel(),b&&Mb.isFunc(b.onHide)&&b.onHide(a),Tb.removeClass("non-adjustable")},ob.prototype.onShow=function(a){var b=null,c=this.tab();this.confirmSaving(c),b=this.getCurrentViewModel(),b&&Mb.isFunc(b.onShow)&&b.onShow(a),Tb.addClass("non-adjustable")},ob.prototype.viewTab=function(a){var b=this.getViewModel(Lb.SettingsTab.Common),c=b?Lb.SettingsTab.Common:Lb.SettingsTab.EmailAccounts,d=this.getViewModel(a),e=-1===Mb.inArray(a,Lb.SettingsTab);a=d&&e?a:c,this.tab(a)},ob.prototype.onRoute=function(a){var b=null,c=this.tab();_.isArray(a)&&a.length>0&&(c=a[0]),b=this.getCurrentViewModel(),b&&Mb.isFunc(b.onHide)&&b.onHide(a),this.confirmSaving(this.tab()),this.viewTab(c),b=this.getCurrentViewModel(),b&&Mb.isFunc(b.onRoute)&&b.onRoute(a)},ob.prototype.confirmSaving=function(a){var b=this.getViewModel(a),c=Mb.i18n("SETTINGS/CONFIRM_SETTINGS_SAVE"),d=_.bind(function(a){b&&(a?b.onSaveClick&&b.onSaveClick():b.init&&b.init())},this);b&&Mb.isFunc(b.isChanged)&&b.isChanged()&&Ob.Screens.showPopup(t,[c,d])},ob.prototype.getViewModel=function(a){return _.find(this.aTabs,function(b){return b.TabName===a})},ob.prototype.getCurrentViewModel=function(){return this.getViewModel(this.tab())},ob.prototype.showTab=function(a){Ob.Routing.setHash([Lb.Screens.Settings,a])},ob.prototype.onResponseFolderDelete=function(a){a.Result?Ob.MailCache.getFolderList(Qb.Accounts.editedId()):Ob.Api.showErrorByCode(a,Mb.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"))},ob.prototype.deleteFolder=function(a,b,c){var d={Action:"FolderDelete",AccountID:Qb.Accounts.editedId(),Folder:a.fullName()};c&&b&&a&&(b.remove(function(b){return a.fullName()===b.fullName()?!0:!1}),Ob.Ajax.send(d,this.onResponseFolderDelete,this))},ob.prototype.onResponseFolderSubscribe=function(a){a.Result?Ob.MailCache.getFolderList(Qb.Accounts.editedId()):Ob.Api.showErrorByCode(a,Mb.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"))},ob.prototype.onSubscribeFolderClick=function(a){var b={Action:"FolderSubscribe",AccountID:Qb.Accounts.editedId(),Folder:a.fullName(),SetAction:a.subscribed()?0:1};a&&a.canSubscribe()&&(a.subscribed(!a.subscribed()),Ob.Ajax.send(b,this.onResponseFolderSubscribe,this))},ob.prototype.onDeleteFolderClick=function(a,b){var c=Mb.i18n("SETTINGS/ACCOUNT_FOLDERS_CONFIRMATION_DELETE"),d=this.getCollectionFromParent(b),e=_.bind(this.deleteFolder,this,a,d),f=this.getViewModel(Lb.SettingsTab.EmailAccounts);a&&a.canDelete()?Ob.Screens.showPopup(t,[c,e]):f&&f.oAccountFolders.highlighted(!0)},ob.prototype.onResponseFolderRename=function(a){a.Result?Ob.MailCache.getFolderList(Qb.Accounts.editedId()):Ob.Api.showErrorByCode(a,Mb.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"))},ob.prototype.folderEditOnEnter=function(a){var b={Action:"FolderRename",AccountID:Qb.Accounts.editedId(),PrevFolderFullNameRaw:a.fullName(),NewFolderNameInUtf8:a.nameForEdit()};Ob.Ajax.send(b,this.onResponseFolderRename,this),a.name(a.nameForEdit()),a.edited(!1)},ob.prototype.folderEditOnEsc=function(a){a.edited(!1)},ob.prototype.getCollectionFromParent=function(a){return a.subfolders?a.subfolders:a.collection},ob.prototype.canMoveFolderUp=function(a,b,c){var d=this.getCollectionFromParent(c),e=d()[b-1],f="";return b>0&&e&&(f=d()[b-1].fullName()),0!==b&&a&&a.fullName()!==Ob.MailCache.editedFolderList().inboxFolderFullName()&&Ob.MailCache.editedFolderList().inboxFolderFullName()!==f},ob.prototype.canMoveFolderDown=function(a,b,c){var d=this.getCollectionFromParent(c);return b!==d().length-1&&a.fullName()!==Ob.MailCache.editedFolderList().inboxFolderFullName()},ob.prototype.moveFolderUp=function(a,b,c){var d=this.getCollectionFromParent(c),e=b-2,f=e>=0?d()[e].fullName():"",g=d()[b]?d()[b].fullName():"";this.canMoveFolderUp(a,b,c)&&d&&(d.splice(b,1),d.splice(b-1,0,a),this.folderListOrderNameUpdate(a,f,g),this.folderListOrderUpdateDebounce())},ob.prototype.moveFolderDown=function(a,b,c){var d=this.getCollectionFromParent(c),e=d()[b].fullName(),f=d()[b+2]?d()[b+2].fullName():"";this.canMoveFolderDown(a,b,c)&&d&&(d.splice(b,1),d.splice(b+1,0,a),this.folderListOrderNameUpdate(a,e,f),this.folderListOrderUpdateDebounce())},ob.prototype.afterSortableFolderMove=function(a){var b=a.item,c=a.sourceParent(),d=a.targetIndex-1,e=d>=0?c[d].fullName():"",f=a.targetIndex+1,g=c[f]?c[f].fullName():"";this.folderListOrderNameUpdate(b,e,g),this.folderListOrderUpdateDebounce()},ob.prototype.folderListOrderUpdate=function(){var a=[],b=[],c=null;this.bAllowFolderListOrderNameUpdate||(a=Ob.MailCache.editedFolderList().getOptions(),b=_.map(a,function(a){return a&&a.id?a.id:null}),c={Action:"FolderListOrderUpdate",AccountID:Qb.Accounts.editedId(),FolderList:_.compact(b)},Ob.Ajax.send(c,this.onResponseFolderListOrderUpdate,this))},ob.prototype.onResponseFolderListOrderUpdate=function(a){a.Result?Ob.MailCache.getFolderList(Qb.Accounts.editedId()):Ob.Api.showErrorByCode(a,Mb.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"))},ob.prototype.folderListOrderNameUpdate=function(a,b,c){var d=null,e=null;this.bAllowFolderListOrderNameUpdate&&(d=Ob.MailCache.editedFolderList().getFolderByFullName(a.parentFullName()),e={Action:"FolderListOrderNameUpdate",FolderName:a.fullName(),AboveName:b,BelowName:c,ParentName:a.parentFullName(),ParentDelimiter:d?d.delimiter():""},Ob.Ajax.send(e,this.onResponseFolderListOrderNameUpdate,this))},ob.prototype.onResponseFolderListOrderNameUpdate=function(){var a=Qb.Accounts.editedId();clearTimeout(this.iUpdateFolderListTimer),this.iUpdateFolderListTimer=setTimeout(function(){Ob.MailCache.getFolderList(a)},5e3)},pb.prototype.TemplateName="Settings_CommonSettingsViewModel",pb.prototype.TabName=Lb.SettingsTab.Common,pb.prototype.TabTitle=Mb.i18n("SETTINGS/TAB_COMMON"),pb.prototype.setMessagesPerPage=function(a){var b=this.rangeOfNumbers;-1===_.indexOf(b,a)&&(b=_.sortBy(_.union(b,[a]),function(a){return a},this)),this.messagesPerPageValues(b),this.messagesPerPage(a)},pb.prototype.setContactsPerPage=function(a){var b=this.rangeOfNumbers;-1===_.indexOf(b,a)&&(b=_.sortBy(_.union(b,[a]),function(a){return a},this)),this.contactsPerPageValues(b),this.contactsPerPage(a)},pb.prototype.init=function(){this.selectedSkin(Qb.User.DefaultTheme),this.layout(Qb.User.Layout),this.selectedLanguage(Qb.User.DefaultLanguage),this.setMessagesPerPage(Qb.User.MailsPerPage),this.setContactsPerPage(Qb.User.ContactsPerPage),this.autocheckmailInterval(Qb.User.AutoCheckMailInterval),this.richText(Qb.User.DefaultEditor),this.timeFormat(Qb.User.defaultTimeFormat()),this.dateFormat(Qb.User.DefaultDateFormat),this.useThreads(Qb.User.useThreads()),this.saveRepliedToCurrFolder(Qb.User.SaveRepliedToCurrFolder)},pb.prototype.getState=function(){var a=[this.selectedSkin(),this.layout(),this.selectedLanguage(),this.messagesPerPage(),this.contactsPerPage(),this.autocheckmailInterval(),this.richText(),this.timeFormat(),this.dateFormat(),this.useThreads(),this.saveRepliedToCurrFolder()];return a.join(":")},pb.prototype.updateFirstState=function(){this.firstState=this.getState()},pb.prototype.isChanged=function(){return this.firstState&&this.getState()!==this.firstState?!0:!1},pb.prototype.onResponse=function(a,c){var d=!1;this.loading(!1),a.Result===!1?Ob.Api.showErrorByCode(a,Mb.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED")):(Ob.CalendarCache.calendarSettingsChanged(!0),d=c.DefaultTheme!==Qb.User.DefaultTheme||c.DefaultLanguage!==Qb.User.DefaultLanguage,d?b.location.reload():(this.setMessagesPerPage(c.MailsPerPage),this.setContactsPerPage(c.ContactsPerPage),Qb.User.updateCommonSettings(c.MailsPerPage,c.ContactsPerPage,c.AutoCheckMailInterval,c.DefaultEditor,c.Layout,c.DefaultTheme,c.DefaultLanguage,c.DefaultDateFormat,c.DefaultTimeFormat,c.UseThreads,c.SaveRepliedMessagesToCurrentFolder),Ob.Api.showReport(Mb.i18n("SETTINGS/COMMON_REPORT_UPDATED_SUCCESSFULLY"))))},pb.prototype.onSaveClick=function(){var a={Action:"UpdateUserSettings",MailsPerPage:parseInt(this.messagesPerPage(),10),ContactsPerPage:parseInt(this.contactsPerPage(),10),AutoCheckMailInterval:parseInt(this.autocheckmailInterval(),10),DefaultEditor:parseInt(this.richText(),10),Layout:parseInt(this.layout(),10),DefaultTheme:this.selectedSkin(),DefaultLanguage:this.selectedLanguage(),DefaultDateFormat:this.dateFormat(),DefaultTimeFormat:parseInt(this.timeFormat(),10),UseThreads:this.useThreads()?"1":"0",SaveRepliedMessagesToCurrentFolder:this.saveRepliedToCurrFolder()?"1":"0"};this.loading(!0),this.updateFirstState(),Ob.Ajax.send(a,this.onResponse,this)},qb.prototype.TemplateName="Settings_EmailAccountsSettingsViewModel",qb.prototype.TabName=Lb.SettingsTab.EmailAccounts,qb.prototype.TabTitle=Mb.i18n("SETTINGS/TAB_EMAIL_ACCOUNTS"),qb.prototype.isChanged=function(){return!1
},qb.prototype.onRoute=function(a){var b=Qb.Accounts.getEdited();b&&(_.isArray(a)&&a.length>1&&this.tab(a[1]),this.confirmSaving(Lb.AccountSettingsTab.Properties),this.viewCurrentTab(a))},qb.prototype.confirmSaving=function(a,b,c){var d=this.getViewModel(a),e={},f=Mb.i18n("SETTINGS/CONFIRM_SETTINGS_SAVE"),g=_.bind(function(a){d&&(a?d.onSaveClick&&d.saveData(e):d.updateFirstState())},this);b=Mb.isUnd(b)?!1:b,c=Mb.isUnd(c)?null:c,!b&&d&&Mb.isFunc(d.isChanged)&&d.isChanged()&&(e=d.prepareParameters(),Ob.Screens.showPopup(t,[f,g]))},qb.prototype.onHide=function(){this.confirmSaving(this.tab())},qb.prototype.viewCurrentTab=function(a){var b=Qb.Accounts.getEdited(),c=null,d=this.isTabAllowed(this.tab(),b);b&&(d?(c=this.getCurrentViewModel(),c&&(Mb.isFunc(c.onHide)&&c.onHide(a),Mb.isFunc(c.onShow)&&c.onShow(a,b))):(this.tab(Lb.AccountSettingsTab.Properties),Ob.Routing.replaceHash([Lb.Screens.Settings,Lb.SettingsTab.EmailAccounts,Lb.AccountSettingsTab.Properties]),this.editedFetcherId(null),this.editedIdentityId(null)))},qb.prototype.getViewModel=function(a){switch(a){case Lb.AccountSettingsTab.Folders:return this.oAccountFolders;case Lb.AccountSettingsTab.Filters:return this.oAccountFilters;case Lb.AccountSettingsTab.Forward:return this.oAccountForward;case Lb.AccountSettingsTab.Signature:return this.oAccountSignature;case Lb.AccountSettingsTab.Autoresponder:return this.oAccountAutoresponder;case Lb.AccountSettingsTab.FetcherInc:return this.oFetcherIncoming;case Lb.AccountSettingsTab.FetcherOut:return this.oFetcherOutgoing;case Lb.AccountSettingsTab.FetcherSig:return this.oFetcherSignature;case Lb.AccountSettingsTab.IdentityProperties:return this.oIdentityProperties;case Lb.AccountSettingsTab.IdentitySignature:return this.oIdentityProperties;default:case Lb.AccountSettingsTab.Properties:return this.oAccountProperties}},qb.prototype.getCurrentViewModel=function(){return this.getViewModel(this.tab())},qb.prototype.isTabAllowed=function(a,b){var c=[Lb.AccountSettingsTab.Properties,Lb.AccountSettingsTab.Signature,Lb.AccountSettingsTab.Folders,Lb.AccountSettingsTab.FetcherInc,Lb.AccountSettingsTab.FetcherOut,Lb.AccountSettingsTab.FetcherSig];return b.extensionExists("AllowSieveFiltersExtension")&&c.push(Lb.AccountSettingsTab.Filters),b.extensionExists("AllowForwardExtension")&&c.push(Lb.AccountSettingsTab.Forward),b.extensionExists("AllowAutoresponderExtension")&&c.push(Lb.AccountSettingsTab.Autoresponder),Qb.AllowIdentities&&this.editedIdentityId()&&(c.push(Lb.AccountSettingsTab.IdentityProperties),c.push(Lb.AccountSettingsTab.IdentitySignature)),-1!==Mb.inArray(a,c)},qb.prototype.onTabClick=function(a){Ob.Routing.setHash([Lb.Screens.Settings,Lb.SettingsTab.EmailAccounts,a])},qb.prototype.onResponseAccountDelete=function(a,c){a.Result?(Qb.Accounts.deleteAccount(c.AccountIDToDelete),this.changeAccount(this.editedAccountId()),this.defaultAccountId()===c.AccountIDToDelete&&(Ob.Routing.setHash([]),b.location.reload())):Ob.Api.showErrorByCode(a,Mb.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"))},qb.prototype.deleteAccount=function(a,b){var c={Action:"AccountDelete",AccountIDToDelete:a};b&&Ob.Ajax.send(c,this.onResponseAccountDelete,this)},qb.prototype.onAccountDelete=function(a){var b=_.bind(this.deleteAccount,this,a),c=Qb.Accounts.getAccount(a);this.allowUsersChangeInterfaceSettings&&Ob.Screens.showPopup(t,[c.removeConfirmation(),b,c.email()])},qb.prototype.onEditedAccountDelete=function(){this.onAccountDelete(this.editedAccountId())},qb.prototype.onAccountAdd=function(){Ob.Screens.showPopup(u,[])},qb.prototype.changeAccount=function(a){var b=null,c={Action:"AccountSettings",AccountID:a};(this.isFetcherTab(this.tab())||this.isIdentityTab(this.tab()))&&this.onTabClick(Lb.AccountSettingsTab.Properties),this.confirmSaving(this.tab()),b=Qb.Accounts.getAccount(a),!Mb.isUnd(b)&&b.isExtended()?this.populate(b):Ob.Ajax.send(c,this.onAccountSettingsResponse,this),this.editedFetcherId(null),this.editedIdentityId(null)},qb.prototype.onAccountSettingsResponse=function(a,b){if(a.Result){var c=Qb.Accounts.getAccount(b.AccountID);Mb.isUnd(c)||(c.updateExtended(a.Result),this.populate(c))}else Ob.Api.showErrorByCode(a,Mb.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"))},qb.prototype.populate=function(a){this.allowAutoresponderExtension(a.extensionExists("AllowAutoresponderExtension")),this.allowForwardExtension(a.extensionExists("AllowForwardExtension")),this.allowSieveFiltersExtension(a.extensionExists("AllowSieveFiltersExtension")),Qb.Accounts.changeEditedAccount(a.id()),this.viewCurrentTab()},qb.prototype.onIdentityAdd=function(a,b){b.stopPropagation(),Ob.Screens.showPopup(v,[a])},qb.prototype.onFetcherAdd=function(){Ob.Screens.showPopup(w,[])},qb.prototype.fetcherDelete=function(a,b){var c={Action:"FetcherDelete",FetcherID:a};b&&Ob.Ajax.send(c,this.onFetcherDeleteResponse,this)},qb.prototype.onFetcherDelete=function(a){var b=Mb.i18n("WARNING/FETCHER_DELETE_WARNING"),c=_.bind(this.fetcherDelete,this,a.idFetcher()),d=a.incomingMailServer();Ob.Screens.showPopup(t,[b,c,d])},qb.prototype.onFetcherDeleteResponse=function(a){a.Result?(Qb.Accounts.populateFetchers(),this.editedFetcherId(null)):Ob.Api.showErrorByCode(a.ErrorCode,Mb.i18n("WARNING/FETCHER_DELETING_ERROR"))},qb.prototype.onChangeFetcher=function(a){var b=this.defaultAccount.fetchers().getFetcher(a);this.fetcher(b),this.isFetcherTab(this.tab())||this.onTabClick(Lb.AccountSettingsTab.FetcherInc),this.confirmSaving(this.tab()),this.oFetcherIncoming.populate(b),this.oFetcherOutgoing.populate(b),this.oFetcherSignature.populate(b),this.editedFetcherId(b.id()),this.editedIdentityId(null)},qb.prototype.isFetcherTab=function(a){return-1!==Mb.inArray(a,[Lb.AccountSettingsTab.FetcherInc,Lb.AccountSettingsTab.FetcherOut,Lb.AccountSettingsTab.FetcherSig])},qb.prototype.onChangeIdentity=function(a){this.onTabClick(Lb.AccountSettingsTab.IdentityProperties),this.confirmSaving(this.tab()),this.oIdentityProperties.populate(a),this.editedIdentityId(a.id()),this.editedFetcherId(null)},qb.prototype.isIdentityTab=function(a){return-1!==Mb.inArray(a,[Lb.AccountSettingsTab.IdentityProperties,Lb.AccountSettingsTab.IdentitySignature])},qb.prototype.onRemoveIdentity=function(){this.editedIdentityId(null),this.viewCurrentTab()},rb.prototype.TemplateName="Settings_CalendarSettingsViewModel",rb.prototype.TabName=Lb.SettingsTab.Calendar,rb.prototype.TabTitle=Mb.i18n("SETTINGS/TAB_CALENDAR"),rb.prototype.init=function(){this.showWeekends(Qb.User.CalendarShowWeekEnds),this.selectedWorkdayStarts(Qb.User.CalendarWorkDayStarts),this.selectedWorkdayEnds(Qb.User.CalendarWorkDayEnds),this.showWorkday(Qb.User.CalendarShowWorkDay),this.weekStartsOn(Qb.User.CalendarWeekStartsOn),this.defaultTab(Qb.User.CalendarDefaultTab)},rb.prototype.getState=function(){var a=[this.showWeekends(),this.selectedWorkdayStarts(),this.selectedWorkdayEnds(),this.showWorkday(),this.weekStartsOn(),this.defaultTab()];return a.join(":")},rb.prototype.updateFirstState=function(){this.firstState=this.getState()},rb.prototype.isChanged=function(){return this.firstState&&this.getState()!==this.firstState?!0:!1},rb.prototype.onResponse=function(a,b){this.loading(!1),a.Result===!1?Ob.Api.showErrorByCode(a,Mb.i18n("SETTINGS/ERROR_CALENDAR_SETTINGS_SAVING_FAILED")):(Ob.CalendarCache.calendarSettingsChanged(!0),Qb.User.updateCalendarSettings(b.ShowWeekEnds,b.ShowWorkDay,b.WorkDayStarts,b.WorkDayEnds,b.WeekStartsOn,b.DefaultTab),Ob.Api.showReport(Mb.i18n("SETTINGS/COMMON_REPORT_UPDATED_SUCCESSFULLY")))},rb.prototype.onSaveClick=function(){var a={Action:"UpdateUserSettings",ShowWeekEnds:this.showWeekends()?1:0,ShowWorkDay:this.showWorkday()?1:0,WorkDayStarts:parseInt(this.selectedWorkdayStarts(),10),WorkDayEnds:parseInt(this.selectedWorkdayEnds(),10),WeekStartsOn:parseInt(this.weekStartsOn(),10),DefaultTab:parseInt(this.defaultTab(),10)};this.loading(!0),this.updateFirstState(),Ob.Ajax.send(a,this.onResponse,this)},rb.prototype.getDisplayedTimes=function(a){var b=[];switch(a){case"HH:mm":b=[{text:"01:00",value:"1"},{text:"02:00",value:"2"},{text:"03:00",value:"3"},{text:"04:00",value:"4"},{text:"05:00",value:"5"},{text:"06:00",value:"6"},{text:"07:00",value:"7"},{text:"08:00",value:"8"},{text:"09:00",value:"9"},{text:"10:00",value:"10"},{text:"11:00",value:"11"},{text:"12:00",value:"12"},{text:"13:00",value:"13"},{text:"14:00",value:"14"},{text:"15:00",value:"15"},{text:"16:00",value:"16"},{text:"17:00",value:"17"},{text:"18:00",value:"18"},{text:"19:00",value:"19"},{text:"20:00",value:"20"},{text:"21:00",value:"21"},{text:"22:00",value:"22"},{text:"23:00",value:"23"},{text:"00:00",value:"24"}];break;case"hh:mm A":b=[{text:"01:00 AM",value:"1"},{text:"02:00 AM",value:"2"},{text:"03:00 AM",value:"3"},{text:"04:00 AM",value:"4"},{text:"05:00 AM",value:"5"},{text:"06:00 AM",value:"6"},{text:"07:00 AM",value:"7"},{text:"08:00 AM",value:"8"},{text:"09:00 AM",value:"9"},{text:"10:00 AM",value:"10"},{text:"11:00 AM",value:"11"},{text:"12:00 PM",value:"12"},{text:"01:00 PM",value:"13"},{text:"02:00 PM",value:"14"},{text:"03:00 PM",value:"15"},{text:"04:00 PM",value:"16"},{text:"05:00 PM",value:"17"},{text:"06:00 PM",value:"18"},{text:"07:00 PM",value:"19"},{text:"08:00 PM",value:"20"},{text:"09:00 PM",value:"21"},{text:"10:00 PM",value:"22"},{text:"11:00 PM",value:"23"},{text:"12:00 AM",value:"24"}]}return b},sb.prototype.TemplateName="Settings_MobileSyncSettingsViewModel",sb.prototype.TabName=Lb.SettingsTab.MobileSync,sb.prototype.TabTitle=Mb.i18n("SETTINGS/TAB_MOBILE_SYNC"),sb.prototype.onRoute=function(){Qb.User.requestSyncSettings()},sb.prototype.onMobileSyncSubscribe=function(){this.enableDav(Qb.User.MobileSyncEnable&&this.mobileSync()&&this.mobileSync().EnableDav),this.enableDav()&&(this.davLogin(this.mobileSync().Dav.Login),this.davServer(this.mobileSync().Dav.Server),this.davCalendars(this.mobileSync().Dav.Calendars),this.davPersonalContactsUrl(this.mobileSync().Dav.PersonalContactsUrl),this.davCollectedAddressesUrl(this.mobileSync().Dav.CollectedAddressesUrl),this.davGlobalAddressBookUrl(this.mobileSync().Dav.GlobalAddressBookUrl))},tb.prototype.TemplateName="Settings_OutLookSyncSettingsViewModel",tb.prototype.TabName=Lb.SettingsTab.OutLookSync,tb.prototype.TabTitle=Mb.i18n("SETTINGS/TAB_OUTLOOK_SYNC"),tb.prototype.onRoute=function(){Qb.User.requestSyncSettings()},tb.prototype.onOutlookSyncSubscribe=function(){Qb.User.OutlookSyncEnable&&(this.visibleOutlookSync(!0),this.outlookSync()&&(this.login(this.outlookSync().Login),this.server(this.outlookSync().Server)))},ub.prototype.getState=function(){var a=[this.friendlyName(),this.email(),this.incomingMailLogin(),this.incomingMailPort(),this.incomingMailServer(),this.outgoingMailLogin(),this.outgoingMailPort(),this.outgoingMailServer(),this.useSmtpAuthentication()];return a.join(":")},ub.prototype.updateFirstState=function(){this.firstState=this.getState()},ub.prototype.isChanged=function(){return this.firstState&&this.getState()!==this.firstState?!0:!1},ub.prototype.populate=function(a){a?(this.allowChangePassword(a.extensionExists("AllowChangePasswordExtension")),this.isInternal(a.isInternal()),this.isLinked(a.isLinked()),this.isDefault(a.isDefault()),this.removeHint(a.removeHint()),this.useSmtpAuthentication(2===Mb.pInt(a.outgoingMailAuth())?!0:!1),this.friendlyName(a.friendlyName()),this.email(a.email()),this.incomingMailLogin(a.incomingMailLogin()),this.incomingMailServer(a.incomingMailServer()),this.incomingMailPort(a.incomingMailPort()),this.outgoingMailServer(a.outgoingMailServer()),this.outgoingMailLogin(a.outgoingMailLogin()),this.outgoingMailPort(a.outgoingMailPort()),this.updateFirstState()):(this.allowChangePassword(!1),this.isLinked(!0),this.useSmtpAuthentication(!0),this.friendlyName(""),this.email(""),this.incomingMailLogin(""),this.incomingMailServer(""),this.incomingMailPort(143),this.outgoingMailServer(""),this.outgoingMailLogin(""),this.outgoingMailPort(25))},ub.prototype.onResponse=function(a,b){if(this.loading(!1),a.Result){var c=Mb.pInt(a.AccountID),d=c>0?Qb.Accounts.getAccount(c):null;d&&(d.updateExtended(b),Ob.Api.showReport(Mb.i18n("SETTINGS/COMMON_REPORT_UPDATED_SUCCESSFULLY")))}else Ob.Api.showErrorByCode(a,Mb.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"))},ub.prototype.prepareParameters=function(){var a={Action:"UpdateAccountSettings",AccountID:this.account().id(),FriendlyName:this.friendlyName(),Email:this.email(),IncomingMailLogin:this.incomingMailLogin(),IncomingMailServer:this.incomingMailServer(),IncomingMailPort:Mb.pInt(this.incomingMailPort()),OutgoingMailServer:this.outgoingMailServer(),OutgoingMailLogin:this.outgoingMailLogin(),OutgoingMailPort:Mb.pInt(this.outgoingMailPort()),OutgoingMailAuth:this.useSmtpAuthentication()?2:0,IncomingMailPassword:this.incomingMailPassword()};return a},ub.prototype.saveData=function(a){this.updateFirstState(),Ob.Ajax.send(a,this.onResponse,this)},ub.prototype.onSaveClick=function(){this.account()&&(this.loading(!0),this.saveData(this.prepareParameters()))},ub.prototype.onChangePasswordClick=function(){Ob.Screens.showPopup(z,[!1])},ub.prototype.onShow=function(a,b){this.account(b)},vb.prototype.isChanged=function(){return!1},vb.prototype.onAddNewFolderClick=function(){Ob.Screens.showPopup(y)},vb.prototype.onSystemFoldersClick=function(){Ob.Screens.showPopup(x)},wb.prototype.__name="CAccountSignatureViewModel",wb.prototype.getState=function(){var a=[this.type(),this.useSignature(),this.oHtmlEditor.getText()];return a.join(":")},wb.prototype.updateFirstState=function(){this.firstState=this.getState()},wb.prototype.isChanged=function(){return this.firstState&&this.getState()!==this.firstState?!0:!1},wb.prototype.getSignature=function(){if(this.account())if(null!==this.account().signature())this.type(this.account().signature().type()),this.useSignature(this.account().signature().options()),this.signature(this.account().signature().signature());else{var a={Action:"AccountSignature",AccountID:this.account().id()};Ob.Ajax.send(a,this.onSignatureResponse,this)}},wb.prototype.onSignatureResponse=function(a){var b=null,c=parseInt(a.AccountID,10);a.Result?this.account()&&c===this.account().id()&&(b=new U,b.parse(c,a.Result),this.account().signature(b),this.type(this.account().signature().type()),this.useSignature(this.account().signature().options()),this.signature(this.account().signature().signature())):Ob.Api.showErrorByCode(a)},wb.prototype.prepareParameters=function(){var a={Action:"UpdateAccountSignature",AccountID:this.account().id(),Type:this.type()?1:0,Options:this.useSignature(),Signature:this.signature()};return a},wb.prototype.saveData=function(a){this.updateFirstState(),Ob.Ajax.send(a,this.onResponse,this)},wb.prototype.save=function(){this.account()&&(this.loading(!0),this.signature(this.oHtmlEditor.getNotDefaultText()),this.account().signature().type(this.type()),this.account().signature().options(this.useSignature()),this.account().signature().signature(this.signature()),this.saveData(this.prepareParameters()))},wb.prototype.onResponse=function(a){this.loading(!1),a.Result?Ob.Api.showReport(Mb.i18n("SETTINGS/COMMON_REPORT_UPDATED_SUCCESSFULLY")):Ob.Api.showErrorByCode(a,Mb.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"))},wb.prototype.onShow=function(a,b){this.account(b),this.oHtmlEditor.initCrea(this.signature(),""),this.oHtmlEditor.setActivitySource(this.useSignature),this.updateFirstState()},xb.prototype.getState=function(){var a=[this.enable(),this.email()];return a.join(":")},xb.prototype.updateFirstState=function(){this.firstState=this.getState()},xb.prototype.isChanged=function(){return this.firstState&&this.getState()!==this.firstState?!0:!1},xb.prototype.prepareParameters=function(){var a={Action:"UpdateForward",AccountID:this.account().id(),Enable:this.enable()?"1":"0",Email:this.email()};return a},xb.prototype.saveData=function(a){this.updateFirstState(),Ob.Ajax.send(a,this.onUpdateForwardResponse,this)},xb.prototype.onSaveClick=function(){if(this.account()){var a=this.account().forward();a&&(a.enable=this.enable(),a.email=this.email()),this.loading(!0),this.saveData(this.prepareParameters())}},xb.prototype.getForward=function(){if(this.account())if(null!==this.account().forward())this.enable(this.account().forward().enable),this.email(this.account().forward().email),this.firstState=this.getState();else{var a={Action:"GetForward",AccountID:this.account().id()};this.loading(!0),this.updateFirstState(),Ob.Ajax.send(a,this.onGetForwardResponse,this)}},xb.prototype.onShow=function(a,b){this.account(b)},xb.prototype.onGetForwardResponse=function(a,b){if(this.loading(!1),b&&b.Action){if(a&&a.Result&&a.AccountID&&this.account()){var c=null,d=new Y,e=Mb.pInt(a.AccountID);e&&(c=Qb.Accounts.getAccount(e),c&&(d.parse(e,a.Result),c.forward(d),this.enable(c.forward().enable),this.email(c.forward().email),this.updateFirstState(),e===this.account().id()&&this.account.valueHasMutated()))}}else Ob.Api.showError(Mb.i18n("WARNING/UNKNOWN_ERROR"))},xb.prototype.onUpdateForwardResponse=function(a,b){this.loading(!1),b&&b.Action?a&&a.Result?Ob.Api.showReport(Mb.i18n("SETTINGS/ACCOUNT_FORWARD_SUCCESS_REPORT")):Ob.Api.showErrorByCode(a,Mb.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED")):Ob.Api.showError(Mb.i18n("WARNING/UNKNOWN_ERROR"))},yb.prototype.getState=function(){var a=[this.enable(),this.subject(),this.message()];return a.join(":")},yb.prototype.updateFirstState=function(){this.firstState=this.getState()},yb.prototype.isChanged=function(){return this.firstState&&this.getState()!==this.firstState?!0:!1},yb.prototype.prepareParameters=function(){var a={Action:"UpdateAutoresponder",AccountID:this.account().id(),Enable:this.enable()?"1":"0",Subject:this.subject(),Message:this.message()};return a},yb.prototype.saveData=function(a){this.updateFirstState(),Ob.Ajax.send(a,this.onUpdateAutoresponder,this)},yb.prototype.onSaveClick=function(){if(this.account()){var a=this.account().autoresponder();a&&(a.enable=this.enable(),a.subject=this.subject(),a.message=this.message()),this.loading(!0),this.saveData(this.prepareParameters())}},yb.prototype.getAutoresponder=function(){if(this.account())if(null!==this.account().autoresponder())this.enable(this.account().autoresponder().enable),this.subject(this.account().autoresponder().subject),this.message(this.account().autoresponder().message),this.updateFirstState();else{var a={Action:"GetAutoresponder",AccountID:this.account().id()};this.loading(!0),Ob.Ajax.send(a,this.onGetAutoresponderResponse,this)}},yb.prototype.onShow=function(a,b){this.account(b)},yb.prototype.onGetAutoresponderResponse=function(a,b){if(this.loading(!1),b&&b.Action){if(a&&a.Result&&a.AccountID&&this.account()){var c=null,d=new V,e=Mb.pInt(a.AccountID);e&&(c=Qb.Accounts.getAccount(e),c&&(d.parse(e,a.Result),c.autoresponder(d),e===this.account().id()&&this.account.valueHasMutated()))}}else Ob.Api.showError(Mb.i18n("WARNING/UNKNOWN_ERROR"))},yb.prototype.onUpdateAutoresponder=function(a,b){this.loading(!1),b&&b.Action?a&&a.Result?Ob.Api.showReport(Mb.i18n("SETTINGS/ACCOUNT_AUTORESPONDER_SUCCESS_REPORT")):Ob.Api.showErrorByCode(a,Mb.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED")):Ob.Api.showError(Mb.i18n("WARNING/UNKNOWN_ERROR"))},zb.prototype.getState=function(){var a=":",b=_.map(this.collection(),function(a){return a.toString()},this);return b.length>0&&(a=b.join(":")),a},zb.prototype.updateFirstState=function(){_.each(this.newCollection(),function(a){this.deleteFilter(a)},this),this.newCollection([]),this.firstState=this.getState()},zb.prototype.isChanged=function(){return this.firstState&&this.getState()!==this.firstState},zb.prototype.prepareParameters=function(){var a=_.map(this.collection(),function(a){return{Enable:a.enable()?"1":"0",Field:a.field(),Filter:a.filter(),Condition:a.condition(),Action:a.action(),FolderFullName:a.folder()}}),b={Action:"UpdateSieveFilters",AccountID:this.account().id(),Filters:a};return b},zb.prototype.saveData=function(a){this.updateFirstState(),Ob.Ajax.send(a,this.onUpdateFiltersResponse,this)},zb.prototype.onSaveClick=function(){this.account()&&(this.loading(!0),this.newCollection([]),this.saveData(this.prepareParameters()))},zb.prototype.getFilters=function(){if(this.account())if(null!==this.account().filters())this.collection(this.account().filters().collection()),this.updateFirstState();else{var a={Action:"GetSieveFilters",AccountID:this.account().id()};this.loading(!0),Ob.Ajax.send(a,this.onGetFiltersResponse,this)}},zb.prototype.onShow=function(a,b){this.account(b)},zb.prototype.deleteFilter=function(a){this.collection.remove(a),this.newCollection.remove(a)},zb.prototype.addFilter=function(){if(this.account()){var a=new $(this.account().id());this.collection.push(a),this.newCollection.push(a)}},zb.prototype.displayFilterPart=function(a,b){var c="";return c="%FIELD%"===a?"Field":"%CONDITION%"===a?"Condition":"%STRING%"===a?"String":"%ACTION%"===a?"Action":"%FOLDER%"===a?"Folder":"%DEPENDED"===a.substr(0,9)?"DependedText":"Text",b+c},zb.prototype.getDependedText=function(a){return a=Mb.pString(a),a&&(a=a.replace(/%/g,"").split("=")[1]||""),a},zb.prototype.getDependedField=function(a,b){return a=Mb.pString(a),a&&(a=a.replace(/[=](.*)/g,"").split("-")[1]||"",a=a.toLowerCase()),Mb.isUnd(b[a])?!1:b[a]()},zb.prototype.onGetFiltersResponse=function(a,b){if(this.loading(!1),b&&b.Action){if(a&&a.Result&&a.AccountID&&this.account()){var c=null,d=new Z,e=Mb.pInt(a.AccountID);e&&(c=Qb.Accounts.getAccount(e),c&&(d.parse(e,a.Result),c.filters(d),e===this.account().id()&&this.account.valueHasMutated()))}}else Ob.Api.showError(Mb.i18n("WARNING/UNKNOWN_ERROR"))},zb.prototype.onUpdateFiltersResponse=function(a,b){this.loading(!1),b&&b.Action?a&&a.Result?Ob.Api.showReport(Mb.i18n("SETTINGS/ACCOUNT_FILTERS_SUCCESS_REPORT")):Ob.Api.showError(Mb.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED")):Ob.Api.showError(Mb.i18n("WARNING/UNKNOWN_ERROR"))},Ab.prototype.onSaveClick=function(){if(this.isEmptyRequiredFields())Ob.Api.showError(Mb.i18n("WARNING/FETCHER_CREATE_ERROR"));else{var a={Action:"FetcherUpdate",AccountID:this.defaultAccountId(),FetcherID:this.idFetcher(),IsEnabled:this.isEnabled()?1:0,Folder:this.folder(),IncomingMailPassword:""===this.incomingMailPassword()?"******":this.incomingMailPassword(),LeaveMessagesOnServer:this.leaveMessagesOnServer()?1:0};this.loading(!0),Ob.Ajax.send(a,this.onSaveFetcherResponse,this)}},Ab.prototype.onSaveFetcherResponse=function(a){this.loading(!1),a.Result?(Qb.Accounts.populateFetchers(),Ob.Api.showReport(Mb.i18n("SETTINGS/ACCOUNT_FETCHER_SUCCESSFULLY_SAVED"))):Ob.Api.showErrorByCode(a,Mb.i18n("WARNING/UNKNOWN_ERROR"))},Ab.prototype.populate=function(a){a&&(this.fetcher(a),this.idFetcher(a.id()),this.isEnabled(a.isEnabled()),this.folder(a.folder()),this.incomingMailServer(a.incomingMailServer()),this.incomingMailPort(a.incomingMailPort()),this.incomingMailLogin(a.incomingMailLogin()),this.incomingMailPassword("******"),this.leaveMessagesOnServer(a.leaveMessagesOnServer()))},Ab.prototype.isEmptyRequiredFields=function(){switch(""){case this.incomingMailServer():return this.serverIsSelected(!0),!0;case this.incomingMailLogin():return this.loginIsSelected(!0),!0;case this.incomingMailPassword():return this.passwordIsSelected(!0),!0;default:return!1}},Bb.prototype.onSaveClick=function(){if(this.outgoingMailAuth()&&this.isEmptyRequiredFields())Ob.Api.showError(Mb.i18n("WARNING/FETCHER_CREATE_ERROR"));else{var a={Action:"FetcherUpdate",AccountID:this.defaultAccountId(),FetcherID:this.idFetcher(),Email:this.email(),Name:this.userName(),IsOutgoingEnabled:this.isOutgoingEnabled()?1:0,OutgoingMailServer:this.outgoingMailServer(),OutgoingMailPort:parseInt(this.outgoingMailPort(),10),OutgoingMailAuth:this.outgoingMailAuth()?1:0};this.loading(!0),Ob.Ajax.send(a,this.onSaveFetcherResponse,this)}},Bb.prototype.onSaveFetcherResponse=function(a){this.loading(!1),a.Result?(Qb.Accounts.populateFetchers(),Ob.Api.showReport(Mb.i18n("SETTINGS/ACCOUNT_FETCHER_SUCCESSFULLY_SAVED"))):Ob.Api.showErrorByCode(a,Mb.i18n("WARNING/UNKNOWN_ERROR"))},Bb.prototype.populate=function(a){a&&(this.fetcher(a),this.idFetcher(a.id()),this.isEnabled(a.isEnabled()),this.email(a.email()),this.userName(a.userName()),this.isOutgoingEnabled(a.isOutgoingEnabled()),this.outgoingMailServer(a.outgoingMailServer()),this.outgoingMailPort(a.outgoingMailPort()),this.outgoingMailAuth(a.outgoingMailAuth()))},Bb.prototype.isEmptyRequiredFields=function(){return this.isOutgoingEnabled()&&""===this.outgoingMailServer()?(this.serverIsSelected(!0),!0):!1},Cb.prototype.__name="CFetcherSignatureViewModel",Cb.prototype.save=function(){var a={Action:"FetcherUpdate",AccountID:this.defaultAccountId(),FetcherID:this.idFetcher(),SignatureOptions:this.useSignature(),Signature:this.oHtmlEditor.getText()};this.loading(!0),Ob.Ajax.send(a,this.onSaveFetcherResponse,this)},Cb.prototype.onSaveFetcherResponse=function(a){this.loading(!1),a.Result?(Ob.Api.showReport(Mb.i18n("SETTINGS/COMMON_REPORT_UPDATED_SUCCESSFULLY")),Qb.Accounts.populateFetchers()):Ob.Api.showErrorByCode(a,Mb.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED"))},Cb.prototype.populate=function(a){a&&(this.fetcher(a),this.idFetcher(a.id()),this.signature(a.signature()),this.useSignature(a.signatureOptions()))},Cb.prototype.getState=function(){var a=[this.type(),this.useSignature(),this.oHtmlEditor.getText()];return a.join(":")},Cb.prototype.updateFirstState=function(){this.firstState=this.getState()},Cb.prototype.onShow=function(){this.oHtmlEditor.initCrea(this.signature(),""),this.oHtmlEditor.setActivitySource(this.useSignature),this.updateFirstState()},Db.prototype.TemplateName="Settings_HelpdeskSettingsViewModel",Db.prototype.TabName=Lb.SettingsTab.Helpdesk,Db.prototype.TabTitle=Mb.i18n("SETTINGS/TAB_HELPDESK"),Db.prototype.onShow=function(){this.allowNotifications(Qb.User.AllowHelpdeskNotifications)},Db.prototype.onResponse=function(a){this.loading(!1),a.Result===!1?Ob.Api.showErrorByCode(a,Mb.i18n("SETTINGS/ERROR_SETTINGS_SAVING_FAILED")):(Qb.User.updateHelpdeskSettings(this.allowNotifications()),Ob.Api.showReport(Mb.i18n("SETTINGS/COMMON_REPORT_UPDATED_SUCCESSFULLY")))},Db.prototype.onSaveClick=function(){var a={Action:"UpdateHelpdeskUserSettings",AllowHelpdeskNotifications:this.allowNotifications()?"1":"0"};this.loading(!0),Ob.Ajax.send(a,this.onResponse,this)},Eb.prototype.__name="CIdentityPropertiesViewModel",Eb.prototype.onShow=function(){this.oHtmlEditor.initCrea(this.signature(),""),this.oHtmlEditor.setActivitySource(this.useSignature)},Eb.prototype.save=function(){if(""===this.email())Ob.Api.showError(Mb.i18n("WARNING/FETCHER_CREATE_ERROR"));else{this.signature(this.oHtmlEditor.getNotDefaultText());var a=this.bCreate?"CreateIdentity":"UpdateIdentity",b={Action:a,AccountID:this.identity().accountId(),Enabled:this.enabled()?1:0,Email:this.email(),Signature:this.signature(),UseSignature:this.useSignature(),FriendlyName:this.friendlyName()};this.bCreate||(b.IdIdentity=this.identity().id()),this.loading(!0),Ob.Ajax.send(b,this.onUpdateIdentityResponse,this)}},Eb.prototype.onUpdateIdentityResponse=function(a){this.loading(!1),a.Result?(Qb.Accounts.populateIdentities(),this.bCreate&&this.oParent.closeCommand()):Ob.Api.showErrorByCode(a,Mb.i18n("SETTINGS/ACCOUNTS_IDENTITY_ADDING_ERROR"))},Eb.prototype.populate=function(a){a&&(this.identity(a),this.enabled(a.enabled()),this.email(a.email()),this.friendlyName(a.friendlyName()),this.signature(a.signature()),this.useSignature(a.useSignature()?1:0))},Eb.prototype.remove=function(){var a={Action:"DeleteIdentity",AccountID:this.identity().accountId(),IdIdentity:this.identity().id()};Ob.Ajax.send(a,this.onDeleteIdentityResponse,this),this.bCreate||this.oParent.onRemoveIdentity()},Eb.prototype.onDeleteIdentityResponse=function(a){a.Result||Ob.Api.showErrorByCode(a,Mb.i18n("SETTINGS/ACCOUNTS_IDENTITY_DELETING_ERROR")),Qb.Accounts.populateIdentities()},Eb.prototype.cancel=function(){this.bCreate&&this.oParent.cancel()},Fb.prototype.initEventSources=function(){this.$calendarGrid.fullCalendar("removeEventSource",this.eventSources()),this.$calendarGrid.fullCalendar("addEventSource",this.eventSources())},Fb.prototype.eventSources=function(){var a=this;return{events:function(b,c,d){var e=[];_.each(a.calendars.collection(),function(a){e=e.concat(a&&a.active()?a.events():[])}),d(e)}}},Fb.prototype.initFullCalendar=function(){this.$calendarGrid.fullCalendar(this.fullcalendarOptions)},Fb.prototype.applyCalendarSettings=function(){this.timeFormatGrid=Qb.User.defaultTimeFormat()===Lb.TimeFormat.F24?"HH:mm":"hh:mm TT",this.timeFormatMoment=Qb.User.defaultTimeFormat()===Lb.TimeFormat.F24?"HH:mm":"hh:mm A",this.dateFormat=Qb.User.DefaultDateFormat,this.calendarGridDom().removeClass("fc-show-weekends"),Qb.User.CalendarShowWeekEnds&&this.calendarGridDom().addClass("fc-show-weekends"),this.fullcalendarOptions.timeFormat=this.timeFormatGrid+"{ - "+this.timeFormatGrid+"}",this.fullcalendarOptions.axisFormat=this.timeFormatGrid,this.fullcalendarOptions.firstDay=Qb.User.CalendarWeekStartsOn,this.fullcalendarOptions.defaultView=this.defaultViewName(),this.changeView(this.defaultViewName()),this.applyFirstDay(),this.$calendarGrid.fullCalendar("destroy"),this.$calendarGrid.fullCalendar(this.fullcalendarOptions),this.initEventSources()},Fb.prototype.applyFirstDay=function(){var a=[],b="",c="";switch(_.each(this.aDayNames,function(b){a.push(b)}),Qb.User.CalendarWeekStartsOn){case 1:c=a.shift(),a.push(c);break;case 6:b=a.pop(),a.unshift(b)}this.correctedDayNames(a),this.$datePicker.datepicker("option","firstDay",Qb.User.CalendarWeekStartsOn)},Fb.prototype.initDatePicker=function(){this.$datePicker.datepicker({showOtherMonths:!0,selectOtherMonths:!0,monthNames:Mb.getMonthNamesArray(),dayNamesMin:Mb.i18n("DATETIME/DAY_NAMES_MIN").split(" "),onChangeMonthYear:_.bind(this.changeMonthYearFromDatePicker,this),onSelect:_.bind(this.selectDateFromDatePicker,this),beforeShowDay:_.bind(this.getDayDescription,this)})},Fb.prototype.onApplyBindings=function(){this.$calendarGrid=a(this.calendarGridDom()),this.$datePicker=a(this.datePickerDom()),this.initFullCalendar(),this.initDatePicker(),this.applyCalendarSettings(),this.highlightWeekInDayPicker(),_.delay(_.bind(this.initResizing,this),300)},Fb.prototype.onShow=function(){Ob.CalendarCache&&Ob.CalendarCache.calendarSettingsChanged()?(this.applyCalendarSettings(),this.reloadAll()):Ob.CalendarCache&&Ob.CalendarCache.calendarChanged()?(Ob.CalendarCache.calendarChanged(!1),this.reloadAll()):this.loaded||this.getCalendars()},Fb.prototype.setTimeline=function(){var b=new Date,c=this.todayDate,d=this.$calendarGrid.fullCalendar("getView"),e=new Date(c.getFullYear(),c.getMonth(),c.getDate()),f=new Date(b.getFullYear(),b.getMonth(),b.getDate());f>e&&(this.execCommand("today"),this.todayDate=this.$calendarGrid.fullCalendar("getDate"));var g=a(".fc-agenda-slots:visible").parent(),h=g.children(".timeline");0===h.length&&(h=a("<hr>").addClass("timeline"),g.prepend(h)),d.visStart<b&&d.visEnd>b?h.show():h.hide();var i=60*b.getHours()*60+60*b.getMinutes()+b.getSeconds(),j=i/86400,k=Math.floor(g.height()*j);h.css("top",k+"px")},Fb.prototype.displayViewCallback=function(c){var d,e=0,f=null,g="01/01/2001 ";"undefined"!=typeof d&&b.clearInterval(d),d=b.setInterval(_.bind(function(){this.setTimeline()},this),6e4);try{this.setTimeline()}catch(h){}"month"!==c.name&&Qb.User.CalendarShowWorkDay&&a(".fc-agenda-slots tr").each(function(){var b=a(this).find("td");0!==b.length&&(a(".fc-slot"+e+" th").each(function(){var c=a(this).eq(0).text(),d=""!==c?Date.parse(g+c):null,e=Date.parse(g+Qb.User.CalendarWorkDayStarts+":00"),h=Date.parse(g+Qb.User.CalendarWorkDayEnds+":00");d?f=d:d=f,(e>d||d>=h)&&b.addClass("fc-non-working-time")}),e++)}),this.activateCustomScrollInDayAndWeekView()},Fb.prototype.collectBusyDays=function(){var a=[],b=this.calendars.getEvents();_.each(b,function(b){for(var c=moment(b.start),d=b.end?moment(b.end):null,e=d?d.diff(c,"days"):0,f=0;e>=f;f++)a.push(c.clone().add("days",f).toDate())},this),this.busyDays(a)},Fb.prototype.refreshDatePicker=function(){var a=this;
_.defer(function(){a.collectBusyDays(),a.$datePicker.datepicker("refresh"),a.highlightWeekInDayPicker()})},Fb.prototype.getDayDescription=function(a){var b=!0,c=_.find(this.busyDays(),function(b){return b.getDate()===a.getDate()&&b.getMonth()===a.getMonth()&&b.getYear()===a.getYear()},this),d=c?"day_with_events":"",e="";return[b,d,e]},Fb.prototype.initResizing=function(){var c=_.throttle(_.bind(this.resize,this),50);a(b).bind("resize",function(a){(a.target===this||Ob.browser.ie8AndBelow)&&c()}),c()},Fb.prototype.resize=function(){var a=this.$calendarGrid.parent();a&&this.$calendarGrid.fullCalendar("option","height",a.height()),this.dayNamesResize()},Fb.prototype.dayNamesResize=function(){if("month"===this.selectedView()){var b=a("div.weekday-header-item"),c=a("tr.fc-first td.fc-day"),d=a(c[0]).width(),e=0;if(7===b.length&&7===c.length&&0!==d)for(;7>e;e++)a(b[e]).width(d)}},Fb.prototype.changeMonthYearFromDatePicker=function(a,b){var c=this.$calendarGrid.fullCalendar("getDate");this.$calendarGrid.fullCalendar("gotoDate",a,b-1,c.getDate()),this.changeDate()},Fb.prototype.selectDateFromDatePicker=function(a){var b=new Date(a);this.$calendarGrid.fullCalendar("gotoDate",b.getFullYear(),b.getMonth(),b.getDate()),this.changeDate(),_.defer(_.bind(this.highlightWeekInDayPicker,this))},Fb.prototype.highlightWeekInDayPicker=function(){var a=this.$datePicker.find("td.ui-datepicker-current-day"),b=a.parent(),c=this.$datePicker.find("table.ui-datepicker-calendar"),d=this.$calendarGrid.fullCalendar("getView");switch(d.name){case"agendaDay":c.addClass("highlight_day").removeClass("highlight_week");break;case"agendaWeek":c.removeClass("highlight_day").addClass("highlight_week");break;default:c.removeClass("highlight_day").removeClass("highlight_week")}b.addClass("current_week")},Fb.prototype.changeDateTitle=function(){var a=moment(this.$calendarGrid.fullCalendar("getDate")),b=this.$calendarGrid.fullCalendar("getView"),c=a.format("MMMM YYYY"),d=b.start?moment(b.start):null,e=b.end?moment(b.end).add("days",-1):null;switch(b.name){case"agendaDay":c=a.format("MMMM D, YYYY");break;case"agendaWeek":d&&e&&(c=d.format("MMMM D, YYYY")+" - "+e.format("MMMM D, YYYY"))}this.dateTitle(c)},Fb.prototype.changeDate=function(){this.getCalendars()},Fb.prototype.changeDateInDatePicker=function(){this.$datePicker.datepicker("setDate",this.$calendarGrid.fullCalendar("getDate")),this.highlightWeekInDayPicker()},Fb.prototype.activateCustomScrollInDayAndWeekView=function(){if(!Wb){var b=a("table.fc-agenda-slots").parent().parent();b.each(function(){var b=a(this),d=a(this).parent();d.hasClass("scroll-wrap")||(d.attr("data-bind","customScrollbar: {x: false, relativeToInner: true}"),b.css({overflow:"hidden"}).addClass("scroll-inner"),c.applyBindings({},d[0]))})}},Fb.prototype.execCommand=function(a,b){b?this.$calendarGrid.fullCalendar(a,b):this.$calendarGrid.fullCalendar(a),this.changeDate(),this.changeDateInDatePicker()},Fb.prototype.displayToday=function(){this.execCommand("today")},Fb.prototype.displayPrev=function(){this.execCommand("prev")},Fb.prototype.displayNext=function(){this.execCommand("next")},Fb.prototype.changeView=function(a){this.selectedView(a),this.execCommand("changeView",a)},Fb.prototype.setAutoReloadTimer=function(){var a=this;clearTimeout(this.iAutoReloadTimer),Qb.User.AutoCheckMailInterval>0&&(this.iAutoReloadTimer=setTimeout(function(){a.getCalendars()},60*Qb.User.AutoCheckMailInterval*1e3))},Fb.prototype.reloadAll=function(){this.startDateTime=0,this.endDateTime=0,this.needsToReload=!0,this.getCalendars()},Fb.prototype.getTimeLimits=function(){var a=this.$calendarGrid.fullCalendar("getView"),b=a&&a.visStart&&a.visStart.getTime?a.visStart.getTime()/1e3:0,c=a&&a.visEnd&&a.visEnd.getTime?a.visEnd.getTime()/1e3:0;0===this.startDateTime&&0===this.endDateTime?(this.startDateTime=b,this.endDateTime=c,this.needsToReload=!0):b<this.startDateTime&&c>this.endDateTime?(this.startDateTime=b,this.endDateTime=c,this.needsToReload=!0):b<this.startDateTime?(c=this.startDateTime,this.startDateTime=b,this.needsToReload=!0):c>this.endDateTime&&(b=this.endDateTime,this.endDateTime=c,this.needsToReload=!0)},Fb.prototype.getCalendars=function(){this.changeDateTitle(),this.checkStarted(!0),this.setCalendarGridVisibility(),Ob.Ajax.abortRequestByActionName("CalendarList"),Ob.Ajax.sendExt({Action:"CalendarList",IsPublic:this.isPublic?1:0,PublicCalendarId:this.publicCalendarId},this.onCalendarsResponse,this)},Fb.prototype.onCalendarsResponse=function(a){var b=[],c=[],d=null,e=null;this.getTimeLimits(),a.Result?(this.loaded=!0,a.Result=_.sortBy(a.Result,function(a){return!a.isDefault}),_.each(a.Result,function(a){d=this.calendars.parseCalendar(a),b.push(d.id),e=this.calendars.getCalendarById(d.id),(this.needsToReload||!e||d&&e&&e.cTag!==d.cTag)&&(this.calendars.removeCalendar(d.id),d=this.calendars.parseAndAddCalendar(a),d&&(e&&d.events(e.events()),this.isPublic&&(Ob.setTitle(d.name()),this.publicCalendarName(d.name())),c.push(d.id)))},this),this.needsToReload=!1,this.calendars.expunge(b),0===c.length&&this.isPublic&&(Ob.setTitle(Mb.i18n("CALENDAR/NO_CALENDAR_FOUND")),Ob.Api.showErrorByCode(0,Mb.i18n("CALENDAR/NO_CALENDAR_FOUND"))),this.getEvents(c)):this.setCalendarGridVisibility()},Fb.prototype.getEvents=function(a){a.length>0?(Ob.Ajax.abortRequestByActionName("EventList"),Ob.Ajax.sendExt({CalendarIds:JSON.stringify(a),Start:this.startDateTime,End:this.endDateTime,IsPublic:this.isPublic?1:0,Action:"EventList"},this.onEventsResponse,this)):(this.setAutoReloadTimer(),this.checkStarted(!1))},Fb.prototype.onEventsResponse=function(a,b){var c=null,d=b.CalendarIds?JSON.parse(b.CalendarIds):[],e=[];a.Result&&(_.each(d,function(a){c=this.calendars.getCalendarById(a),c&&c.eventsCount()>0&&c.reloadEvents()},this),_.each(a.Result,function(a){if(c=this.calendars.getCalendarById(a.calendarId)){e.push(a.id);var b=c.eventExists(a.id);Mb.isUnd(b)?c.addEvent(a):b.lastModified!==a.lastModified&&c.updateEvent(a)}},this),_.each(d,function(a){c=this.calendars.getCalendarById(a),c&&c.eventsCount()>0&&c.active()&&c.expungeEvents(e)},this),this.refreshView()),this.setAutoReloadTimer(),this.checkStarted(!1)},Fb.prototype.setCalendarGridVisibility=function(){this.$calendarGrid.css("visibility","").find(".fc-view div").first().css("visibility","")},Fb.prototype.getUnusedColor=function(){var a=_.difference(this.colors,this.calendars.getColors());return a.length>0?a[0]:this.colors[0]},Fb.prototype.openCreateCalendarForm=function(){if(!this.isPublic){var a=new CCalendarModel;a.color(this.getUnusedColor()),Ob.Screens.showPopup(CalendarCreatePopup,[_.bind(this.createCalendar,this),this.colors,a])}},Fb.prototype.createCalendar=function(a,b,c){this.isPublic||Ob.Ajax.send({Name:a,Description:b,Color:c,Action:"CalendarCreate"},this.onCalendarCreateResponse,this)},Fb.prototype.onCalendarCreateResponse=function(a){a.Result&&(this.calendars.parseAndAddCalendar(a.Result),this.calendars.sort())},Fb.prototype.openUpdateCalendarForm=function(a){this.isPublic||Ob.Screens.showPopup(CalendarCreatePopup,[_.bind(this.updateCalendar,this),this.colors,a])},Fb.prototype.updateCalendar=function(a,b,c,d){this.isPublic||Ob.Ajax.send({Name:a,Description:b,Color:c,Id:d,Action:"CalendarUpdate"},this.onCalendarUpdateResponse,this)},Fb.prototype.onCalendarUpdateResponse=function(a,b){var c=null,d=[];a.Result&&(c=this.calendars.getCalendarById(b.Id),c&&(d=c.events(),c.name(b.Name),c.description(b.Description),c.color(b.Color),this.refetchEvents()))},Fb.prototype.updateCalendarColor=function(a,b){this.isPublic||Ob.Ajax.send({Color:a,Id:b,Action:"CalendarUpdateColor"},this.onCalendarUpdateColorResponse,this)},Fb.prototype.onCalendarUpdateColorResponse=function(a,b){if(a.Result){var c=this.calendars.getCalendarById(b.Id);c&&(c.color(b.Color),this.refetchEvents())}},Fb.prototype.openGetLinkCalendarForm=function(a){this.isPublic||Ob.Screens.showPopup(CalendarGetLinkPopup,[_.bind(this.publicCalendar,this),a])},Fb.prototype.openShareCalendarForm=function(a){this.isPublic||Ob.Screens.showPopup(CalendarSharePopup,[_.bind(this.shareCalendar,this),a])},Fb.prototype.shareCalendar=function(a,b,c,d,e){this.isPublic||Ob.Ajax.send({Action:"CalendarShareUpdate",Id:a,IsPublic:b?1:0,Shares:JSON.stringify(c),ShareToAll:d?1:0,ShareToAllAccess:e},this.onCalendarShareUpdateResponse,this)},Fb.prototype.onCalendarShareUpdateResponse=function(a,b){if(a.Result){var c=this.calendars.getCalendarById(b.Id);c&&(c.shares(JSON.parse(b.Shares)),1===b.ShareToAll?(c.isShared(!0),c.isSharedToAll(!0),c.sharedToAllAccess=b.ShareToAllAccess):c.isSharedToAll(!1))}},Fb.prototype.publicCalendar=function(a,b){this.isPublic||Ob.Ajax.send({Action:"CalendarPublicUpdate",Id:a,IsPublic:b?1:0},this.onCalendarPublicUpdateResponse,this)},Fb.prototype.onCalendarPublicUpdateResponse=function(a,b){if(a.Result){var c=this.calendars.getCalendarById(b.Id);c&&c.isPublic(b.IsPublic)}},Fb.prototype.deleteCalendar=function(a){var b=this.calendars.getCalendarById(a),c=b?Mb.i18n("CALENDAR/CONFIRM_REMOVE_CALENDAR",{CALENDARNAME:b.name()}):"",d=_.bind(function(b){b&&Ob.Ajax.send({Id:a,Action:"CalendarDelete"},this.onCalendarDeleteResponse,this)},this);!this.isPublic&&b&&Ob.Screens.showPopup(t,[c,d])},Fb.prototype.onCalendarDeleteResponse=function(a,b){if(a.Result){var c=this.calendars.getCalendarById(b.Id);c&&!c.isDefault&&(this.calendars.currentCal().id===c.id&&this.calendars.currentCal(null),this.calendars.removeCalendar(c.id),this.refetchEvents())}},Fb.prototype.onEventDragStart=function(){this.dragEventTrigger=!0,this.refreshDatePicker()},Fb.prototype.onEventDragStop=function(){var a=this;this.dragEventTrigger=!1,this.delayOnEventResult&&this.delayOnEventResultData&&0<this.delayOnEventResultData.length?(this.delayOnEventResult=!1,_.each(this.delayOnEventResultData,function(b){a.onEventActionResponse(b[0],b[1],!1)}),this.delayOnEventResultData=[],this.refreshView()):this.refreshDatePicker()},Fb.prototype.onEventResizeStart=function(){this.dragEventTrigger=!0},Fb.prototype.onEventResizeStop=function(){var a=this;this.dragEventTrigger=!1,this.delayOnEventResult&&this.delayOnEventResultData&&0<this.delayOnEventResultData.length?(this.delayOnEventResult=!1,_.each(this.delayOnEventResultData,function(b){a.onEventActionResponse(b[0],b[1],!1)}),this.delayOnEventResultData=[],this.refreshView()):this.refreshDatePicker()},Fb.prototype.createNewEventInCurrentCalendar=function(){this.createNewEventToday(this.calendars.currentCal())},Fb.prototype.createNewEventInCalendar=function(a){this.createNewEventToday(this.calendars.getCalendarById(a))},Fb.prototype.createNewEventToday=function(a){var b=moment();b.minutes()>30?b.add("minutes",60-b.minutes()):b.minutes(30),b.seconds(0),b.milliseconds(0),this.openCreateEventForm(a,b,b.clone().add("minutes",30),!1)},Fb.prototype.getParamsFromEventData=function(a){var b={id:a.id,uid:a.uid,calendarId:a.calendarId,newCalendarId:Mb.isUnd(a.newCalendarId)?a.calendarId:a.newCalendarId,subject:a.subject,allDay:a.allDay?1:0,location:a.location,description:a.description,alarms:a.alarms?JSON.stringify(a.alarms):"[]",attendees:a.attendees?JSON.stringify(a.attendees):"[]",owner:a.owner,recurrenceId:a.recurrenceId,excluded:a.excluded,allEvents:a.allEvents,modified:a.modified?1:0};return a.rrule&&(b.rrule=JSON.stringify(a.rrule)),b.start=a.start,b.end=a.end,b.startTimestamp=b.start.getTime()/1e3,b.endTimestamp=b.end?b.end.getTime()/1e3:b.startTimestamp,b},Fb.prototype.getEventDataFromParams=function(a){var b=a;return b.alarms=a.alarms?JSON.parse(a.alarms):[],b.attendees=a.attendees?JSON.parse(a.attendees):[],a.rrule&&(b.rrule=JSON.parse(a.rrule)),b},Fb.prototype.createEventFromGrid=function(a,b,c){this.openCreateEventForm(this.calendars.currentCal(),moment(a),moment(b),c)},Fb.prototype.openCreateEventForm=function(a,b,c,d){this.isPublic||Ob.Screens.showPopup(CalendarCreateEventPopup,[{CallbackSave:_.bind(this.createEvent,this),CallbackDelete:_.bind(this.deleteEvent,this),Calendars:this.calendars,SelectedCalendar:a.id,StartMoment:b,EndMoment:c,AllDay:d,TimeFormat:this.timeFormatMoment,DateFormat:this.dateFormat,CallbackAttendeeActionDecline:_.bind(this.attendeeActionDecline,this)}])},Fb.prototype.createEvent=function(a){var b=this.getParamsFromEventData(a),c=this.$calendarGrid.fullCalendar("getView"),d=c&&c.visStart&&c.visStart.getTime?c.visStart.getTime()/1e3:0,e=c&&c.visEnd&&c.visEnd.getTime?c.visEnd.getTime()/1e3:0;this.isPublic||(b.calendarId=a.newCalendarId,b.selectStart=d,b.selectEnd=e,b.Action="EventCreate",Ob.Ajax.send(b,this.onEventActionResponseWithSubThrottle,this))},Fb.prototype.openEditEventForm=function(a){var b=_.bind(function(b){var c={CallbackSave:_.bind(this.updateEvent,this),CallbackDelete:_.bind(this.deleteEvent,this),ID:a.id,Uid:a.uid,RecurrenceId:a.recurrenceId,Calendars:this.calendars,SelectedCalendar:a.calendarId,AllDay:a.allDay,Location:a.location,Description:a.description,Subject:a.subject,Alarms:a.alarms,Attendees:a.attendees,RRule:a.rrule?a.rrule:null,Excluded:a.excluded?a.excluded:!1,Owner:a.owner,Appointment:a.appointment,OwnerName:a.ownerName,TimeFormat:this.timeFormatMoment,DateFormat:this.dateFormat,AllEvents:b,CallbackAttendeeActionDecline:_.bind(this.attendeeActionDecline,this)};b!==Lb.CalendarEditRecurrenceEvent.None&&(b===Lb.CalendarEditRecurrenceEvent.AllEvents&&a.rrule?(c.StartMoment=moment(1e3*a.rrule.startBase),c.EndMoment=moment(1e3*a.rrule.endBase)):(c.StartMoment=moment(a.start),c.EndMoment=moment(a.end)),Ob.Screens.showPopup(CalendarCreateEventPopup,[c]))},this);a.rrule?a.excluded?b(Lb.CalendarEditRecurrenceEvent.OnlyThisInstance):Ob.Screens.showPopup(CalendarEditRecurrenceEventPopup,[b]):b(Lb.CalendarEditRecurrenceEvent.AllEvents)},Fb.prototype.eventAction=function(a,b,c){var d=this.calendars.getCalendarById(b.calendarId);d.access()===Lb.CalendarAccess.Read?c&&c():this.isPublic||(c&&(this.revertFunction=c),b.Action=a,Ob.Ajax.send(b,this.onEventActionResponseWithSubThrottle,this))},Fb.prototype.updateEvent=function(a){var b=this.getParamsFromEventData(a),c=this.$calendarGrid.fullCalendar("getView"),d=c&&c.visStart&&c.visStart.getTime?c.visStart.getTime()/1e3:0,e=c&&c.visEnd&&c.visEnd.getTime?c.visEnd.getTime()/1e3:0;b.selectStart=d,b.selectEnd=e,a.modified&&(this.calendars.setDefault(a.newCalendarId),this.eventAction("EventUpdate",b))},Fb.prototype.moveEvent=function(a,b,c,d,e){a.dayDelta=b?b:0,a.minuteDelta=c?c:0;var f=this.getParamsFromEventData(a),g=this.$calendarGrid.fullCalendar("getView"),h=g&&g.visStart&&g.visStart.getTime?g.visStart.getTime()/1e3:0,i=g&&g.visEnd&&g.visEnd.getTime?g.visEnd.getTime()/1e3:0;f.selectStart=h,f.selectEnd=i,this.isPublic||(f.rrule?e(!1):(f.allEvents=Lb.CalendarEditRecurrenceEvent.AllEvents,this.eventAction("EventUpdate",f,e)))},Fb.prototype.resizeEvent=function(a,b,c,d){var e=this.getParamsFromEventData(a),f=this.$calendarGrid.fullCalendar("getView"),g=f&&f.visStart&&f.visStart.getTime?f.visStart.getTime()/1e3:0,h=f&&f.visEnd&&f.visEnd.getTime?f.visEnd.getTime()/1e3:0,i=_.bind(function(a){a!==Lb.CalendarEditRecurrenceEvent.None?(e.allEvents=a,this.eventAction("EventUpdate",e,d)):d()},this);e.selectStart=g,e.selectEnd=h,a.rrule?e.excluded?i(Lb.CalendarEditRecurrenceEvent.OnlyThisInstance):Ob.Screens.showPopup(CalendarEditRecurrenceEventPopup,[i]):i(Lb.CalendarEditRecurrenceEvent.AllEvents)},Fb.prototype.deleteEvent=function(a){this.eventAction("EventDelete",this.getParamsFromEventData(a))},Fb.prototype.onEventActionResponseWithSubThrottle=function(a,b){this.dragEventTrigger?(this.delayOnEventResult=!0,this.delayOnEventResultData.push([a,b])):this.onEventActionResponse(a,b)},Fb.prototype.onEventActionResponse=function(b,c,d){var e=this.calendars.getCalendarById(c.calendarId),f=null,g=null;d=Mb.isUnd(d)?!0:!!d,b&&b.Result&&!Mb.isUnd(e)?"EventCreate"===c.Action||"EventUpdate"===c.Action?(this.customscrollTop(parseInt(a(".calendar .scroll-inner").scrollTop(),10)),g=e.getEvent(c.id),(Mb.isUnd(g)||Mb.isUnd(g.rrule))&&!c.rrule||c.allEvents!==Lb.CalendarEditRecurrenceEvent.AllEvents?e.removeEvent(c.id):e.removeEventByUid(c.uid,!0),c.newCalendarId&&c.newCalendarId!==c.calendarId&&(e=this.calendars.getCalendarById(c.newCalendarId)),_.each(b.Result.Events,function(a){e.addEvent(a)},this),e.cTag=b.Result.CTag,e.active()||e.active(!0),d&&this.refreshView(),this.customscrollTop.valueHasMutated(),this.calendars.currentCal(e)):"EventDelete"===c.Action?(e.cTag=b.Result,c.allEvents===Lb.CalendarEditRecurrenceEvent.OnlyThisInstance?e.removeEvent(c.id):e.removeEventByUid(c.uid),d&&this.refreshView()):"EventBase"===c.Action&&(f=b.Result,Ob.Screens.showPopup(CalendarCreateEventPopup,[{CallbackSave:_.bind(this.updateEvent,this),CallbackDelete:_.bind(this.deleteEvent,this),ID:f.id,Uid:f.uid,RecurrenceId:f.recurrenceId,Calendars:this.calendars,SelectedCalendar:f.calendarId,StartMoment:moment(1e3*f.start),EndMoment:moment(1e3*f.end),AllDay:f.allDay,Location:f.location,Description:f.description,Subject:f.subject,Alarms:f.alarms,Attendees:f.attendees,RRule:f.rrule?f.rrule:null,Excluded:f.excluded?f.excluded:!1,Owner:f.owner,Appointment:f.appointment,TimeFormat:this.timeFormatMoment,DateFormat:this.dateFormat,AllEvents:Lb.CalendarEditRecurrenceEvent.AllEvents}])):"EventUpdate"!==c.Action||b.Result||1155!==Mb.pInt(b.ErrorCode)?this.revertFunction&&this.revertFunction():this.revertFunction=null,this.revertFunction=null},Fb.prototype.attendeeActionDecline=function(a,b){a.removeEvent(b),this.refreshView()},Fb.prototype.refetchEvents=function(){this.$calendarGrid.fullCalendar("refetchEvents")},Fb.prototype.refreshViewSingle=function(){this.refetchEvents(),this.refreshDatePicker()},Fb.prototype.refreshView=function(){},Gb.prototype.initScreens=function(){},Gb.prototype.initLayout=function(){},Gb.prototype.init=function(){this.initScreens(),this.initLayout(),a("#pSevenContent").addClass("single_mode"),_.defer(function(){Qb.SingleMode||a("#pSevenContent").removeClass("single_mode")}),this.informationScreen(this.showNormalScreen(Lb.Screens.Information))},Gb.prototype.showCurrentScreen=function(a,b){this.currentScreen()!==a&&(this.hideCurrentScreen(),this.currentScreen(a)),this.showNormalScreen(a,b)},Gb.prototype.hideCurrentScreen=function(){this.currentScreen().length>0&&this.hideScreen(this.currentScreen())},Gb.prototype.hideScreen=function(a){var b=a,c=this.oScreens[b];"undefined"!=typeof c&&c.bInitialized&&c.Model.hideViewModel()},Gb.prototype.showNormalScreen=function(a,b){var c=a,d=this.oScreens[c];return d&&(d.bInitialized="boolean"!=typeof d.bInitialized?!1:d.bInitialized,d.bInitialized||(d.Model=this.initViewModel(d.Model,d.TemplateName),d.bInitialized=!0),d.Model.showViewModel(b)),d?d.Model:null},Gb.prototype.initViewModel=function(b,d){var e=null,f=null;return e=new b,f=a('div[data-view-model="'+d+'"]').attr("data-bind","template: {name: '"+d+"'}").hide(),e.$viewModel=f,e.bShown=!1,e.showViewModel=function(a){this.$viewModel.show(),"function"==typeof this.onRoute&&this.onRoute(a),this.bShown||("function"==typeof this.onShow&&this.onShow(a),Pb.runPluginHook&&this.__name&&Pb.runPluginHook("view-model-on-show",[this.__name,this]),this.bShown=!0)},e.hideViewModel=function(){this.$viewModel.hide(),"function"==typeof this.onHide&&this.onHide(),this.bShown=!1},c.applyBindings(e,f[0]),"function"==typeof e.onApplyBindings&&e.onApplyBindings(f),e},Gb.prototype.showPopup=function(b,d){if(b){if(!b.__builded){var e=null,f=new b,g=f.popupTemplate?f.popupTemplate():"";""!==g&&(e=a('div[data-view-model="'+g+'"]').attr("data-bind","template: {name: '"+g+"'}").removeClass("visible").hide(),e&&1===e.length&&(f.visibility=c.observable(!1),b.__builded=!0,b.__vm=f,f.$viewModel=e,b.__dom=e,f.showViewModel=Mb.createCommand(f,function(){Ob&&Ob.Screens&&Ob.Screens.showPopup(b)}),f.closeCommand=Mb.createCommand(f,function(){Ob&&Ob.Screens&&Ob.Screens.hidePopup(b)}),c.applyBindings(f,e[0]),Mb.delegateRun(f,"onApplyBindings",[e])))}b.__vm&&b.__dom&&(b.__dom.show(),_.delay(function(){b.__dom.addClass("visible")},50),b.__vm.visibility(!0),Mb.delegateRun(b.__vm,"onShow",d),this.popupVisibility(!0),this.popups.push(b),this.keyupPopupBinded=_.bind(this.keyupPopup,this,b.__vm),a(document).on("keyup",this.keyupPopupBinded))}},Gb.prototype.keyupPopup=function(a,c){if(c){var d=b.parseInt(c.keyCode,10);27===d&&a.closeCommand(),13!==d&&32!==d||!a.onEnterHandler||a.onEnterHandler()}},Gb.prototype.hidePopup=function(b){b&&b.__vm&&b.__dom&&(this.keyupPopupBinded&&(a(document).off("keyup",this.keyupPopupBinded),this.keyupPopupBinded=void 0),b.__dom.removeClass("visible").hide(),b.__vm.visibility(!1),Mb.delegateRun(b.__vm,"onHide"),this.popupVisibility(!1),this.popups=_.without(this.popups,b))},Gb.prototype.hideAllPopup=function(){_.each(this.popups,function(a){this.hidePopup(a)},this)},Gb.prototype.showLoading=function(a){this.informationScreen()&&this.informationScreen().showLoading(a)},Gb.prototype.hideLoading=function(){this.informationScreen()&&this.informationScreen().hideLoading()},Gb.prototype.showReport=function(a,b){this.informationScreen()&&this.informationScreen().showReport(a,b)},Gb.prototype.showError=function(a,b,c,d){this.informationScreen()&&this.informationScreen().showError(a,b,c,d)},Gb.prototype.hideError=function(a){this.informationScreen()&&this.informationScreen().hideError(a)},Gb.prototype.initScreens=function(){this.oScreens[Lb.Screens.Information]={Model:ab,TemplateName:"Common_InformationViewModel"},this.oScreens[Lb.Screens.Login]={Model:gb,TemplateName:"Login_LoginViewModel"},this.oScreens[Lb.Screens.Header]={Model:bb,TemplateName:"Common_HeaderMobileViewModel"},this.oScreens[Lb.Screens.Mailbox]={Model:kb,TemplateName:"Mail_LayoutSidePane_MailViewModel"},this.oScreens[Lb.Screens.BottomMailbox]={Model:kb,TemplateName:"Mail_LayoutBottomPane_MailViewModel"},this.oScreens[Lb.Screens.SingleMessageView]={Model:jb,TemplateName:"Mail_LayoutSidePane_MessagePaneViewModel"},this.oScreens[Lb.Screens.Compose]={Model:lb,TemplateName:"Mail_ComposeViewModel"},this.oScreens[Lb.Screens.Settings]={Model:ob,TemplateName:"Settings_SettingsViewModel"}},Gb.prototype.initLayout=function(){a("#pSevenContent").append(a("#Layout").html())},Hb.prototype.init=function(){var a=null;Qb.SingleMode&&b.opener&&(a=b.opener.App.MailCache,this.oFolderListItems=a.oFolderListItems,b.name&&this.currentAccountId(Mb.pInt(b.name))),this.currentAccountId.valueHasMutated()},Hb.prototype.getCurrentFolder=function(){return this.folderList().currentFolder()},Hb.prototype.getFolderByFullName=function(a,b){var c=this.oFolderListItems[a];return c?c.getFolderByFullName(b):null},Hb.prototype.getFolderList=function(a){var b={Action:"FolderList"};Mb.isUnd(a)||(b.AccountID=a),Ob.Ajax.send(b,this.onFolderListResponse,this)},Hb.prototype.markMessageReplied=function(a,b,c,d){var e=this.oFolderListItems[a],f=null;e&&(f=e.getFolderByFullName(b),f&&f.markMessageReplied(c,d))},Hb.prototype.hideThreads=function(a){Qb.User.useThreads()&&a.folder()===this.folderList().currentFolderFullName()&&!a.threadOpened()&&this.folderList().currentFolder().hideThreadMessages(a)},Hb.prototype.showOpenedThreads=function(a){Mb.log("****************************************showOpenedThreads"),Mb.log(this.messages()),Mb.log(a),Mb.log(this.uidList()),this.messages(this.getMessagesWithThreads(a,this.uidList(),this.messages())),Mb.log(this.messages()),Mb.log("****************************************")},Hb.prototype.getMessagesWithThreads=function(a,b,c){var d=[],e=[],f=this.folderList().currentFolder(),g=f&&f.withoutThreads(),h=""===b.search()&&""===b.filters();return f&&a===f.fullName()&&Qb.User.useThreads()&&!g&&h&&(e=_.filter(c,function(a){return!a.threadPart()}),_.each(e,function(a){var b=[];d.push(a),a.threadCount()>0&&(a.threadOpened()&&(b=this.folderList().currentFolder().getThreadMessages(a),d=_.union(d,b)),this.folderList().currentFolder().computeUnreadThreadCount(a))},this),Mb.log("Get messages with threads",c.length,"Messages without threads",e.length,"Messages with opened threads",d.length),d.length)?d:c},Hb.prototype.setMessagesFromUidList=function(a,b,c,d){var e=a.getUidsForOffset(b,c),f=_.map(e,function(a){return c[a]},this),g=f.length;return d&&(Mb.log("****************************************setMessagesFromUidList"),Mb.log(this.messages()),Mb.log(this.folderList().currentFolderFullName()),Mb.log(a),Mb.log(f),this.messages(this.getMessagesWithThreads(this.folderList().currentFolderFullName(),a,f)),Mb.log(this.messages()),Mb.log("****************************************"),b+g<a.resultCount()&&g<Qb.User.MailsPerPage&&this.messagesLoading(!0),this.currentMessage()&&(this.currentMessage().deleted()||this.currentMessage().folder()!==this.folderList().currentFolderFullName())&&(Mb.log("setMessagesFromUidList currentMessage = null",this.currentMessage().deleted(),this.currentMessage().folder(),this.folderList().currentFolderFullName()),this.currentMessage(null))),e},Hb.prototype.executeCheckMail=function(){var a=this.folderList(),b=a?a.getInboxSpamFiltersFetcherAndCurrentFolders():[],c={Action:"FolderCounts",Folders:b,AccountID:a?a.iAccountId:0};!this.checkMailStarted()&&b.length>0&&(this.checkMailStarted(!0),Mb.log("Check mail started - executeCheckMail",this.checkMailStarted()),Ob.Ajax.send(c,this.onFolderCountsResponse,this))},Hb.prototype.setAutocheckmailTimer=function(){clearTimeout(this.iAutoCheckMailTimer),!Qb.SingleMode&&Qb.User.AutoCheckMailInterval>0&&(this.iAutoCheckMailTimer=setTimeout(function(){Ob.Ajax.isSearchMessages()||Ob.MailCache.executeCheckMail()},60*Qb.User.AutoCheckMailInterval*1e3))},Hb.prototype.changeCurrentMessageList=function(a,b,c,d){this.requestCurrentMessageList(a,b,c,d,!0)},Hb.prototype.requestCurrentMessageList=function(a,b,c,d,e){var f=this.requestMessageList(a,b,c,d||"",!0,e||!1);this.uidList(f.UidList),this.page(b),this.messagesLoading(f.DataExpected),this.messagesLoadingError(!1),Ob.Prefetcher.start()},Hb.prototype.requestMessageList=function(a,b,c,d,e,f){var g=this.oFolderListItems[this.currentAccountId()],h=g?g.getFolderByFullName(a):null,i=h&&h.withoutThreads(),j=Qb.User.useThreads()&&!i&&""===c&&""===d,k=h?h.getUidList(c,d):null,l=(b-1)*Qb.User.MailsPerPage,m=k?this.setMessagesFromUidList(k,l,h.oMessages,f):[],n={Action:"MessageList",Folder:a,Offset:l,Limit:Qb.User.MailsPerPage,Search:c,Filters:d,UseThreads:j?"1":"0"},o=!1,p=!1,q=e?this.onCurrentMessageListResponse:this.onMessageListResponse;return k&&(p=-1===k.resultCount()||l+m.length<k.resultCount()&&m.length<Qb.User.MailsPerPage,o=h.hasChanges()||p),o&&Ob.Ajax.send(n,q,this),{UidList:k,RequestStarted:o,DataExpected:p}},Hb.prototype.executeEmptyTrash=function(){var a=this.folderList().trashFolder();a&&a.emptyFolder()},Hb.prototype.executeEmptySpam=function(){var a=this.folderList().spamFolder();a&&a.emptyFolder()},Hb.prototype.onClearFolder=function(a){if(a&&a.selected()){this.messages.removeAll(),Mb.log("onClearFolder currentMessage = null",a.fullName()),this.currentMessage(null);var b=a?a.getUidList(this.uidList().search(),this.uidList().filters()):null;b?this.uidList(b):this.uidList(new O),this.checkMailStarted(!1),this.setAutocheckmailTimer(),Mb.log("Check mail started - onClearFolder",this.checkMailStarted())}},Hb.prototype.moveMessagesToFolder=function(a,b,c){if(b.length>0){var d=this.folderList().currentFolder(),e=d.getUidsWithThread(b),f=this.folderList().getFolderByFullName(a),g={Action:"MessageMove",Folder:d?d.fullName():"",ToFolder:a,Uids:e.join(",")},h=null;d&&f&&(h=d.markDeletedByUids(e),f.addMessagesCountsDiff(h.MinusDiff,h.UnseenMinusDiff),(Mb.isUnd(c)?0:!c)||f.recivedAnim(!0),this.excludeDeletedMessages(),f.markHasChanges(),Ob.Ajax.send(g,this.onMoveMessagesResponse,this),f&&f.type()===Lb.FolderTypes.Trash&&Pb.runPluginHook("move-messages-to-trash",[Qb.Accounts.currentId(),g.Folder,e]),f&&f.type()===Lb.FolderTypes.Spam&&Pb.runPluginHook("move-messages-to-spam",[Qb.Accounts.currentId(),g.Folder,e]))}},Hb.prototype.excludeDeletedMessages=function(){_.delay(_.bind(function(){var a=this.folderList().currentFolder(),b=(this.page()-1)*Qb.User.MailsPerPage;this.setMessagesFromUidList(this.uidList(),b,a.oMessages,!0)},this),500)},Hb.prototype.removeMessagesFromCacheForFolder=function(a){var b=this.folderList().getFolderByFullName(a),c=this.folderList().currentFolderFullName();b&&(b.markHasChanges(),a===c&&this.requestCurrentMessageList(c,this.page(),this.uidList().search(),"",!0))},Hb.prototype.deleteMessages=function(a){var b=this.folderList().currentFolder();b&&this.deleteMessagesFromFolder(b,a)},Hb.prototype.deleteMessagesFromFolder=function(a,b){var c=a.getUidsWithThread(b),d={Action:"MessageDelete",Folder:a.fullName(),Uids:c.join(",")};a.markDeletedByUids(c),this.excludeDeletedMessages(),Ob.Ajax.send(d,this.onMoveMessagesResponse,this),Pb.runPluginHook("delete-messages",[Qb.Accounts.currentId(),d.Folder,c])},Hb.prototype.showExternalPictures=function(a){var b=[],c=null;this.currentMessage()&&(b=this.currentMessage().oFrom.aCollection,c=this.folderList().getFolderByFullName(this.currentMessage().folder()),a&&b.length>0?c.alwaysShowExternalPicturesForSender(b[0].sEmail):c.showExternalPictures(this.currentMessage().uid()))},Hb.prototype.setCurrentMessage=function(a,b){var c=Qb.SingleMode?this.folderList().getFolderByFullName(b):this.folderList().currentFolder(),d=c&&a?c.oMessages[a]:null;d&&!d.deleted()?(this.currentMessage(d),this.currentMessage().seen()||this.executeGroupOperation("MessageSetSeen",[this.currentMessage().uid()],"seen",!0),c.getCompletelyFilledMessage(a,this.onCurrentMessageResponse,this)):(Mb.log("setCurrentMessage, currentMessage = null",a,b,d,d?d.deleted():""),this.currentMessage(null))},Hb.prototype.onCurrentMessageResponse=function(a,b){var c=this.currentMessage()?this.currentMessage().uid():"";null===a&&c===b&&(Mb.log("onCurrentMessageResponse currentMessage = null",null===a,c,b),this.currentMessage(null))},Hb.prototype.getMessage=function(a,b,c,d){var e=this.folderList().getFolderByFullName(a);e&&e.getCompletelyFilledMessage(b,c,d)},Hb.prototype.executeGroupOperation=function(a,b,c,d){var e=this.folderList().currentFolder(),f={Action:a,Folder:e?e.fullName():"",Uids:b.join(","),SetAction:d?1:0},g=(this.page()-1)*Qb.User.MailsPerPage,h=b.length,i=this.folderList().oStarredFolder?this.folderList().oStarredFolder.messageCount():0,j=e.getUidList("",Lb.FolderFilter.Flagged);e&&(Ob.Ajax.send(f),e.executeGroupOperation(c,b,d),e.type()===Lb.FolderTypes.Inbox&&c===Lb.FolderFilter.Flagged&&(""!==this.uidList().filters()?d||(this.uidList().deleteUids(b),this.folderList().oStarredFolder&&this.folderList().oStarredFolder.messageCount(j.resultCount())):(e.removeFlaggedMessageListsFromCache(),""===this.uidList().search()&&this.folderList().oStarredFolder&&(d?this.folderList().oStarredFolder.messageCount(i+h):this.folderList().oStarredFolder.messageCount(i-h>0?i-h:0)))),this.setMessagesFromUidList(this.uidList(),g,e.oMessages,!0))},Hb.prototype.onFolderListResponse=function(a,b){var c=new M,d=parseInt(a.AccountID,10),e=this.oFolderListItems[d],f=e?e.oNamedCollection:{};a.Result===!1?(Ob.Api.showErrorByCode(a),b.AccountID===this.currentAccountId()&&0===this.messages().length&&(this.messagesLoading(!1),this.messagesLoadingError(!0))):(c.parse(d,a.Result,f),this.oFolderListItems[d]=c,setTimeout(_.bind(this.getAllFolderCounts,this,d),2e3),this.currentAccountId()===d&&this.folderList(c),this.editedAccountId()===d&&this.editedFolderList(c))},Hb.prototype.setCurrentFolderList=function(a){var b=a.iAccountId;b===this.currentAccountId()&&b!==this.folderList().iAccountId&&this.folderList(a)},Hb.prototype.getAllFolderCounts=function(a){var b=this.oFolderListItems[a],c=b?b.getFoldersWithoutCountInfo():[],d={Action:"FolderCounts",Folders:c,AccountID:a};c.length>0&&Ob.Ajax.send(d,this.onFolderCountsResponse,this)},Hb.prototype.onFolderCountsResponse=function(a){var b=!1,c=a.AccountID,d=this.oFolderListItems[c],e=this.folderList().currentFolderFullName(),f=this.currentAccountId()===c;a.Result===!1?Ob.Api.showErrorByCode(a):_.each(a.Result,function(a,c){if(_.isArray(a)&&a.length>3){var g=a[0],h=a[1],i=a[2],j=a[3],k=!1,l=null;
d&&(l=d.getFolderByFullName(c),l&&(k=l.setRelevantInformation(i,j,g,h,!0),f&&k&&l.fullName()===e&&(this.requestCurrentMessageList(l.fullName(),this.page(),this.uidList().search(),this.uidList().filters(),!1),b=!0)))}},this),this.checkMailStarted(b),this.checkMailStarted()||this.setAutocheckmailTimer(),Mb.log("Check mail started - onFolderCountsResponse",this.checkMailStarted())},Hb.prototype.onCurrentMessageListResponse=function(a,b){if(this.checkMailStarted(!1),Mb.log("Check mail started - onCurrentMessageListResponse",this.checkMailStarted()),a.Result){if(this.messagesLoadingError(!1),this.parseMessageList(a,b),""!==this.deletedDraftMessageUid()){var c=this.deletedDraftMessageUid(),d=_.find(a.Result["@Collection"],function(a){return a.Uid===c});d||(Mb.log("onCurrentMessageListResponse"),this.setCurrentMessage("",""),this.deletedDraftMessageUid(""))}}else Ob.Api.showErrorByCode(a),this.messagesLoading()===!0&&a.ErrorCode!==Lb.Errors.NotDisplayedError&&this.messagesLoadingError(!0),this.messagesLoading(!1),this.setAutocheckmailTimer()},Hb.prototype.onMessageListResponse=function(a,b){a&&a.Result&&this.parseMessageList(a,b)},Hb.prototype.parseMessageList=function(a,b){var c=a.Result,d=this.oFolderListItems[a.AccountID],e=null,f=null,g="1"===b.UseThreads,h=!1,i=!1,j=!1,k=!1,l=[];c!==!1&&"Collection/MessageCollection"===c["@Object"]&&(e=d.getFolderByFullName(c.FolderName),e.setRelevantInformation(c.UidNext.toString(),c.FolderHash,c.MessageCount,c.MessageUnseenCount,!1),h=e.hasChanges(),e.removeAllMessageListsFromCacheIfHasChanges(),f=e.getUidList(c.Search,c.Filters),f.setUidsAndCount(c),_.each(c["@Collection"],function(a){var b=e.parseAndCacheMessage(a,!1,g);l.push(b)},this),Pb.runPluginHook("response-custom-messages",[a.AccountID,e.fullName(),l]),i=this.currentAccountId()===a.AccountID&&this.folderList().currentFolderFullName()===c.FolderName,j=i&&this.uidList().search()===f.search()&&this.uidList().filters()===f.filters(),k=this.page()===c.Offset/Qb.User.MailsPerPage+1,j&&(this.uidList(f),k&&(this.setMessagesFromUidList(f,c.Offset,e.oMessages,!0),this.messagesLoading(!1),this.setAutocheckmailTimer())),!h||!i||j&&k||this.requestCurrentMessageList(this.folderList().currentFolderFullName(),this.page(),this.uidList().search(),this.uidList().filters(),!1),e.type()===Lb.FolderTypes.Inbox&&f.filters()===Lb.FolderFilter.Flagged&&""===f.search()&&this.folderList().oStarredFolder&&this.folderList().oStarredFolder.messageCount(f.resultCount()))},Hb.prototype.onMoveMessagesResponse=function(a,b){var c=a.Result,d=this.folderList().getFolderByFullName(b.Folder),e=this.folderList().getFolderByFullName(b.ToFolder),f=e&&e.type()===Lb.FolderTypes.Trash,g=e&&e.type()===Lb.FolderTypes.Spam,h=null,i=f?Mb.i18n("MAILBOX/CONFIRM_MESSAGES_DELETE_WITHOUT_TRASH"):Mb.i18n("MAILBOX/CONFIRM_MESSAGES_MARK_SPAM_WITHOUT_SPAM"),j=_.bind(function(a){a&&d&&this.deleteMessagesFromFolder(d,b.Uids.split(","))},this),k=this.folderList().currentFolder(),l=k.fullName();c===!1?(h=d.revertDeleted(b.Uids.split(",")),e?(e.addMessagesCountsDiff(-h.PlusDiff,-h.UnseenPlusDiff),a.ErrorCode===Lb.Errors.ImapQuota&&(f||g)?Ob.Screens.showPopup(t,[i,j]):Ob.Api.showErrorByCode(a,Mb.i18n("MAILBOX/ERROR_MOVING_MESSAGES"))):Ob.Api.showErrorByCode(a,Mb.i18n("MAILBOX/ERROR_DELETING_MESSAGES"))):d.commitDeleted(b.Uids.split(",")),l===d.fullName()||e&&l===e.fullName()?(k.markHasChanges(),this.requestCurrentMessageList(l,this.page(),this.uidList().search(),"",!1)):l!==d.fullName()?Ob.Prefetcher.startFolderPrefetch(d):e&&l!==e.fullName()&&Ob.Prefetcher.startFolderPrefetch(e)},Hb.prototype.searchMessagesInCurrentFolder=function(a){var b=this.folderList().currentFolderFullName()||"INBOX",c=this.currentMessage()?this.currentMessage().uid():"",d=this.uidList().filters();Ob.Routing.setHash(Ob.Links.mailbox(b,1,c,a,d))},Hb.prototype.searchMessagesInInbox=function(a){Ob.Routing.setHash(Ob.Links.mailbox(this.folderList().inboxFolderFullName()||"INBOX",1,"",a,""))},Hb.prototype.countMessages=function(a){var b=[],c=function(a){_.each(a.subfolders(),function(a){a.subscribed()&&(b.push(a.unseenMessageCount()),a.subfolders().length&&a.subscribed()&&c(a))},this)};a.expanded()||a.isNamespace()?a.subfoldersMessagesCount(0):(c(a),a.subfoldersMessagesCount(_.reduce(b,function(a,b){return a+b},0)))},Ib.prototype.clearInfoAboutEmail=function(a){this.contacts[a]=void 0},Ib.prototype.getContactByEmail=function(a,b,c){if(Qb.User.ShowContacts){var d=this.contacts[a],e={Action:"ContactByEmail",Email:a};void 0!==d?b.apply(c,[d,a]):(this.responseHandlers[a]={Handler:b,Context:c},Ob.Ajax.send(e,this.onContactByEmailResponse,this))}},Ib.prototype.onContactByEmailResponse=function(a,b){var c=null,d=this.responseHandlers[b.Email];a.Result&&(c=new R,c.parse(a.Result)),this.contacts[b.Email]=c,d&&(d.Handler.apply(d.Context,[c,b.Email]),this.responseHandlers[b.Email]=void 0)},Ib.prototype.addVcard=function(a){this.vcardAttachments.push(a)},Ib.prototype.markVcardsNonexistentByUid=function(a){_.each(this.vcardAttachments,function(b){-1!==_.indexOf(a,b.uid())&&b.isExists(!1)})},Ib.prototype.markVcardExistentByFile=function(a){_.each(this.vcardAttachments,function(b){b.file()===a&&b.isExists(!0)})},Ib.prototype.addToContacts=function(a,b,c,d){var e={Action:"ContactCreate",PrimaryEmail:"Home",UseFriendlyName:"1",FullName:a,HomeEmail:b};Ob.Ajax.send(e,c,d),Ob.ContactsCache.recivedAnim(!0)},Jb.prototype.addIcal=function(a){this.icalAttachments.push(a),0===this.calendars().length&&this.requestCalendarList()},Jb.prototype.onCalendarListResponse=function(a){if(a&&a.Result){var b=Qb.Accounts,c=b.currentId(),d=b.getAccount(c).email(),e=_.filter(a.Result,function(a){return a.Owner===d||a.Access===Lb.CalendarAccess.Full||a.Access===Lb.CalendarAccess.Write});this.calendars(_.map(e,function(a){return{name:a.Name+" <"+a.Owner+">",id:a.Id}}))}this.calendarsLoadingStarted(!1)},Jb.prototype.requestCalendarList=function(){this.calendarsLoadingStarted()||(Ob.Ajax.send({Action:"CalendarList"},this.onCalendarListResponse,this),this.calendarsLoadingStarted(!0))},Jb.prototype.markIcalNonexistent=function(a){_.each(this.icalAttachments,function(b){a===b.uid()&&b.onEventDelete()})},Jb.prototype.markIcalTypeByFile=function(a,b,c,d,e,f){_.each(this.icalAttachments,function(g){a===g.file()&&(g.type(b),g.cancelDecision(c),g.replyDecision(d),g.calendarId(e),g.selectedCalendar(f))})},Jb.prototype.markIcalTentative=function(a){_.each(this.icalAttachments,function(b){a===b.uid()&&b.onEventTentative()})},Jb.prototype.markIcalAccepted=function(a){_.each(this.icalAttachments,function(b){a===b.uid()&&b.onEventAccept()})},Kb.prototype.init=function(){var c=Qb.User,d=new C,e=Qb.Accounts,f=new E,g=Qb.App,h=new B,i=Mb.getAppPath()+"#"+Lb.Screens.Compose+"/to/%s",j=""!==Qb.App.SiteName?Qb.App.SiteName:"WebMail",k=!1;d.parse(c),Qb.User=d,e=e,f.parse(Mb.pInt(Qb.Default),e),Qb.Accounts=f,h.parse(g),Qb.App=h,this.MailCache=new Hb,this.useGoogleAnalytics(),this.collectScreensData(),b.navigator&&Mb.isFunc(b.navigator.registerProtocolHandler)&&(this.browser.firefox&&1===this.Storage.getData("MailtoAsked")&&(k=!0),k||b.navigator.registerProtocolHandler("mailto",i,j),this.browser.firefox&&this.Storage.setData("MailtoAsked",1)),a(b).unload(function(){Mb.WindowOpener.closeAll()}),a(document).on("touchmove",function(a){a.preventDefault()}),a(document).on("touchmove","body",function(a){a.preventDefault()}),a(document).on("touchmove",".scroll-inner",function(a){a.stopPropagation()})},Kb.prototype.collectScreensData=function(){Qb.User.ShowContacts&&this.addScreenToHeader("contacts",Mb.i18n("HEADER/CONTACTS"),Mb.i18n("TITLE/CONTACTS"),"Contacts_ContactsViewModel",nb,this.ContactsCache.recivedAnim),Qb.User.AllowCalendar&&this.addScreenToHeader("calendar",Mb.i18n("HEADER/CALENDAR"),Mb.i18n("TITLE/CALENDAR"),"Calendar_CalendarViewModel",Fb,this.CalendarCache.recivedAnim),Qb.User.IsFilesSupported&&this.addScreenToHeader("files",Mb.i18n("HEADER/FILESTORAGE"),Mb.i18n("TITLE/FILESTORAGE"),"FileStorage_FileStorageViewModel",CFileStorageViewModel),Qb.User.IsHelpdeskSupported&&this.addScreenToHeader("helpdesk",Mb.i18n("HEADER/HELPDESK"),Mb.i18n("TITLE/HELPDESK"),"Helpdesk_HelpdeskViewModel",CHelpdeskViewModel)},Kb.prototype.registerHelpdeskUpdateFunction=function(a){this.fHelpdeskUpdate=a},Kb.prototype.updateHelpdesk=function(){this.fHelpdeskUpdate&&this.fHelpdeskUpdate()},Kb.prototype.useGoogleAnalytics=function(){var a=null,c=null;Qb.App.GoogleAnalyticsAccount&&0<Qb.App.GoogleAnalyticsAccount.length&&(b._gaq=b._gaq||[],b._gaq.push(["_setAccount",Qb.App.GoogleAnalyticsAccount]),b._gaq.push(["_trackPageview"]),a=document.createElement("script"),a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",c=document.getElementsByTagName("script")[0],c.parentNode.insertBefore(a,c))},Kb.prototype.tokenProblem=function(){var a="window.location.reload(); return false;",b=Mb.i18n("WARNING/TOKEN_PROBLEM_HTML",{RELOAD_FUNC:a});Qb.Auth=!1,Ob.Api.showError(b,!0,!0)},Kb.prototype.logout=function(a){var b={Action:"Logout"};a&&(b.LastErrorCode=a),Ob.Ajax.send(b,this.onLogout,this)},Kb.prototype.authProblem=function(){this.logout(Lb.Errors.AuthError)},Kb.prototype.onLogout=function(){Mb.WindowOpener.closeAll(),Ob.Routing.finalize(),""!==Qb.App.CustomLogoutUrl?b.location.href=Qb.App.CustomLogoutUrl:b.location.reload()},Kb.prototype.getAccounts=function(){return Qb.Accounts},Kb.prototype.run=function(){if(this.Screens.init(),Ub&&Qb&&Qb.Auth&&Qb.App.IosDetectOnLogin&&Ob.browser.safari?b.location.href="?ios":Qb&&Qb.Auth?(Qb.SingleMode=this.Routing.isSingleMode(),Qb.SingleMode&&b.opener&&(Qb.Accounts=b.opener.App.getAccounts()),this.MailCache.init(),Qb.HelpdeskRedirect&&this.Routing.currentScreen!==Lb.Screens.Helpdesk&&this.Routing.setHash([Lb.Screens.Helpdesk]),this.Routing.init(Lb.Screens.Mailbox),Qb.SingleMode||this.doFirstRequests()):Qb&&""!==Qb.App.CustomLoginUrl?b.location.href=Qb.App.CustomLoginUrl:(this.Screens.showCurrentScreen(Lb.Screens.Login),Qb&&Qb.LastErrorCode===Lb.Errors.AuthError&&this.Api.showError(Mb.i18n("WARNING/AUTH_PROBLEM"),!1,!0)),Qb.User.AllowVoice){var c=this;a(b).on("storage",function(){"false"!==b.localStorage.getItem("phoneLoad")&&b.localStorage.setItem("phoneLoad","false")}),b.localStorage.setItem("phoneLoad",Math.floor(900*Math.random()+100).toString()),b.setTimeout(function(){Qb.SingleMode||"false"===b.localStorage.getItem("phoneLoad")&&!b.sessionStorage.getItem("phoneTab")||(c.Phone.init(),b.sessionStorage.setItem("phoneTab","true"))},1e3)}},Kb.prototype.getHelpLink=function(a){return Qb&&Qb.Links&&Qb.Links[a]?Qb.Links[a]:""},Kb.prototype.addScreenToHeader=function(a,b,c,d,e,f){var g=null;Lb.Screens[a]=a,a===Lb.Screens.Helpdesk&&(g=_.bind(this.Routing.setLastHelpdeskHash,this.Routing)),this.Screens.oScreens[Lb.Screens[a]]={Model:e,TemplateName:d},this.headerTabs.push({name:Lb.Screens[a],title:b,hash:this.Routing.buildHashFromArray([Lb.Screens[a]]),clickHandler:g,koRecivedAnim:f}),this.screensTitle[Lb.Screens[a]]=c},Kb.prototype.doFirstRequests=function(){b.setTimeout(function(){Qb.Accounts.doFirstRequests()},4e3),b.setTimeout(function(){Ob.Ajax.send({Action:"DoServerInitializations"})},3e4)},Kb.prototype.initHeaderInfo=function(){this.browser.ie?a(document).bind("focusin",_.bind(this.onFocus,this)).bind("focusout",_.bind(this.onBlur,this)):a(b).bind("focus",_.bind(this.onFocus,this)).bind("blur",_.bind(this.onBlur,this))},Kb.prototype.onFocus=function(){this.focused(!0)},Kb.prototype.onBlur=function(){this.focused(!1)},Kb.prototype.setTitle=function(a){var b=this.newMessagesCount(),c=Qb.SingleMode&&!this.focused();a=a||"",c||(a=this.focused()||0===b?this.getTitleByScreen():Mb.i18n("TITLE/HAS_UNSEEN_MESSAGES_PLURAL",{COUNT:b},null,b)+" - "+Qb.Accounts.getEmail(),document.title=".",document.title=a)},Kb.prototype.getTitleByScreen=function(){var a="",b="";try{this.MailCache.currentMessage()&&(b=this.MailCache.currentMessage().subject())}catch(c){}switch(this.currentScreen()){case Lb.Screens.Login:a=Mb.i18n("TITLE/LOGIN",null,"");break;case Lb.Screens.Mailbox:case Lb.Screens.BottomMailbox:a=Qb.Accounts.getEmail()+" - "+Mb.i18n("TITLE/MAILBOX");break;case Lb.Screens.Compose:case Lb.Screens.SingleCompose:a=Qb.Accounts.getEmail()+" - "+Mb.i18n("TITLE/COMPOSE");break;case Lb.Screens.SingleMessageView:a=Qb.Accounts.getEmail()+" - "+Mb.i18n("TITLE/VIEW_MESSAGE"),b&&(a=b+" - "+a);break;default:this.screensTitle[this.currentScreen()]&&(a=this.screensTitle[this.currentScreen()])}return""===a?a=Qb.App.SiteName:a+=Qb.App.SiteName&&""!==Qb.App.SiteName?" - "+Qb.App.SiteName:"",a},Kb.prototype.desktopNotify=function(a,b,c,d,e,f){Mb.desktopNotify(a,b,c,d,e,f)},Ob=new Kb,b.App=Ob,-1===Qb.IsMobile){var Yb=b.matchMedia("all and (min-width: 768px)").matches?0:1;b.App.Ajax.send({Action:"SetMobile",Mobile:Yb},function(){Yb?b.location.reload():a(function(){_.defer(function(){Ob.run()})})},this)}else a(function(){_.defer(function(){Ob.run()})});b.AfterLogicApi=Pb,b.Enums=Lb,Tb.removeClass("no-js").addClass("js"),Tb.hasClass("pdf")&&(Xb.push("application/pdf"),Xb.push("application/x-pdf"))}(jQuery,window,ko,crossroads,hasher);