/*!
 * Copyright 2004-2015, AfterLogic Corp.
 * Licensed under AGPLv3 license or AfterLogic license
 * if commerical version of the product was purchased.
 * See the LICENSE file for a full license statement.
 */
!function(e,t,i){"use strict";function o(){this.edge=/edge/.test(navigator.userAgent.toLowerCase()),this.ie11=!!navigator.userAgent.match(/Trident.*rv[ :]*11\./),this.ie=/msie/.test(navigator.userAgent.toLowerCase())&&!t.opera||this.ie11,this.ieVersion=this.getIeVersion(),this.ie8AndBelow=this.ie&&this.ieVersion<=8,this.ie9AndBelow=this.ie&&this.ieVersion<=9,this.ie10AndAbove=this.ie&&this.ieVersion>=10,this.opera=!!t.opera||/opr/.test(navigator.userAgent.toLowerCase()),this.firefox=/firefox/.test(navigator.userAgent.toLowerCase()),this.chrome=/chrome/.test(navigator.userAgent.toLowerCase())&&!/opr/.test(navigator.userAgent.toLowerCase()),this.chromeIos=/crios/.test(navigator.userAgent.toLowerCase()),this.safari=/safari/.test(navigator.userAgent.toLowerCase())&&!this.chromeIos}function n(){this.sUrl="?/Ajax/",this.requests=i.observableArray([]),this.openedRequestsCount=i.observable(0),this.requests.subscribe(function(){this.openedRequestsCount(this.requests().length)},this),this.aActionsWithoutAuthForSend=["SystemLogin","SystemUpdateLanguageOnLogin","SystemLogout","AccountCreate","SystemSetMobile","AccountRegister","AccountGetForgotQuestion","AccountValidateForgotQuestion","AccountChangeForgotPassword"],this.aActionsWithoutAuthForSendExt=["SocialRegister","HelpdeskRegister","HelpdeskForgot","HelpdeskLogin","HelpdeskForgotChangePassword","SystemLogout","CalendarList","CalendarEventList","FilesPub"]}function s(t,o,n,s,r,a,l,c,h,u){this.fBeforeSelectCallback=null,this.fSelectCallback=o||function(){},this.fDeleteCallback=n||function(){},this.fDblClickCallback=!M&&s?s:function(){},this.fEnterCallback=r||function(){},this.bResetCheckedOnClick=I.isUnd(l)?!1:!!l,this.bCheckOnSelect=I.isUnd(c)?!1:!!c,this.bUnselectOnCtrl=I.isUnd(h)?!1:!!h,this.bDisableMultiplySelection=I.isUnd(u)?!1:!!u,this.useKeyboardKeys=i.observable(!1),this.list=i.observableArray([]),t&&t.subscribe&&t.subscribe(function(e){this.list(e)},this),this.multiplyLineFactor=a,this.oLast=null,this.oListScope=null,this.oScrollScope=null,this.iTimer=0,this.iFactor=1,this.KeyUp=F.Key.Up,this.KeyDown=F.Key.Down,this.KeyLeft=F.Key.Up,this.KeyRight=F.Key.Down,this.multiplyLineFactor&&(this.multiplyLineFactor.subscribe?this.multiplyLineFactor.subscribe(function(e){this.iFactor=e>0?e:1},this):this.iFactor=I.pInt(this.multiplyLineFactor),this.KeyUp=F.Key.Up,this.KeyDown=F.Key.Down,this.KeyLeft=F.Key.Left,this.KeyRight=F.Key.Right,e("html").hasClass("rtl")&&(this.KeyLeft=F.Key.Right,this.KeyRight=F.Key.Left)),this.sActionSelector="",this.sSelectabelSelector="",this.sCheckboxSelector="";var p=this;this.listChecked=i.computed({read:function(){var e=_.filter(this.list(),function(e){var t=e.checked(),i=e.selected();return t||p.bCheckOnSelect&&i});return e},write:function(e){e=!!e,_.each(this.list(),function(t){t.checked(e)}),this.list.valueHasMutated()},owner:this}),this.checkAll=i.computed({read:function(){return 0<this.listChecked().length},write:function(e){this.listChecked(!!e)},owner:this}),this.selectorHook=i.observable(null),this.selectorHook.subscribe(function(){var e=this.selectorHook();e&&e.selected(!1)},this,"beforeChange"),this.selectorHook.subscribe(function(e){e&&e.selected(!0)},this),this.itemSelected=i.computed({read:this.selectorHook,write:function(e){this.selectorHook(e),e&&(this.oLast=e)},owner:this}),this.list.subscribe(function(e){if(_.isArray(e)){var t=this.itemSelected();t&&(_.find(e,function(e){return t===e})||this.itemSelected(null))}else this.itemSelected(null)},this),this.listCheckedOrSelected=i.computed({read:function(){var e=this.itemSelected(),t=this.listChecked();return 0<t.length?t:e?[e]:[]},write:function(e){e?this.listChecked(!0):(this.itemSelected(null),this.listChecked(!1))},owner:this}),this.listCheckedAndSelected=i.computed({read:function(){var e=[],t=this.itemSelected(),i=this.listChecked();return i&&(e=i.slice(0)),t&&-1===_.indexOf(i,t)&&e.push(t),e},write:function(e){e?this.listChecked(!0):(this.itemSelected(null),this.listChecked(!1))},owner:this}),this.isIncompleteChecked=i.computed(function(){var e=this.list().length,t=this.listChecked().length;return e>0&&t>0&&e>t},this),this.onKeydownBinded=_.bind(this.onKeydown,this)}function r(){this.openPgp=null,this.openPgpCallbacks=[]}function a(){this.bHtml5=!0,this.init()}function l(e,t){this.pgp=e,this.pgpKeyring=new this.pgp.Keyring(new this.pgp.Keyring.localstore(t)),this.keys=i.observableArray([]),this.reloadKeysFromStorage()}function c(e){this.pgpKey=e;var t=this.pgpKey.getPrimaryUser();this.user=t&&t.user?t.user.userId.userid:this.pgpKey.users&&this.pgpKey.users[0]?this.pgpKey.users[0].userId.userid:"",this.emailParts=I.Address.getEmailParts(this.user)}function h(){this.result=!0,this.errors=null,this.notices=null,this.exceptions=null}function u(){this.alertDesc=i.observable(""),this.closeCallback=null,this.title=i.observable(""),this.okButtonText=i.observable(I.i18n("MAIN/BUTTON_OK"))}function p(){this.fConfirmCallback=null,this.confirmDesc=i.observable(""),this.title=i.observable(""),this.okButtonText=i.observable(I.i18n("MAIN/BUTTON_OK")),this.cancelButtonText=i.observable(I.i18n("MAIN/BUTTON_CANCEL")),this.shown=!1}function d(){this.pgp=null,this.keyArmor=i.observable(""),this.keyArmorFocused=i.observable(!1),this.keys=i.observableArray([]),this.hasExistingKeys=i.observable(!1),this.headlineText=i.computed(function(){return I.i18n("OPENPGP/INFO_TEXT_INCLUDES_KEYS_PLURAL",{},null,this.keys().length)},this)}function f(){this.fCallback=null,this.folderName=i.observable(""),this.folderName.focus=i.observable(!1),this.folderName.error=i.observable(""),this.folderName.subscribe(function(){this.folderName.error("")},this)}function m(){this.fCallback=null,this.link=i.observable(""),this.linkPrev=i.observable(""),this.linkFocus=i.observable(!1),this.checkTimeout=null,this.urlChecked=i.observable(!1),this.saveCommand=I.createCommand(this,this.executeSave,function(){return this.urlChecked()}),this.fileItem=i.observable(new A)}function g(){this.fCallback=null,this.item=null,this.name=i.observable(""),this.name.focus=i.observable(!1),this.name.error=i.observable(""),this.name.subscribe(function(){this.name.error("")},this)}function b(){this.item=null,this.pub=i.observable(""),this.pubFocus=i.observable(!1)}function y(){this.displayName=i.observable(""),this.email=i.observable(""),this.phone=i.observable(""),this.address=i.observable(""),this.skype=i.observable(""),this.facebook=i.observable(""),this.focusDisplayName=i.observable(!1),this.loading=i.observable(!1),this.fCallback=null,this.oContext=null}function v(){this.iframe=i.observable("")}function S(){this.IdUser=1,this.MailsPerPage=20,this.ContactsPerPage=20,this.iInterval=-1,this.AutoCheckMailInterval=0,this.DefaultTheme="Default",this.DefaultLanguage="English",this.DefaultLanguageShort="en",this.DefaultDateFormat="MM/DD/YYYY",this.defaultTimeFormat=i.observable(F.TimeFormat.F24),this.ThreadsEnabled=!0,this.useThreads=i.observable(!0),this.SaveRepliedToCurrFolder=!0,this.ComposePlainTextDefault=!1,this.AllowChangeInputDirection=!1,this.DesktopNotifications=!1,this.EmailNotification="",this.AllowCompose=!0,this.AllowReply=!0,this.AllowForward=!0,this.SaveMail=F.SaveMail.Checked,this.AllowFetcher=!1,this.OutlookSyncEnable=!0,this.MobileSyncEnable=!0,this.ShowPersonalContacts=!0,this.ShowGlobalContacts=!1,this.IsFilesSupported=!1,this.IsHelpdeskSupported=!1,this.IsHelpdeskAgent=!1,this.HelpdeskIframeUrl="",this.ShowContacts=this.ShowPersonalContacts||this.ShowGlobalContacts,this.LastLogin=0,this.LoginsCount=0,this.LastLoginIp="",this.LastLoginUa="",this.SocialName=0,this.IsDemo=!1,this.AllowVoice=!1,this.SipRealm="",this.SipWebsocketProxyUrl="",this.SipOutboundProxyUrl="",this.SipCallerID="",this.SipImpi="",this.SipImpu="",this.SipPassword="",this.VoiceProvider="",this.AllowCalendar=!0,this.CalendarSharing=!1,this.CalendarAppointments=!1,this.CalendarShowWeekEnds=!1,this.CalendarShowWorkDay=!1,this.CalendarWorkDayStarts=0,this.CalendarWorkDayEnds=0,this.CalendarWeekStartsOn=0,this.CalendarDefaultTab=F.CalendarDefaultTab.Month,this.mobileSync=i.observable(null),this.MobileSyncDemoPass="demo",this.outlookSync=i.observable(null),this.OutlookSyncDemoPass="demo",this.AllowHelpdeskNotifications=!1,this.IsCollaborationSupported=!1,this.AllowFilesSharing=!1,this.DefaultFontName="Tahoma",this.fillDefaultFontName(),this.DefaultFontSize=3,this.fillDefaultFontSize(),this.enableOpenPgp=i.observable(!1),this.AllowAutosaveInDrafts=!0,this.AutosignOutgoingEmails=!1,this.filesEnable=i.observable(!0),this.helpdeskSignature=i.observable(""),this.helpdeskSignatureEnable=i.observable(!1),this.SocialAccounts=i.observableArray([]),this.CanLoginWithPassword=!0}function E(){this.iTimeStampInUTC=0,this.oMoment=null}function A(){this.isIosDevice=U,this.isFolder=i.observable(!1),this.isLink=i.observable(!1),this.linkType=i.observable(F.FileStorageLinkType.Unknown),this.linkUrl=i.observable(""),this.isPopupItem=i.observable(!1),this.id=i.observable(""),this.fileName=i.observable(""),this.tempName=i.observable(""),this.displayName=i.observable(""),this.extension=i.observable(""),this.oembed=i.observable(""),this.linkType.subscribe(function(e){var t="";switch(e){case F.FileStorageLinkType.YouTube:t="YouTube";break;case F.FileStorageLinkType.Vimeo:(!D.browser.ie||D.browser.ie11)&&(t="Vimeo");break;case F.FileStorageLinkType.SoundCloud:(!D.browser.ie||D.browser.ie10AndAbove)&&(t="SoundCloud")}this.oembed(t)},this),this.fileName.subscribe(function(e){this.id(e),this.displayName(e),this.extension(this.isFolder()?"":I.getFileExtension(e))},this),this.size=i.observable(0),this.friendlySize=i.computed(function(){return this.size()>0?I.friendlySize(this.size()):""},this),this.content=i.observable(""),this.accountId=i.observable(O.Accounts?O.Accounts.defaultId():null),this.hash=i.observable(""),this.thumb=i.observable(!1),this.iframedView=i.observable(!1),this.downloadLink=i.computed(function(){return I.getDownloadLinkByHash(this.accountId(),this.hash())},this),this.viewLink=i.computed(function(){var e=I.File.getViewLinkByHash(this.accountId(),this.hash());return this.iframedView()?I.getIframeWrappwer(this.accountId(),e):e},this),this.thumbnailSrc=i.observable(""),this.thumbnailLoaded=i.observable(!1),this.thumbnailSessionUid=i.observable(""),this.thumbnailLink=i.computed(function(){return this.thumb()?I.getViewThumbnailLinkByHash(this.accountId(),this.hash()):""},this),this.type=i.observable(""),this.uploadUid=i.observable(""),this.uploaded=i.observable(!1),this.uploadError=i.observable(!1),this.visibleImportLink=i.computed(function(){return O.User.enableOpenPgp()&&"asc"===this.extension().toLowerCase()&&""!==this.content()&&!this.isPopupItem()},this),this.isViewMimeType=i.computed(function(){return-1!==e.inArray(this.type(),V)||this.iframedView()},this),this.isMessageType=i.observable(!1),this.visibleViewLink=i.computed(function(){return""!==this.hash()&&this.isVisibleViewLink()&&!this.isPopupItem()},this),this.visibleOpenLink=i.computed(function(){return""!==this.linkUrl()},this),this.visibleDownloadLink=i.computed(function(){return""!==this.hash()&&!this.isPopupItem()&&!this.visibleOpenLink()},this),this.visibleSaveToServerLink=i.observable(!1),this.subFiles=i.observableArray([]),this.allowExpandSubFiles=i.observable(!1),this.subFilesLoaded=i.observable(!1),this.subFilesCollapsed=i.observable(!1),this.subFilesStartedLoading=i.observable(!1),this.visibleExpandLink=i.computed(function(){return this.allowExpandSubFiles()&&!this.subFilesCollapsed()&&!this.subFilesStartedLoading()},this),this.visibleExpandingText=i.computed(function(){return this.allowExpandSubFiles()&&!this.subFilesCollapsed()&&this.subFilesStartedLoading()},this),this.visibleSpinner=i.observable(!1),this.statusText=i.observable(""),this.statusTooltip=i.computed(function(){return this.uploadError()?this.statusText():""},this),this.progressPercent=i.observable(0),this.visibleProgress=i.observable(!1),this.uploadStarted=i.observable(!1),this.uploadStarted.subscribe(function(){this.uploadStarted()?(this.uploaded(!1),this.visibleProgress(!0),this.progressPercent(20)):(this.progressPercent(100),this.visibleProgress(!1),this.uploaded(!0))},this),this.allowDrag=i.observable(!1),this.allowSelect=i.observable(!1),this.allowCheck=i.observable(!1),this.allowDelete=i.observable(!1),this.allowUpload=i.observable(!1),this.allowSharing=i.observable(!1),this.allowHeader=i.observable(!1),this.allowDownload=i.observable(!0),this.downloadTitle=i.computed(function(){var e="";return!this.allowSelect()&&this.allowDownload()&&(e=I.i18n("MESSAGE/ATTACHMENT_CLICK_TO_DOWNLOAD",{FILENAME:this.fileName(),SIZE:this.friendlySize()}),""===this.friendlySize()&&(e=e.replace(" ()",""))),e},this),this.oembedHtml=i.observable("")}function k(){this.id=i.observable(""),this.fileName=i.observable(""),this.nameForEdit=i.observable(""),this.storageType=i.observable(F.FileStorageType.Personal),this.lastModified=i.observable(""),this.path=i.observable(""),this.fullPath=i.observable(""),this.publicHash=i.observable(""),this.selected=i.observable(!1),this.checked=i.observable(!1),this.isFolder=i.observable(!1),this.edited=i.observable(!1),this.isExternal=i.observable(!1),this.isLink=i.observable(!1),this.linkType=i.observable(0),this.linkUrl=i.observable(""),this.thumbnailExternalLink=i.observable(""),this.deleted=i.observable(!1),this.recivedAnim=i.observable(!1).extend({autoResetToFalse:500}),this.shared=i.observable(!1),this.owner=i.observable(""),this.ownerHeaderText=i.computed(function(){return I.i18n("FILESTORAGE/OWNER_HEADER_EMAIL",{OWNER:this.owner()})},this),this.lastModifiedHeaderText=i.computed(function(){return I.i18n("FILESTORAGE/OWNER_HEADER_LAST_MODIFIED_DATE_TEXT",{LASTMODIFIED:this.lastModified()})},this),A.call(this),this.fileName.subscribe(function(e){this.nameForEdit(e)},this),this.type=this.storageType,this.uploaded=i.observable(!0),this.downloadLink=i.computed(function(){return I.getFilestorageDownloadLinkByHash(O.Accounts?O.Accounts.currentId():null,this.hash(),this.publicHash())},this),this.viewLink=i.computed(function(){if(this.isLink())return this.linkUrl();var e=I.getFilestorageViewLinkByHash(O.Accounts?O.Accounts.currentId():null,this.hash(),this.publicHash());return this.iframedView()?I.getIframeWrappwer(O.Accounts?O.Accounts.currentId():null,e):e},this),this.isViewable=i.computed(function(){var e=!1,t=["JPEG","JPG","PNG","GIF","HTM","HTML","TXT","CSS","ASC","JS","PDF","BMP"];return _.indexOf(t,this.extension().toUpperCase())>=0&&(e=!0),(this.iframedView()||e||this.isLink())&&!this.isPopupItem()},this),this.visibleViewLink=i.computed(function(){return(""!==this.oembed()||""===this.linkUrl())&&this.isViewable()},this),this.thumbnailLink=i.computed(function(){return this.isExternal()||this.isLink()&&(this.linkType()===F.FileStorageLinkType.GoogleDrive||this.linkType()===F.FileStorageLinkType.YouTube||this.linkType()===F.FileStorageLinkType.Vimeo||this.linkType()===F.FileStorageLinkType.SoundCloud)?this.thumbnailExternalLink():this.thumb()?I.getFilestorageViewThumbnailLinkByHash(this.accountId(),this.hash(),this.publicHash()):""},this),this.edited.subscribe(function(e){e===!1&&this.nameForEdit(this.fileName())},this),this.canShare=i.computed(function(){return this.storageType===F.FileStorageType.Personal||this.storageType===F.FileStorageType.Corporate},this)}function T(e){this.allowSendEmails=i.computed(function(){return!!(O.App&&O.App.AllowWebMail&&O.Accounts&&O.Accounts.isCurrentAllowsMail())},this),this.error=i.observable(!1),this.loaded=i.observable(!1),this.isPublic=x,this.publicHash=x?O.FileStoragePubHash:"",this.IsCollaborationSupported=O.User.IsCollaborationSupported,this.AllowFilesSharing=O.User.AllowFilesSharing,this.storages=i.observableArray(),this.folders=i.observableArray(),this.files=i.observableArray(),this.uploadingFiles=i.observableArray(),this.selected=i.observable(!1),this.rootPath=i.observable(I.i18n("FILESTORAGE/TAB_PERSONAL_FILES")),this.storageType=i.observable(F.FileStorageType.Personal),this.storageType.subscribe(function(){var e=null;this.isPublic?this.rootPath(O.FileStoragePubParams.Name):(e=this.getStorageByType(this.storageType()),e&&this.rootPath(e.displayName())),this.selector.listCheckedAndSelected(!1)},this),this.iPathIndex=i.observable(-1),this.pathItems=i.observableArray(),this.dropPath=i.observable(""),this.path=i.computed(function(){var e=_.map(this.pathItems(),function(e){return e.id()});return e.join("/")},this),this.path.subscribe(function(e){this.dropPath(e)},this),this.collection=i.computed(function(){var e=_.union(this.files(),this.getUploadingFiles());return e.sort(function(e,t){return e.fileName()===t.fileName()?0:e.fileName().toLowerCase()<t.fileName().toLowerCase()?-1:1}),_.union(this.folders(),e)},this),this.columnCount=i.observable(1),this.selector=new s(this.collection,null,_.bind(this.onItemDelete,this),_.bind(this.onItemDblClick,this),_.bind(this.onEnter,this),this.columnCount,!0,!0,!0),this.searchPattern=i.observable(""),this.isSearchFocused=i.observable(!1),this.renameCommand=I.createCommand(this,this.executeRename,function(){var e=this.selector.listCheckedAndSelected();return 1===e.length}),this.deleteCommand=I.createCommand(this,this.executeDelete,function(){var e=this.selector.listCheckedAndSelected();return 0<e.length}),this.downloadCommand=I.createCommand(this,this.executeDownload,function(){var e=this.selector.listCheckedAndSelected();return 1===e.length&&!e[0].isFolder()}),this.shareCommand=I.createCommand(this,this.executeShare,function(){var e=this.selector.listCheckedAndSelected();return 1===e.length&&!e[0].isLink()}),this.sendCommand=I.createCommand(this,this.executeSend,function(){var e=this.selector.listCheckedAndSelected(),t=_.filter(e,function(e){return!e.isFolder()},this);return t.length>0}),this.uploaderButton=i.observable(null),this.uploaderArea=i.observable(null),this.bDragActive=i.observable(!1),this.bDragActiveComp=i.computed(function(){var e=this.bDragActive();return e&&""===this.searchPattern()},this),this.bAllowDragNDrop=!1,this.uploadError=i.observable(!1),this.quota=i.observable(0),this.used=i.observable(0),this.quotaDesc=i.observable(""),this.quotaProc=i.observable(-1),i.computed(function(){if(!O.App||O.App&&!O.App.ShowQuotaBar)return!0;var e=this.quota(),t=this.used(),i=e>0?Math.ceil(t/e*100):-1;return i=i>100?100:i,this.quotaProc(i),this.quotaDesc(i>-1?I.i18n("MAILBOX/QUOTA_TOOLTIP",{PROC:i,QUOTA:I.friendlySize(e)}):""),!0},this),this.dragover=i.observable(!1),this.loading=i.observable(!1),this.loadedFiles=i.observable(!1),this.fileListInfoText=i.computed(function(){var e="";return this.loading()?e=I.i18n("FILESTORAGE/INFO_LOADING"):this.loadedFiles()?0===this.collection().length&&(this.isPublic?e=I.i18n("FILESTORAGE/INFO_PUBLIC_FOLDER_NOT_EXIST"):""!==this.searchPattern()||this.isPublic?e=I.i18n("FILESTORAGE/INFO_NO_ITEMS_FOUND"):""!==this.path()||this.isPopup?e=I.i18n("FILESTORAGE/INFO_FOLDER_IS_EMPTY"):this.bAllowDragNDrop&&(e=I.i18n("FILESTORAGE/INFO_FILESTORAGE_IS_EMPTY"))):this.error()&&(e=I.i18n("FILESTORAGE/ERROR_FILESTORAGE")),e},this),this.dragAndDropHelperBinded=_.bind(this.dragAndDropHelper,this),this.isPopup=!!e,this.isCurrentStorageExternal=i.computed(function(){var e=this.getStorageByType(this.storageType());return e&&e.isExternal()},this),this.timerId=null}function C(){this.iAnimationDuration=500,this.iReportDuration=5e3,this.iErrorDuration=1e4,this.loadingMessage=i.observable(""),this.loadingHidden=i.observable(!0),this.loadingVisible=i.observable(!1),this.isHtmlLoading=i.observable(!1),this.loadingVisibleClose=i.observable(!1),this.reportMessage=i.observable(""),this.reportHidden=i.observable(!0),this.reportVisible=i.observable(!1),this.reportVisibleClose=i.observable(!1),this.iReportTimeout=-1,this.errorMessage=i.observable(""),this.errorHidden=i.observable(!0),this.errorVisible=i.observable(!1),this.iErrorTimeout=-1,this.isHtmlError=i.observable(!1),this.gray=i.observable(!1)}function P(){var o=e(t);this.resizeAll=_.debounce(function(){o.resize()},100),this.oScreens={},this.currentScreen=i.observable(""),this.informationScreen=i.observable(null),this.popups=[]}function w(){this.browser=new o;try{this.favico=!this.browser.ie8AndBelow&&t.Favico?new t.Favico({animation:"none"}):null}catch(e){this.favico=null}this.Ajax=new n,this.Screens=new P,this.Api=new r,this.Storage=new a,this.helpdeskUnseenCount=i.observable(0),this.helpdeskPendingCount=i.observable(0),this.mailUnseenCount=i.observable(0),this.InternetConnectionError=!1}function R(){w.call(this),this.init()}var F={},I={},N=t.pSevenI18N||{},D={},L={},O=t.pSevenAppData||{},x=!1,M=!1,H=e("html"),K=-1<navigator.userAgent.indexOf("Windows Phone"),U=!K&&(-1<navigator.userAgent.indexOf("iPhone")||-1<navigator.userAgent.indexOf("iPod")||-1<navigator.userAgent.indexOf("iPad")),B=!K&&-1<navigator.userAgent.toLowerCase().indexOf("android"),G=K||U||B,V=["image/jpeg","image/png","image/gif","text/html","text/plain","text/css","text/rfc822-headers","message/delivery-status","application/x-httpd-php","application/javascript"];if(t.Modernizr&&navigator&&t.Modernizr.addTest("pdf",function(){for(var e=navigator.mimeTypes,t=0,i=e.length;i>t;t++)if("application/pdf"===e[t].type)return V.push("application/pdf"),!0;return!1}),Date.now||(Date.now=function(){return(new Date).getTime()}),x=!0,o.prototype.getIeVersion=function(){var e=navigator.userAgent.toLowerCase(),t=I.pInt(e.slice(e.indexOf("msie")+4,e.indexOf(";",e.indexOf("msie")+4)));return this.ie11&&(t=11),t},n.prototype.AddActionsWithoutAuthForSendExt=function(e){e=I.isUnd(e)?"":e,""!==e&&-1===_.indexOf(this.aActionsWithoutAuthForSendExt,e)&&this.aActionsWithoutAuthForSendExt.push(e)},n.prototype.AddActionsWithoutAuthForSend=function(e){e=I.isUnd(e)?"":e,""!==e&&-1===_.indexOf(this.aActionsWithoutAuthForSend,e)&&this.aActionsWithoutAuthForSend.push(e)},n.prototype.hasOpenedRequests=function(e){return e=I.isUnd(e)?"":e,this.requests(_.filter(this.requests(),function(t){var i=t&&4===t.Xhr.readyState,o=!t||0===t.Xhr.readyState&&"abort"===t.Xhr.statusText,n=""===e||t&&t.Parameters.Action===e;return t&&!i&&!o&&n})),this.requests().length>0},n.prototype.isSearchMessages=function(){var e=!1;return _.each(this.requests(),function(t){t&&t.Parameters&&"MessagesGetList"===t.Parameters.Action&&""!==t.Parameters.Search&&(e=!0)},this),e},n.prototype.isAllowedActionWithoutAuth=function(e){return-1!==_.indexOf(this.aActionsWithoutAuthForSend,e)},n.prototype.isAllowedExtAction=function(e){return"SocialRegister"===e||"HelpdeskRegister"===e||"HelpdeskForgot"===e||"HelpdeskLogin"===e||"SystemLogout"===e},n.prototype.doSend=function(t,i,o,n){var s=_.bind(n||null,this,t,i,o),r=_.bind(this.fail,this,t,i,o),a=_.bind(this.always,this,t),l=null;L.runPluginHook&&L.runPluginHook("ajax-default-request",[t.Action,t]),O.Token&&(t.Token=O.Token),this.abortRequests(t),I.log("Ajax request send",t.Action,t),l=e.ajax({url:this.sUrl,type:"POST",async:!0,dataType:"json",data:t,success:s,error:r,complete:a,timeout:"MessagesGetBodies"===t.Action?1e5:5e4}),this.requests().push({Parameters:t,Xhr:l})},n.prototype.send=function(e,t,i){var o=void 0===e.AccountID,n=o||O.Accounts.hasAccountWithId(e.AccountID);e&&(O.Auth&&n||this.isAllowedActionWithoutAuth(e.Action))&&(o&&"Login"!==e.Action&&(e.AccountID=O.Accounts.currentId()),this.doSend(e,t,i,this.done))},n.prototype.sendExt=function(e,t,i){var o=-1!==_.indexOf(this.aActionsWithoutAuthForSendExt,e.Action);e&&(O.Auth||o)&&(O.TenantHash&&(e.TenantHash=O.TenantHash),this.doSend(e,t,i,this.doneExt))},n.prototype.abortRequests=function(e){switch(e.Action){case"MessageMove":case"MessageDelete":this.abortRequestByActionName("MessagesGetList",{Folder:e.Folder}),this.abortRequestByActionName("MessageGet");break;case"MessagesGetList":case"MessageSetSeen":case"MessageSetFlagged":this.abortRequestByActionName("MessagesGetList",{Folder:e.Folder});break;case"MessagesSetAllSeen":this.abortRequestByActionName("MessagesGetList",{Folder:e.Folder}),this.abortRequestByActionName("MessagesGetListByUids",{Folder:e.Folder});break;case"FolderClear":this.abortRequestByActionName("MessagesGetList",{Folder:e.Folder}),this.abortRequestByActionName("FoldersGetRelevantInformation");break;case"FoldersGetRelevantInformation":this.abortRequestByActionName("FoldersGetRelevantInformation");break;case"MessagesGetFlags":this.abortRequestByActionName("MessagesGetFlags");break;case"ContactList":case"ContactGlobalList":this.abortRequestByActionName("ContactList"),this.abortRequestByActionName("ContactGlobalList");break;case"ContactGet":case"ContactGlobal":this.abortRequestByActionName("ContactGet"),this.abortRequestByActionName("ContactGlobal");break;case"CalendarEventUpdate":this.abortRequestByActionName("CalendarEventUpdate",{calendarId:e.calendarId,uid:e.uid});break;case"CalendarList":this.abortRequestByActionName("CalendarList");break;case"CalendarEventList":this.abortRequestByActionName("CalendarEventList")}},n.prototype.abortRequestByActionName=function(e,t){var i;_.each(this.requests(),function(o,n){if(i=!1,o&&o.Parameters.Action===e)switch(e){case"MessagesGetList":t.Folder===o.Parameters.Folder&&(i=!0);break;case"CalendarEventUpdate":t.calendarId===o.Parameters.calendarId&&t.uid===o.Parameters.uid&&(i=!0);break;default:i=!0}i&&(o.Xhr.abort(),this.requests()[n]=void 0)},this),this.requests(_.compact(this.requests()))},n.prototype.abortAllRequests=function(){_.each(this.requests(),function(e){e&&e.Xhr.abort()},this),this.requests([])},n.prototype.done=function(e,t,i,o,n){var s=this.isAllowedActionWithoutAuth(e.Action),r=O.Accounts.hasAccountWithId(e.AccountID),a=e.AccountID===O.Accounts.defaultId();if(I.log("Ajax request done",e.Action,n,I.getAjaxDataForLog(e.Action,o),e),s||r){if(o&&!o.Result)switch(o.ErrorCode){case F.Errors.InvalidToken:s||D.tokenProblem();break;case F.Errors.AuthError:a&&!s&&(this.abortAllRequests(),D.authProblem())}this.executeResponseHandler(t,i,o,e)}},n.prototype.doneExt=function(e,t,i,o){this.executeResponseHandler(t,i,o,e)},n.prototype.fail=function(e,t,i,o,n,s){var r={Result:!1,ErrorCode:0};switch(I.log("Ajax request fail",e.Action,n,e),n){case"abort":r={Result:!1,ErrorCode:F.Errors.NotDisplayedError};break;default:case"error":case"parseerror":r=""===s?{Result:!1,ErrorCode:F.Errors.NotDisplayedError}:{Result:!1,ErrorCode:F.Errors.DataTransferFailed}}this.executeResponseHandler(t,i,r,e)},n.prototype.executeResponseHandler=function(e,t,i,o){i||(i={Result:!1,ErrorCode:0}),L.runPluginHook&&L.runPluginHook("ajax-default-response",[o.Action,i]),"function"!=typeof e||i.StopExecuteResponse||e.apply(t,[i,o])},n.prototype.always=function(e,t,i){"abort"!==i&&(_.each(this.requests(),function(t,i){t&&_.isEqual(t.Parameters,e)&&(this.requests()[i]=void 0)},this),this.requests(_.compact(this.requests())),I.checkConnection(e.Action,i),D.Prefetcher&&"parsererror"!==i&&!this.hasOpenedRequests()&&D.Prefetcher.start())},F.Screens={Login:"login",Information:"information",Header:"header",Mailbox:"mailbox",SingleMessageView:"single-message-view",Compose:"compose",SingleCompose:"single-compose",Settings:"settings",Contacts:"contacts",Calendar:"calendar",FileStorage:"files",Helpdesk:"helpdesk",SingleHelpdesk:"single-helpdesk"},F.CalendarDefaultTab={Day:1,Week:2,Month:3},F.TimeFormat={F24:"0",F12:"1"},F.Errors={InvalidToken:101,AuthError:102,DataBaseError:104,LicenseProblem:105,DemoLimitations:106,Captcha:107,AccessDenied:108,CanNotGetMessage:202,ImapQuota:205,NotSavedInSentItems:304,NoRequestedMailbox:305,CanNotChangePassword:502,AccountOldPasswordNotCorrect:503,FetcherIncServerNotAvailable:702,FetcherLoginNotCorrect:703,HelpdeskThrowInWebmail:805,HelpdeskUserNotExists:807,HelpdeskUserNotActivated:808,IncorrectFileExtension:811,FilesQuotaLimit:812,MailServerError:901,DataTransferFailed:1100,NotDisplayedError:1155},F.FolderTypes={Inbox:1,Sent:2,Drafts:3,Spam:4,Trash:5,Virus:6,Starred:7,Template:8,System:9,User:10},F.FolderFilter={Flagged:"flagged",Unseen:"unseen"},F.LoginFormType={Email:0,Login:3,Both:4},F.LoginSignMeType={DefaultOff:0,DefaultOn:1,Unuse:2},F.ReplyType={Reply:"reply",ReplyAll:"reply-all",Resend:"resend",Forward:"forward"},F.Importance={Low:5,Normal:3,High:1},F.Sensitivity={Nothing:0,Confidential:1,Private:2,Personal:3},F.ContactEmailType={Personal:"Personal",Business:"Business",Other:"Other"},F.ContactPhoneType={Mobile:"Mobile",Personal:"Personal",Business:"Business"},F.ContactAddressType={Personal:"Personal",Business:"Business"},F.ContactSortType={Email:"Email",Name:"Name",Frequency:"Frequency"},F.SaveMail={Hidden:0,Checked:1,Unchecked:2},F.SettingsTab={Common:"common",EmailAccounts:"accounts",Calendar:"calendar",MobileSync:"mobile_sync",OutLookSync:"outlook_sync",Helpdesk:"helpdesk",Pgp:"pgp",Services:"services",CloudStorage:"cloud-storage"},F.AccountSettingsTab={Properties:"properties",Signature:"signature",Filters:"filters",Autoresponder:"autoresponder",Forward:"forward",Folders:"folders",FetcherInc:"fetcher-inc",FetcherOut:"fetcher-out",FetcherSig:"fetcher-sig",IdentityProperties:"identity-properties",IdentitySignature:"identity-signature"},F.AccountCreationPopupType={OneStep:1,TwoSteps:2,ConnectToMail:3},F.ContactsGroupListType={Personal:0,SubGroup:1,Global:2,SharedToAll:3,All:4},F.IcalType={Request:"REQUEST",Reply:"REPLY",Cancel:"CANCEL",Save:"SAVE"},F.IcalConfig={Accepted:"ACCEPTED",Declined:"DECLINED",Tentative:"TENTATIVE",NeedsAction:"NEEDS-ACTION"},F.IcalConfigInt={Accepted:1,Declined:2,Tentative:3,NeedsAction:0},F.Key={Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Esc:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Up:38,Down:40,Left:37,Right:39,Del:46,Six:54,a:65,b:66,c:67,f:70,i:73,k:75,n:78,p:80,q:81,r:82,s:83,u:85,v:86,y:89,z:90,F5:116,Comma:188,Dot:190,Dash:192,Apostrophe:222},F.MouseKey={Left:0,Middle:1,Right:2},F.FileStorageType={Personal:"personal",Corporate:"corporate",Shared:"shared",GoogleDrive:"google",Dropbox:"dropbox"},F.FileStorageLinkType={Unknown:0,GoogleDrive:1,Dropbox:2,YouTube:3,Vimeo:4,SoundCloud:5},F.HelpdeskThreadStates={None:0,Pending:1,Waiting:2,Answered:3,Resolved:4,Deferred:5},F.HelpdeskPostType={Normal:0,Internal:1,System:2},F.HelpdeskFilters={All:0,Pending:1,Resolved:2,InWork:3,Open:4,Archived:9},F.CalendarAccess={Full:0,Write:1,Read:2},F.CalendarEditRecurrenceEvent={None:0,OnlyThisInstance:1,AllEvents:2},F.CalendarRepeatPeriod={None:0,Daily:1,Weekly:2,Monthly:3,Yearly:4},F.CalendarAlways={Disable:0,Enable:1},F.PhoneAction={Offline:"offline",OfflineError:"offline_error",OfflineInit:"offline_init",OfflineActive:"offline_active",Online:"online",OnlineActive:"online_active",Incoming:"incoming",IncomingConnect:"incoming_connect",Outgoing:"outgoing",OutgoingConnect:"outgoing_connect",Settings:"settings"},F.HtmlEditorImageSizes={Small:"small",Medium:"medium",Large:"large",Original:"original"},F.MobilePanel={Groups:1,Items:2,View:3},F.PgpAction={Import:"import",Generate:"generate",Encrypt:"encrypt",Sign:"sign",EncryptSign:"encrypt-sign",Verify:"ferify",DecryptVerify:"decrypt-ferify"},F.SocialType={Unknown:0,Google:1,Dropbox:2,Facebook:3,Twitter:4,Vkontakte:5},F.notificationPermission={Granted:"granted",Denied:"denied",Default:"default"},F.AnotherMessageComposedAnswer={Discard:"Discard",SaveAsDraft:"SaveAsDraft",Cancel:"Cancel"},i.bindingHandlers.command={init:function(t,o,n,s){var r=e(t),a=o();if(!a||!a.enabled||!a.canExecute)throw new Error("You are not using command function");r.addClass("command"),i.bindingHandlers[r.is("form")?"submit":"click"].init.apply(s,arguments)},update:function(t,i){var o=!0,n=e(t),s=i();o=s.enabled(),n.toggleClass("command-not-enabled",!o),o&&(o=s.canExecute(),n.toggleClass("unavailable",!o)),n.toggleClass("command-disabled disable disabled",!o),n.toggleClass("enable",o)}},i.bindingHandlers.simpleTemplate={init:function(t){var i=e(t);i.length>0&&"replaced"!==i.data("replaced")&&(i.html(i.html().replace(/&lt;script(.*?)&gt;/i,"<script$1>").replace(/&lt;\/script(.*?)&gt;/i,"</script>")),i.data("replaced","replaced"))}},i.bindingHandlers.findFocused={init:function(t){var i=e(t),o=null;
o=i.find(".catch-focus"),o&&1===o.length&&o[0]&&o.on("blur",function(){i.removeClass("focused")}).on("focus",function(){i.addClass("focused")})}},i.bindingHandlers.findFilled={init:function(t){var i=e(t),o=null,n=null;o=i.find(".catch-filled"),o&&1===o.length&&o[0]&&(n=function(){i.toggleClass("filled",""!==o.val())},n(),_.delay(n,200),o.on("change",n))}},i.bindingHandlers.alert={init:function(e,o){t.alert(i.utils.unwrapObservable(o()))},update:function(e,o){t.alert(i.utils.unwrapObservable(o()))}},i.bindingHandlers.onEnter={init:function(t,o,n,s){e(t).on("keydown",function(n){return n.keyCode===F.Key.Enter?(e(t).trigger("change"),o().call(s,i.dataFor(t)),!1):void 0})}},i.bindingHandlers.onCtrlEnter={init:M?null:function(t,o,n,s){var r=e(t);r.on("keydown",function(e){e.ctrlKey&&e.keyCode===F.Key.Enter&&(r.trigger("change"),o().call(s,i.dataFor(t)))})}},i.bindingHandlers.onEsc={init:M?null:function(t,o,n,s){var r=e(t);r.on("keydown",function(e){e.keyCode===F.Key.Esc&&(r.trigger("change"),o().call(s,i.dataFor(t)))})}},i.bindingHandlers.onFocusSelect={init:function(t){e(t).on("focus",function(){t.select()})}},i.bindingHandlers.fadeIn={update:function(t,o){i.utils.unwrapObservable(o())&&e(t).hide().fadeIn("fast")}},i.bindingHandlers.fadeOut={update:function(t,o){i.utils.unwrapObservable(o())&&e(t).fadeOut()}},i.bindingHandlers.csstext={init:function(t,o){t&&t.styleSheet&&!I.isUnd(t.styleSheet.cssText)?t.styleSheet.cssText=i.utils.unwrapObservable(o()):e(t).text(i.utils.unwrapObservable(o()))},update:function(t,o){t&&t.styleSheet&&!I.isUnd(t.styleSheet.cssText)?t.styleSheet.cssText=i.utils.unwrapObservable(o()):e(t).text(i.utils.unwrapObservable(o()))}},i.bindingHandlers.i18n={init:function(t,i){var o=e(t).data("i18n"),n=o?I.i18n(o):o;if(""!==n)switch(i()){case"value":e(t).val(n);break;case"text":e(t).text(n);break;case"html":e(t).html(n);break;case"title":e(t).attr("title",n);break;case"placeholder":e(t).attr({placeholder:n})}}},i.bindingHandlers.link={init:function(t,o){e(t).attr("href",i.utils.unwrapObservable(o()))}},i.bindingHandlers.title={init:function(t,o){e(t).attr("title",i.utils.unwrapObservable(o()))},update:function(t,o){e(t).attr("title",i.utils.unwrapObservable(o()))}},i.bindingHandlers.initDom={init:function(t,i){if(i())if(_.isArray(i()))for(var o=i(),n=o.length-1;n>=0;n--)o[n](e(t));else i()(e(t))}},i.bindingHandlers.customScrollbar={init:M?null:function(t,i){if(!G){var o=e(t),n=_.defaults(i(),{oScroll:null,scrollToTopTrigger:null,scrollToBottomTrigger:null,scrollTo:null}),s=null;n=n,o.addClass("scroll-wrap").customscroll(n),s=o.data("customscroll"),n.oScroll&&I.isFunc(n.oScroll.subscribe)?n.oScroll(s):n.oScroll=s,I.isUnd(n.reset)||(t._customscroll_reset=_.throttle(function(){s.reset()},100)),n.scrollToTopTrigger&&I.isFunc(n.scrollToTopTrigger.subscribe)&&n.scrollToTopTrigger.subscribe(function(){s&&s.scrollToTop()}),n.scrollToBottomTrigger&&I.isFunc(n.scrollToBottomTrigger.subscribe)&&n.scrollToBottomTrigger.subscribe(function(){s&&s.scrollToBottom()}),n.scrollTo&&I.isFunc(n.scrollTo.subscribe)&&n.scrollTo.subscribe(function(){s&&s.scrollTo(n.scrollTo())})}},update:M?null:function(t,i){G||(t._customscroll_reset&&t._customscroll_reset(),I.isUnd(i().top)||e(t).data("customscroll").vertical.set(i().top))}},i.bindingHandlers.customOptions={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t,o,n,s){for(var r=0,a=0,l=i.utils.arrayMap(i.utils.arrayFilter(e.childNodes,function(e){return e.tagName&&"OPTION"===e.tagName&&e.selected}),function(e){return i.selectExtensions.readValue(e)||e.innerText||e.textContent}),c=e.scrollTop,h=i.utils.unwrapObservable(t());e.length>0;)i.cleanNode(e.options[0]),e.remove(0);if(h){"number"!=typeof h.length&&(h=[h]);var u=o().optionsBind;for(r=0,a=h.length;a>r;r++){var p=document.createElement("OPTION"),d=i.utils.unwrapObservable(h[r]);i.selectExtensions.writeValue(p,d),p.appendChild(document.createTextNode(d)),e.appendChild(p),u&&(p.setAttribute("data-bind",u),i.applyBindings(s.createChildContext(d),p))}var f=e.getElementsByTagName("OPTION"),m=0,g=navigator.userAgent.indexOf("MSIE 6")>=0;for(r=0,a=f.length;a>r;r++)i.utils.arrayIndexOf(l,i.selectExtensions.readValue(f[r]))>=0&&(g?f[r].setAttribute("selected",!0):f[r].selected=!0,m++);e.scrollTop=c,m<l.length&&i.utils.triggerEvent(e,"change")}}},i.bindingHandlers.splitter={init:M?null:function(t,i){setTimeout(function(){e(t).splitter(i())},1)}},i.bindingHandlers.dropdown={update:function(i,o,n,s){var r,a,l,c=e(i),h=_.defaults(o(),{disabled:"disabled",expand:"expand",control:!0,container:".dropdown_content",scrollToTopContainer:".scroll-inner",passClick:!0,trueValue:!0}),u="function"==typeof h.control?h.control():h.control,p=c.find(".control"),d=c.find(".dropdown"),f=c.find(".dropdown_helper"),m=c.find(".dropdown_arrow"),g=c.find(".dropdown_arrow.bottom"),b=e(document),y=!1,v=function(){I.isUnd(h.callback)||h.callback.call(s,c.hasClass(h.expand)?h.trueValue:!1,c)},S=function(e){e.stopPropagation()},E=function(){h.scrollToTopContainer&&c.find(h.scrollToTopContainer).scrollTop(0)},A=function(e){I.isUnd(e)&&(e=!c.hasClass(h.expand)),!e&&c.hasClass(h.expand)&&E(),c.toggleClass(h.expand,e),g.length>0&&c.hasClass(h.expand)&&d.css({top:c.position().top-f.height()+"px",left:c.position().left+"px",width:"auto"})},k=function(i){r=f.offset(),I.isUnd(r)||(a=r.left+10,l=e(t).width()-(a+f.outerWidth(!0)),l>0&&(l=0),f.css("left",i||l+"px"),m.css("left",i||Math.abs(l?l+parseInt(m.css("margin-left")):0)+"px"))},T=function(t){var i=e(t.originalEvent.originalTarget).parents(".dropdown"),o=i.length>0;o||c.hasClass(h.disabled)||y||(A(),_.defer(function(){v()}),c.hasClass(h.expand)&&(h.close&&h.close.subscribe&&h.close(!0),_.defer(function(){b.on("click.dropdown",function(e){!h.passClick&&e.button===F.MouseKey.Right||y||(b.unbind("click.dropdown"),h.close&&h.close.subscribe&&h.close(!1),A(!1),v(),k(0)),y=!1})}),k()))};c.off(),p.off(),h.passClick||(c.find(h.container).on("click",S),c.on("click",S),p.on("click",S)),A(!1),h.close&&h.close.subscribe&&h.close.subscribe(function(e){e||(b.unbind("click.dropdown"),A(!1)),v()}),c.on("mousedown",function(t){y=e(t.target).hasClass("customscroll-scrollbar")||e(t.target.parentElement).hasClass("customscroll-scrollbar")}),c.on("click",function(e){u||T(e)}),p.on("click",function(e){u&&T(e)})}},i.bindingHandlers.customSelect={init:function(t,i,o,n){var s=e(t),r=_.defaults(i(),{disabled:"disabled",selected:"selected",expand:"expand",control:!0,input:!1,expandState:function(){}}),a=[],l=r.control?s.find(".control"):s,c=s.find(".dropdown_content"),h=s.find(".link"),u=function(t){_.each(a,function(e){e.removeClass(r.selected)});var i=_.find(r.options,function(e){return e[r.optionsValue]===t});return I.isUnd(i)?i=r.options[0]:(a[_.indexOf(r.options,i)].addClass(r.selected),h.text(e.trim(i[r.optionsText]))),i[r.optionsValue]},p=function(t){c.empty(),a=[],_.each(t?t:r.options,function(t){var i=e('<span class="item"></span>').text(t[r.optionsText]).data("value",t[r.optionsValue]),o=t.isDisabled;o?i.data("isDisabled",o).addClass("disabled"):i.data("isDisabled",o).removeClass("disabled"),a.push(i),c.append(i)},this)};p(),c.on("click",".item",function(){var t=e(this);t.data("isDisabled")||r.value(t.data("value"))}),!r.input&&r.value&&r.value.subscribe&&(r.value.subscribe(function(){var e=u(r.value());r.value()!==e&&r.value(e)},n),r.value.valueHasMutated()),r.input&&r.value&&r.value.subscribe&&(r.value.subscribe(function(){u(r.value())},n),r.value.valueHasMutated()),r.input&&r.value&&r.value.subscribe&&(r.value.subscribe(function(){u(r.value())},n),r.value.valueHasMutated()),r.alarmOptions&&r.alarmOptions.subscribe(function(){p()},n),r.timeOptions&&r.timeOptions.subscribe(function(e){p(e)},n),s.removeClass(r.expand),l.click(function(){if(!s.hasClass(r.disabled)&&(s.toggleClass(r.expand),r.expandState(s.hasClass(r.expand)),s.hasClass(r.expand))){var t=s.find(".dropdown_content"),i=t.find(".selected");i.position()&&(t.scrollTop(0),t.scrollTop(i.position().top-100)),_.defer(function(){e(document).one("click",function(){s.removeClass(r.expand),r.expandState(!1)})})}})}},i.bindingHandlers.moveToFolderFilter={init:function(t,i){var o=e(t),n=i(),s=e(t).find(n.container),r=_.isArray(n.options)?n.options:n.options(),a=n.value?n.value():"",l=_.find(r,function(e){return e[n.optionsValue]===a});l||(a="",n.value("")),o.removeClass("expand"),s.empty(),_.each(r,function(t){var i=e('<span class="item"></span>').text(t[n.optionsText]).data("value",t[n.optionsValue]);a===t[n.optionsValue]&&i.addClass("selected"),t.jq=i,s.append(i)}),s.on("click",".item",function(){var t=e(this).data("value");n.value(t)}),o.click(function(){o.toggleClass("expand"),o.hasClass("expand")&&_.defer(function(){e(document).one("click",function(){o.removeClass("expand")})})})},update:function(t,i){var o=e(t),n=i(),s=_.isArray(n.options)?n.options:n.options(),r=n.value?n.value():"",a=_.find(s,function(e){return e[n.optionsValue]===r}),l=o.find(".link");_.each(s,function(e){e.jq&&e.jq.toggleClass("selected",r===e[n.optionsValue])}),a&&l.text(e.trim(a[n.optionsText]))}},i.bindingHandlers.contactCardInMessage={update:M||G?null:function(i,o){var n=e(i),s=o(),r=s.address,a=e("div.item_viewer[data-email='"+r+"']"),l=!1,c=0,h=function(){a&&n&&(l=!0,clearTimeout(c),setTimeout(function(){var i,o,s,r=n.offset();l&&r.left+r.top!==0&&(i=r.left+10,o=r.top+n.height()+6,s=e(t).width()-(i+396),s>0&&(s=0),a.addClass("expand").offset({top:o,left:i+s}))},180))},u=function(){l&&a&&n&&(l=!1,c=setTimeout(function(){l||a.removeClass("expand")},200))};a.length>0?(n.off().on("mouseover",function(){a.off().on("mouseenter",h).on("mouseleave",u).find(".link, .button").off(".links").on("click.links",function(){l=!1,a.removeClass("expand")}),setTimeout(function(){a.find(".link, .button").off("click.links").on("click.links",function(){l=!1,a.removeClass("expand")})}.bind(this),100),h()}).on("mouseout",u),l=!1,a.removeClass("expand")):n.off()}},i.bindingHandlers.contactcard={init:M||G?null:function(t,i){var o=e(t),n=!1,s=_.defaults(i(),{disabled:"disabled",expand:"expand",control:!0}),r=s.control?o.find(".control"):o;void 0!==s.trigger&&void 0!==s.trigger.subscribe&&(o.removeClass(s.expand),r.bind({mouseover:function(){!o.hasClass(s.disabled)&&s.trigger()&&(n=!0,_.delay(function(){n&&(void 0!==s.controlWidth&&void 0!==s.controlWidth.subscribe&&s.controlWidth(r.width()),o.addClass(s.expand))},200))},mouseout:function(){s.trigger()&&(n=!1,_.delay(function(){n||o.removeClass(s.expand)},200))}}))}},i.bindingHandlers.checkmail={update:function(t,i){var o=t.oOptions||null,n=t.jqElement||null,s=t.oIconIE||null,r=i(),a=r.state;void 0!==r.state&&(n||(t.jqElement=n=e(t)),o||(t.oOptions=o=_.defaults(r,{activeClass:"process",duration:800})),I.deferredUpdate(n,a,o.duration,function(e,i){if(D.browser.ie9AndBelow)if(s||(t.oIconIE=s=n.find(".icon")),!s.__intervalIE&&i){var r=0,a="";s.__intervalIE=setInterval(function(){a="0px -"+20*r+"px",r=7>r?r+1:0,s.css({"background-position":a})},1e3/12)}else s.css({"background-position":"0px 0px"}),clearInterval(s.__intervalIE),s.__intervalIE=null;else e.toggleClass(o.activeClass,i)}))}},i.bindingHandlers.heightAdjust={update:function(t,i){var o=t.jqElement||null,n=0,s=i().location,r=i().delay||400;o||(t.jqElement=o=e(t)),_.delay(function(){_.each(i().elements,function(e){var t=e();t&&(n+=t.is(":visible")?t.outerHeight():0)}),"top"===s||void 0===s?o.css({"padding-top":n,"margin-top":-n}):"bottom"===s&&o.css({"padding-bottom":n,"margin-bottom":-n})},r)}},i.bindingHandlers.minHeightAdjust={update:function(t,i){var o=e(t),n=i(),s=n.adjustElement||e("body"),r=n.minHeight||0;n.removeTrigger&&s.css("min-height","inherit"),n.trigger&&_.delay(function(){s.css({"min-height":o.outerHeight(!0)+r})},100)}},i.bindingHandlers.watchWidth={init:function(t,i){var o=!1;o||i().subscribe(function(){i()(e(t).outerWidth()),o=!0},this)}},i.bindingHandlers.columnCalc={init:function(i,o){var n=e(i),s=o().prop,r=null,a=0;r=n.find(o().itemSelector),void 0!==r[0]&&(a=r.outerWidth(!0),a=1>=a?1:a,s&&e(t).bind("resize",function(){var e=n.width();s(e>0?Math.floor(e/a):1)}))}},i.bindingHandlers.listWithMoreButton={init:function(t){var i=e(t),o=!1;i.closest("div.panel.left_panel").resize(function(){var t=i.find("span.hotkey"),n=i.find("span.item"),s=i.find("span.more_hints").show(),r=i.width(),a=s.width(),l=!0;o?o=!1:(_.each(t,function(t,i){var s=e(t),c=s.width();l&&r>a+c?(o=!1,s.show(),e(n[i]).hide(),a+=c):(o=!0,l=!1,s.hide(),e(n[i]).show())}),l&&s.hide())})}},i.bindingHandlers.quickReplyAnim={update:M?null:function(t,i){var o=t.jqTextarea||null,n=t.jqStatus||null,s=t.jqButtons||null,r=t.jqElement||null,a=t.oPrevActions||null,l=i(),c=null;c=_.defaults(l,{saveAction:!1,sendAction:!1,activeAction:!1}),r||(t.jqElement=r=e(t),t.jqTextarea=o=r.find("textarea"),t.jqStatus=n=r.find(".status"),t.jqButtons=s=r.find(".buttons"),t.oPrevActions=a={saveAction:null,sendAction:null,activeAction:null}),D.browser.ie9AndBelow?(!o||r.defualtHeight||o.defualtHeight||(r.defualtHeight=r.outerHeight(),o.defualtHeight=o.outerHeight(),n.defualtHeight=s.outerHeight(),s.defualtHeight=s.outerHeight()),_.defer(function(){var e=a.activeAction!==c.activeAction,t=a.sendAction!==c.sendAction,i=a.saveAction!==c.saveAction;e&&(c.activeAction?(o.animate({height:o.defualtHeight+50},300),r.animate({"max-height":r.defualtHeight+s.defualtHeight+50},300)):(o.animate({height:o.defualtHeight},300),r.animate({"max-height":r.defualtHeight},300))),(t||i)&&(c.sendAction?(r.animate({"max-height":"30px"},300),n.animate({"max-height":"30px",opacity:1},300)):c.saveAction?r.animate({"max-height":0},300):(r.animate({"max-height":r.defualtHeight+s.defualtHeight+50},300),n.animate({"max-height":0,opacity:0},300)))})):(r.toggleClass("saving",c.saveAction),r.toggleClass("sending",c.sendAction),r.toggleClass("active",c.activeAction)),_.defer(function(){a=c})}},i.extenders.reversible=function(e){var t=e();return e.commit=function(){t=e()},e.revert=function(){e(t)},e.commitedValue=function(){return t},e.changed=function(){return t!==e()},e},i.extenders.autoResetToFalse=function(e,i){return e.iTimeout=0,e.subscribe(function(o){o&&(t.clearTimeout(e.iTimeout),e.iTimeout=t.setTimeout(function(){e.iTimeout=0,e(!1)},I.pInt(i)))}),e},I.createCommand=function(e,t,o){var n=t?function(){return n.canExecute&&n.canExecute()?t.apply(e,Array.prototype.slice.call(arguments)):!1}:function(){};return n.enabled=i.observable(!0),o=I.isUnd(o)?!0:o,n.canExecute=i.computed(I.isFunc(o)?function(){return n.enabled()&&o.call(e)}:function(){return n.enabled()&&!!o}),n},i.bindingHandlers.autocomplete={init:function(t,i){function o(e){return e.split(/,\s*/)}function n(e){return o(e).pop()}var s=i(),r=e(t);s&&r&&r[0]&&r.autocomplete({minLength:0,autoFocus:!0,source:function(e,t){s(n(e.term),t)},search:function(){return n(this.value).length>0},focus:function(){return!1},select:function(e,t){var i=o(this.value),n=null;return i.pop(),i.push(t.item.value),i.push(""),this.value=i.join(", ").slice(0,-2),r.trigger("change"),n=function(e){var t=e.value.length;e.blur(),e.focus(),e.setSelectionRange&&e.setSelectionRange(t,t)},n(r[0]),!1}}).on("click",function(){""===r.val()&&(e(r.autocomplete("widget")).is(":visible")?r.autocomplete("close"):(r.autocomplete("option","minLength",0),r.autocomplete("search"),r.autocomplete("option","minLength",1)))})}},i.bindingHandlers.autocompleteSimple={init:function(t,i){var o=e(t),n=i(),s=n.callback,r=n.dataAccessor?n.dataAccessor:I.emptyFunction(),a=n.deleteAccessor?n.deleteAccessor:I.emptyFunction(),l=I.emptyFunction(),c=null,h=null,u=function(){a(h),e.ui.autocomplete.prototype.__response.call(o.data("autocomplete"),_.filter(c,function(e){return e.value!==h.value}))};s&&o&&o[0]&&o.autocomplete({minLength:1,autoFocus:!0,position:{collision:"flip"},source:function(e,t){l=t,s(e.term,function(e){c=e,l(e)})},focus:function(e,t){h=t.item},open:function(){e(o.autocomplete("widget")).find("span.del").on("click",function(e){I.calmEvent(e),u()})},select:function(e,t){return _.delay(function(){o.trigger("change")},5),r(t.item),!0}}).on("click",function(){""===o.val()&&(e(o.autocomplete("widget")).is(":visible")?o.autocomplete("close"):(o.autocomplete("option","minLength",0),o.autocomplete("search"),o.autocomplete("option","minLength",1)))}).on("keydown",function(e){c&&h&&!h.global&&e.keyCode===F.Key.Del&&e.shiftKey&&(I.calmEvent(e),u())})}},i.bindingHandlers.draggablePlace={init:M?null:function(t,o,n,s){if(null===o())return null;var r=n?n():null;e(t).draggable({distance:20,handle:".dragHandle",cursorAt:{top:0,left:0},helper:function(e){return o().apply(s,e&&e.target?[i.dataFor(e.target),e.ctrlKey]:null)},start:r&&r.draggableDragStartCallback?r.draggableDragStartCallback:I.emptyFunction,stop:r&&r.draggableDragStopCallback?r.draggableDragStopCallback:I.emptyFunction}).on("mousedown",function(){I.removeActiveFocus()})}},i.bindingHandlers.droppable={init:M?null:function(t,i){var o=i(),n=o.valueFunc,s=o.switchObserv;!1!==n&&e(t).droppable({hoverClass:"droppableHover",drop:function(e,t){n(e,t)}}),s&&n!==!1&&(s.subscribe(function(i){e(t).data().droppable&&e(t).droppable(i?"disable":"enable")},this),s.valueHasMutated())}},i.bindingHandlers.draggable={init:M?null:function(t,o){e(t).attr("draggable",i.utils.unwrapObservable(o()))}},i.bindingHandlers.autosize={init:function(t,i){var o=e(t),n=i(),s=o.height(),r=o.outerHeight(),a=o.innerHeight(),l=r-a,c=a-s,h=n.minHeight?n.minHeight:0,u=n.maxHeight?n.maxHeight:0,p=n.scrollableHeight?n.scrollableHeight:1e3,d=n.autosizeTrigger?n.autosizeTrigger:null,f=function(e){var t=0;D.browser.firefox&&(t=2*parseInt(o.css("padding-top"),10)),u?setTimeout(function(){o.prop("scrollHeight")<u?(o.height(h-c-l),o.height(o.prop("scrollHeight")+t-c)):o.height(u-c-l)},100):(e||o.prop("scrollHeight")<p)&&setTimeout(function(){o.height(h-c-l),o.height(o.prop("scrollHeight")+t-c)},100)};o.on("keydown",function(){f()}),o.on("paste",function(){f()}),d&&d.subscribe(function(e){f(e)},this),f()}},i.extenders.disableLinebreaks=function(e,t){if(t){var o=i.computed({read:function(){return e()},write:function(t){e(t.replace(/[\r\n\t]+/gm," "))}});return o(e()),o}return e},i.bindingHandlers.fade={init:function(t,i){var o=e(t),n=e('<span class="faded"></span>'),s=_.defaults(i(),{color:null,css:"fadeout"}),r=s.color,a=s.css,l=function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return e=e.replace(t,function(e,t,i,o){return t+t+i+i+o+o}),i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null},c=function(e,t){I.isRTL()?n.css("filter","progid:DXImageTransform.Microsoft.gradient(startColorstr='"+e+"', endColorstr='"+e+"',GradientType=1 )").css("background-image","-webkit-gradient(linear, left top, right top, color-stop(0%,"+t+",1)), color-stop(100%,"+t+",0)))").css("background-image","-moz-linear-gradient(left, "+t+",1)0%, "+t+",0)100%)").css("background-image","-webkit-linear-gradient(left, "+t+"1)0%,"+t+",0)100%)").css("background-image","-o-linear-gradient(left, "+t+",1)0%,"+t+",0)100%)").css("background-image","-ms-linear-gradient(left, "+t+",1)0%,"+t+",0)100%)").css("background-image","linear-gradient(left, "+t+",1)0%,"+t+",0)100%)"):n.css("filter","progid:DXImageTransform.Microsoft.gradient(startColorstr='"+e+"', endColorstr='"+e+"',GradientType=1 )").css("background-image","-webkit-gradient(linear, left top, right top, color-stop(0%,"+t+",0)), color-stop(100%,"+t+",1)))").css("background-image","-moz-linear-gradient(left, "+t+",0)0%, "+t+",1)100%)").css("background-image","-webkit-linear-gradient(left, "+t+",0)0%,"+t+",1)100%)").css("background-image","-o-linear-gradient(left, "+t+",0)0%,"+t+",1)100%)").css("background-image","-ms-linear-gradient(left, "+t+",0)0%,"+t+",1)100%)").css("background-image","linear-gradient(left, "+t+",0)0%,"+t+",1)100%)")},h=function(e){if(""!==e){var t=l(e),i="rgba("+t.r+","+t.g+","+t.b;c(e,i)}};o.parent().addClass(a),o.after(n),void 0!==s.color.subscribe&&(h(r()),r.subscribe(function(e){h(e)},this))}},i.bindingHandlers.highlighter={init:function(i,o){function n(){var e,o,n,s,r=0;return"undefined"!=typeof t.getSelection?(e=t.getSelection().getRangeAt(0),o=e.cloneRange(),o.selectNodeContents(i),o.setEnd(e.endContainer,e.endOffset),r=o.toString().length):"undefined"!=typeof document.selection&&"Control"!==document.selection.type&&(n=document.selection.createRange(),s=document.body.createTextRange(),s.moveToElementText(i),s.setEndPoint("EndToEnd",n),r=s.text.length),r}function s(e){var o,n,s;if(!i)return!1;if(document.createRange)o=document.createRange(),o.selectNodeContents(i),o.setStart(i,e),o.setEnd(i,e),n=t.getSelection(),n.removeAllRanges(),n.addRange(o);else{if(i.createTextRange)return s=i.createTextRange(),s.collapse(!0),s.moveEnd(e),s.moveStart(e),s.select(),!0;if(i.setSelectionRange)return i.setSelectionRange(e,e),!0}return!1}function r(t){if(y){var i=0,o=a.text(),r=o.split(d),l=[],c='<span class="search_highlight">$&</span>';e.each(r,function(t,i){_.any(p,function(e){return e===i})?e.each(i,function(t,i){l.push(e(i.replace(/(.)/,c)))}):e.each(i,function(e,t){l.push(" "===t?document.createTextNode(""):document.createTextNode(t))})}),t?a.empty().append(l):(i=n(),a.empty().append(l),s(i))}}var a=e(i),l=o(),c=l.valueObserver?l.valueObserver:null,h=l.highlighterValueObserver?l.highlighterValueObserver:null,u=l.highlightTrigger?l.highlightTrigger:null,p=["from:","to:","subject:","text:","email:","has:","date:","text:","body:"],d=function(){var t="";return e.each(p,function(e,i){t=e?t+"|\\b"+i:t+"\\b"+i}),new RegExp("("+t+")","g")}(),f=function(e){return e.replace(/\xC2\xA0/g," ").replace(/\xA0/g," ").replace(/[\s]+/g," ")},m=-1,g=t.navigator.language||t.navigator.userLanguage,b=["zh","zh-TW","zh-CN","zh-HK","zh-SG","zh-MO","ja","ja-JP","ko","ko-KR","vi","vi-VN","th","th-TH"],y=!_.include(b,g);e(i).on("keydown",function(e){return e.keyCode!==F.Key.Enter}).on("keyup",function(e){var t=[F.Key.Left,F.Key.Right,F.Key.Home,F.Key.End],i=-1!==I.inArray(e.keyCode,t);return e.keyCode===F.Key.Shift||e.keyCode===F.Key.Ctrl||i||(e.ctrlKey||m===F.Key.Ctrl)&&e.keyCode===F.Key.a||(c(f(a.text())),r(!1)),m=e.keyCode,!0}).on("paste",function(){return setTimeout(function(){c(f(a.text())),r(!1)},0),!0}),setTimeout(function(){r(!0)},0),u.notifySubscribers(),u.subscribe(function(e){setTimeout(function(){r(!!e)},0)},this),h.subscribe(function(){a.text(c())},this)}},i.bindingHandlers.quoteText={init:function(t,i,o,n){var s=(e(t),e('<span class="button_quote">'+I.i18n("HELPDESK/BUTTON_QUOTE")+"</span>")),r=i(),a=r.actionHandler,l=!1,c=null,h="";e("#pSevenContent").append(s),e(document.body).on("click",function(t){l=!!e(t.target).parents(".posts")[0],document.getSelection?(c=document.getSelection(),c&&(h=c.toString())):h=document.selection.createRange().text,l&&""!==h.replace(/[\n\r\s]/,"")?s.css({top:t.clientY+20,left:t.clientX+20}).show():s.hide()}),s.on("click",function(){a.call(n,h)})}},i.bindingHandlers.adjustHeightToContent={init:function(t){var i=e(t),o=null,n=null,s=null;_.delay(_.bind(function(){o=e(_.max(i.find(".title .text"),function(e){return e.offsetWidth})),n=o.parent(),s=n.find(".icon"),i.css("min-width",parseInt(n.css("margin-left"))+parseInt(n.css("padding-left"))+parseInt(s.width())+parseInt(s.css("margin-left"))+parseInt(s.css("margin-right"))+parseInt(s.css("padding-left"))+parseInt(s.css("padding-right"))+parseInt(o.width())+parseInt(o.css("margin-left"))+parseInt(o.css("padding-left"))+10)},this),1)}},i.bindingHandlers.customTooltip={init:G||M?null:function(t,i){var o=i(),n=I.encodeHtml(_.isFunction(o)?o():I.i18n(o)),s=e(t),r=s.find("span.dropdown"),a=!1,l=function(){var t=e(this);t.hasClass("expand")||(clearTimeout(I.CustomTooltip.iHideTimer),a=!0,clearTimeout(I.CustomTooltip.iTimer),I.CustomTooltip.iTimer=setTimeout(function(){a&&(t.hasClass("expand")?(a=!1,clearTimeout(I.CustomTooltip.iTimer),I.CustomTooltip.hide()):I.CustomTooltip.show(n,t))},100))},c=function(){clearTimeout(I.CustomTooltip.iHideTimer),I.CustomTooltip.iHideTimer=setTimeout(function(){a=!1,clearTimeout(I.CustomTooltip.iTimer),I.CustomTooltip.hide()},10)},h=function(){},u=function(){s.unbind("mouseover",l),s.unbind("mouseout",c),s.unbind("click",c),r.unbind("mouseover",c),r.unbind("mouseout",h),""!==n&&(s.bind("mouseover",l),s.bind("mouseout",c),s.bind("click",c),r.bind("mouseover",c),r.bind("mouseout",h))},p=null;u(),_.isFunction(o)&&_.isFunction(o.subscribe)&&null===p&&(p=i().subscribe(function(e){n=I.encodeHtml(e),u()}))}},i.bindingHandlers.foreachprop={transformObject:function(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push({key:i,value:e[i]});return t},init:function(e,t,o,n,s){var r=i.utils.unwrapObservable(t()),a=i.bindingHandlers.foreachprop.transformObject(r);return i.applyBindingsToNode(e,{foreach:a},s),{controlsDescendantBindings:!0}}},I.inArray=e.inArray,I.isFunc=e.isFunction,I.trim=e.trim,I.emptyFunction=function(){},I.isUnd=function(e){return void 0===e},I.isNull=function(e){return null===e},I.isNormal=function(e){return!I.isUnd(e)&&!I.isNull(e)},I.isNumeric=function(e){return I.isNormal(e)?/^[1-9]+[0-9]*$/.test(e.toString()):!1},I.pInt=function(e){var i=t.parseInt(e,10);return isNaN(i)&&(i=0),i},I.pString=function(e){return I.isNormal(e)?e.toString():""},I.isNonEmptyArray=function(e,t){return t=t||1,_.isArray(e)&&t<=e.length},I.pImport=function(e,t,i){e[t]=i},I.pExport=function(e,t,i){return I.isUnd(e[t])?i:e[t]},I.encodeHtml=function(e){return e?e.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""},I.plainToHtml=function(e){return e?e.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/\r\n/gi,"<br />").replace(/\n/gi,"<br />"):""},I.HtmlToPlain=function(e){return e?e.toString().replace(/<style[^>]*>[^<]*<\/style>/gi,"\n").replace(/<br *\/{0,1}>/gi,"\n").replace(/<\/p>/gi,"\n").replace(/<a [^>]*href="([^"]*?)"[^>]*>(.*?)<\/a>/gi,"$2 ($1)").replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"'):""},I.i18n=function(e,t,i,o){var n="",s=I.isUnd(N[e])?I.isNormal(i)?i:e:N[e];if(I.isUnd(o)||(s=function(e,t){var i=I.getPlural(O.User.DefaultLanguage,e),o=t.split("|");return o&&o[i]?o[i]:o&&o[0]?o[0]:t}(o,s)),I.isNormal(t))for(n in t)if(t.hasOwnProperty(n)){var r=new RegExp("%"+n+"%","g");s=s.replace(r,t[n])}return s},I.roundNumber=function(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)},I.friendlySize=function(e){var t=1024,i=t*t,o=t*t*t;return e=I.pInt(e),e>=o?I.roundNumber(e/o,1)+I.i18n("MAIN/GIGABYTES"):e>=i?I.roundNumber(e/i,1)+I.i18n("MAIN/MEGABYTES"):e>=t?I.roundNumber(e/t,0)+I.i18n("MAIN/KILOBYTES"):e+I.i18n("MAIN/BYTES")},I.timeOutAction=function(){var e={};return function(i,o,n){I.isUnd(e[i])&&(e[i]=0),t.clearTimeout(e[i]),e[i]=t.setTimeout(o,n)}}(),I.$log=null,I.aLog=[],I.log=function(){function t(e,t){return"string"==typeof t&&t.length>50?t.substring(0,50):t}if(O&&O.ClientDebug&&D.browser&&!D.browser.ie9AndBelow){var i=I.$log||e('<div style="display: none;"></div>').appendTo("body"),o=[];_.each(arguments,function(e){var i="string"==typeof e?e:JSON.stringify(e,t);0===o.length&&(i=" *** "+i+" *** "),o.push(i)}),o.push(moment().format(" *** D MMMM, YYYY, HH:mm:ss *** ")),I.$log=i,I.aLog.length>200&&I.aLog.shift(),I.aLog.push(I.encodeHtml(o.join(", "))),i.html(I.aLog.join("<br /><br />"))}},I.getAjaxDataForLog=function(e,t){var i=t;if(t&&t.Result)switch(e){case"MessagesGetList":case"MessagesGetListByUids":i={Result:{Uids:t.Result.Uids,UidNext:t.Result.UidNext,FolderHash:t.Result.FolderHash,MessageCount:t.Result.MessageCount,MessageUnseenCount:t.Result.MessageUnseenCount,MessageResultCount:t.Result.MessageResultCount}};break;case"MessageGet":i={Result:{Folder:t.Result.Folder,Uid:t.Result.Uid,Subject:t.Result.Subject,Size:t.Result.Size,TextSize:t.Result.TextSize,From:t.Result.From,To:t.Result.To}};break;case"MessagesGetBodies":i={Result:_.map(t.Result,function(e){return{Uid:e.Uid,Subject:e.Subject}})}}else t&&(i={Result:t.Result,ErrorCode:t.ErrorCode});return i},I.getImportContactsLink=function(){return"?/ImportContacts/"},I.getExportContactsLink=function(e){return"?/Raw/Contacts"+e+"/"},I.getExportCalendarLinkByHash=function(e,t){return"?/Raw/Calendar/"+e+"/"+t},I.getDownloadLinkByHash=function(e,t,i,o){return i=I.isUnd(i)?!1:!!i,o=I.isUnd(o)?"":o,"?/Raw/Download/"+e+"/"+t+"/"+(i?"1":"0")+(""===o?"":"/"+o)},I.getIframeLinkByHash=function(e,t,i,o){return i=I.isUnd(i)?!1:!!i,o=I.isUnd(o)?"":o,"?/Raw/Iframe/"+e+"/"+t+"/"+(i?"1":"0")+(""===o?"":"/"+o)},I.getIframeWrappwer=function(e,i){return"?/Raw/Iframe/"+e+"/"+t.encodeURIComponent(i)+"/"},I.getViewThumbnailLinkByHash=function(e,t,i,o){return i=I.isUnd(i)?!1:!!i,o=I.isUnd(o)?"":o,"?/Raw/Thumbnail/"+e+"/"+t+"/"+(i?"1":"0")+(""===o?"":"/"+o)},I.getFilestorageDownloadLinkByHash=function(e,t,i){var o="?/Raw/FilesDownload/"+e+"/"+t;return I.isUnd(i)||(o=o+"/0/"+i),o},I.getEventDownloadLinkByHash=function(e,t){return"?/Raw/EventAttachment/"+e+"/"+t},I.getFilestorageViewLinkByHash=function(e,t,i){var o="?/Raw/FilesView/"+e+"/"+t;return I.isUnd(i)||(o=o+"/0/"+i),o},I.getFilestorageViewThumbnailLinkByHash=function(e,t,i){var o="?/Raw/FilesThumbnail/"+e+"/"+t;return I.isUnd(i)||(o=o+"/0/"+i),o},I.getFilestoragePublicViewLinkByHash=function(e){return"?/Window/Files/0/"+e},I.getFilestoragePublicDownloadLinkByHash=function(e){return"?/Raw/FilesPub/0/"+e},I.daysInMonth=function(e,t){return e>0&&13>e&&t>0?new Date(t,e,0).getDate():31},I.WindowOpener={_iDefaultRatio:.8,_aOpenedWins:[],openMessage:function(e,t){if(e){var i=e.folder(),o=e.uid(),n="";n=D.Routing.buildHashFromArray(t?[F.Screens.SingleCompose,"drafts",i,o]:[F.Screens.SingleMessageView,i,"msg"+o]),this.openTab(n)}},openTab:function(i,o){e.cookie("aft-cache-ctrl","1");var n=null;return n=t.open(i,"_blank"),n&&(n.focus(),n.name=o?o:O.Accounts?O.Accounts.currentId():0,this._aOpenedWins.push(n)),n},open:function(e,i,o){var n=o?",menubar=yes":",menubar=no",s="location=no,toolbar=no,status=no,scrollbars=yes,resizable=yes"+n,r=null;return i=i.replace(/\W/g,""),s+=this._getSizeParameters(),r=t.open(e,i,s),r.focus(),r.name=O.Accounts?O.Accounts.currentId():0,this._aOpenedWins.push(r),r},getOpenedDraftUids:function(){this._aOpenedWins=_.filter(this._aOpenedWins,function(e){return!e.closed});var e=_.map(this._aOpenedWins,function(e){return e.App&&t.location.origin===e.location.origin?e.App.MailCache.editedDraftUid():""});return D.Screens.hasOpenedMinimizedPopups()&&e.push(D.MailCache.editedDraftUid()),_.uniq(_.compact(e))},closeComposesWithDraftUids:function(e){_.each(this._aOpenedWins,function(t){t.App&&-1!==I.inArray(t.App.MailCache.editedDraftUid(),e)&&t.close()}),-1!==I.inArray(D.MailCache.editedDraftUid(),e)&&D.Api.closeComposePopup()},closeAll:function(){for(var e=this._aOpenedWins.length,t=0,i=null;e>t;t++)i=this._aOpenedWins[t],i.closed||i.close();this._aOpenedWins=[]},_getSizeParameters:function(){var e=t.screen.width,i=Math.ceil(e*this._iDefaultRatio),o=Math.ceil((e-i)/2),n=t.screen.height,s=Math.ceil(n*this._iDefaultRatio),r=Math.ceil((n-s)/2);return",width="+i+",height="+s+",top="+r+",left="+o}},I.delegateRun=function(e,t,i){e&&e[t]&&e[t].apply(e,_.isArray(i)?i:[])},I.strRepeat=function(e,t){return new Array(t+1).join(e)},I.deferredUpdate=function(e,i,o,n){!e.__interval&&i?(e.__state=!0,n(e,!0),e.__interval=t.setInterval(function(){e.__state||(n(e,!1),t.clearInterval(e.__interval),e.__interval=null)},o)):i||(e.__state=!1)},I.draggableMessages=function(){return e('<div class="draggable draggableMessages"><div class="content"><span class="count-text"></span></div></div>').appendTo("#pSevenHidden")},I.draggableContacts=function(){return e('<div class="draggable draggableContacts"><div class="content"><span class="count-text"></span></div></div>').appendTo("#pSevenHidden")},I.removeActiveFocus=function(){if(document&&document.activeElement&&document.activeElement.blur){var t=e(document.activeElement);
(t.is("input")||t.is("textarea"))&&document.activeElement.blur()}},I.uiDropHelperAnim=function(i,o){var n=0,s=0,r=0,a=0,l=0,c=0,h=o.helper.clone().appendTo("#pSevenHidden"),u=e(i.target).find(".animGoal"),p=null;u=e(u[0]?u[0]:i.target),p=u&&u[0]?u.offset():null,p&&(n=t.Math.round(p.left),s=t.Math.round(p.top),l=u.width(),c=u.height(),r=n,l>0&&(r+=t.Math.round(l/2)),a=s,c>0&&(a+=t.Math.round(c/2)),h.animate({left:r+"px",top:a+"px","font-size":"0px",opacity:0},800,"easeOutQuint",function(){e(this).remove()}))},I.isTextFieldFocused=function(){var e=document&&document.activeElement?document.activeElement:null,t=e?e.tagName:null,i=e&&e.type?e.type.toLowerCase():null,o=e?e.contentEditable:null;return"INPUT"===t&&("text"===i||"password"===i||"email"===i)||"TEXTAREA"===t||"IFRAME"===t||"true"===o},I.removeSelection=function(){t.getSelection?t.getSelection().removeAllRanges():document.selection&&document.selection.empty()},I.getMonthNamesArray=function(){for(var e=I.i18n("DATETIME/MONTH_NAMES").split(" "),t=12,i=e.length;t>i;i++)e[i]="";return e},I.getPlural=function(e,t){var i=0;switch(t=I.pInt(t),e){case"Arabic":i=0===t?0:1===t?1:2===t?2:t%100>=3&&10>=t%100?3:t%100>=11?4:5;break;case"Bulgarian":i=1===t?0:1;break;case"Chinese-Simplified":i=0;break;case"Chinese-Traditional":i=1===t?0:1;break;case"Czech":i=1===t?0:t>=2&&4>=t?1:2;break;case"Danish":i=1===t?0:1;break;case"Dutch":i=1===t?0:1;break;case"English":i=1===t?0:1;break;case"Estonian":i=1===t?0:1;break;case"Finnish":i=1===t?0:1;break;case"French":i=1===t?0:1;break;case"German":i=1===t?0:1;break;case"Greek":i=1===t?0:1;break;case"Hebrew":i=1===t?0:1;break;case"Hungarian":i=1===t?0:1;break;case"Italian":i=1===t?0:1;break;case"Japanese":i=0;break;case"Korean":i=0;break;case"Latvian":i=t%10===1&&t%100!==11?0:0!==t?1:2;break;case"Lithuanian":i=t%10===1&&t%100!==11?0:t%10>=2&&(10>t%100||t%100>=20)?1:2;break;case"Norwegian":i=1===t?0:1;break;case"Persian":i=0;break;case"Polish":i=1===t?0:t%10>=2&&4>=t%10&&(10>t%100||t%100>=20)?1:2;break;case"Portuguese-Portuguese":i=1===t?0:1;break;case"Portuguese-Brazil":i=1===t?0:1;break;case"Romanian":i=1===t?0:0===t||t%100>0&&20>t%100?1:2;break;case"Russian":i=t%10===1&&t%100!==11?0:t%10>=2&&4>=t%10&&(10>t%100||t%100>=20)?1:2;break;case"Slovenian":i=t%10===1&&t%100!==11?0:t%10===2&&t%100!==12?1:2;break;case"Serbian":i=t%10===1&&t%100!==11?0:t%10>=2&&4>=t%10&&(10>t%100||t%100>=20)?1:2;break;case"Spanish":i=1===t?0:1;break;case"Swedish":i=1===t?0:1;break;case"Thai":i=0;break;case"Turkish":i=1===t?0:1;break;case"Ukrainian":i=t%10===1&&t%100!==11?0:t%10>=2&&4>=t%10&&(10>t%100||t%100>=20)?1:2;break;case"Vietnamese":i=0;break;default:i=0}return i},I.getFileExtension=function(e){var t="",i=e.lastIndexOf(".");return i>-1&&(t=e.substr(i+1)),t},I.getFileNameWithoutExtension=function(e){var t=e,i=e.lastIndexOf(".");return i>-1&&(t=e.substr(0,i)),t},I.defaultOptionsAfterRender=function(e,t){t&&(I.isUnd(t.disable)||i.applyBindingsToNode(e,{disable:t.disable},t))},I.getDateFormatForMoment=function(e){var t="MM/DD/YYYY";switch(e){case"MM/DD/YYYY":t="MM/DD/YYYY";break;case"DD/MM/YYYY":t="DD/MM/YYYY";break;case"DD Month YYYY":t="DD MMMM YYYY"}return t},I.getDateFormatForDatePicker=function(e){var t="mm/dd/yy";switch(e){case"MM/DD/YYYY":t="mm/dd/yy";break;case"DD/MM/YYYY":t="dd/mm/yy";break;case"DD Month YYYY":t="dd MM yy"}return t},I.getDateFormatsForSelector=function(){return _.map(O.App.DateFormats,function(e){switch(e){case"MM/DD/YYYY":return{name:I.i18n("DATETIME/DATEFORMAT_MMDDYYYY"),value:e};case"DD/MM/YYYY":return{name:I.i18n("DATETIME/DATEFORMAT_DDMMYYYY"),value:e};case"DD Month YYYY":return{name:I.i18n("DATETIME/DATEFORMAT_DDMONTHYYYY"),value:e};default:return{name:e,value:e}}})},I.getTitleForEvent=function(e){var t=e?I.trim(e.replace(/[\n\r]/," ")):"",i=t.indexOf(" ",180);return i>=0&&(t=t.substring(0,i)+"..."),t.length>200&&(t=t.substring(0,200)+"..."),t},I.desktopNotify=function(){var e=[];return function(i){if(i&&O.User.DesktopNotifications&&t.Notification&&!D.focused())switch(i.action){case"show":if(t.Notification.permission!==F.notificationPermission.Denied){var o,n={body:i.body||"",dir:i.dir||"auto",lang:i.lang||"",tag:i.tag||Math.floor(900*Math.random()+100),icon:i.icon||!1},s=function(){o=new t.Notification(i.title,n),o.onclick=function(){i.callback&&i.callback(),o.close()},i.timeout&&setTimeout(function(){o.close()},i.timeout),e.push(o)};t.Notification.permission===F.notificationPermission.Granted?s():t.Notification.permission===F.notificationPermission.Default&&t.Notification.requestPermission(function(e){e===F.notificationPermission.Granted&&s()})}break;case"hide":_.each(e,function(t,o){i.tag===t.tag&&(t.close(),e.splice(o,1))});break;case"hideAll":_.each(e,function(e){e.close()}),e.length=0}}}(),I.isRTL=function(){return H.hasClass("rtl")},I.validateFileOrFolderName=function(e){return e=I.trim(e),""!==e&&!/["\/\\*?<>|:]/.test(e)},I.shadeColor=function(e,i){var o=!1,n=0,s=0,r=0,a=0;return"#"===e[0]&&(e=e.slice(1),o=!0),n=t.parseInt(e,16),s=(n>>16)+i,s>255?s=255:0>s&&(s=0),r=(n>>8&255)+i,r>255?r=255:0>r&&(r=0),a=(255&n)+i,a>255?a=255:0>a&&(a=0),(o?"#":"")+(a|r<<8|s<<16).toString(16)},I.extend=function(e,t){var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e},I.thumbQueue=function(){var e={},t={},i=2;return function(o,n,s){n&&s?!(o in t)||t[o]>0?(o in t||(t[o]=i,e[o]=[]),t[o]--,s(n)):e[o].push({imageSrc:n,imageSrcObserver:s,messageUid:o}):e[o]&&e[o].length&&(e[o][0].imageSrcObserver(e[o][0].imageSrc),e[o].shift())}}(),I.checkConnection=function(){var e=-1,t=(new Date).getTime(),i=0,o=!1;return setInterval(function(){i=(new Date).getTime(),o=i>t+5e3+1e3,t=i,o&&D.Api.hideError(!0)},5e3),function(t,i){clearTimeout(e),"error"!==i?(D.InternetConnectionError=!1,D.Api.hideError(!0)):"SystemPing"===t?(D.InternetConnectionError=!0,D.Api.showError(I.i18n("WARNING/NO_INTERNET_CONNECTION"),!1,!0,!0),e=setTimeout(function(){D.Ajax.send({Action:"SystemPing"})},6e4)):D.Ajax.send({Action:"SystemPing"})}}(),I.loadScript=function(e,i,o,n){var s=document.createElement("script");!I.isUnd(n)&&i&&(t[n]=i),I.isUnd(o)&&(o={}),_.each(o,function(e,t){s.setAttribute(t,e)}),s.type="text/javascript",s.src=e,document.body.appendChild(s)},I.registerMailto=function(e){!t.navigator||!I.isFunc(t.navigator.registerProtocolHandler)||e&&1===D.Storage.getData("MailtoAsked")||(t.navigator.registerProtocolHandler("mailto",I.Common.getAppPath()+"#"+F.Screens.Compose+"/to/%s",""!==O.App.SiteName?O.App.SiteName:"WebMail"),D.Storage.setData("MailtoAsked",1))},I.CustomTooltip={_$Region:null,_$ArrowTop:null,_$Text:null,_$ArrowBottom:null,_iArrowBorderLeft:0,_iArrowMarginLeft:0,_iLeftShift:0,_bInitialized:!1,_bShown:!1,iHideTimer:0,iTimer:0,init:function(){this._bInitialized||(this._$Region=e('<span class="custom_tooltip"></span>').appendTo("body").hide(),this._$ArrowTop=e('<span class="custom_tooltip_arrow top"></span>').appendTo(this._$Region),this._$Text=e('<span class="custom_tooltip_text"></span>').appendTo(this._$Region),this._$ArrowBottom=e('<span class="custom_tooltip_arrow bottom"></span>').appendTo(this._$Region),this._iArrowMarginLeft=I.pInt(this._$ArrowTop.css("margin-left")),this._iArrowBorderLeft=I.pInt(this._$ArrowTop.css("border-left-width")),this._iLeftShift=I.pInt(this._$Region.css("margin-left"))+this._iArrowMarginLeft+this._iArrowBorderLeft,this._bInitialized=!0),this._$ArrowTop.show(),this._$ArrowBottom.hide(),this._$ArrowTop.css({"margin-left":this._iArrowMarginLeft+"px"}),this._$ArrowBottom.css({"margin-left":this._iArrowMarginLeft+"px"})},show:function(t,i){this.init();var o=i.offset(),n=i.width(),s=70>n?n/2:n/4,r=I.pInt(i.css("padding-left")),a=e("body");this._$Text.html(t),this._bShown=!0,this._$Region.stop().fadeIn(260,_.bind(function(){this._bShown||this._$Region.hide()},this)).css({top:o.top+i.outerHeight()+1,left:o.left+r+s-this._iLeftShift,right:"auto"}),a.outerHeight()<this._$Region.outerHeight()+this._$Region.offset().top&&(this._$ArrowTop.hide(),this._$ArrowBottom.show(),this._$Region.css({top:o.top-this._$Region.outerHeight()})),setTimeout(function(){a.width()<this._$Region.outerWidth(!0)+this._$Region.offset().left&&(this._$Region.css({left:"auto",right:0}),this._$ArrowTop.css({"margin-left":s+o.left-this._$Region.offset().left-this._iArrowBorderLeft+"px"}),this._$ArrowBottom.css({"margin-left":s+o.left-this._$Region.offset().left-this._iArrowBorderLeft+I.pInt(this._$Region.css("margin-right"))+"px"}))}.bind(this),1)},hide:function(){this._bInitialized&&(this._bShown=!1,this._$Region.hide())}},I.htmlStartsWithBlockquote=function(e){var t=e.split("<blockquote"),i=t.length>0?t[0]:"",o=I.trim(i.replace(/<[^>]*>/g,""));return""===o},I.escapeQuotes=function(e){return e.replace(/'/g,"\\'").replace(/"/g,'\\"')},I.checkCookies=function(){e.cookie("checkCookie","1",{path:"/"});var t="1"===e.cookie("checkCookie");return t||D.Screens.showError(I.i18n("WARNING/COOKIES_DISABLED"),!1,!0),t},I.calmEvent=function(e){e&&(e.stop&&e.stop(),e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),e.cancelBubble=!0,e.returnValue=!1)},I.Common={},I.Common.getRequestParam=function(e){var t=[],i=[],o=null;return void 0===this.aGetParams&&(t=""!==location.search?location.search.substr(1).split("&"):[],t.length>0&&_.each(t,function(e){var t=e.split("=");i[t[0]]=t.length>1?t[1]:""}),this.aGetParams=i),void 0!==this.aGetParams[e]&&(o=this.aGetParams[e]),o},I.Common.getAppPath=function(){var e=t.location.origin||t.location.protocol+"//"+t.location.host;return e+t.location.pathname},I.Common.clearAndReloadLocation=function(e,i){if(e||""===t.location.search&&""===t.location.hash)t.location.reload();else{var o=I.Common.getAppPath();i||""===t.location.search||(o+=t.location.search),"replaceState"in history?(history.replaceState("",document.title,o),t.location.reload(!0)):t.location.href=o}},I.File={},I.File.getViewLinkByHash=function(e,t,i,o){var n="?/Raw/View/"+e+"/"+t,s=i===!0?"/1":"/0",r="string"==typeof o&&""!==o?"/"+o:"";return n+s+r},I.Address={},I.Address.isCorrectEmail=function(e){return!!e.match(/^[A-Z0-9\"!#\$%\^\{\}`~&'\+\-=_\.]+@[A-Z0-9\.\-]+$/i)},I.Address.getFullEmail=function(e,t){var i="";return i=t.length>0?e.length>0?I.Address.isCorrectEmail(e)||-1!==e.indexOf(",")?'"'+e+'" <'+t+">":e+" <"+t+">":t:e},I.Address.getEmailParts=function(t,i){for(var o=t.indexOf('"'),n=t.indexOf('"',o+1),s=t.indexOf("<",n),r=-1,a=-1,l="",c="";-1!==s;)r=s,s=t.indexOf("<",s+1);return s=r,a=t.indexOf(">",s+1),-1===s?c=e.trim(t):(o=i?-1:o,l=e.trim(-1===o?t.substring(0,s):t.substring(o+1,n)),c=e.trim(t.substring(s+1,a))),{name:l,email:c,fullEmail:I.Address.getFullEmail(l,c)}},I.Address.getArrayRecipients=function(e,t){for(var i=[",",";"," "],o="",n=e,s=0,r=0,a="",l=null,c=[];n.length>0;){for(s=I.Address._getFirstSeparatorPosition(n,i),r=s;-1!==_.indexOf(i,n[r+1]);)r++;-1===s?(a=o+n,l=I.Address.getEmailParts(a),(t||I.Address.isCorrectEmail(l.email))&&c.push(l),n=""):(a=o+n.substring(0,s),l=I.Address.getEmailParts(a),I.Address.isCorrectEmail(l.email)?(c.push(l),o=""):o+=n.substring(0,r+1),n=n.substring(r+1))}return c},I.Address._getFirstSeparatorPosition=function(e,t){var i=-1;return _.each(t,function(t){var o=e.indexOf(t);-1!==o&&(-1===i||i>o)&&(i=o)}),i},I.Address.getIncorrectEmailsFromAddressString=function(t){for(var i=t.replace(/"[^"]*"/g,"").replace(/;/g,",").split(","),o=[],n=0,s=i.length,r="",a=null;s>n;n++)r=e.trim(i[n]),r.length>0&&(a=I.Address.getEmailParts(e.trim(i[n])),I.Address.isCorrectEmail(a.email)||o.push(a.email));return o},s.prototype.iTimer=0,s.prototype.bResetCheckedOnClick=!1,s.prototype.bCheckOnSelect=!1,s.prototype.bUnselectOnCtrl=!1,s.prototype.bDisableMultiplySelection=!1,s.prototype.setBeforeSelectCallback=function(e){this.fBeforeSelectCallback=e||null},s.prototype.getLastOrSelected=function(){var e=0,t=null;return _.each(this.list(),function(i){i.checked()&&e++,i.selected()&&(t=i)}),0===e&&t?t:this.oLast},s.prototype.initOnApplyBindings=function(t,o,n,s,r){e(document).on("keydown",this.onKeydownBinded),this.oListScope=s,this.oScrollScope=r,this.sActionSelector=t,this.sSelectabelSelector=o,this.sCheckboxSelector=n;var a=this,l=function(e,t,i){var o=0,n=0,s=null,r=!1,l=!1,c=[],h=!1;if(t=t?t:null,i&&i.shiftKey&&null!==t&&null!==e&&t!==e)for(c=a.list(),h=t.checked(),o=0,n=c.length;n>o;o++)s=c[o],r=!1,(s===e||s===t)&&(r=!0),r&&(l=!l),(l||r)&&s.checked(h);t&&(a.oLast=t)};e(this.oListScope).on("dblclick",t,function(e){var t=i.dataFor(this);!t||!e||e.ctrlKey||e.altKey||e.shiftKey||a.onDblClick(t)}),G&&e(this.oListScope).on("touchstart",t,function(t){if(t){var i=t.timeStamp,o=e(this).data("lastTouch")||i,n=i-o,s=t.originalEvent&&t.originalEvent.touches?t.originalEvent.touches.length:0;e(this).data("lastTouch",i),!n||n>250||s>1||(t.preventDefault(),e(this).trigger("dblclick"))}}),e(this.oListScope).on("click",t,function(e){var t=!0,o=null,n=a.getLastOrSelected(),s=i.dataFor(this);s&&e&&(e.shiftKey?(t=!1,a.bDisableMultiplySelection||(null===a.oLast&&(a.oLast=s),s.checked(!s.checked()),l(n,s,e))):e.ctrlKey&&(t=!1,a.bDisableMultiplySelection||(a.oLast=s,o=a.itemSelected(),!o||o.checked()||s.checked()||o.checked(!0),a.bUnselectOnCtrl&&s===a.itemSelected()?(s.checked(!s.selected()),a.itemSelected(null)):s.checked(!s.checked()))),t&&(a.onSelect(s),a.scrollToSelected()))}),e(this.oListScope).on("click",n,function(e){var t=i.dataFor(this);t&&e&&!a.bDisableMultiplySelection&&(e.shiftKey?(null===a.oLast&&(a.oLast=t),l(a.getLastOrSelected(),t,e)):a.oLast=t),e&&e.stopPropagation&&e.stopPropagation()}),e(this.oListScope).on("dblclick",n,function(e){e&&e.stopPropagation&&e.stopPropagation()})},s.prototype.getResultSelection=function(e,t){var i=this,o=!1,n=!1,s=null,r=this.iFactor,a=!!this.multiplyLineFactor,l=0,c=0,h=[];if(!e&&-1<I.inArray(t,[this.KeyUp,this.KeyDown,this.KeyLeft,this.KeyRight,F.Key.PageUp,F.Key.PageDown,F.Key.Home,F.Key.End]))h=this.list(),h&&0<h.length&&(-1<I.inArray(t,[this.KeyDown,this.KeyRight,F.Key.PageUp,F.Key.Home])?s=h[0]:-1<I.inArray(t,[this.KeyUp,this.KeyLeft,F.Key.PageDown,F.Key.End])&&(s=h[h.length-1]));else if(e&&(h=this.list(),c=h?h.length:0,c>0))if(F.Key.Home===t||F.Key.PageUp===t||F.Key.End===t||F.Key.PageDown===t||a&&(F.Key.Left===t||F.Key.Right===t)||!a&&(F.Key.Up===t||F.Key.Down===t))_.each(h,function(r){if(!o)switch(t){case i.KeyUp:case i.KeyLeft:e===r?o=!0:s=r;break;case F.Key.Home:case F.Key.PageUp:s=r,o=!0;break;case i.KeyDown:case i.KeyRight:n?(s=r,o=!0):e===r&&(n=!0);break;case F.Key.End:case F.Key.PageDown:s=r}});else if(a&&this.KeyDown===t){for(;c>l;l++)if(e===h[l]){l+=r,l>c-1&&(l-=r),s=h[l];break}}else if(a&&this.KeyUp===t)for(l=c;l>=0;l--)if(e===h[l]){l-=r,0>l&&(l+=r),s=h[l];break}return s},s.prototype.shiftClickResult=function(e,t,i){if(t){var o=!!this.multiplyLineFactor,n=!1,s=!1;-1<I.inArray(i,o?[F.Key.Left,F.Key.Right]:[F.Key.Up,F.Key.Down])?t.checked(!t.checked()):-1<I.inArray(i,o?[F.Key.Up,F.Key.Down,F.Key.PageUp,F.Key.PageDown,F.Key.Home,F.Key.End]:[F.Key.Left,F.Key.Right,F.Key.PageUp,F.Key.PageDown,F.Key.Home,F.Key.End])&&(s=!t.checked(),_.each(this.list(),function(i){var o=!1;(i===e||t===i)&&(n=!n,o=!0),(n||o)&&(i.checked(s),o=!1)}),o&&e&&(i===F.Key.Up||i===F.Key.Down)&&e.checked(!e.checked()))}},s.prototype.clickNewSelectPosition=function(e,i){var o=this,n=0,s=null,r=this.itemSelected();s=this.getResultSelection(r,e),s?(i&&this.shiftClickResult(s,r,e),s&&this.fBeforeSelectCallback?(this.fBeforeSelectCallback(s,function(e){e&&(o.itemSelected(s),n=0===o.iTimer?50:150,0!==o.iTimer&&t.clearTimeout(o.iTimer),o.iTimer=t.setTimeout(function(){o.iTimer=0,o.onSelect(s,!1)},n),this.scrollToSelected())}),this.scrollToSelected()):(this.itemSelected(s),n=0===this.iTimer?50:150,0!==this.iTimer&&t.clearTimeout(this.iTimer),this.iTimer=t.setTimeout(function(){o.iTimer=0,o.onSelect(s)},n),this.scrollToSelected())):r&&i&&-1<I.inArray(e,[this.KeyUp,this.KeyDown,this.KeyLeft,this.KeyRight,F.Key.PageUp,F.Key.PageDown,F.Key.Home,F.Key.End])&&r.checked(!r.checked())},s.prototype.onKeydown=function(e){var t=!0,i=0;return this.useKeyboardKeys()&&e&&!I.isTextFieldFocused()&&!D.Screens.hasOpenedMaximizedPopups()&&(i=e.keyCode,e.ctrlKey||this.KeyUp!==i&&this.KeyDown!==i&&this.KeyLeft!==i&&this.KeyRight!==i&&F.Key.PageUp!==i&&F.Key.PageDown!==i&&F.Key.Home!==i&&F.Key.End!==i?F.Key.Del!==i||e.ctrlKey||e.shiftKey?F.Key.Enter===i?0<this.list().length&&!e.ctrlKey&&(this.onEnter(this.itemSelected()),t=!1):!e.ctrlKey||e.altKey||e.shiftKey||F.Key.a!==i||(this.checkAll(!(this.checkAll()&&!this.isIncompleteChecked())),t=!1):0<this.list().length&&(this.onDelete(),t=!1):(this.clickNewSelectPosition(i,e.shiftKey),t=!1)),t},s.prototype.onDelete=function(){this.fDeleteCallback.call(this,this.listCheckedOrSelected())},s.prototype.onEnter=function(e){var t=this;e&&this.fBeforeSelectCallback?this.fBeforeSelectCallback(e,function(i){i&&(t.itemSelected(e),t.fEnterCallback.call(this,e))}):(this.itemSelected(e),this.fEnterCallback.call(this,e))},s.prototype.selectionFunc=function(e){this.itemSelected(null),this.bResetCheckedOnClick&&this.listChecked(!1),this.itemSelected(e),this.fSelectCallback.call(this,e)},s.prototype.onSelect=function(e,t){if(t=I.isUnd(t)?!0:!!t,this.fBeforeSelectCallback&&t){var i=this;this.fBeforeSelectCallback(e,function(t){t&&i.selectionFunc(e)})}else this.selectionFunc(e)},s.prototype.onDblClick=function(e){this.fDblClickCallback.call(this,e)},s.prototype.koCheckAll=function(){return i.computed({read:this.checkAll,write:this.checkAll,owner:this})},s.prototype.koCheckAllIncomplete=function(){return i.computed({read:this.isIncompleteChecked,write:this.isIncompleteChecked,owner:this})},s.prototype.scrollToSelected=function(){if(!this.oListScope||!this.oScrollScope)return!1;var t=20,i=e(this.sSelectabelSelector,this.oScrollScope),o=i.position(),n=this.oScrollScope.height(),s=i.outerHeight();return o&&(o.top<0||o.top+s>n)?(this.oScrollScope.scrollTop(o.top<0?this.oScrollScope.scrollTop()+o.top-t:this.oScrollScope.scrollTop()+o.top-n+s+t),!0):!1},function(e){e.fn.splitter=function(i){return i=i||{},this.each(function(){var o=!1,n=i.collapse?i.collapse:!1,s=i.name,r=0,a=0,l=0,c={},h={},u=e(this),p=e(">*:not(css3pie)",u).each(function(){this.$=e(this)}),d=(i.splitHorizontal?"h":i.splitVertical?"v":i.type)||"v",f=e(".resize_handler",p.get(0)).attr({unselectable:"on"}),m="rtl"===u.css("direction"),g=e.extend({activeClass:"active",pxPerKey:8,tabIndex:0,accessKey:""},{v:{keyLeft:39,keyRight:37,type:"v",eventPos:"pageX",origin:"left",split:"width",pxSplit:"offsetWidth",side1:"Left",side2:"Right",fixed:"height",pxFixed:"offsetHeight",side3:"Top",side4:"Bottom"},h:{keyTop:40,keyBottom:38,type:"h",eventPos:"pageY",origin:"top",split:"height",pxSplit:"offsetHeight",side1:"Top",side2:"Bottom",fixed:"width",pxFixed:"offsetWidth",side3:"Left",side4:"Right"}}[d],i),b=function(e,i){var o=p.get(0)._min;l=e,n&&o-e>150&&(e=5,i=!0),i||(e=t.Math.max(o,u._overallWidth-p.get(1)._max,t.Math.min(e,p.get(0)._max,u._overallWidth-p.get(1)._min))),p.get(0).$.css(g.split,e),p.get(1).$.css(g.split,u._overallWidth-e),D.browser.ie8AndBelow||p.trigger("resize")},y=function(e){var t=(m?u._overallWidth-e[g.eventPos]:e[g.eventPos])+g._posSplit;b(t),I.isFunc(i.resizeFunc)&&i.resizeFunc()},v=function A(){f.removeClass(g.activeClass),e("body").attr({unselectable:"off"}).removeClass("unselectable"),s&&D.Storage.setData(s+"ResizerWidth",p.get(0)[g.pxSplit]),e(document).unbind("mousemove",y).unbind("mouseup",A),I.isFunc(i.resizeFunc)&&i.resizeFunc()},S=function(t){o=!0,f.addClass(g.activeClass),g._posSplit=-((m?u._overallWidth-t[g.eventPos]:t[g.eventPos])-p.get(0)[g.pxSplit]),e("body").attr({unselectable:"on"}).addClass("unselectable"),e(document).bind("mousemove",y).bind("mouseup",v)},E=function(e){for(var i=0,o=1;o<arguments.length;o++)i+=t.Math.max(t.parseInt(e.css(arguments[o]),10)||0,0);return i};f.bind("mousedown",S),p.get(0)._paneName=g.side1,p.get(1)._paneName=g.side2,p.each(function(){this._min=g["min"+this._paneName]||E(this.$,"min-"+g.split),this._max=g["max"+this._paneName]||E(this.$,"max-"+g.split)||9999,this._init=void 0===g["size"+this._paneName]?t.parseInt(e.css(this,g.split),10):g["size"+this._paneName]}),r=s?D.Storage.getData(s+"ResizerWidth")||p.get(0)._init:p.get(0)._init,isNaN(r)&&(r=u[0][g.pxSplit],r=t.Math.round(r/p.length)),g.resizeToWidth&&!D.browser.ie8AndBelow&&e(t).bind("resize",function(e){e.target===this&&u.trigger("resize")}),u.bind("resize",function(e,t,i,n,s){var r=e.target.className+"_"+i;o&&(c={}),e.target===this&&(u._overallWidth=u[0][g.pxSplit],u._overallWidth<=0||(a=g.sizeRight||g.sizeBottom?u._overallWidth-p.get(1)[g.pxSplit]:p.get(0)[g.pxSplit],isNaN(t)?t=a:i&&(s?t=c[r]?c[r]:a:(o=!1,c[r]?(t=c[r],c[r]=null):(t===a?(c[r]=null,t=h[r]):c[r]=h[r]=a,_.each(c,function(e,t){t!==r&&(c[t]=null)})))),b(t,n)))}).trigger("resize",[r])})}}(jQuery),function(e){e.ui.autocomplete.prototype._renderItem=function(t,i){var o=i.label.match(/[a-zA-Z0-9.\-_]+@[a-zA-Z0-9.\-]+/g);return i.label=o?i.label.replace("<"+o[0]+">","<span style='opacity: 0.5'>&lt;"+o[0]+"&gt</span>"):i.label.replace(new RegExp("<","g"),"&lt;").replace(new RegExp(">","g"),"&gt;"),e("<li>").append("<a>"+i.label+(i.global===!1?'<span class="del"></span>':"")+"</a>").appendTo(t)},e.ui.autocomplete.prototype._renderMenu=function(t,i){var o=this,n="";e.each(i,function(e,i){i&&i.category&&i.category!==n&&(n=i.category,t.append('<li class="ui-autocomplete-category">'+i.category+"</li>")),o._renderItemData(t,i)})},e.ui.autocomplete.prototype._move=function(e,t){return this.menu.element.is(":visible")?(this.menu.isFirstItem()&&/^previous/.test(e)?(this._value(this.term),this.menu._move("first","first",t)):this.menu.isLastItem()&&/^next/.test(e)&&(this._value(this.term),this.menu._move("last","last",t)),void this.menu[e](t)):void this.search(null,t)}}(jQuery),r.prototype.composeMessage=function(){D.Routing.setHash([F.Screens.Compose])},r.prototype.composeMessageFromDrafts=function(e,t){var i=D.Links.composeFromMessage("drafts",e,t);D.Routing.setHash(i)},r.prototype.composeMessageAsReplyOrForward=function(e,t,i){var o=D.Links.composeFromMessage(e,t,i);D.Routing.setHash(o)},r.prototype.composeMessageToAddresses=function(e){var t=D.Links.composeWithToField(e);D.Routing.setHash(t)},r.prototype.composeMessageWithVcard=function(e){var t=["vcard",e];D.Routing.goDirectly(D.Links.compose(),t)},r.prototype.composeMessageWithEml=function(e){var t=["eml",e];D.Routing.goDirectly(D.Links.compose(),t)},r.prototype.composeMessageWithPgpKey=function(e,t){var i=["data-as-file",e,t];D.Routing.goDirectly(D.Links.compose(),i)},r.prototype.composeMessageWithFiles=function(e){var t=["file",e];D.Routing.goDirectly(D.Links.compose(),t)},r.prototype.closeComposePopup=function(){},r.prototype.createMailAccount=function(){},r.prototype.showChangeDefaultAccountPasswordPopup=function(){},r.prototype.showConfigureMailPopup=function(){},r.prototype.downloadByUrl=function(i){var o=null;G?t.open(i):(o=e('<iframe style="display: none;"></iframe>').appendTo(document.body),o.attr("src",i),setTimeout(function(){o.remove()},6e4))},r.prototype.isPgpSupported=function(){return!(!t.crypto||!t.crypto.getRandomValues)},r.prototype.pgp=function(i,o){if(I.isFunc(i))if(this.openPgp)i(this.openPgp);else if(this.isPgpSupported()){null!==this.openPgpCallbacks?this.openPgpCallbacks.push(i):i(!1);var n=this;this.openPgpRequest||(this.openPgpRequest=!0,e.ajax({url:"static/js/openpgp.js",dataType:"script",cache:!0,complete:function(){n.openPgp=t.openpgp?new l(t.openpgp,"user_"+(o||"0")+"_"):!1,null!==n.openPgpCallbacks&&_.each(n.openPgpCallbacks,function(e){e(n.openPgp)}),n.openPgpCallbacks=null}}))}else i(!1)},r.prototype.showLoading=function(e,t,i){D.Screens.showLoading(e,t,i)},r.prototype.hideLoading=function(){D.Screens.hideLoading()},r.prototype.showReport=function(e,t){D.Screens.showReport(e,t)},r.prototype.showError=function(e,t,i,o){D.Screens.showError(e,t,i,o)},r.prototype.hideError=function(e){D.Screens.hideError(e)},r.prototype.showPgpErrorByCode=function(e,t,i){var o=I.isNonEmptyArray(e.errors)?e.errors:[],n=I.isNonEmptyArray(e.notices)?e.notices:[],s=[],r=[],a="",l=!1,c=!0;if(_.each(_.union(o,n),function(e){if(2===e.length)switch(e[0]){case h.Enum.GenerateKeyError:a=I.i18n("OPENPGP/ERROR_GENERATE_KEY");break;case h.Enum.ImportKeyError:a=I.i18n("OPENPGP/ERROR_IMPORT_KEY");break;case h.Enum.ImportNoKeysFoundError:a=I.i18n("OPENPGP/ERROR_IMPORT_NO_KEY_FOUND");break;case h.Enum.PrivateKeyNotFoundError:case h.Enum.PrivateKeyNotFoundNotice:r.push(e[1]);break;case h.Enum.PublicKeyNotFoundError:c=!1,s.push(e[1]);break;case h.Enum.PublicKeyNotFoundNotice:s.push(e[1]);break;case h.Enum.KeyIsNotDecodedError:t===F.PgpAction.DecryptVerify?a=I.i18n("OPENPGP/ERROR_DECRYPT")+" "+I.i18n("OPENPGP/ERROR_KEY_NOT_DECODED",{USER:e[1]}):(t===F.PgpAction.Sign||t===F.PgpAction.EncryptSign)&&(a=I.i18n("OPENPGP/ERROR_SIGN")+" "+I.i18n("OPENPGP/ERROR_KEY_NOT_DECODED",{USER:e[1]}));break;case h.Enum.SignError:a=I.i18n("OPENPGP/ERROR_SIGN");break;case h.Enum.VerifyError:a=I.i18n("OPENPGP/ERROR_VERIFY");break;case h.Enum.EncryptError:a=I.i18n("OPENPGP/ERROR_ENCRYPT");break;case h.Enum.DecryptError:a=I.i18n("OPENPGP/ERROR_DECRYPT");break;case h.Enum.SignAndEncryptError:a=I.i18n("OPENPGP/ERROR_ENCRYPT_OR_SIGN");break;case h.Enum.VerifyAndDecryptError:a=I.i18n("OPENPGP/ERROR_DECRYPT_OR_VERIFY");break;case h.Enum.DeleteError:a=I.i18n("OPENPGP/ERROR_DELETE_KEY");break;case h.Enum.VerifyErrorNotice:a=I.i18n("OPENPGP/ERROR_VERIFY");break;case h.Enum.NoSignDataNotice:l=!0}}),s.length>0?(s=_.without(s,""),s.length>0?a=I.i18n("OPENPGP/ERROR_NO_PUBLIC_KEYS_FOR_USERS_PLURAL",{USERS:s.join(", ")},null,s.length):t===F.PgpAction.Verify&&(a=I.i18n("OPENPGP/ERROR_NO_PUBLIC_KEY_FOUND_FOR_VERIFY")),c&&""!==a&&(a+=" "+I.i18n("OPENPGP/ERROR_MESSAGE_WAS_NOT_VERIFIED"))):r.length>0&&(r=_.without(r,""),r.length>0?a=I.i18n("OPENPGP/ERROR_NO_PRIVATE_KEYS_FOR_USERS_PLURAL",{USERS:r.join(", ")},null,r.length):t===F.PgpAction.DecryptVerify&&(a=I.i18n("OPENPGP/ERROR_NO_PRIVATE_KEY_FOUND_FOR_DECRYPT"))),""===a&&!l){switch(t){case F.PgpAction.Generate:a=I.i18n("OPENPGP/ERROR_GENERATE_KEY");break;case F.PgpAction.Import:a=I.i18n("OPENPGP/ERROR_IMPORT_KEY");break;case F.PgpAction.DecryptVerify:a=I.i18n("OPENPGP/ERROR_DECRYPT");break;case F.PgpAction.Verify:a=I.i18n("OPENPGP/ERROR_VERIFY");break;case F.PgpAction.Encrypt:a=I.i18n("OPENPGP/ERROR_ENCRYPT");break;case F.PgpAction.EncryptSign:a=I.i18n("OPENPGP/ERROR_ENCRYPT_OR_SIGN");break;case F.PgpAction.Sign:a=I.i18n("OPENPGP/ERROR_SIGN")}a=i}return""!==a&&D.Api.showError(a),l},r.prototype.showErrorByCode=function(e,t,i){var o=e.ErrorCode,n=e.ErrorMessage||"",s="";switch(o){default:s=t||I.i18n("WARNING/UNKNOWN_ERROR");break;case F.Errors.AuthError:s=I.i18n("WARNING/LOGIN_PASS_INCORRECT");break;case F.Errors.DataBaseError:s=I.i18n("WARNING/DATABASE_ERROR");break;case F.Errors.LicenseProblem:s=I.i18n("WARNING/INVALID_LICENSE");break;case F.Errors.DemoLimitations:s=I.i18n("DEMO/WARNING_THIS_FEATURE_IS_DISABLED");break;case F.Errors.Captcha:s=I.i18n("WARNING/CAPTCHA_IS_INCORRECT");break;case F.Errors.CanNotGetMessage:s=I.i18n("MESSAGE/ERROR_MESSAGE_DELETED");break;case F.Errors.NoRequestedMailbox:s=t+" "+I.i18n("COMPOSE/ERROR_INVALID_ADDRESS",{ADDRESS:e.Mailbox||""});break;case F.Errors.CanNotChangePassword:s=I.i18n("WARNING/UNABLE_CHANGE_PASSWORD");break;case F.Errors.AccountOldPasswordNotCorrect:s=I.i18n("WARNING/CURRENT_PASSWORD_NOT_CORRECT");break;case F.Errors.FetcherIncServerNotAvailable:s=I.i18n("WARNING/FETCHER_SAVE_ERROR");break;case F.Errors.FetcherLoginNotCorrect:s=I.i18n("WARNING/FETCHER_SAVE_ERROR");break;case F.Errors.HelpdeskUserNotExists:s=I.i18n("HELPDESK/ERROR_FORGOT_NO_ACCOUNT");break;case F.Errors.MailServerError:s=I.i18n("WARNING/CANT_CONNECT_TO_SERVER");break;case F.Errors.DataTransferFailed:s=I.i18n("WARNING/DATA_TRANSFER_FAILED");break;case F.Errors.NotDisplayedError:s=""}o===F.Errors.InvalidToken?D.tokenProblem():""!==s?(""!==n&&(s+=" ("+n+")"),this.showError(s,!1,!!i)):""!==n&&this.showError(n)},r.prototype.showErrorIfAttachmentSizeLimit=function(e,t){var i=I.i18n("COMPOSE/UPLOAD_ERROR_FILENAME_SIZE",{FILENAME:e,MAXSIZE:I.friendlySize(O.App.AttachmentSizeLimit)});return O.App.AttachmentSizeLimit>0&&t>O.App.AttachmentSizeLimit?(D.Screens.showPopup(u,[i]),!0):!1},r.prototype.deleteMessages=function(e,t,i){I.isFunc(i)||(i=function(){});var o=D.MailCache.folderList(),n=o.currentFolderFullName(),s=o.trashFolder(),r=s&&n===s.fullName(),a=o.spamFolder(),l=a&&n===a.fullName(),c=function(o){o&&(t.MailCache.deleteMessages(e),i())};l?(t.MailCache.deleteMessages(e),i()):r?D.Screens.showPopup(p,[I.i18n("MAILBOX/CONFIRM_MESSAGES_DELETE"),c]):s?(t.MailCache.moveMessagesToFolder(s.fullName(),e),i()):s||D.Screens.showPopup(p,[I.i18n("MAILBOX/CONFIRM_MESSAGES_DELETE_NO_TRASH_FOLDER"),c])},r.prototype.contactCreate=function(){},a.prototype.hasData=function(t){var i=this.bHtml5?localStorage.getItem(t):e.cookie(t);return!!i},a.prototype.getData=function(t){var i=this.bHtml5?localStorage.getItem(t):e.cookie(t);return e.parseJSON(i)},a.prototype.setData=function(t,i){var o=JSON.stringify(i);this.bHtml5?localStorage.setItem(t,o):e.cookie(t,o,{expires:30})},a.prototype.removeData=function(t){this.bHtml5?localStorage.removeItem(t):e.cookie(t,null)},a.prototype.init=function(){if("undefined"==typeof Storage)this.bHtml5=!1;else try{localStorage.setItem("check","val"),localStorage.removeItem("check")}catch(e){this.bHtml5=!1}},l.prototype.pgp=null,l.prototype.pgpKeyring=null,l.prototype.keys=[],l.prototype.getKeys=function(){return this.keys()},l.prototype.getKeysObservable=function(){return this.keys},l.prototype.reloadKeysFromStorage=function(){var e=[],t=this.pgpKeyring.getAllKeys();_.each(t,function(t){t&&t.primaryKey&&e.push(new c(t))}),this.keys(e)},l.prototype.convertToNativeKeys=function(e){return _.map(e,function(e){return e&&e.pgpKey?e.pgpKey:e})},l.prototype.cloneKey=function(e){var t=null;return e&&(t=this.pgp.key.readArmored(e.armor()),t&&!t.err&&t.keys&&t.keys[0]?(t=t.keys[0],t&&t.primaryKey||(t=null)):t=null),t},l.prototype.decryptKeyHelper=function(e,t,i,o){if(t)try{t.decrypt(I.pString(i)),t&&t.primaryKey&&t.primaryKey.isDecrypted||e.addError(h.Enum.KeyIsNotDecodedError,o||"")}catch(n){e.addExceptionMessage(n,h.Enum.KeyIsNotDecodedError,o||"")}else e.addError(h.Enum.KeyIsNotDecodedError,o||"")},l.prototype.verifyMessageHelper=function(e,t,i){var o=!1,n=null,s=[],r=[],a=[];if(i&&i.getSigningKeyIds)if(r=i.getSigningKeyIds(),r&&0<r.length)if(a=this.findKeysByEmails([t],!0),a&&0!==a.length){s=[];try{s=i.verify(this.convertToNativeKeys(a))}catch(l){e.addNotice(h.Enum.VerifyErrorNotice,t)}s&&0<s.length&&(n=_.find(s,function(e){return e&&e.keyid&&e.valid}),n&&n.keyid&&a&&a[0]&&n.keyid.toHex().toLowerCase()===a[0].getId()?o=!0:e.addNotice(h.Enum.VerifyErrorNotice,t))}else e.addNotice(h.Enum.PublicKeyNotFoundNotice,t);else e.addNotice(h.Enum.NoSignDataNotice);else e.addError(h.Enum.UnknownError);return o||e.hasNotices()||e.addNotice(h.Enum.VerifyErrorNotice),o},l.prototype.generateKey=function(e,t,i){var o=new h,n=null;try{n=this.pgp.generateKeyPair({userId:e,numBits:I.pInt(i),passphrase:I.trim(t)})}catch(s){o.addExceptionMessage(s)}if(n&&n.privateKeyArmored)try{this.pgpKeyring.privateKeys.importKey(n.privateKeyArmored),this.pgpKeyring.publicKeys.importKey(n.publicKeyArmored),this.pgpKeyring.store()}catch(s){o.addExceptionMessage(s,h.Enum.GenerateKeyError)}else o.addError(h.Enum.GenerateKeyError);return this.reloadKeysFromStorage(),o},l.prototype.splitKeys=function(e){var t=[],i=0,o=30,n=null,s=I.trim(e),r=/[\-]{3,6}BEGIN[\s]PGP[\s](PRIVATE|PUBLIC)[\s]KEY[\s]BLOCK[\-]{3,6}[\s\S]+?[\-]{3,6}END[\s]PGP[\s](PRIVATE|PUBLIC)[\s]KEY[\s]BLOCK[\-]{3,6}/gi;for(s=s.replace(/[\r\n]([a-zA-Z0-9]{2,}:[^\r\n]+)[\r\n]+([a-zA-Z0-9\/\\+=]{10,})/g,"\n$1---xyx---$2").replace(/[\n\r]+/g,"\n").replace(/---xyx---/g,"\n\n");;){if(n=r.exec(s),!n||0>o)break;n[0]&&n[1]&&n[2]&&n[1]===n[2]&&("PRIVATE"===n[1]||"PUBLIC"===n[1])&&(t.push([n[1],n[0]]),i++),o--
}return t},l.prototype.importKeys=function(e){e=I.trim(e);var t=0,i=0,o=new h,n=null,s=[];if(!e)return o.addError(h.Enum.InvalidArgumentErrors);for(s=this.splitKeys(e),t=0;t<s.length;t++)if(n=s[t],"PRIVATE"===n[0])try{this.pgpKeyring.privateKeys.importKey(n[1]),i++}catch(r){o.addExceptionMessage(r,h.Enum.ImportKeyError,"private")}else if("PUBLIC"===n[0])try{this.pgpKeyring.publicKeys.importKey(n[1]),i++}catch(r){o.addExceptionMessage(r,h.Enum.ImportKeyError,"public")}return i>0?this.pgpKeyring.store():o.addError(h.Enum.ImportNoKeysFoundError),this.reloadKeysFromStorage(),o},l.prototype.getArmorInfo=function(e){e=I.trim(e);var t=0,i=0,o=null,n=[],s=null,r=[];if(!e)return!1;for(r=this.splitKeys(e),t=0;t<r.length;t++)if(s=r[t],"PRIVATE"===s[0])try{o=this.pgp.key.readArmored(s[1]),o&&!o.err&&o.keys&&o.keys[0]&&n.push(new c(o.keys[0])),i++}catch(a){n.push(null)}else if("PUBLIC"===s[0])try{o=this.pgp.key.readArmored(s[1]),o&&!o.err&&o.keys&&o.keys[0]&&n.push(new c(o.keys[0])),i++}catch(a){n.push(null)}return n},l.prototype.findKeyByID=function(e,t){t=!!t,e=e.toLowerCase();var i=_.find(this.keys(),function(i){var o=!1,n=null;return i&&t===i.isPublic()&&(n=i.pgpKey.getKeyIds(),n&&(o=_.find(n,function(t){return t&&t.toHex&&e===t.toHex().toLowerCase()}))),!!o});return i?i:null},l.prototype.findKeysByEmails=function(e,t,i){t=!!t;var o=[],n=this.keys();return _.each(e,function(e){var s=_.find(n,function(i){return i&&t===i.isPublic()&&e===i.getEmail()});s?o.push(s):i&&i.addError(t?h.Enum.PublicKeyNotFoundError:h.Enum.PrivateKeyNotFoundError,e)}),o},l.prototype.decryptAndVerify=function(e,t,i,o){var n=this,s=null,r=null,a=null,l=null,c=null,u=new h,p=[];if(s=this.pgp.message.readArmored(e),s&&s.decrypt)if(p=s.getEncryptionKeyIds(),p&&(a=null,r=null,_.each(p,function(e){r||(r=n.findKeyByID(e.toHex(),!1),r&&t!==r.getEmail()&&(r=null))}),r&&(a=r),a||_.each(p,function(e){a||(a=n.findKeyByID(e.toHex(),!1))})),a){if(l=this.cloneKey(this.convertToNativeKeys([a])[0]),this.decryptKeyHelper(u,l,o,a.getEmail()),l&&!u.hasErrors())try{c=s.decrypt(l)}catch(d){u.addExceptionMessage(d,h.Enum.DecryptError),c=null}c&&!u.hasErrors()&&(this.verifyMessageHelper(u,i,c),u.result=c.getText())}else u.addError(h.Enum.PrivateKeyNotFoundError);return u},l.prototype.verify=function(e,t){var i=null,o=new h;return i=this.pgp.cleartext.readArmored(e),i&&i.getText&&i.verify?(this.verifyMessageHelper(o,t,i),o.result=i.getText()):o.addError(h.Enum.CanNotReadMessage),o},l.prototype.encrypt=function(e,t){var i=new h,o=this.findKeysByEmails(t,!0,i);if(!i.hasErrors())try{i.result=this.pgp.encryptMessage(this.convertToNativeKeys(o),e)}catch(n){i.addExceptionMessage(n,h.Enum.EncryptError)}return i},l.prototype.sign=function(e,t,i){var o=new h,n=null,s=null,r=this.findKeysByEmails([t],!1,o);if(!o.hasErrors()&&(n=this.convertToNativeKeys(r)[0],s=this.cloneKey(n),this.decryptKeyHelper(o,s,i,t),s&&!o.hasErrors()))try{o.result=this.pgp.signClearMessage([s],e)}catch(a){o.addExceptionMessage(a,h.Enum.SignError,t)}return o},l.prototype.signAndEncrypt=function(e,t,i,o){var n=null,s=null,r=new h,a=this.findKeysByEmails([t],!1,r),l=this.findKeysByEmails(i,!0,r);if(!r.hasErrors()&&(n=this.convertToNativeKeys(a)[0],s=this.cloneKey(n),this.decryptKeyHelper(r,s,o,t),s&&!r.hasErrors()))try{r.result=this.pgp.signAndEncryptMessage(this.convertToNativeKeys(l),s,e)}catch(c){r.addExceptionMessage(c,h.Enum.SignAndEncryptError)}return r},l.prototype.deleteKey=function(e){var t=new h;if(e)try{this.pgpKeyring[e.isPrivate()?"privateKeys":"publicKeys"].removeForId(e.getFingerprint()),this.pgpKeyring.store()}catch(i){t.addExceptionMessage(i,h.Enum.DeleteError)}else t.addError(e?h.Enum.UnknownError:h.Enum.InvalidArgumentError);return this.reloadKeysFromStorage(),t},c.prototype.pgpKey=null,c.prototype.emailParts=null,c.prototype.user="",c.prototype.getId=function(){return this.pgpKey.primaryKey.getKeyId().toHex().toLowerCase()},c.prototype.getEmail=function(){return this.emailParts.email||this.user},c.prototype.getUser=function(){return this.user},c.prototype.getFingerprint=function(){return this.pgpKey.primaryKey.getFingerprint()},c.prototype.getBitSize=function(){return this.pgpKey.primaryKey.getBitSize()},c.prototype.getArmor=function(){return this.pgpKey.armor()},c.prototype.isPrivate=function(){return!!this.pgpKey.isPrivate()},c.prototype.isPublic=function(){return!this.isPrivate()},h.Enum={UnknownError:0,UnknownNotice:1,InvalidArgumentError:2,GenerateKeyError:10,ImportKeyError:20,ImportNoKeysFoundError:21,PrivateKeyNotFoundError:30,PublicKeyNotFoundError:31,KeyIsNotDecodedError:32,SignError:40,VerifyError:41,EncryptError:42,DecryptError:43,SignAndEncryptError:44,VerifyAndDecryptError:45,CanNotReadMessage:50,CanNotReadKey:51,DeleteError:60,PublicKeyNotFoundNotice:70,PrivateKeyNotFoundNotice:71,VerifyErrorNotice:72,NoSignDataNotice:73},h.prototype.result=!1,h.prototype.errors=null,h.prototype.notices=null,h.prototype.addError=function(e,t){return this.result=!1,this.errors=this.errors||[],this.errors.push([e||h.Enum.UnknownError,t||""]),this},h.prototype.addNotice=function(e,t){return this.notices=this.notices||[],this.notices.push([e||h.Enum.UnknownNotice,t||""]),this},h.prototype.addExceptionMessage=function(e,t,i){return e&&(this.result=!1,this.exceptions=this.exceptions||[],this.exceptions.push(""+(e.name||"unknown")+": "+(e.message||""))),I.isUnd(t)||this.addError(t,i),this},h.prototype.hasErrors=function(){return this.errors&&0<this.errors.length},h.prototype.hasNotices=function(){return this.notices&&0<this.notices.length},u.prototype.onShow=function(e,t,i,o){this.alertDesc(e),this.closeCallback=t||null,this.title(i||""),this.okButtonText(o||I.i18n("MAIN/BUTTON_OK"))},u.prototype.popupTemplate=function(){return"Popups_AlertPopupViewModel"},u.prototype.onEnterHandler=function(){this.close()},u.prototype.close=function(){I.isFunc(this.closeCallback)&&this.closeCallback(),this.closeCommand()},p.prototype.onShow=function(e,t,i,o,n){this.confirmDesc(e),this.title(i||""),this.okButtonText(o||I.i18n("MAIN/BUTTON_OK")),this.cancelButtonText(n||I.i18n("MAIN/BUTTON_CANCEL")),I.isFunc(t)&&(this.fConfirmCallback=t),this.shown=!0},p.prototype.onHide=function(){this.shown=!1},p.prototype.popupTemplate=function(){return"Popups_ConfirmPopupViewModel"},p.prototype.onEnterHandler=function(){this.yesClick()},p.prototype.yesClick=function(){this.shown&&this.fConfirmCallback&&this.fConfirmCallback(!0),this.closeCommand()},p.prototype.noClick=function(){this.fConfirmCallback&&this.fConfirmCallback(!1),this.closeCommand()},p.prototype.onEscHandler=function(){this.noClick()},d.prototype.onShow=function(e,t){this.pgp=e,this.keyArmor(t||""),this.keyArmorFocused(!0),this.keys([]),this.hasExistingKeys(!1),""!==this.keyArmor()&&this.checkArmor()},d.prototype.popupTemplate=function(){return"Popups_ImportOpenPgpKeyPopupViewModel"},d.prototype.checkArmor=function(){var e=null,t=[],o=this.pgp,n=!1;""===this.keyArmor()?this.keyArmorFocused(!0):o&&(e=o.getArmorInfo(this.keyArmor()),I.isNonEmptyArray(e)&&_.each(e,function(e){if(e){var s=o.findKeyByID(e.getId(),e.isPublic()),r=null!==s,a=e.isPublic()?"OPENPGP/PUBLIC_KEY_ADD_INFO":"OPENPGP/PRIVATE_KEY_ADD_INFO";n=n||r,t.push({armor:e.getArmor(),email:e.user,id:e.getId(),addInfo:I.i18n(a,{LENGTH:e.getBitSize()}),needToImport:i.observable(!r),disabled:r})}}),0===t.length&&D.Api.showError(I.i18n("OPENPGP/ERROR_IMPORT_NO_KEY_FOUND")),this.keys(t),this.hasExistingKeys(n))},d.prototype.importKey=function(){var e=null,t=[];this.pgp&&(_.each(this.keys(),function(e){e.needToImport()&&t.push(e.armor)}),t.length>0?(e=this.pgp.importKeys(t.join("")),e&&e.result&&D.Api.showReport(I.i18n("OPENPGP/REPORT_KEY_SUCCESSFULLY_IMPORTED_PLURAL",{},null,t.length)),e&&!e.result&&D.Api.showPgpErrorByCode(e,F.PgpAction.Import,I.i18n("OPENPGP/ERROR_IMPORT_KEY")),this.closeCommand()):D.Api.showError(I.i18n("OPENPGP/ERROR_IMPORT_NO_KEY_SELECTED")))},f.prototype.onShow=function(e){this.folderName(""),this.folderName.focus(!0),this.folderName.error(""),I.isFunc(e)&&(this.fCallback=e)},f.prototype.popupTemplate=function(){return"Popups_FileStorage_FolderCreatePopupViewModel"},f.prototype.onOKClick=function(){if(this.folderName.error(""),this.fCallback){var e=this.fCallback(this.folderName());e?this.folderName.error(""+e):this.closeCommand()}else this.closeCommand()},f.prototype.onCancelClick=function(){this.closeCommand()},m.prototype.onShow=function(e){this.link(""),this.linkFocus(!0),I.isFunc(e)&&(this.fCallback=e),this.checkTimer=setTimeout(_.bind(this.checkUrl,this),2e3)},m.prototype.popupTemplate=function(){return"Popups_FileStorage_LinkCreatePopupViewModel"},m.prototype.checkUrl=function(){clearTimeout(this.checkTimer),this.link()!==this.linkPrev()&&(this.linkPrev(this.link()),D.Ajax.send({Action:"FilesCheckUrl",Url:this.link()},this.onFilesCheckUrlResponse,this)),this.checkTimer=setTimeout(_.bind(this.checkUrl,this),1e3)},m.prototype.onFilesCheckUrlResponse=function(e){var t=new A;e.Result?(t.isPopupItem(!0),t.linkUrl(this.link()),t.fileName(e.Result.Name),t.size(e.Result.Size),t.linkType(e.Result.LinkType?e.Result.LinkType:F.FileStorageLinkType.Unknown),t.allowDownload(!1),e.Result.Thumb&&(t.thumb(!0),t.thumbnailSrc(e.Result.Thumb)),this.fileItem(t),this.urlChecked(!0)):this.urlChecked(!1)},m.prototype.executeSave=function(){this.fCallback&&(this.fCallback(this.fileItem()),this.link(""),this.linkPrev(""),this.urlChecked(!1)),clearTimeout(this.checkTimer),this.closeCommand()},m.prototype.onCancelClick=function(){this.link(""),this.linkPrev(""),this.urlChecked(!1),clearTimeout(this.checkTimer),this.closeCommand()},m.prototype.onEscHandler=function(){this.onCancelClick()},g.prototype.onShow=function(e,t){this.item=e,this.item.nameForEdit(this.item.fileName()),this.name(this.item.nameForEdit()),this.name.focus(!0),this.name.error(""),I.isFunc(t)&&(this.fCallback=t)},g.prototype.popupTemplate=function(){return"Popups_FileStorage_RenamePopupViewModel"},g.prototype.onOKClick=function(){if(this.name.error(""),this.fCallback){this.item.nameForEdit(this.name());var e=this.fCallback(this.item);e?this.name.error(""+e):this.closeCommand()}else this.closeCommand()},g.prototype.onCancelClick=function(){this.closeCommand()},b.prototype.onShow=function(e){this.item=e,this.pub(""),D.Ajax.send({Action:"FilesCreatePublicLink",Account:O.Accounts.defaultId(),Type:e.storageType(),Path:e.path(),Name:e.fileName(),Size:e.size(),IsFolder:e.isFolder()?"1":"0"},this.onFilesCreatePublicLinkResponse,this)},b.prototype.onFilesCreatePublicLinkResponse=function(e){e.Result&&(this.pub(e.Result),this.pubFocus(!0),this.item.shared(!0))},b.prototype.popupTemplate=function(){return"Popups_FileStorage_SharePopupViewModel"},b.prototype.onOKClick=function(){this.closeCommand()},b.prototype.onFilesDeletePublicLinkResponse=function(){this.closeCommand()},b.prototype.onCancelSharingClick=function(){this.item&&(D.Ajax.send({Action:"FilesPublicLinkDelete",Account:O.Accounts.defaultId(),Type:this.item.storageType(),Path:this.item.path(),Name:this.item.fileName()},this.onFilesDeletePublicLinkResponse,this),this.item.shared(!1))},y.prototype.popupTemplate=function(){return"Popups_ContactCreatePopupViewModel"},y.prototype.onShow=function(e,t,i,o){(this.displayName()!==e||this.email()!==t)&&(this.displayName(e),this.email(t),this.phone(""),this.address(""),this.skype(""),this.facebook("")),I.isFunc(i)&&(this.fCallback=i),o&&(this.oContext=o)},y.prototype.onSaveClick=function(){if(this.canBeSave()){if(!this.loading()){var e={Action:"ContactCreate",PrimaryEmail:"Home",UseFriendlyName:"1",FullName:this.displayName(),HomeEmail:this.email(),HomePhone:this.phone(),HomeStreet:this.address(),Skype:this.skype(),Facebook:this.facebook()};this.loading(!0),D.Ajax.send(e,this.onContactCreateResponse,this)}}else D.Api.showError(I.i18n("CONTACTS/ERROR_EMPTY_CONTACT"))},y.prototype.onCancelClick=function(){this.loading(!1),this.closeCommand()},y.prototype.onContactCreateResponse=function(e,t){this.loading(!1),e.Result?(D.Api.showReport(I.i18n("CONTACTS/REPORT_CONTACT_SUCCESSFULLY_ADDED")),D.ContactsCache.clearInfoAboutEmail(t.HomeEmail),D.ContactsCache.getContactsByEmails([t.HomeEmail],this.fCallback,this.oContext),this.closeCommand()):D.Api.showErrorByCode(e,I.i18n("WARNING/CREATING_ACCOUNT_ERROR"))},y.prototype.canBeSave=function(){return""!==this.displayName()||""!==this.email()},y.prototype.goToContacts=function(){D.ContactsCache.newContactParams={displayName:this.displayName(),email:this.email(),phone:this.phone(),address:this.address(),skype:this.skype(),facebook:this.facebook()},this.closeCommand(),D.Routing.replaceHash(D.Links.contacts())},v.prototype.onShow=function(e){this.iframe(e)},v.prototype.popupTemplate=function(){return"Popups_PlayerPopupViewModel"},v.prototype.onClose=function(){I.isFunc(this.closeCallback)&&this.closeCallback(),this.closeCommand(),this.iframe("")},S.prototype.fillDefaultFontName=function(){var e=I.pString(O.HtmlEditorDefaultFontName);""!==e&&(this.DefaultFontName=e)},S.prototype.fillDefaultFontSize=function(){var e=I.pInt(O.HtmlEditorDefaultFontSize);-1!==I.inArray(e,[2,3,5,7])&&(this.DefaultFontSize=e)},S.prototype.getSaveMailInSentItems=function(){var e=!0;switch(this.SaveMail){case F.SaveMail.Unchecked:e=!1;break;case F.SaveMail.Checked:case F.SaveMail.Hidden:e=!0}return e},S.prototype.getUseSaveMailInSentItems=function(){var e=!1;switch(this.SaveMail){case F.SaveMail.Unchecked:case F.SaveMail.Checked:e=!0;break;case F.SaveMail.Hidden:e=!1}return e},S.prototype.parse=function(e){var t=null;null!==e&&(this.IdUser=I.pInt(e.IdUser),this.MailsPerPage=I.pInt(e.MailsPerPage),this.ContactsPerPage=I.pInt(e.ContactsPerPage),this.AutoCheckMailInterval=I.pInt(e.AutoCheckMailInterval),this.DefaultTheme=I.pString(e.DefaultTheme),this.DefaultLanguage=I.pString(e.DefaultLanguage),this.DefaultLanguageShort=I.pString(e.DefaultLanguageShort),this.DefaultDateFormat=I.pString(e.DefaultDateFormat),this.defaultTimeFormat(I.pString(e.DefaultTimeFormat)),this.ThreadsEnabled=!!e.ThreadsEnabled,this.useThreads(!!e.UseThreads),this.SaveRepliedToCurrFolder=!!e.SaveRepliedMessagesToCurrentFolder,this.ComposePlainTextDefault=!!O.App&&O.App.AllowComposePlainText&&!!e.ComposePlainTextDefault,this.DesktopNotifications=!!e.DesktopNotifications,this.EmailNotification=I.pString(e.EmailNotification),this.AllowChangeInputDirection=!!e.AllowChangeInputDirection,this.AllowCompose=!!e.AllowCompose,this.AllowReply=!!e.AllowReply,this.AllowForward=!!e.AllowForward,this.SaveMail=I.pInt(e.SaveMail),this.AllowFetcher=!!e.AllowFetcher,this.OutlookSyncEnable=!!e.OutlookSyncEnable,this.MobileSyncEnable=!!e.MobileSyncEnable,this.ShowPersonalContacts=!!e.ShowPersonalContacts,this.ShowGlobalContacts=!!e.ShowGlobalContacts,this.ShowContacts=this.ShowPersonalContacts||this.ShowGlobalContacts,this.IsFilesSupported=!!e.IsFilesSupported&&!M,this.filesEnable(!!e.FilesEnable&&!M),this.IsHelpdeskSupported=!!e.IsHelpdeskSupported&&!M,this.IsHelpdeskAgent=!!e.IsHelpdeskAgent,this.helpdeskSignature(I.pString(e.HelpdeskSignature)),this.helpdeskSignatureEnable(e.HelpdeskSignatureEnable?"1":"0"),this.LastLogin=I.pInt(e.LastLogin),this.LoginsCount=I.pInt(e.LoginsCount),this.LastLoginIp=I.pString(e.LastLoginIp),this.LastLoginUa=I.pString(e.LastLoginUa),this.SocialName=I.pString(e.SocialName),this.AllowCalendar=!!e.AllowCalendar&&!M,this.CalendarSharing=!!e.CalendarSharing,this.CalendarAppointments=!!e.CalendarAppointments,this.IsDemo=!!e.IsDemo,this.AllowVoice=!!e.AllowVoice,this.SipRealm=e.SipRealm,this.SipWebsocketProxyUrl=e.SipWebsocketProxyUrl,this.SipOutboundProxyUrl=e.SipOutboundProxyUrl,this.SipCallerID=e.SipCallerID,this.SipImpi=e.SipImpi,this.SipImpu=e.SipImpu,this.SipPassword=e.SipPassword,this.VoiceProvider=e.VoiceProvider,this.AllowHelpdeskNotifications=e.AllowHelpdeskNotifications,this.IsCollaborationSupported=!!e.IsCollaborationSupported,this.AllowFilesSharing=!!e.AllowFilesSharing,this.enableOpenPgp(!!e.EnableOpenPgp),this.AllowAutosaveInDrafts=!!e.AllowAutosaveInDrafts&&(O.App?O.App.AutoSave:!1),t=e.Calendar,t&&(this.CalendarShowWeekEnds=!!t.ShowWeekEnds,this.CalendarShowWorkDay=!!t.ShowWorkDay,this.CalendarWorkDayStarts=I.pInt(t.WorkDayStarts),this.CalendarWorkDayEnds=I.pInt(t.WorkDayEnds),this.CalendarWeekStartsOn=I.pInt(t.WeekStartsOn),this.CalendarDefaultTab=I.pInt(t.DefaultTab)),this.SocialAccounts(e.SocialAccounts),this.CanLoginWithPassword=!!e.CanLoginWithPassword)},S.prototype.updateCommonSettings=function(e,t,i,o,n,s,r,a,l,c,h,u,p){var d=this.defaultTimeFormat()!==r;this.MailsPerPage=e,this.ContactsPerPage=t,this.AutoCheckMailInterval=i,D.MailCache.setAutocheckmailTimer(),this.DefaultTheme=o,this.DefaultLanguage=n,this.DefaultDateFormat=s,this.defaultTimeFormat(r),this.useThreads("1"===a),this.SaveRepliedToCurrFolder="1"===l,this.ComposePlainTextDefault="1"===c,this.AllowChangeInputDirection="1"===u,this.DesktopNotifications="1"===h,this.EmailNotification=p,d&&D.nowDateNumber.valueHasMutated()},S.prototype.updateOpenPgpSettings=function(e,t){this.enableOpenPgp("1"===e),this.AllowAutosaveInDrafts="1"===t},S.prototype.updateCalendarSettings=function(e,t,i,o,n,s){this.CalendarShowWeekEnds=e,this.CalendarShowWorkDay=t,this.CalendarWorkDayStarts=i,this.CalendarWorkDayEnds=o,this.CalendarWeekStartsOn=n,this.CalendarDefaultTab=s},S.prototype.updateHelpdeskSettings=function(e,t,i){this.AllowHelpdeskNotifications=e,this.helpdeskSignature(t),this.helpdeskSignatureEnable(i)},S.prototype.onUserSettingsGetSyncResponse=function(e){e.Result?(this.mobileSync(e.Result.Mobile),this.outlookSync(e.Result.Outlook)):D.Api.showErrorByCode(e)},S.prototype.requestSyncSettings=function(){(null===this.mobileSync()||null===this.outlookSync())&&D.Ajax.send({Action:"UserSettingsGetSync"},this.onUserSettingsGetSyncResponse,this)},E.prototype.parse=function(e){this.iTimeStampInUTC=e,this.oMoment=moment.unix(this.iTimeStampInUTC)},E.prototype.setDate=function(e,t,i){this.oMoment=moment([e,t,i])},E.prototype.getTimeFormat=function(){return O.User.defaultTimeFormat()===F.TimeFormat.F24?"HH:mm":"hh:mm A"},E.prototype.getFullDate=function(){return this.oMoment?this.oMoment.format("ddd, MMM D, YYYY, "+this.getTimeFormat()):""},E.prototype.getMidDate=function(){return this.getShortDate(!0)},E.prototype.getShortDate=function(e){var t="",i=null;return this.oMoment&&(i=moment(),i.format("L")===this.oMoment.format("L")?t=this.oMoment.format(this.getTimeFormat()):(t=i.clone().subtract(1,"days").format("L")===this.oMoment.format("L")?I.i18n("DATETIME/YESTERDAY"):this.oMoment.format(i.year()===this.oMoment.year()?"MMM D":"MMM D, YYYY"),(I.isUnd(e)?1:!e)||(t+=", "+this.oMoment.format(this.getTimeFormat())))),t},E.prototype.getDate=function(){return this.oMoment?this.oMoment.format("ddd, MMM D, YYYY"):""},E.prototype.getTime=function(){return this.oMoment?this.oMoment.format(this.getTimeFormat()):""},E.prototype.convertDate=function(e){var t=I.getDateFormatForMoment(O.User.DefaultDateFormat)+" "+this.getTimeFormat();return moment(1e3*e).format(t)},E.prototype.getTimeStampInUTC=function(){return this.iTimeStampInUTC},A.prototype.dataObjectName="",A.prototype.isVisibleViewLink=function(){return this.uploaded()&&!this.uploadError()&&this.isViewMimeType()},A.prototype.parse=function(e,t){e["@Object"]===this.dataObjectName&&(this.fileName(I.pString(e.FileName)),this.tempName(I.pString(e.TempName)),""===this.tempName()&&this.tempName(this.fileName()),this.type(I.pString(e.MimeType)),this.size(e.EstimatedSize?parseInt(e.EstimatedSize,10):parseInt(e.SizeInBytes,10)),this.content(I.pString(e.Content)),this.thumb(!!e.Thumb),this.hash(I.pString(e.Hash)),this.accountId(t),this.allowExpandSubFiles(!!e.Expand),this.iframedView(!!e.Iframed),this.uploadUid(this.hash()),this.uploaded(!0),I.isFunc(this.additionalParse)&&this.additionalParse(e))},A.prototype.getInThumbQueue=function(e){this.thumbnailSessionUid(e),this.thumb()&&(!this.linked||this.linked&&!this.linked())&&I.thumbQueue(this.thumbnailSessionUid(),this.thumbnailLink(),this.thumbnailSrc)},A.prototype.downloadFile=function(e){this.allowDownload()&&(e&&e.Api&&e.Api.downloadByUrl||(e=D),e&&this.downloadLink().length>0&&"#"!==this.downloadLink()&&e.Api.downloadByUrl(this.downloadLink()))},A.prototype.onFileExpandResponse=function(e){this.subFiles([]),I.isNonEmptyArray(e.Result)&&(_.each(e.Result,_.bind(function(e){var t=this.getInstance();e["@Object"]=this.dataObjectName,t.parse(e,this.accountId()),this.subFiles.push(t)},this)),this.subFilesLoaded(!0),this.subFilesCollapsed(!0)),this.subFilesStartedLoading(!1)},A.prototype.expandFile=function(){this.subFilesLoaded()?this.subFilesCollapsed(!0):(this.subFilesStartedLoading(!0),D.Ajax.send({Action:"FileExpand",RawKey:this.hash()},this.onFileExpandResponse,this))},A.prototype.collapseFile=function(){this.subFilesCollapsed(!1)},A.prototype.getInstance=function(){return new A},A.prototype.importFile=function(){var e=this.content(),t=_.bind(function(t){t&&D.Screens.showPopup(d,[t,e])},this);D.Api.pgp(t,O.User.IdUser)},A.prototype.downloadOrViewByIconClick=function(e,t,i){""!==this.oembed()?this.viewFile(e,t):this.allowSelect()||this.downloadFile(i)},A.prototype.viewFile=function(e,t){I.calmEvent(t),this.viewCommonFile()},A.prototype.openLink=function(){I.WindowOpener.openTab(this.viewLink())},A.prototype.viewCommonFile=function(){var e=I.Common.getAppPath()+this.viewLink(),t=null;this.visibleViewLink()&&this.viewLink().length>0&&"#"!==this.viewLink()&&(this.isLink()&&(e=this.linkUrl()),""!==this.oembedHtml()?D.Api.showPlayer(this.oembedHtml()):t=this.iframedView()?I.WindowOpener.openTab(e):I.WindowOpener.open(e,e,!1),t&&t.focus())},A.prototype.eventDragStart=function(e,t){var i=t.originalEvent||t;return e&&i&&i.dataTransfer&&i.dataTransfer.setData&&i.dataTransfer.setData("DownloadURL",this.generateTransferDownloadUrl()),!0},A.prototype.generateTransferDownloadUrl=function(){var e=this.downloadLink();return"http"!==e.substr(0,4)&&(e=I.Common.getAppPath()+e),this.type()+":"+this.fileName()+":"+e},A.prototype.onUploadSelect=function(e,t){this.fileName(I.pString(t.FileName)),this.type(I.pString(t.Type)),this.size(I.pInt(t.Size)),this.uploadUid(e),this.uploaded(!1),this.visibleSpinner(!1),this.statusText(""),this.progressPercent(0),this.visibleProgress(!1)},A.prototype.onUploadStart=function(){this.visibleSpinner(!0),this.visibleProgress(!0)},A.prototype.onUploadProgress=function(e,t){t>0&&(this.progressPercent(Math.ceil(e/t*100)),this.visibleProgress(!0))},A.prototype.onUploadComplete=function(e,t,i){var o=!(t&&i&&!i.Error&&(!i.Result||!i.Result.Error)),n=I.i18n("COMPOSE/UPLOAD_ERROR_UNKNOWN");if(this.visibleSpinner(!1),this.progressPercent(0),this.visibleProgress(!1),this.uploaded(!0),this.uploadError(o),o&&i)switch(i.Error||i.Result&&i.Result.Error){case"quota":case"size":n=I.i18n("COMPOSE/UPLOAD_ERROR_SIZE");break;case"exception":110===i.ErrorCode&&(n=I.i18n("FILESTORAGE/UPLOAD_ERROR_MAXPATHLEN")),i.ErrorCode===F.Errors.InvalidToken&&(n="",D.tokenProblem())}this.statusText(o?n:I.i18n("COMPOSE/UPLOAD_COMPLETE")),o||(this.fillDataAfterUploadComplete(i,e),setTimeout(function(e){return function(){e.statusText("")}}(this),3e3))},A.prototype.fillDataAfterUploadComplete=function(){},A.prototype.onImageLoad=function(){this.thumb()&&!this.thumbnailLoaded()&&(this.thumbnailLoaded(!0),I.thumbQueue(this.thumbnailSessionUid()))},A.prototype.saveToServer=function(){},I.extend(k,A),k.prototype.getInstance=function(){return new k},k.prototype.parse=function(e,t){var i=new E;this.isFolder(!!e.IsFolder),this.isLink(!!e.IsLink),this.fileName(I.pString(e.Name)),this.id(I.pString(e.Id)),this.path(I.pString(e.Path)),this.fullPath(I.pString(e.FullPath)),this.storageType(I.pString(e.Type)),this.shared(!!e.Shared),this.isExternal(!!e.IsExternal),this.iframedView(!!e.Iframed),this.isLink()&&(this.linkUrl(I.pString(e.LinkUrl)),this.linkType(I.pInt(e.LinkType))),this.isFolder()||(this.size(I.pInt(e.Size)),i.parse(e.LastModified),this.lastModified(i.getShortDate()),this.owner(I.pString(e.Owner)),this.thumb(!!e.Thumb),this.thumbnailExternalLink(I.pString(e.ThumbnailLink)),this.hash(I.pString(e.Hash)),this.publicHash(t),this.oembedHtml(e.OembedHtml?e.OembedHtml:"")),this.thumb()&&""===this.thumbnailExternalLink()&&I.thumbQueue(this.thumbnailSessionUid(),this.thumbnailLink(),this.thumbnailSrc),this.content(I.pString(e.Content))},k.prototype.onUploadSelectOwn=function(e,t,i,o,n,s){var r=new E,a=new Date;this.onUploadSelect(e,t),r.parse(a.getTime()/1e3),this.fileName(i),this.lastModified(r.getShortDate()),this.owner(o),this.path(n),this.storageType(s)},T.prototype.__name="CFileStorageViewModel",T.prototype.onApplyBindings=function(t){this.selector.initOnApplyBindings(".items_sub_list .item",".items_sub_list .selected.item",".items_sub_list .item .custom_checkbox",e(".panel.files .items_list",t),e(".panel.files .items_list .files_scroll.scroll-inner",t)),this.initUploader(),this.hotKeysBind()},T.prototype.hotKeysBind=function(){var t=D.Screens.currentScreen()===F.Screens.FileStorage;e(document).on("keydown",_.bind(function(e){t&&e&&e.keyCode===F.Key.s&&this.selector.useKeyboardKeys()&&!I.isTextFieldFocused()&&(e.preventDefault(),this.isSearchFocused(!0))},this))},T.prototype.initUploader=function(){var e=this;this.uploaderButton()&&this.uploaderArea()&&(this.oJua=new Jua({action:"?/Upload/File/",name:"jua-uploader",queueSize:2,clickElement:this.uploaderButton(),hiddenElementsPosition:I.isRTL()?"right":"left",dragAndDropElement:this.uploaderArea(),disableAjaxUpload:this.isPublic?!0:!1,disableFolderDragAndDrop:this.isPublic?!0:!1,disableDragAndDrop:this.isPublic?!0:!1,hidden:{Token:function(){return O.Token},AccountID:function(){return O.Accounts.currentId()},AdditionalData:function(t){return JSON.stringify({Type:e.storageType(),SubPath:t&&!I.isUnd(t.Folder)?t.Folder:"",Path:e.dropPath()})}}}),this.oJua.on("onProgress",_.bind(this.onFileUploadProgress,this)).on("onSelect",_.bind(this.onFileUploadSelect,this)).on("onStart",_.bind(this.onFileUploadStart,this)).on("onDrop",_.bind(this.onDrop,this)).on("onComplete",_.bind(this.onFileUploadComplete,this)).on("onBodyDragEnter",_.bind(this.bDragActive,this,!0)).on("onBodyDragLeave",_.bind(this.bDragActive,this,!1)),this.bAllowDragNDrop=this.oJua.isDragAndDropSupported())},T.prototype.onFileUploadSelect=function(e,t){if(O.App.FileSizeLimit>0&&t.Size/1048576>O.App.FileSizeLimit)return D.Screens.showPopup(u,[I.i18n("FILESTORAGE/ERROR_SIZE_LIMIT",{SIZE:O.App.FileSizeLimit})]),!1;var i=this.quota()-this.used();if(this.storageType()===F.FileStorageType.Personal&&0!==this.quota()&&t.Size>i)return D.Screens.showPopup(u,[i>0?I.i18n("FILESTORAGE/ERROR_SIZE_QUOTA_LIMIT",{FRIENDLYSIZE:I.friendlySize(i)}):I.i18n("COMPOSE/UPLOAD_ERROR_SIZE")]),!1;if(""===this.searchPattern()){var o=new k,n=t.FileName,s=I.getFileExtension(n),r=I.getFileNameWithoutExtension(n),a=0,l=O.Accounts.getDefault();for(""!==s&&(s="."+s);!I.isUnd(this.getFileByName(n));)n=r+"_"+a+s,a++;o.onUploadSelectOwn(e,t,n,l.email(),this.path(),this.storageType()),this.uploadingFiles.push(o)}},T.prototype.onFileUploadStart=function(e){var t=this.getUploadFileByUid(e);t&&t.onUploadStart()},T.prototype.onFileUploadProgress=function(e,t,i){if(""===this.searchPattern()){var o=this.getUploadFileByUid(e);o&&o.onUploadProgress(t,i)}},T.prototype.onFileUploadComplete=function(e,t,i){if(""===this.searchPattern()){var o=this.getUploadFileByUid(e);o&&(o.onUploadComplete(e,t,i),this.deleteUploadFileByUid(e),o.uploadError()?(this.uploadError(!0),D.Api.showError(o.statusText())):(this.files.push(o),0===this.uploadingFiles().length&&D.Api.showReport(I.i18n("COMPOSE/UPLOAD_COMPLETE")))),this.getFiles(this.storageType(),this.getPathItemByIndex(this.iPathIndex()),this.searchPattern(),!1)}},T.prototype.onDrop=function(e,t){if(!this.isPublic)if(t&&t.target&&""===this.searchPattern()){var o=i.dataFor(t.target);o&&o instanceof k&&o.isFolder()&&this.dropPath(o.fullPath())}else D.Api.showReport(I.i18n("FILESTORAGE/INFO_CANNOT_UPLOAD_SEARCH_RESULT"))},T.prototype.filesDrop=function(e,t,i){if(!this.isPublic&&e&&t){var o=this,n="",s=!1,r=e.fullPath(),a=[],l=[],c=0,h=0;if(this.path()!==r&&this.storageType()===e.storageType()||this.storageType()!==e.storageType()){if(e.recivedAnim(!0),I.uiDropHelperAnim(t,i),a=this.selector.listCheckedAndSelected(),this.quota()>0&&this.storageType()!==e.storageType()&&e.storageType()===F.FileStorageType.Personal&&(c=_.reduce(a,function(e,t){return e+(t.isFolder()?0:t.size())},0),h=this.quota()-this.used(),c>h))return void D.Screens.showPopup(u,[h>0?I.i18n("FILESTORAGE/ERROR_SIZE_QUOTA_LIMIT",{FRIENDLYSIZE:I.friendlySize(h)}):I.i18n("FILESTORAGE/ERROR_MOVE_QUOTA_LIMIT")]);_.each(a,function(e){n=e.path(),s=e.isFolder()&&r===n+"/"+e.id(),s||(t.ctrlKey||(e.isFolder()?o.deleteFolderByName(e.fileName()):o.deleteFileByName(e.id())),l.push({Name:e.id(),IsFolder:e.isFolder(),Size:e.isFolder()?0:e.size()}))}),l.length>0&&D.Ajax.send({Action:t.ctrlKey?"FilesCopy":"FilesMove",FromType:this.storageType(),ToType:e.storageType(),FromPath:n,ToPath:r,Files:JSON.stringify(l)},this.onFilesMoveResponse,this)}}},T.prototype.onFilesMoveResponse=function(e,t){if(!e.Result){if(t.ToType===F.FileStorageType.Personal&&e.ErrorCode===F.Errors.FilesQuotaLimit){var i=this.quota()-this.used();D.Screens.showPopup(u,[i>0?I.i18n("FILESTORAGE/ERROR_SIZE_QUOTA_LIMIT",{FRIENDLYSIZE:I.friendlySize(i)}):I.i18n("FILESTORAGE/ERROR_MOVE_QUOTA_LIMIT")])}else D.Api.showErrorByCode(e);this.getFiles(this.storageType(),this.getPathItemByIndex(this.iPathIndex()))}this.getQuota(this.storageType())},T.prototype.dragAndDropHelper=function(t){t&&t.checked(!0);var i=I.draggableMessages(),o=this.selector.listCheckedAndSelected(),n=o.length,s=0,r=0,a="";return _.each(o,function(e){e.isFolder()?r++:s++},this),0!==s&&0!==r?a=I.i18n("FILESTORAGE/DRAG_ITEMS_TEXT_PLURAL",{COUNT:n},null,n):0===s?a=I.i18n("FILESTORAGE/DRAG_FOLDERS_TEXT_PLURAL",{COUNT:r},null,r):0===r&&(a=I.i18n("FILESTORAGE/DRAG_TEXT_PLURAL",{COUNT:s},null,s)),e(".count-text",i).text(a),i},T.prototype.onItemDelete=function(){this.executeDelete()},T.prototype.onEnter=function(e){this.onItemDblClick(e)},T.prototype.onItemDblClick=function(e){e&&(e.isFolder()?this.getFiles(this.storageType(),e):e.isViewable()?e.viewFile():this.isPopup?this.onSelectClickPopupBinded&&this.onSelectClickPopupBinded():e.downloadFile())},T.prototype.onFilesResponse=function(e,t){if(e.Result){var i=[],o=[],n=Date.now().toString();e.Result.Quota&&(this.quota(e.Result.Quota[0]+e.Result.Quota[1]),this.used(e.Result.Quota[0])),_.each(e.Result.Items,function(e){var t=(new k).allowDrag(!0).allowSelect(!0).allowCheck(!0).allowDelete(!0).allowUpload(!0).allowSharing(!0).allowHeader(!0).allowDownload(!0).isPopupItem(this.isPopup);t.parse(e,this.publicHash),t.getInThumbQueue(n),t.isFolder()?i.push(t):o.push(t)},this),(this.isPublic||t.Type===this.storageType())&&(this.folders(i),this.files(o)),this.loading(!1),this.loadedFiles(!0),clearTimeout(this.timerId)}else this.loading(!1),this.error(!0)},T.prototype.onQuotaResponse=function(e){e.Result&&e.Result.Quota&&(this.quota(e.Result.Quota[0]+e.Result.Quota[1]),this.used(e.Result.Quota[0]))},T.prototype.onFilesDeleteResponse=function(e){e.Result?(this.expungeFileItems(),this.getQuota(this.storageType())):this.getFiles(this.storageType(),this.getPathItemByIndex(this.iPathIndex()),this.searchPattern())},T.prototype.executeRename=function(){var e=this.selector.listCheckedAndSelected();!this.isPublic&&e[0]&&D.Screens.showPopup(g,[e[0],_.bind(this.renameItem,this)])},T.prototype.executeDownload=function(){var e=this.selector.listCheckedAndSelected();e[0]&&!e[0].isFolder()&&e[0].downloadFile()},T.prototype.executeShare=function(){var e=this.selector.listCheckedAndSelected();!this.isPublic&&e[0]&&D.Screens.showPopup(b,[e[0]])},T.prototype.executeSend=function(){var e=this.selector.listCheckedAndSelected(),t=_.filter(e,function(e){return!e.isFolder()},this);t.length>0&&D.Api.composeMessageWithFiles(t)},T.prototype.onShareIconClick=function(e){e&&D.Screens.showPopup(b,[e])
},T.prototype.renameItem=function(e){var t=I.trim(e.nameForEdit());return I.validateFileOrFolderName(t)?(D.Ajax.send({Action:"FilesRename",Type:this.storageType(),Path:e.path(),Name:e.id(),NewName:t,IsLink:e.isLink()?1:0},this.onFilesRenameResponse,this),""):I.i18n(e.isFolder()?"FILESTORAGE/INVALID_FOLDER_NAME":"FILESTORAGE/INVALID_FILE_NAME")},T.prototype.onFilesRenameResponse=function(){this.getFiles(this.storageType(),this.getPathItemByIndex(this.iPathIndex()),this.searchPattern())},T.prototype.executeDelete=function(){var e=this.selector.listCheckedAndSelected();!this.isPublic&&e&&e.length>0&&D.Screens.showPopup(p,[I.i18n("FILESTORAGE/CONFIRMATION_DELETE"),_.bind(this.deleteItems,this,e)])},T.prototype.onShow=function(){this.loaded(!0),this.getStorages(),this.selector.useKeyboardKeys(!0),this.oJua&&this.oJua.setDragAndDropEnabledStatus(!0)},T.prototype.onHide=function(){this.selector.useKeyboardKeys(!1),this.oJua&&this.oJua.setDragAndDropEnabledStatus(!1)},T.prototype.getQuota=function(e){D.Ajax.send({Action:"FilesQuota",Type:e},this.onQuotaResponse,this)},T.prototype.getStorageByType=function(e){return _.find(this.storages(),function(t){return t.storageType()===e})},T.prototype.getStorages=function(){this.isPublic?this.getFiles(this.storageType(),this.getPathItemByIndex(this.iPathIndex())):(this.getStorageByType(F.FileStorageType.Personal)||this.storages.push((new k).isFolder(!0).storageType(F.FileStorageType.Personal).displayName(I.i18n("FILESTORAGE/TAB_PERSONAL_FILES"))),this.IsCollaborationSupported&&(this.getStorageByType(F.FileStorageType.Corporate)||this.storages.push((new k).isFolder(!0).storageType(F.FileStorageType.Corporate).displayName(I.i18n("FILESTORAGE/TAB_CORPORATE_FILES"))),this.AllowFilesSharing&&(this.getStorageByType("shared")||this.storages.push((new k).isFolder(!0).storageType("shared").displayName(I.i18n("FILESTORAGE/TAB_SHARED_FILES"))))),this.isPopup?this.getFiles(this.storageType(),this.getPathItemByIndex(this.iPathIndex())):this.getExternalFileStorages())},T.prototype.getExternalFileStorages=function(){D.Ajax.send({Action:"FileStoragesExternal"},this.onExternalStoragesResponse,this)},T.prototype.onExternalStoragesResponse=function(e){e.Result&&(_.each(e.Result,function(e){this.getStorageByType(e.Type)||this.storages.push((new k).isExternal(!0).isFolder(!0).storageType(e.Type).displayName(e.DisplayName))},this),this.expungeExternalStorages(_.map(e.Result,function(e){return e.Type},this))),this.getStorageByType(this.storageType())||(this.storageType(F.FileStorageType.Personal),this.pathItems([]),this.iPathIndex(-1)),this.getFiles(this.storageType(),this.getPathItemByIndex(this.iPathIndex()))},T.prototype.getFiles=function(e,t,i,o){var n=this,s=this.storageType(),r=this.iPathIndex(),a=(new k).isFolder(!0).storageType(e);return this.isPublic?this.getFilesPub(t):(this.error(!1),this.storageType(e),n.loadedFiles(!1),(I.isUnd(o)||!I.isUnd(o)&&o)&&(this.timerId=setTimeout(function(){n.loadedFiles()||n.error()||(n.folders([]),n.files([]),n.loading(!0))},1500)),this.searchPattern(I.isUnd(i)?"":I.pString(i)),I.isUnd(t)||""===t.id()?(this.pathItems.removeAll(),a.displayName(this.rootPath())):a=t,this.pathItems.push(a),this.iPathIndex(this.pathItems().length-1),(r!==this.iPathIndex()||s!==this.storageType())&&(this.folders([]),this.files([])),void D.Ajax.sendExt({Action:"Files",Type:e,Path:!I.isUnd(t)&&t.isFolder()?t.fullPath():this.path(),Pattern:this.searchPattern()},this.onFilesResponse,this))},T.prototype.getFilesPub=function(e){var t=this.iPathIndex(),i=(new k).isFolder(!0);I.isUnd(e)||""===e.id()?(this.pathItems.removeAll(),i.displayName(this.rootPath())):i=e,this.pathItems.push(i),this.iPathIndex(this.pathItems().length-1),t!==this.iPathIndex()&&(this.folders([]),this.files([])),D.Ajax.sendExt({Action:"FilesPub",Hash:O.FileStoragePubHash,Path:this.path()},this.onFilesResponse,this)},T.prototype.deleteItems=function(e,t){if(t&&0<e.length){var i=_.map(e,function(e){return e.deleted(!0),{Path:e.path(),Name:e.id()}});D.Ajax.send({Action:"FilesDelete",Type:this.storageType(),Path:this.path(),Items:JSON.stringify(i)},this.onFilesDeleteResponse,this)}},T.prototype.getPathItemByIndex=function(e){var t=this.pathItems()[e],i=(new k).fileName(this.rootPath()).id("");return this.pathItems(this.pathItems().slice(0,e)),t&&!this.isPublic&&(i=t),i},T.prototype.getFullPathByIndex=function(e){var t=_.map(this.pathItems().slice(0,e),function(e){return e.fileName()});return t.join("/")},T.prototype.getFileByName=function(e){return _.find(this.files(),function(t){return t.id()===e})},T.prototype.deleteFileByName=function(e){this.files(_.filter(this.files(),function(t){return t.id()!==e}))},T.prototype.deleteFolderByName=function(e){this.folders(_.filter(this.folders(),function(t){return t.fileName()!==e}))},T.prototype.expungeFileItems=function(){this.folders(_.filter(this.folders(),function(e){return!e.deleted()},this)),this.files(_.filter(this.files(),function(e){return!e.deleted()},this))},T.prototype.expungeExternalStorages=function(e){this.storages(_.filter(this.storages(),function(t){return!t.isExternal()||_.include(e,t.storageType())},this))},T.prototype.deleteStorageByType=function(e){this.storages(_.filter(this.storages(),function(t){return t.storageType()!==e}))},T.prototype.getUploadFileByUid=function(e){return _.find(this.uploadingFiles(),function(t){return t.uploadUid()===e})},T.prototype.deleteUploadFileByUid=function(e){this.uploadingFiles(_.filter(this.uploadingFiles(),function(t){return t.uploadUid()!==e}))},T.prototype.getUploadingFiles=function(){var e=[],t=this.uploadingFiles(),i=this;return I.isUnd(t)||(e=_.filter(t,function(e){return e.path()===i.path()&&e.storageType()===i.storageType()})),e},T.prototype.onCancelUpload=function(e){this.oJua&&this.oJua.cancel(e),this.deleteUploadFileByUid(e)},T.prototype.onCreateFolderResponse=function(){this.getFiles(this.storageType(),this.getPathItemByIndex(this.iPathIndex()))},T.prototype.createFolder=function(e){return e=I.trim(e),I.validateFileOrFolderName(e)?(D.Ajax.send({Action:"FilesFolderCreate",Type:this.storageType(),Path:this.path(),FolderName:e},this.onCreateFolderResponse,this),""):I.i18n("FILESTORAGE/INVALID_FOLDER_NAME")},T.prototype.onCreateFolderClick=function(){D.Screens.showPopup(f,[_.bind(this.createFolder,this)])},T.prototype.onCreateLinkResponse=function(){this.getFiles(this.storageType(),this.getPathItemByIndex(this.iPathIndex()))},T.prototype.createLink=function(e){D.Ajax.send({Action:"FilesLinkCreate",Type:this.storageType(),Path:this.path(),Link:e.linkUrl(),Name:e.fileName()},this.onCreateLinkResponse,this)},T.prototype.onCreateLinkClick=function(){var e=_.bind(this.createLink,this);D.Screens.showPopup(m,[e])},T.prototype.onSearch=function(){this.getFiles(this.storageType(),this.getPathItemByIndex(this.iPathIndex()),this.searchPattern())},T.prototype.clearSearch=function(){this.getFiles(this.storageType(),this.getPathItemByIndex(this.iPathIndex()))},C.prototype.showLoading=function(e,t,i){this.loadingMessage(e&&""!==e?e:I.i18n("MAIN/LOADING")),this.loadingVisible(!0),this.isHtmlLoading(!!t),this.loadingVisibleClose(!!i),_.defer(_.bind(function(){this.loadingHidden(!1)},this))},C.prototype.hideLoading=function(){this.loadingHidden(!0),setTimeout(_.bind(function(){this.loadingHidden()&&this.loadingVisible(!1)},this),this.iAnimationDuration)},C.prototype.showReport=function(e,t){0!==t&&(t=t||this.iReportDuration),e&&""!==e?(this.reportMessage(e),this.reportVisible(!0),_.defer(_.bind(this.reportHidden,this,!1)),clearTimeout(this.iReportTimeout),0===t?this.reportVisibleClose(!0):(this.reportVisibleClose(!1),this.iReportTimeout=setTimeout(_.bind(this.selfHideReport,this),t))):(this.reportHidden(!0),this.reportVisible(!1))},C.prototype.selfHideReport=function(){this.reportHidden(!0),setTimeout(_.bind(function(){this.reportHidden()&&this.reportVisible(!1)},this),this.iAnimationDuration)},C.prototype.showError=function(e,t,i,o){e&&""!==e?(this.gray(!!o),this.errorMessage(e),this.isHtmlError(t),this.errorVisible(!0),_.defer(_.bind(function(){this.errorHidden(!1)},this)),clearTimeout(this.iErrorTimeout),i||(this.iErrorTimeout=setTimeout(_.bind(function(){this.selfHideError()},this),this.iErrorDuration))):this.selfHideError()},C.prototype.selfHideError=function(){this.errorHidden(!0),setTimeout(_.bind(function(){this.errorHidden()&&this.errorVisible(!1)},this),this.iAnimationDuration)},C.prototype.hideError=function(e){e=I.isUnd(e)?!1:!!e,e===this.gray()&&this.selfHideError()},P.prototype.initScreens=function(){},P.prototype.initLayout=function(){},P.prototype.init=function(){this.initScreens(),this.initLayout(),e("#pSevenContent").addClass("single_mode"),_.defer(function(){O.SingleMode||e("#pSevenContent").removeClass("single_mode")}),this.informationScreen(this.showNormalScreen(F.Screens.Information))},P.prototype.hasOpenedMinimizedPopups=function(){var e=!1;return _.each(this.popups,function(t){var i=t.__vm;i.minimized&&i.minimized()&&(e=!0)}),e},P.prototype.hasOpenedMaximizedPopups=function(){var e=!1;return _.each(this.popups,function(t){var i=t.__vm;i.minimized&&i.minimized()||(e=!0)}),e},P.prototype.getCurrentScreenModel=function(){var e=this.oScreens[this.currentScreen()],t="undefined"!=typeof e?e.Model:null;return t},P.prototype.showCurrentScreen=function(e,t){var i=this.oScreens[this.currentScreen()],o="undefined"!=typeof i?i.Model:null;this.currentScreen()!==e&&(o&&i.bInitialized&&o.hideViewModel(),this.currentScreen(e)),this.showNormalScreen(e,t),this.resizeAll()},P.prototype.showNormalScreen=function(e,t){var i=e,o=this.oScreens[i];return o&&(o.bInitialized="boolean"!=typeof o.bInitialized?!1:o.bInitialized,o.bInitialized||(o.Model=this.initViewModel(o.Model,o.TemplateName),o.bInitialized=!0),o.Model.showViewModel(t)),o?o.Model:null},P.prototype.initViewModel=function(t,o){var n=null,s=null;return n=new t,s=e('div[data-view-model="'+o+'"]').attr("data-bind","template: {name: '"+o+"'}").hide(),n.$viewModel=s,n.bShown=!1,n.showViewModel=function(e){M&&(K||D.browser.ie)?_.defer(_.bind(function(){this.$viewModel.show()},this)):this.$viewModel.show(),"function"==typeof this.onRoute&&this.onRoute(e),this.bShown||("function"==typeof this.onShow&&this.onShow(e),L.runPluginHook&&this.__name&&L.runPluginHook("view-model-on-show",[this.__name,this]),this.bShown=!0)},n.hideViewModel=function(){this.$viewModel.hide(),"function"==typeof this.onHide&&this.onHide(),this.bShown=!1},i.applyBindings(n,s[0]),"function"==typeof n.onApplyBindings&&n.onApplyBindings(s),n},P.prototype.showPopup=function(t,o){if(t){if(!t.__builded){var n=null,s=new t,r=s.popupTemplate?s.popupTemplate():"";""!==r&&(n=e('div[data-view-model="'+r+'"]').attr("data-bind","template: {name: '"+r+"'}").removeClass("visible").hide(),n&&1===n.length&&(s.visibility=i.observable(!1),t.__builded=!0,t.__vm=s,s.$viewModel=n,t.__dom=n,s.showViewModel=I.createCommand(s,function(){D&&D.Screens&&D.Screens.showPopup(t)}),s.closeCommand=I.createCommand(s,function(){D&&D.Screens&&D.Screens.hidePopup(t)}),i.applyBindings(s,n[0]),I.delegateRun(s,"onApplyBindings",[n])))}t.__vm&&t.__dom&&(t.__vm.visibility()||(t.__dom.show(),_.delay(function(){t.__dom.addClass("visible")},50),t.__vm.visibility(!0),this.popups.push(t),1===this.popups.length&&(this.keyupPopupBinded=_.bind(this.keyupPopup,this),e(document).on("keyup",this.keyupPopupBinded))),I.delegateRun(t.__vm,"onShow",o))}},P.prototype.keyupPopup=function(e){var i=this.popups.length>0?this.popups[this.popups.length-1].__vm:null;if(e&&i&&(!i.minimized||!i.minimized())){var o=t.parseInt(e.keyCode,10);F.Key.Esc===o&&(i.onEscHandler?i.onEscHandler(e):i.closeCommand()),F.Key.Enter!==o&&F.Key.Space!==o||!i.onEnterHandler||i.onEnterHandler()}},P.prototype.hidePopup=function(t){t&&t.__vm&&t.__dom&&(this.keyupPopupBinded&&1===this.popups.length&&(e(document).off("keyup",this.keyupPopupBinded),this.keyupPopupBinded=void 0),t.__dom.removeClass("visible").hide(),t.__vm.visibility(!1),I.delegateRun(t.__vm,"onHide"),this.popups=_.without(this.popups,t))},P.prototype.showLoading=function(e,t,i){this.informationScreen()&&this.informationScreen().showLoading(e,t,i)},P.prototype.hideLoading=function(){this.informationScreen()&&this.informationScreen().hideLoading()},P.prototype.showReport=function(e,t){this.informationScreen()&&this.informationScreen().showReport(e,t)},P.prototype.showError=function(e,t,i,o){this.informationScreen()&&this.informationScreen().showError(e,t,i,o)},P.prototype.hideError=function(e){this.informationScreen()&&this.informationScreen().hideError(e)},P.prototype.initHelpdesk=function(){var e=this.oScreens[F.Screens.Helpdesk];O.User.IsHelpdeskSupported&&e&&!e.bInitialized&&(e.Model=this.initViewModel(e.Model,e.TemplateName),e.bInitialized=!0)},P.prototype.initScreens=function(){this.oScreens[F.Screens.Information]={Model:C,TemplateName:"Common_InformationViewModel"},this.oScreens[F.Screens.FileStorage]={Model:T,TemplateName:"FileStorage_FileStorageViewModel"}},P.prototype.initLayout=function(){e("#pSevenContent").append(e("#FileStoragePubLayout").html())},w.prototype.init=function(){},w.prototype.collectScreensData=function(){},w.prototype.run=function(){},w.prototype.momentDateTriggerCallback=function(){var e=i.dataFor(this);e&&e.updateMomentDate&&e.updateMomentDate()},w.prototype.fastMomentDateTrigger=function(){e(".moment-date-trigger-fast").each(this.momentDateTriggerCallback)},w.prototype.setTitle=function(e){document.title=".",document.title=e||""},w.prototype.tokenProblem=function(){var e="window.location.reload(); return false;",t=I.i18n("WARNING/TOKEN_PROBLEM_HTML",{RELOAD_FUNC:e});O.Auth=!1,D.Api.showError(t,!0,!0)},_.extend(R.prototype,w.prototype),R.prototype.init=function(){O.User=new S},R.prototype.authProblem=function(){},R.prototype.run=function(){this.Screens.init(),this.Screens.showCurrentScreen(F.Screens.FileStorage)},D=new R,t.App=D,O.AllowMobile&&-1===O.IsMobile){var Y=t.matchMedia("all and (min-width: 768px)").matches?0:1;t.App.Ajax.send({Action:"SystemSetMobile",Mobile:Y},function(){Y?t.location.reload():e(function(){_.defer(function(){D.run()})})},this)}else e(function(){_.defer(function(){D.run()})});t.Modernizr&&navigator&&t.Modernizr.addTest("mobile",function(){return M}),t.AfterLogicApi=L,t.Enums=F,H.removeClass("no-js").addClass("js"),H.hasClass("pdf")&&(V.push("application/pdf"),V.push("application/x-pdf"))}(jQuery,window,ko,crossroads,hasher);
